<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/erl_lint_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id $</i>
   17:<i>%%</i>
   18:-<b>module</b>(erl_lint_SUITE).
   19:
<a name="20"></a>   20:<i>%-define(debug, true).</i>
   21:
   22:-<b>ifdef</b>(debug).
   23:-<b>define</b>(line, put(line, ?LINE), ).
   24:-<b>define</b>(config(X,Y), foo).
   25:-<b>define</b>(datadir, "erl_lint_SUITE_data").
   26:-<b>define</b>(privdir, "erl_lint_SUITE_priv").
   27:-<b>define</b>(t, test_server).
   28:-<b>else</b>.
   29:-<b>include</b>("test_server.hrl").
<a name="30"></a>   30:-<b>define</b>(datadir, ?config(data_dir, Conf)).
   31:-<b>define</b>(privdir, ?config(priv_dir, Conf)).
   32:-<b>endif</b>.
   33:
   34:-<b>export</b>([all/1, init_per_testcase/2, fin_per_testcase/2]).
   35:
   36:-<b>export</b>([unused_vars_warn/1, 
   37:             unused_vars_warn_basic/1, 
   38:             unused_vars_warn_lc/1, 
   39:             unused_vars_warn_rec/1,
<a name="40"></a>   40:             unused_vars_warn_fun/1, 
   41:         export_vars_warn/1,
   42:         unsafe_vars/1,unsafe_vars2/1,
   43:         guard/1,
   44:	 format_warn/1
   45:        ]).
   46:
   47:<i>% Default timetrap timeout (set in init_per_testcase).</i>
   48:-<b>define</b>(default_timeout, ?t:minutes(1)).
   49:
<a name=init_per_testcase><a name="50"></a>   50:<b>init_per_testcase</b></a>(Case, Config) -&gt;
   51:    ?line Dog = ?t:timetrap(?default_timeout),
   52:    [{watchdog, Dog} | Config].
   53:
<a name=fin_per_testcase>   54:<b>fin_per_testcase</b></a>(Case, Config) -&gt;
   55:    Dog = ?config(watchdog, Config),
   56:    test_server:timetrap_cancel(Dog),
   57:    ok.
   58:
<a name=all>   59:<b>all</b></a>(suite) -&gt; [unused_vars_warn, export_vars_warn, unsafe_vars, 
<a name="60"></a>   60:               unsafe_vars2, guard, format_warn].
   61:
<a name=unused_vars_warn>   62:<b>unused_vars_warn</b></a>(suite) -&gt;
   63:    [unused_vars_warn_basic, unused_vars_warn_lc, unused_vars_warn_rec, 
   64:     unused_vars_warn_fun].
   65:
<a name=unused_vars_warn_basic>   66:<b>unused_vars_warn_basic</b></a>(doc) -&gt;
   67:    "Warnings for unused variables in some simple cases.";
<a name=unused_vars_warn_basic>   68:<b>unused_vars_warn_basic</b></a>(suite) -&gt; [];
<a name=unused_vars_warn_basic>   69:<b>unused_vars_warn_basic</b></a>(Config) when list(Config) -&gt;
<a name="70"></a>   70:    Ts = [{basic1,
   71:           &lt;&lt;"f(F) -&gt; % F unused.
   72:                ok.
   73:
   74:            f(F, F) -&gt;
   75:                ok.
   76:
   77:            g(_X) -&gt;
   78:                y.
   79:
<a name="80"></a>   80:            h(P) -&gt;
   81:                P.
   82:
   83:            x(N) -&gt;
   84:                case a:b() of
   85:                    [N|Y] -&gt; % Y unused.
   86:                        ok
   87:                end.
   88:
   89:            y(N, L) -&gt;
<a name="90"></a>   90:                lists:map(fun(T) -&gt; T*N end, L).
   91:
   92:            z(N, L) -&gt; % N unused
   93:                lists:map(fun(N, T) -&gt; T*N end, L).  % N shadowed.
   94:
   95:
   96:            c(A) -&gt;
   97:                case A of
   98:                    _ -&gt; B = []; % B unused.
   99:                    _ -&gt; B = []; % B unused.
<a name="100"></a>  100:                    _ -&gt; B = f, B
  101:                end.
  102:           "&gt;&gt;,
  103:	   [warn_unused_vars],
  104:	   {warnings,[{1,erl_lint,{unused_var,'F'}},
  105:             {15,erl_lint,{unused_var,'Y'}},
  106:             {22,erl_lint,{unused_var,'N'}},
  107:             {23,erl_lint,{shadowed_var,'N','fun'}},
  108:             {28,erl_lint,{unused_var,'B'}},
  109:             {29,erl_lint,{unused_var,'B'}}]}}],
<a name="110"></a>  110:    ?line [] = run(Config, Ts),
  111:    ok.
  112:
<a name=unused_vars_warn_lc>  113:<b>unused_vars_warn_lc</b></a>(doc) -&gt;
  114:    "Warnings for unused variables in list comprehensions.";
<a name=unused_vars_warn_lc>  115:<b>unused_vars_warn_lc</b></a>(suite) -&gt; [];
<a name=unused_vars_warn_lc>  116:<b>unused_vars_warn_lc</b></a>(Config) when list(Config) -&gt;
  117:    Ts = [{lc1, 
  118:           &lt;&lt;"bin(X) -&gt;
  119:                  [A || &lt;&lt;A:X&gt;&gt; &lt;- []]; % X used, not shadowed.
<a name="120"></a>  120:              bin(X) -&gt;
  121:                  [X || &lt;&lt;X:X&gt;&gt; &lt;- []]; % X used, and shadowed.
  122:              bin({X,Y,Z}) -&gt;
  123:                  [{A,B} || &lt;&lt;A:X&gt;&gt; &lt;- Z, &lt;&lt;B:Y&gt;&gt; &lt;- Z];
  124:              bin({X,Y,Z}) -&gt; % Y unused.
  125:                  [C || &lt;&lt;V:X&gt;&gt; &lt;- Z, &lt;&lt;B:V&gt;&gt; &lt;- Z, &lt;&lt;C:B&gt;&gt; &lt;- Z].
  126:           "&gt;&gt;, 
  127:           [warn_unused_vars],
  128:           {warnings, [{4,erl_lint,{shadowed_var,'X',generate}},
  129:                       {7,erl_lint,{unused_var,'Y'}}]}},
<a name="130"></a>  130:
  131:          {lc2,
  132:           &lt;&lt;"bin(X) -&gt;
  133:                  [A || &lt;&lt;A:X&gt;&gt; &lt;- []]; % X used, not shadowed.
  134:              bin(X) -&gt;
  135:                  [X || &lt;&lt;X:X&gt;&gt; &lt;- []]; % X used, and shadowed.
  136:              bin({X,Y,Z}) -&gt;
  137:                  [{A,B} || &lt;&lt;A:X&gt;&gt; &lt;- Z, &lt;&lt;B:Y&gt;&gt; &lt;- Z];
  138:              bin({X,Y,Z}) -&gt; % Y unused.
  139:                  [C || &lt;&lt;V:X&gt;&gt; &lt;- Z, &lt;&lt;B:V&gt;&gt; &lt;- Z, &lt;&lt;C:B&gt;&gt; &lt;- Z].
<a name="140"></a>  140:           "&gt;&gt;,
  141:           [warn_unused_vars],
  142:           {warnings,[{4,erl_lint,{shadowed_var,'X',generate}},
  143:                      {7,erl_lint,{unused_var,'Y'}}]}},
  144:
  145:          {lc3,
  146:           &lt;&lt;"a(A) -&gt;
  147:                  B = foo,
  148:                  [{C,B} || {C,_} &lt;- A];
  149:              a(A) -&gt;
<a name="150"></a>  150:                  B = foo,
  151:                  [C || {C,_} &lt;- [B,A]];
  152:              a(A) -&gt;
  153:                  B = foo,
  154:                  [C || {C,_} &lt;- B, B &lt; A].
  155:           "&gt;&gt;,
  156:           [warn_unused_vars],
  157:           []},
  158:
  159:          {lc4,
<a name="160"></a>  160:           &lt;&lt;"b(A) -&gt;
  161:                  B = foo, % B unused.
  162:                  [C || {C,_} &lt;- A].
  163:           "&gt;&gt;,
  164:           [warn_unused_vars],
  165:           {warnings,[{2,erl_lint,{unused_var,'B'}}]}},
  166:
  167:          {lc5,
  168:           &lt;&lt;"c(A) -&gt;
  169:                  B = foo,
<a name="170"></a>  170:                  [C || {C,_} &lt;- A],
  171:                  B.
  172:           "&gt;&gt;,
  173:           [warn_unused_vars],
  174:           []},
  175:
  176:          {lc6,
  177:           &lt;&lt;"d(A) -&gt;
  178:                  B = foo,
  179:                  [{A,B} || {Id,_} &lt;- A]. % Id unused.
<a name="180"></a>  180:           "&gt;&gt;,
  181:           [warn_unused_vars],
  182:           {warnings,[{3,erl_lint,{unused_var,'Id'}}]}},
  183:
  184:          {lc7,
  185:           &lt;&lt;"e(A) -&gt;
  186:                  B = foo, % B unused.
  187:                  [B || B &lt;- A]. % B shadowed.
  188:           "&gt;&gt;,
  189:           [warn_unused_vars],
<a name="190"></a>  190:           {warnings,[{2,erl_lint,{unused_var,'B'}},
  191:                      {3,erl_lint,{shadowed_var,'B',generate}}]}},
  192:
  193:          {lc8,
  194:           &lt;&lt;"f(A) -&gt;
  195:                  B = foo,
  196:                  [B || B &lt;- A], % B shadowed.
  197:                  B.
  198:           "&gt;&gt;,
  199:           [warn_unused_vars],
<a name="200"></a>  200:           {warnings,[{3,erl_lint,{shadowed_var,'B',generate}}]}},
  201:
  202:          {lc9,
  203:           &lt;&lt;"g(A) -&gt;
  204:                  B = foo, % B unused.
  205:                  [A || B &lt;- A]. % B shadowed, B unused.
  206:           "&gt;&gt;,
  207:           [warn_unused_vars],
  208:           {warnings,[{2,erl_lint,{unused_var,'B'}},
  209:                      {3,erl_lint,{shadowed_var,'B',generate}},
<a name="210"></a>  210:                      {3,erl_lint,{unused_var,'B'}}]}},
  211:
  212:          {lc10,
  213:           &lt;&lt;"h(A) -&gt;
  214:                  B = foo,
  215:                  [A || B &lt;- A], % B shadowed, B unused.
  216:                  B.
  217:           "&gt;&gt;,
  218:           [warn_unused_vars],
  219:           {warnings,[{3,erl_lint,{shadowed_var,'B',generate}},
<a name="220"></a>  220:                      {3,erl_lint,{unused_var,'B'}}]}},
  221:
  222:          {lc11,
  223:           &lt;&lt;"i(X) -&gt;
  224:                  [Z || Z &lt;- X, % Z unused.
  225:                        Z = X &lt;- [foo]]. % X and Z shadowed. X unused!
  226:           "&gt;&gt;,
  227:           [warn_unused_vars],
  228:           {warnings,[{2,erl_lint,{unused_var,'Z'}},
  229:                      {3,erl_lint,{shadowed_var,'X',generate}},
<a name="230"></a>  230:                      {3,erl_lint,{shadowed_var,'Z',generate}},
  231:                      {3,erl_lint,{unused_var,'X'}}]}},
  232:
  233:          {lc12,
  234:           &lt;&lt;"j(X) -&gt;
  235:                  [Z || Z &lt;- X, % Z unused.
  236:                        Z &lt;- X = [[1,2,3]], % Z shadowed. Z unused.
  237:                        Z &lt;- X, % Z shadowed. Z unused.
  238:                        Z &lt;- X]; % Z shadowed.
  239:              j(X) -&gt;
<a name="240"></a>  240:                  [foo || X &lt;- X, % X shadowed.
  241:                        X &lt;-    % X shadowed. X unused.
  242:                             X = 
  243:                                 Y = [[1,2,3]], % Y unused.
  244:                        X &lt;- [], % X shadowed.
  245:                        X &lt;- X]. % X shadowed. X unused.
  246:           "&gt;&gt;,
  247:           [warn_unused_vars],
  248:           {warnings,[{2,erl_lint,{unused_var,'Z'}},
  249:                      {3,erl_lint,{shadowed_var,'Z',generate}},
<a name="250"></a>  250:                      {3,erl_lint,{unused_var,'Z'}},
  251:                      {4,erl_lint,{shadowed_var,'Z',generate}},
  252:                      {4,erl_lint,{unused_var,'Z'}},
  253:                      {5,erl_lint,{shadowed_var,'Z',generate}},
  254:                      {7,erl_lint,{shadowed_var,'X',generate}},
  255:                      {8,erl_lint,{shadowed_var,'X',generate}},
  256:                      {8,erl_lint,{unused_var,'X'}},
  257:                      {10,erl_lint,{unused_var,'Y'}},
  258:                      {11,erl_lint,{shadowed_var,'X',generate}},
  259:                      {12,erl_lint,{shadowed_var,'X',generate}},
<a name="260"></a>  260:                      {12,erl_lint,{unused_var,'X'}}]}},
  261:
  262:          {lc13,
  263:           &lt;&lt;"k(X) -&gt;
  264:                  [Z || Z &lt;- Y = X]; % Y unused.
  265:              k(X) -&gt;
  266:                  [Z || Z &lt;- X = Y = X]; % Y unused!
  267:              k(X) -&gt;
  268:                  [Z || Z &lt;- begin X = Y = X, Y end];
  269:              k(X) -&gt;
<a name="270"></a>  270:                  [{Y,W} || W &lt;- Y = X]; % Y unbound
  271:              k(X) -&gt;
  272:                  [Z || Z &lt;- (Y = X), % Y unused.
  273:                       Y &gt; X]; % Y unbound.
  274:              k(X) -&gt;
  275:                  [Y || Y = X &gt; 3, Z = X]; % Z unused.
  276:              k(X) -&gt;
  277:                  [Z || Y = X &gt; 3, Z = X]. % Y unused.
  278:           "&gt;&gt;,
  279:           [warn_unused_vars],
<a name="280"></a>  280:           {error,[{8,erl_lint,{unbound_var,'Y'}},
  281:                   {11,erl_lint,{unbound_var,'Y'}}],
  282:                  [{2,erl_lint,{unused_var,'Y'}},
  283:                   {4,erl_lint,{unused_var,'Y'}},
  284:                   {8,erl_lint,{unused_var,'Y'}},
  285:                   {10,erl_lint,{unused_var,'Y'}},
  286:                   {13,erl_lint,{unused_var,'Z'}},
  287:                   {13,erl_lint,no_generator},
  288:                   {15,erl_lint,{unused_var,'Y'}},
  289:		   {15,erl_lint,no_generator}]}},
<a name="290"></a>  290:
  291:          {lc14,
  292:           &lt;&lt;"lc2() -&gt;
  293:                  Z = [[1],[2],[3]], 
  294:                  [X || Z &lt;- Z, % Z shadowed.
  295:                        X &lt;- Z].
  296:           "&gt;&gt;,
  297:           [warn_unused_vars],
  298:           {warnings,[{3,erl_lint,{shadowed_var,'Z',generate}}]}},
  299:
<a name="300"></a>  300:          {lc15,
  301:           &lt;&lt;"lc3() -&gt;
  302:                  Z = [1,2,3], 
  303:                  [X || X &lt;- Z, 
  304:                        Z &lt;- Z]. % Z shadowed. Z unused.
  305:           "&gt;&gt;,
  306:           [warn_unused_vars],
  307:           {warnings,[{4,erl_lint,{shadowed_var,'Z',generate}},
  308:                      {4,erl_lint,{unused_var,'Z'}}]}},
  309:
<a name="310"></a>  310:          {lc16,
  311:           &lt;&lt;"bin(Z) -&gt;
  312:                  case bar of
  313:                      true -&gt;
  314:                          U = 2;
  315:                      false -&gt;
  316:                          true
  317:                  end,
  318:                  case bar of
  319:                      true -&gt;
<a name="320"></a>  320:                          X = 2;
  321:                      false -&gt;
  322:                          X = 3
  323:                  end,
  324:                  case foo of
  325:                      true -&gt;
  326:                          Y = 3; % Y unused.
  327:                      false -&gt;
  328:                          4
  329:                  end,
<a name="330"></a>  330:                  case foo of
  331:                      1 -&gt;
  332:                          U; % U unsafe.
  333:                      2 -&gt;
  334:                          [Z || &lt;&lt;U:X&gt;&gt; &lt;- Z]; % (X exported.) U unused.
  335:                      3 -&gt;
  336:                          [Z || &lt;&lt;U:X&gt;&gt; &lt;- Z], % (X exported.) U unused.
  337:                          U % U unsafe.
  338:                  end.
  339:           "&gt;&gt;,
<a name="340"></a>  340:           [warn_unused_vars],
  341:           {error,[{22,erl_lint,{unsafe_var,'U',{'case',2}}},
  342:                   {27,erl_lint,{unsafe_var,'U',{'case',2}}}],
  343:            [{16,erl_lint,{unused_var,'Y'}},
  344:     %  {24,erl_lint,{exported_var,'X',{'case',8}}},
  345:             {24,erl_lint,{unused_var,'U'}},
  346:     %  {26,erl_lint,{exported_var,'X',{'case',8}}},
  347:             {26,erl_lint,{unused_var,'U'}}]}},
  348:
  349:          {lc17,
<a name="350"></a>  350:           &lt;&lt;"bin(Z) -&gt;
  351:                  %% This used to pass erl_lint...
  352:                  case bar of
  353:                      true -&gt;
  354:                          U = 2;
  355:                      false -&gt;
  356:                          true
  357:                  end,
  358:                  case bar of
  359:                      true -&gt;
<a name="360"></a>  360:                          X = 2;
  361:                      false -&gt;
  362:                          X = 3
  363:                  end,
  364:                  case foo of
  365:                      true -&gt;
  366:                          Y = 3; % Y unused.
  367:                      false -&gt;
  368:                          4
  369:                  end,
<a name="370"></a>  370:                  [Z || &lt;&lt;U:X&gt;&gt; &lt;- Z], % (X exported.) U unused.
  371:                  U. % U unsafe.
  372:           "&gt;&gt;,
  373:           [warn_unused_vars],
  374:           {error,[{22,erl_lint,{unsafe_var,'U',{'case',3}}}],
  375:            [{17,erl_lint,{unused_var,'Y'}},
  376:     %  {21,erl_lint,{exported_var,'X',{'case',9}}},
  377:             {21,erl_lint,{unused_var,'U'}}]}},
  378:
  379:          {lc18,
<a name="380"></a>  380:           &lt;&lt;"bin(Z) -&gt;
  381:                  case bar of
  382:                      true -&gt;
  383:                          U = 2;
  384:                      false -&gt;
  385:                          true
  386:                  end,
  387:                  case bar of
  388:                      true -&gt;
  389:                          X = 2;
<a name="390"></a>  390:                      false -&gt;
  391:                          X = 3
  392:                  end,
  393:                  case foo of
  394:                      true -&gt;
  395:                          Y = 3;
  396:                      false -&gt;
  397:                          4
  398:                  end,
  399:                  [B || &lt;&lt;U: % U unused
<a name="400"></a>  400:                          U&gt;&gt; &lt;- X, &lt;&lt;B:Y&gt;&gt; &lt;- Z]. % U unsafe. Y unsafe. 
  401:                                                   % U shadowed. (X exported.)
  402:           "&gt;&gt;,
  403:           [warn_unused_vars],
  404:           {error,[{21,erl_lint,{unsafe_var,'U',{'case',2}}},
  405:                   {21,erl_lint,{unsafe_var,'Y',{'case',14}}}],
  406:            [{20,erl_lint,{unused_var,'U'}},
  407:     %       {21,erl_lint,{exported_var,'X',{'case',8}}},
  408:             {21,erl_lint,{shadowed_var,'U',generate}}]}},
  409:
<a name="410"></a>  410:          {lc19,
  411:           &lt;&lt;"p({B,C}) -&gt;
  412:                  &lt;&lt;A:B,A:C&gt;&gt; = &lt;&lt;17:32&gt;&gt;;
  413:              p(B) -&gt;
  414:                  &lt;&lt;A:B&gt;&gt; = &lt;&lt;17:32&gt;&gt;. % A unused.
  415:           "&gt;&gt;,
  416:           [warn_unused_vars],
  417:           {warnings,[{4,erl_lint,{unused_var,'A'}}]}},
  418:
  419:          {lc20,
<a name="420"></a>  420:           &lt;&lt;"c({I1,I2}) -&gt;
  421:                  if
  422:                      &lt;&lt;I1:I2&gt;&gt; == &lt;&lt;&gt;&gt; -&gt;
  423:                          foo
  424:                  end;
  425:              c({C1,C2}) -&gt; % C1 unused.
  426:                  case foo of
  427:                      &lt;&lt;C2:C2,
  428:                        C3:C2&gt;&gt; -&gt; % C3 unused.
  429:                          bar
<a name="430"></a>  430:                  end.
  431:
  432:           "&gt;&gt;,
  433:           [warn_unused_vars],
  434:           {warnings,[{6,erl_lint,{unused_var,'C1'}},
  435:                      {9,erl_lint,{unused_var,'C3'}}]}},
  436:
  437:          {lc21,
  438:           &lt;&lt;"t() -&gt;
  439:                  S = 8,
<a name="440"></a>  440:                  case &lt;&lt;3:8&gt;&gt; of
  441:                      &lt;&lt;X:S&gt;&gt; -&gt;
  442:                          X;
  443:                      &lt;&lt;S:X&gt;&gt; -&gt; % X unbound
  444:                          foo
  445:                  end;
  446:              t() -&gt;
  447:                  S = 8,
  448:                  case &lt;&lt;3:8&gt;&gt; of
  449:                      &lt;&lt;S:S&gt;&gt; -&gt;
<a name="450"></a>  450:                          S;
  451:                      &lt;&lt;Q:32&gt;&gt; -&gt; % Q unused.
  452:                          foo
  453:                  end.
  454:           "&gt;&gt;,
  455:           [warn_unused_vars],
  456:           {error,[{6,erl_lint,{unbound_var,'X'}}],
  457:                  [{14,erl_lint,{unused_var,'Q'}}]}}
  458:
  459:          ],
<a name="460"></a>  460:    ?line [] = run(Config, Ts),
  461:    ok.
  462:
  463:
<a name=unused_vars_warn_rec>  464:<b>unused_vars_warn_rec</b></a>(doc) -&gt;
  465:    "Warnings for unused variables in records.";
<a name=unused_vars_warn_rec>  466:<b>unused_vars_warn_rec</b></a>(suite) -&gt; [];
<a name=unused_vars_warn_rec>  467:<b>unused_vars_warn_rec</b></a>(Config) when list(Config) -&gt;
  468:    Ts = [{rec1, % An example provided by Bjorn.
  469:           &lt;&lt;"-record(edge,
<a name="470"></a>  470:                      {ltpr,
  471:                       ltsu,
  472:                       rtpr,
  473:                       rtsu
  474:                      }).
  475:
  476:              f1(#edge{ltpr = A, ltsu = A}) -&gt;
  477:                  true;
  478:              f1({Q, Q}) -&gt;
  479:                  true.
<a name="480"></a>  480:
  481:              f2(Edge, Etab) -&gt;
  482:                  case gb_trees:lookup(Edge, Etab) of
  483:                      {value,#edge{ltpr=Same,ltsu=Same}} -&gt; ok;
  484:                      {value,_} -&gt; error
  485:                  end.
  486:
  487:              bar(Edge, Etab) -&gt;
  488:                  case gb_trees:lookup(Edge, Etab) of
  489:                      {Same,Same} -&gt; ok;
<a name="490"></a>  490:                      {value,#edge{ltpr=Same}} -&gt; ok; % Same unused.
  491:                      {value,_} -&gt; error
  492:                  end.
  493:           "&gt;&gt;,
  494:           [warn_unused_vars],
  495:           {warnings,[{22,erl_lint,{unused_var,'Same'}}]}}],
  496:    ?line [] = run(Config, Ts),
  497:    ok.
  498:
<a name=unused_vars_warn_fun>  499:<b>unused_vars_warn_fun</b></a>(doc) -&gt;
<a name="500"></a>  500:    "Warnings for unused variables in records.";
<a name=unused_vars_warn_fun>  501:<b>unused_vars_warn_fun</b></a>(suite) -&gt; [];
<a name=unused_vars_warn_fun>  502:<b>unused_vars_warn_fun</b></a>(Config) when list(Config) -&gt;
  503:    Ts = [{fun1,
  504:           &lt;&lt;"a({A,B}) -&gt; % A unused.
  505:                  fun(A) -&gt; B end; % A shadowed. A unused.
  506:              a({A,B}) -&gt;
  507:                  fun(&lt;&lt;A:B&gt;&gt;, % A shadowed. A unused.
  508:                       &lt;&lt;Q:A&gt;&gt;) -&gt; foo % Q unused.
  509:                  end;
<a name="510"></a>  510:              a({A,B,C,D,E}) -&gt;
  511:                  fun(E) when C == &lt;&lt;A:A&gt;&gt;, &lt;&lt;17:B&gt;&gt; == D -&gt; % E shadowed. E unused.
  512:                          foo
  513:                  end,
  514:                  E;
  515:              a({A,B,C,D,E}) -&gt; % E unused.
  516:                  fun() -&gt;
  517:                          (C == &lt;&lt;A:A&gt;&gt;) and (&lt;&lt;17:B&gt;&gt; == D)
  518:                  end.
  519:           "&gt;&gt;,
<a name="520"></a>  520:           [warn_unused_vars],
  521:           {warnings,[{1,erl_lint,{unused_var,'A'}},
  522:                  {2,erl_lint,{shadowed_var,'A','fun'}},
  523:                  {2,erl_lint,{unused_var,'A'}},
  524:                  {4,erl_lint,{shadowed_var,'A','fun'}},
  525:                  {4,erl_lint,{unused_var,'A'}},
  526:                  {5,erl_lint,{unused_var,'Q'}},
  527:                  {8,erl_lint,{shadowed_var,'E','fun'}},
  528:                  {8,erl_lint,{unused_var,'E'}},
  529:                  {12,erl_lint,{unused_var,'E'}}]}},
<a name="530"></a>  530:
  531:          {fun2,
  532:           &lt;&lt;"u() -&gt;
  533:                  case foo of
  534:                      true -&gt;
  535:                          U = 2;
  536:                      false -&gt;
  537:                          true
  538:                  end,
  539:                  fun(U) -&gt; foo end, % U unused.
<a name="540"></a>  540:                  U; % U unsafe.
  541:              u() -&gt;
  542:                  case foo of
  543:                      true -&gt;
  544:                          U = 2;
  545:                      false -&gt;
  546:                          U = 3
  547:                  end,
  548:                  fun(U) -&gt; foo end, % U shadowed. U unused.
  549:                  U;
<a name="550"></a>  550:              u() -&gt;
  551:                  case foo of
  552:                      true -&gt;
  553:                          U = 2; % U unused.
  554:                      false -&gt;
  555:                          U = 3 % U unused.
  556:                  end,
  557:                  fun(U) -&gt; foo end. % U shadowed. U unused.
  558:           "&gt;&gt;,
  559:           [warn_unused_vars],
<a name="560"></a>  560:           {error,[{9,erl_lint,{unsafe_var,'U',{'case',2}}}],
  561:              [{8,erl_lint,{unused_var,'U'}},
  562:               {17,erl_lint,{shadowed_var,'U','fun'}},
  563:               {17,erl_lint,{unused_var,'U'}},
  564:               {22,erl_lint,{unused_var,'U'}},
  565:               {24,erl_lint,{unused_var,'U'}},
  566:               {26,erl_lint,{shadowed_var,'U','fun'}},
  567:               {26,erl_lint,{unused_var,'U'}}]}}
  568:          ],
  569:    ?line [] = run(Config, Ts),
<a name="570"></a>  570:    ok.
  571:
<a name=export_vars_warn>  572:<b>export_vars_warn</b></a>(doc) -&gt;
  573:    "Warnings for exported variables";
<a name=export_vars_warn>  574:<b>export_vars_warn</b></a>(suite) -&gt; [];
<a name=export_vars_warn>  575:<b>export_vars_warn</b></a>(Config) when list(Config) -&gt;
  576:    Ts = [{exp1,
  577:           &lt;&lt;"u() -&gt;
  578:                  case foo of
  579:                      1 -&gt;
<a name="580"></a>  580:                          A = 1,
  581:                          B = 2,
  582:                          W = 3, % W unused.
  583:                          Z = 3; % Z unused.
  584:                      2 -&gt;
  585:                          B = 2,
  586:                          Z = 4 % Z unused.
  587:                  end,
  588:                  case bar of
  589:                      true -&gt;
<a name="590"></a>  590:                          A = 17, % A unsafe.
  591:                          X = 3, % X unused.
  592:                          U = 2,
  593:                          U;
  594:                      false -&gt;
  595:                          B = 19, % B exported.
  596:                          U = 3; % U unused.
  597:                      foo -&gt;
  598:                          X = 3,
  599:                          X;
<a name="600"></a>  600:                      bar -&gt;
  601:                          X = 9, % X unused.
  602:                          U = 14 % U unused.
  603:                  end.
  604:           "&gt;&gt;,
  605:           [warn_unused_vars],
  606:           {error,[{14,erl_lint,{unsafe_var,'A',{'case',2}}}],
  607:                  [{6,erl_lint,{unused_var,'W'}},
  608:                   {7,erl_lint,{unused_var,'Z'}},
  609:                   {10,erl_lint,{unused_var,'Z'}},
<a name="610"></a>  610:                   {15,erl_lint,{unused_var,'X'}},
  611:                   {19,erl_lint,{exported_var,'B',{'case',2}}},
  612:                   {20,erl_lint,{unused_var,'U'}},
  613:                   {25,erl_lint,{unused_var,'X'}},
  614:                   {26,erl_lint,{unused_var,'U'}}]}},
  615:
  616:          {exp2,
  617:           &lt;&lt;"bin(A) -&gt;
  618:                  receive
  619:                      M -&gt;
<a name="620"></a>  620:                           X = M,
  621:                           Y = M,
  622:                           Z = M
  623:                  end,
  624:                  [B || &lt;&lt;B:X&gt;&gt; &lt;- A], % X exported.
  625:                  Y = B, % Y exported. B unbound.
  626:                  [B || B &lt;- Z]. % Z exported. B shadowed.
  627:           "&gt;&gt;,
  628:           [warn_export_vars],
  629:           {error,[{9,erl_lint,{unbound_var,'B'}}],
<a name="630"></a>  630:                  [{8,erl_lint,{exported_var,'X',{'receive',2}}},
  631:                   {9,erl_lint,{exported_var,'Y',{'receive',2}}},
  632:                   {10,erl_lint,{exported_var,'Z',{'receive',2}}},
  633:                   {10,erl_lint,{shadowed_var,'B',generate}}]}},
  634:
  635:          {exp3,
  636:           &lt;&lt;"bin(A) -&gt;
  637:                  receive
  638:                      M -&gt;
  639:                           X = M,
<a name="640"></a>  640:                           Y = M,
  641:                           Z = M
  642:                  end,
  643:                  [B || &lt;&lt;B:X&gt;&gt; &lt;- A], % (X exported.)
  644:                  Y = B, % Y exported. B unbound.
  645:                  [B || B &lt;- Z]. % (Z exported.) B shadowed.
  646:           "&gt;&gt;,
  647:           [],
  648:           {error,[{9,erl_lint,{unbound_var,'B'}}],
  649:                  [{9,erl_lint,{exported_var,'Y',{'receive',2}}},
<a name="650"></a>  650:                   {10,erl_lint,{shadowed_var,'B',generate}}]}}
  651:         ],
  652:    ?line [] = run(Config, Ts),
  653:    ok.
  654:
<a name=unsafe_vars>  655:<b>unsafe_vars</b></a>(doc) -&gt;
  656:    "OTP-4671. Errors for unsafe variables";
<a name=unsafe_vars>  657:<b>unsafe_vars</b></a>(suite) -&gt; [];
<a name=unsafe_vars>  658:<b>unsafe_vars</b></a>(Config) when list(Config) -&gt;
  659:    Ts = [{unsafe1,
<a name="660"></a>  660:           &lt;&lt;"t() -&gt;
  661:                 (X = true) orelse (Y = false),
  662:                  Y.
  663:           "&gt;&gt;,
  664:           [warn_unused_vars],
  665:           {error,[{3,erl_lint,{unsafe_var,'Y',{'orelse',2}}}],
  666:            [{2,erl_lint,{unused_var,'X'}}]}},
  667:          {unsafe2,
  668:           &lt;&lt;"t2() -&gt;
  669:                  (X = true) orelse (Y = false),
<a name="670"></a>  670:                  X.
  671:           "&gt;&gt;,
  672:           [warn_unused_vars],
  673:           {warnings,[{2,erl_lint,{unused_var,'Y'}}]}},
  674:          {unsafe3,
  675:           &lt;&lt;"t3() -&gt;
  676:                  (X = true) andalso (Y = false),
  677:                  Y.
  678:           "&gt;&gt;,
  679:           [warn_unused_vars],
<a name="680"></a>  680:           {error,[{3,erl_lint,{unsafe_var,'Y',{'andalso',2}}}],
  681:            [{2,erl_lint,{unused_var,'X'}}]}},
  682:          {unsafe4,
  683:           &lt;&lt;"t4() -&gt;
  684:                  (X = true) andalso (true = X),
  685:                  X.
  686:           "&gt;&gt;,
  687:           [warn_unused_vars],
  688:           []},
  689:          {unsafe5,
<a name="690"></a>  690:           &lt;&lt;"t5() -&gt;
  691:                  Y = 3,
  692:                  (X = true) andalso (X = true),
  693:                  {X,Y}.
  694:           "&gt;&gt;,
  695:           [warn_unused_vars],
  696:           []},
  697:          {unsafe6,
  698:           &lt;&lt;"t6() -&gt;
  699:                  X = true,
<a name="700"></a>  700:                  (X = true) andalso (true = X),
  701:                  X.
  702:           "&gt;&gt;,
  703:           [warn_unused_vars],
  704:           []},
  705:          {unsafe7,
  706:           &lt;&lt;"t7() -&gt;
  707:                  (if true -&gt; X = 3; false -&gt; true end) 
  708:                      andalso (X &gt; 2),
  709:                  X.
<a name="710"></a>  710:           "&gt;&gt;,
  711:           [warn_unused_vars],
  712:           {errors,[{3,erl_lint,{unsafe_var,'X',{'if',2}}},
  713:                    {4,erl_lint,{unsafe_var,'X',{'if',2}}}],
  714:            []}}
  715:         ],
  716:    ?line [] = run(Config, Ts),
  717:    ok.
  718:
<a name=unsafe_vars2>  719:<b>unsafe_vars2</b></a>(doc) -&gt;
<a name="720"></a>  720:    "OTP-4831, seq8202. No warn_unused_vars and unsafe variables";
<a name=unsafe_vars2>  721:<b>unsafe_vars2</b></a>(suite) -&gt; [];
<a name=unsafe_vars2>  722:<b>unsafe_vars2</b></a>(Config) when list(Config) -&gt;
  723:    Ts = [{unsafe2_1,
  724:           &lt;&lt;"foo(State) -&gt;
  725:                  case State of
  726:                      true -&gt;
  727:                          if
  728:                              false -&gt; ok;
  729:                              true -&gt;  State1=State
<a name="730"></a>  730:                          end
  731:                  end,
  732:                  State1. % unsafe
  733:           "&gt;&gt;,
  734:           [warn_unused_vars],
  735:           {errors,[{9,erl_lint,{unsafe_var,'State1',{'if',4}}}],[]}},
  736:          {unsafe2_2,
  737:           &lt;&lt;"foo(State) -&gt;
  738:                  case State of
  739:                      true -&gt;
<a name="740"></a>  740:                          if
  741:                              false -&gt; ok;
  742:                              true -&gt;  State1=State
  743:                          end
  744:                  end,
  745:                  State1. % unsafe
  746:           "&gt;&gt;,
  747:           [],
  748:           {errors,[{9,erl_lint,{unsafe_var,'State1',{'if',4}}}],[]}}
  749:         ],
<a name="750"></a>  750:    ?line [] = run(Config, Ts),
  751:    ok.
  752:
<a name=guard>  753:<b>guard</b></a>(doc) -&gt;
  754:    "OTP-4670. Guards, is_record in particular.";
<a name=guard>  755:<b>guard</b></a>(suite) -&gt; [];
<a name=guard>  756:<b>guard</b></a>(Config) when list(Config) -&gt;
  757:    %% Well, these could be plain code...
  758:    Ts = [{guard1,
  759:           &lt;&lt;"-record(apa, {}).
<a name="760"></a>  760:              t(A) when atom(A) -&gt;
  761:                  atom;
  762:              t(A) when binary(A) -&gt;
  763:                  binary;
  764:              t(A) when constant(A) -&gt;
  765:                  constant;
  766:              t(A) when float(A) -&gt;
  767:                  float;
  768:              t(A) when function(A) -&gt;
  769:                  function;
<a name="770"></a>  770:              t(A) when integer(A) -&gt;
  771:                  integer;
  772:              t(A) when is_atom(A) -&gt;
  773:                  is_atom;
  774:              t(A) when is_binary(A) -&gt;
  775:                  is_binary;
  776:              t(A) when is_constant(A) -&gt;
  777:                  is_constant;
  778:              t(A) when is_float(A) -&gt;
  779:                  is_float;
<a name="780"></a>  780:              t(A) when is_function(A) -&gt;
  781:                  is_function;
  782:              t(A) when is_integer(A) -&gt;
  783:                  is_integer;
  784:              t(A) when is_list(A) -&gt;
  785:                  is_list;
  786:              t(A) when is_number(A) -&gt;
  787:                  is_number;
  788:              t(A) when is_pid(A) -&gt;
  789:                  is_pid;
<a name="790"></a>  790:              t(A) when is_port(A) -&gt;
  791:                  is_port;
  792:              t(A) when is_record(A, apa) -&gt;
  793:                  is_record;
  794:              t(A) when is_reference(A) -&gt;
  795:                  is_reference;
  796:              t(A) when is_tuple(A) -&gt;
  797:                  is_tuple;
  798:              t(A) when list(A) -&gt;
  799:                  list;
<a name="800"></a>  800:              t(A) when number(A) -&gt;
  801:                  number;
  802:              t(A) when pid(A) -&gt;
  803:                  pid;
  804:              t(A) when port(A) -&gt;
  805:                  port;
  806:              t(A) when record(A, apa) -&gt;
  807:                  record;
  808:              t(A) when reference(A) -&gt;
  809:                  reference;
<a name="810"></a>  810:              t(A) when tuple(A) -&gt;
  811:                  tuple.
  812:           "&gt;&gt;,
  813:           [],
  814:           []},
  815:          {guard2,
  816:           &lt;&lt;"-record(apa,{}).
  817:              t1(A) when atom(A), atom(A) -&gt;
  818:                  atom;
  819:              t1(A) when binary(A), binary(A) -&gt;
<a name="820"></a>  820:                  binary;
  821:              t1(A) when constant(A), constant(A) -&gt;
  822:                  constant;
  823:              t1(A) when float(A), float(A) -&gt;
  824:                  float;
  825:              t1(A) when function(A), function(A) -&gt;
  826:                  function;
  827:              t1(A) when integer(A), integer(A) -&gt;
  828:                  integer;
  829:              t1(A) when is_atom(A), is_atom(A) -&gt;
<a name="830"></a>  830:                  is_atom;
  831:              t1(A) when is_binary(A), is_binary(A) -&gt;
  832:                  is_binary;
  833:              t1(A) when is_constant(A), is_constant(A) -&gt;
  834:                  is_constant;
  835:              t1(A) when is_float(A), is_float(A) -&gt;
  836:                  is_float;
  837:              t1(A) when is_function(A), is_function(A) -&gt;
  838:                  is_function;
  839:              t1(A) when is_integer(A), is_integer(A) -&gt;
<a name="840"></a>  840:                  is_integer;
  841:              t1(A) when is_list(A), is_list(A) -&gt;
  842:                  is_list;
  843:              t1(A) when is_number(A), is_number(A) -&gt;
  844:                  is_number;
  845:              t1(A) when is_pid(A), is_pid(A) -&gt;
  846:                  is_pid;
  847:              t1(A) when is_port(A), is_port(A) -&gt;
  848:                  is_port;
  849:              t1(A) when is_record(A, apa), is_record(A, apa) -&gt;
<a name="850"></a>  850:                  is_record;
  851:              t1(A) when is_reference(A), is_reference(A) -&gt;
  852:                  is_reference;
  853:              t1(A) when is_tuple(A), is_tuple(A) -&gt;
  854:                  is_tuple;
  855:              t1(A) when list(A), list(A) -&gt;
  856:                  list;
  857:              t1(A) when number(A), number(A) -&gt;
  858:                  number;
  859:              t1(A) when pid(A), pid(A) -&gt;
<a name="860"></a>  860:                  pid;
  861:              t1(A) when port(A), port(A) -&gt;
  862:                  port;
  863:              t1(A) when record(A, apa), record(A, apa) -&gt;
  864:                  record;
  865:              t1(A) when reference(A), reference(A) -&gt;
  866:                  reference;
  867:              t1(A) when tuple(A), tuple(A) -&gt;
  868:                  tuple.
  869:           "&gt;&gt;,
<a name="870"></a>  870:           [],
  871:           []},
  872:          {guard3,
  873:           &lt;&lt;"-record(apa,{}).
  874:              t2(A) when atom(A); atom(A) -&gt;
  875:                  atom;
  876:              t2(A) when binary(A); binary(A) -&gt;
  877:                  binary;
  878:              t2(A) when constant(A); constant(A) -&gt;
  879:                  constant;
<a name="880"></a>  880:              t2(A) when float(A); float(A) -&gt;
  881:                  float;
  882:              t2(A) when function(A); function(A) -&gt;
  883:                  function;
  884:              t2(A) when integer(A); integer(A) -&gt;
  885:                  integer;
  886:              t2(A) when is_atom(A); is_atom(A) -&gt;
  887:                  is_atom;
  888:              t2(A) when is_binary(A); is_binary(A) -&gt;
  889:                  is_binary;
<a name="890"></a>  890:              t2(A) when is_constant(A); is_constant(A) -&gt;
  891:                  is_constant;
  892:              t2(A) when is_float(A); is_float(A) -&gt;
  893:                  is_float;
  894:              t2(A) when is_function(A); is_function(A) -&gt;
  895:                  is_function;
  896:              t2(A) when is_integer(A); is_integer(A) -&gt;
  897:                  is_integer;
  898:              t2(A) when is_list(A); is_list(A) -&gt;
  899:                  is_list;
<a name="900"></a>  900:              t2(A) when is_number(A); is_number(A) -&gt;
  901:                  is_number;
  902:              t2(A) when is_pid(A); is_pid(A) -&gt;
  903:                  is_pid;
  904:              t2(A) when is_port(A); is_port(A) -&gt;
  905:                  is_port;
  906:              t2(A) when is_record(A, apa); is_record(A, apa) -&gt;
  907:                  is_record;
  908:              t2(A) when is_reference(A); is_reference(A) -&gt;
  909:                  is_reference;
<a name="910"></a>  910:              t2(A) when is_tuple(A); is_tuple(A) -&gt;
  911:                  is_tuple;
  912:              t2(A) when list(A); list(A) -&gt;
  913:                  list;
  914:              t2(A) when number(A); number(A) -&gt;
  915:                  number;
  916:              t2(A) when pid(A); pid(A) -&gt;
  917:                  pid;
  918:              t2(A) when port(A); port(A) -&gt;
  919:                  port;
<a name="920"></a>  920:              t2(A) when record(A, apa); record(A, apa) -&gt;
  921:                  record;
  922:              t2(A) when reference(A); reference(A) -&gt;
  923:                  reference;
  924:              t2(A) when tuple(A); tuple(A) -&gt;
  925:                  tuple.
  926:           "&gt;&gt;,
  927:           [],
  928:           []},
  929:          {guard4,
<a name="930"></a>  930:           &lt;&lt;"-record(apa, {}).
  931:              t3(A) when float(A) or float(A) -&gt; % coercing... (badarg)
  932:                  float;
  933:              t3(A) when is_atom(A) or is_atom(A) -&gt;
  934:                  is_atom;
  935:              t3(A) when is_binary(A) or is_binary(A) -&gt;
  936:                  is_binary;
  937:              t3(A) when is_constant(A) or is_constant(A) -&gt;
  938:                  is_constant;
  939:              t3(A) when is_float(A) or is_float(A) -&gt;
<a name="940"></a>  940:                  is_float;
  941:              t3(A) when is_function(A) or is_function(A) -&gt;
  942:                  is_function;
  943:              t3(A) when is_integer(A) or is_integer(A) -&gt;
  944:                  is_integer;
  945:              t3(A) when is_list(A) or is_list(A) -&gt;
  946:                  is_list;
  947:              t3(A) when is_number(A) or is_number(A) -&gt;
  948:                  is_number;
  949:              t3(A) when is_pid(A) or is_pid(A) -&gt;
<a name="950"></a>  950:                  is_pid;
  951:              t3(A) when is_port(A) or is_port(A) -&gt;
  952:                  is_port;
  953:              t3(A) when is_record(A, apa) or is_record(A, apa) -&gt;
  954:                  is_record;
  955:              t3(A) when is_reference(A) or is_reference(A) -&gt;
  956:                  is_reference;
  957:              t3(A) when is_tuple(A) or is_tuple(A) -&gt;
  958:                  is_tuple.
  959:           "&gt;&gt;,
<a name="960"></a>  960:           [],
  961:           []}],
  962:    ?line [] = run(Config, Ts),
  963:    Ts1 = [{guard5,
  964:            &lt;&lt;"-record(apa, {}).
  965:               t3(A) when record(A, {apa}) -&gt;
  966:                   foo;
  967:               t3(A) when is_record(A, {apa}) -&gt;
  968:                   foo;
  969:               t3(A) when erlang:is_record(A, {apa}) -&gt;
<a name="970"></a>  970:                   foo;
  971:               t3(A) when {erlang,is_record}(A, {apa}) -&gt;
  972:                   foo;
  973:               t3(A) when record(A, apa) -&gt;
  974:                   foo;
  975:               t3(A) when is_record(A, apa) -&gt;
  976:                   foo;
  977:               t3(A) when erlang:is_record(A, apa) -&gt;
  978:                   foo;
  979:               t3(A) when {erlang,is_record}(A, apa) -&gt;
<a name="980"></a>  980:                   foo.
  981:            "&gt;&gt;,
  982:            [warn_unused_vars],
  983:            {errors,[{2,erl_lint,illegal_guard_expr},
  984:                     {4,erl_lint,illegal_guard_expr},
  985:                     {6,erl_lint,illegal_guard_expr},
  986:                     {8,erl_lint,illegal_guard_expr}],
  987:             []}},
  988:           {guard6,
  989:            &lt;&lt;"-record(apa,{a=a,b=foo:bar()}).
<a name="990"></a>  990:              apa() -&gt;
  991:                 [X || X &lt;- [], #apa{a = a} == {r,X,foo}];
  992:              apa() -&gt;
  993:                 [X || X &lt;- [], #apa{b = b} == {r,X,foo}];
  994:              apa() -&gt;
  995:                 [X || X &lt;- [], #ful{a = a} == {r,X,foo}].
  996:            "&gt;&gt;,
  997:            [],
  998:            {errors,[{7,erl_lint,{undefined_record,ful}}],
  999:             []}},
<a name="1000"></a> 1000:           {guard7,
 1001:            &lt;&lt;"-record(apa,{}).
 1002:               t() -&gt;
 1003:               [X || X &lt;- [1,#apa{},3], (3+is_record(X, apa)) or 
 1004:                                        (is_record(X, apa)*2)].
 1005:            "&gt;&gt;,
 1006:            [],
 1007:            []}],
 1008:    ?line [] = run(Config, Ts1),
 1009:    ok.
<a name="1010"></a> 1010:
<a name=format_warn> 1011:<b>format_warn</b></a>(doc) -&gt;
 1012:    "Check that format warnings are generated.";
<a name=format_warn> 1013:<b>format_warn</b></a>(suite) -&gt; [];
<a name=format_warn> 1014:<b>format_warn</b></a>(Config) when list(Config) -&gt;
 1015:    L1 = 14,
 1016:    L2 = 4,
 1017:    format_level(1, L1, Config),
 1018:    format_level(2, L1+L2, Config),
 1019:    format_level(3, L1+L2, Config),             %there is no level 3
<a name="1020"></a> 1020:    ok.
 1021:
<a name=format_level> 1022:<b>format_level</b></a>(Level, Count, Config) -&gt;
 1023:    ?line W = get_compilation_warnings(Config, "format",
 1024:                                       [{warn_format, Level}]),
 1025:    %% Pick out the 'format' warnings.
 1026:    ?line FW = lists:filter(fun({_Line, erl_lint, {format_error, _}}) -&gt; true;
 1027:                               (_) -&gt; false
 1028:                            end,
 1029:                            W),
<a name="1030"></a> 1030:    ?line case length(FW) of
 1031:              Count -&gt;
 1032:                  ok;
 1033:              Other -&gt;
 1034:                  ?t:format("Expected ~w warning(s); got ~w", [Count,Other]),
 1035:                  fail()
 1036:          end,
 1037:    ok.
 1038:
<a name=run> 1039:<b>run</b></a>(Config, Tests) -&gt;
<a name="1040"></a> 1040:    F = fun({N,P,Ws,E}, BadL) -&gt;
 1041:                case catch run_test(Config, P, Ws) of
 1042:                    E -&gt; 
 1043:                        BadL;
 1044:                    Bad -&gt; 
 1045:                        ?t:format("~nTest ~p failed. Expected~n  ~p~n"
 1046:                                  "but got~n  ~p~n", [N, E, Bad]),
 1047:			fail()
 1048:                end
 1049:        end,
<a name="1050"></a> 1050:    lists:foldl(F, [], Tests).
 1051:
 1052:<i>%% Compiles a test file and returns the list of warnings.</i>
 1053:
<a name=get_compilation_warnings> 1054:<b>get_compilation_warnings</b></a>(Conf, Filename, Warnings) -&gt;
 1055:    ?line DataDir = ?datadir,
 1056:    ?line File = filename:join(DataDir, Filename),
 1057:    {ok,Bin} = file:read_file(File++".erl"),
 1058:    FileS = binary_to_list(Bin),
 1059:    {match,Start,Length} = regexp:match(FileS, "-module.*\\n"),
<a name="1060"></a> 1060:    Test = lists:nthtail(Start+Length, FileS),
 1061:    {warnings, Ws} = run_test(Conf, Test, Warnings),
 1062:    Ws.
 1063:
 1064:<i>%% Compiles a test module and returns the list of errors and warnings.</i>
 1065:
<a name=run_test> 1066:<b>run_test</b></a>(Conf, Test0, Warnings) -&gt;
 1067:    Filename = 'lint_test.erl',
 1068:    ?line DataDir = ?privdir,
 1069:    ?line Test = list_to_binary(["-module(lint_test). ", Test0]),
<a name="1070"></a> 1070:    ?line File = filename:join(DataDir, Filename),
 1071:    ?line Opts = [export_all,return|Warnings],
 1072:    ?line ok = file:write_file(File, Test),
 1073:    ?line case compile:file(File, Opts) of
 1074:              {ok, _M, []} -&gt; [];
 1075:              {ok, _M, [{File,Ws}]} -&gt; {warnings, Ws};
 1076:              {error, [{File,Es}], []} -&gt; {errors, Es, []};
 1077:              {error, [{File,Es}], [{File,Ws}]} -&gt; {error, Es, Ws}
 1078:          end.
 1079:
<a name=fail><a name="1080"></a> 1080:<b>fail</b></a>() -&gt;
 1081:    io:format("failed~n"),
 1082:    ?t:fail().
</pre>
<hr size=1><i>The transformation of this file (1083 lines) took 0.07 seconds</i><br>
</body>
</html>
