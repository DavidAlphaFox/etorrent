<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/gen_event_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:-<b>module</b>(gen_event_SUITE).
   19:
<a name="20"></a>   20:-<b>include</b>("test_server.hrl").
   21:
   22:-<b>export</b>([all/1]).
   23:-<b>export</b>([start/1, test_all/1, add_handler/1, add_sup_handler/1,
   24:	 delete_handler/1, swap_handler/1, swap_sup_handler/1,
   25:	 notify/1, sync_notify/1, call/1, info/1]).
   26:
<a name=all>   27:<b>all</b></a>(suite) -&gt; {req, [stdlib], [start, test_all]}.
   28:
   29:<i>%% --------------------------------------</i>
<a name="30"></a>   30:<i>%% Start an event manager.</i>
   31:<i>%% --------------------------------------</i>
   32:
<a name=start>   33:<b>start</b></a>(doc) -&gt; [];
<a name=start>   34:<b>start</b></a>(suite) -&gt; [];
<a name=start>   35:<b>start</b></a>(Config) when list(Config) -&gt;
   36:    OldFl = process_flag(trap_exit, true),
   37:
   38:    ?line {ok, Pid0} = gen_event:start(), %anonymous
   39:    ?line [] = gen_event:which_handlers(Pid0),
<a name="40"></a>   40:    ?line ok = gen_event:stop(Pid0),
   41:
   42:    ?line {ok, Pid1} = gen_event:start_link(), %anonymous
   43:    ?line [] = gen_event:which_handlers(Pid1),
   44:    ?line ok = gen_event:stop(Pid1),
   45:
   46:    ?line {ok, Pid2} = gen_event:start({local, my_dummy_name}),
   47:    ?line [] = gen_event:which_handlers(my_dummy_name),
   48:    ?line [] = gen_event:which_handlers(Pid2),
   49:    ?line ok = gen_event:stop(my_dummy_name),
<a name="50"></a>   50:
   51:    ?line {ok, Pid3} = gen_event:start_link({local, my_dummy_name}),
   52:    ?line [] = gen_event:which_handlers(my_dummy_name),
   53:    ?line [] = gen_event:which_handlers(Pid3),
   54:    ?line ok = gen_event:stop(my_dummy_name),
   55:
   56:    ?line {ok, Pid4} = gen_event:start_link({global, my_dummy_name}),
   57:    ?line [] = gen_event:which_handlers({global, my_dummy_name}),
   58:    ?line [] = gen_event:which_handlers(Pid4),
   59:    ?line ok = gen_event:stop({global, my_dummy_name}),
<a name="60"></a>   60:
   61:    ?line {ok, _} = gen_event:start_link({local, my_dummy_name}),
   62:    ?line {error, {already_started, _}} =
   63:	gen_event:start_link({local, my_dummy_name}),
   64:    ?line {error, {already_started, _}} =
   65:	gen_event:start({local, my_dummy_name}),
   66:    ?line ok = gen_event:stop(my_dummy_name),
   67:
   68:    ?line {ok, Pid5} = gen_event:start_link({global, my_dummy_name}),
   69:    ?line {error, {already_started, _}} =
<a name="70"></a>   70:	gen_event:start_link({global, my_dummy_name}),
   71:    ?line {error, {already_started, _}} =
   72:	gen_event:start({global, my_dummy_name}),
   73:
   74:    exit(Pid5, shutdown),
   75:    receive
   76:	{'EXIT', Pid5, shutdown} -&gt; ok
   77:    after 10000 -&gt;
   78:	    ?t:fail(exit_gen_event)
   79:    end,
<a name="80"></a>   80:
   81:    ?t:messages_get(),
   82:    process_flag(trap_exit, OldFl),
   83:    ok.
   84:
<a name=test_all>   85:<b>test_all</b></a>(suite) -&gt; [add_handler, add_sup_handler, delete_handler,
   86:		    swap_handler, swap_sup_handler, notify,
   87:		    sync_notify, call, info].
   88:
<a name=add_handler>   89:<b>add_handler</b></a>(doc) -&gt; [];
<a name=add_handler><a name="90"></a>   90:<b>add_handler</b></a>(suite) -&gt; [];
<a name=add_handler>   91:<b>add_handler</b></a>(Config) when list(Config) -&gt;
   92:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
   93:    ?line {error, my_error} =
   94:	gen_event:add_handler(my_dummy_handler, dummy_h, make_error),
   95:    ?line [] = gen_event:which_handlers(my_dummy_handler),
   96:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
   97:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
   98:
   99:    ?line {error, my_error} =
<a name="100"></a>  100:	gen_event:add_handler(my_dummy_handler, {dummy_h, self()}, make_error),
  101:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  102:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,self()},
  103:				     [self()]),
  104:    Self = self(),
  105:    ?line [{dummy_h, Self}, dummy_h] =
  106:	gen_event:which_handlers(my_dummy_handler),
  107:    ?line ok = gen_event:stop(my_dummy_handler),
  108:    ok.
  109:
<a name=add_sup_handler><a name="110"></a>  110:<b>add_sup_handler</b></a>(doc) -&gt; [];
<a name=add_sup_handler>  111:<b>add_sup_handler</b></a>(suite) -&gt; [];
<a name=add_sup_handler>  112:<b>add_sup_handler</b></a>(Config) when list(Config) -&gt;
  113:    ?line {ok,Pid} = gen_event:start({local, my_dummy_handler}),
  114:    ?line {error, my_error} =
  115:	gen_event:add_sup_handler(my_dummy_handler, dummy_h, make_error),
  116:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  117:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  118:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  119:    ?line exit(Pid, sup_died),
<a name="120"></a>  120:    ?t:sleep(1000),
  121:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  122:
  123:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  124:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  125:
  126:    ?line {error, my_error} =
  127:	gen_event:add_handler(my_dummy_handler, {dummy_h, self()}, make_error),
  128:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  129:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, {dummy_h,self()},
<a name="130"></a>  130:					 [self()]),
  131:    Self = self(),
  132:    ?line [{dummy_h, Self}, dummy_h] =
  133:	gen_event:which_handlers(my_dummy_handler),
  134:    ?line ok = gen_event:stop(my_dummy_handler),
  135:
  136:    ?line receive
  137:	      {gen_event_EXIT, dummy_h, shutdown} -&gt;
  138:		  ok
  139:	  after 1000 -&gt;
<a name="140"></a>  140:		  ?t:fail({no,{gen_event_EXIT, dummy_h, shutdown}})
  141:	  end,
  142:
  143:    ?line receive
  144:	      {gen_event_EXIT, {dummy_h,Self}, shutdown} -&gt;
  145:		  ok
  146:	  after 1000 -&gt;
  147:		  ?t:fail({no,{gen_event_EXIT, {dummy_h,Self},
  148:					shutdown}})
  149:	  end,
<a name="150"></a>  150:    ok.
  151:
<a name=delete_handler>  152:<b>delete_handler</b></a>(doc) -&gt; [];
<a name=delete_handler>  153:<b>delete_handler</b></a>(suite) -&gt; [];
<a name=delete_handler>  154:<b>delete_handler</b></a>(Config) when list(Config) -&gt;
  155:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  156:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  157:    ?line {error, module_not_found} =
  158:	gen_event:delete_handler(my_dummy_handler, duuuuuuuuumy, []),
  159:    ?line return_hej =
<a name="160"></a>  160:	gen_event:delete_handler(my_dummy_handler, dummy_h, return_hej),
  161:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  162:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  163:    ?line ok =
  164:	gen_event:delete_handler(my_dummy_handler, dummy_h, []),
  165:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  166:
  167:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,1}, [self()]),
  168:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,2}, [self()]),
  169:    ?line {error, module_not_found} =
<a name="170"></a>  170:	gen_event:delete_handler(my_dummy_handler, {duuuuuuuuumy,1}, []),
  171:    ?line return_hej =
  172:	gen_event:delete_handler(my_dummy_handler, {dummy_h,1}, return_hej),
  173:    ?line return_hej =
  174:	gen_event:delete_handler(my_dummy_handler, {dummy_h,2}, return_hej),
  175:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  176:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,2}, [self()]),
  177:    ?line ok =
  178:	gen_event:delete_handler(my_dummy_handler, {dummy_h,2}, []),
  179:    ?line [] = gen_event:which_handlers(my_dummy_handler),
<a name="180"></a>  180:
  181:    ?line ok = gen_event:stop(my_dummy_handler),
  182:    ok.
  183:
<a name=swap_handler>  184:<b>swap_handler</b></a>(doc) -&gt; [];
<a name=swap_handler>  185:<b>swap_handler</b></a>(suite) -&gt; [];
<a name=swap_handler>  186:<b>swap_handler</b></a>(Config) when list(Config) -&gt;
  187:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  188:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  189:    ?line {error, non_existing} =
<a name="190"></a>  190:	gen_event:swap_handler(my_dummy_handler, {faulty_h, swap},
  191:			       {dummy1_h, []}),
  192:    ?line ok =
  193:	gen_event:swap_handler(my_dummy_handler, {dummy_h, swap},
  194:			       {dummy1_h, swap}),
  195:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  196:
  197:    ?line ok = gen_event:delete_handler(my_dummy_handler, dummy1_h, []),
  198:
  199:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,3}, [self()]),
<a name="200"></a>  200:    ?line {error, non_existing} =
  201:	gen_event:swap_handler(my_dummy_handler, {faulty_h, swap},
  202:			       {dummy1_h, []}),
  203:    ?line ok =
  204:	gen_event:swap_handler(my_dummy_handler, {{dummy_h,3}, swap},
  205:			       {{dummy1_h,4}, swap}),
  206:    ?line [{dummy1_h,4}] = gen_event:which_handlers(my_dummy_handler),
  207:
  208:    ?line ok = gen_event:delete_handler(my_dummy_handler, {dummy1_h,4}, []),
  209:
<a name="210"></a>  210:    ?line ok = gen_event:stop(my_dummy_handler),
  211:    ok.
  212:	
<a name=swap_sup_handler>  213:<b>swap_sup_handler</b></a>(doc) -&gt; [];
<a name=swap_sup_handler>  214:<b>swap_sup_handler</b></a>(suite) -&gt; [];
<a name=swap_sup_handler>  215:<b>swap_sup_handler</b></a>(Config) when list(Config) -&gt;
  216:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  217:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  218:    ?line {error, non_existing} =
  219:	gen_event:swap_handler(my_dummy_handler, {faulty_h, swap},
<a name="220"></a>  220:			       {dummy1_h, []}),
  221:    ?line ok =
  222:	gen_event:swap_handler(my_dummy_handler, {dummy_h, swap},
  223:			       {dummy1_h, swap}),
  224:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  225:
  226:    ?line ok = gen_event:delete_handler(my_dummy_handler, dummy1_h, []),
  227:    ?line receive
  228:	      {gen_event_EXIT, dummy1_h, normal} -&gt;
  229:		  ok
<a name="230"></a>  230:	  after 1000 -&gt;
  231:		  ?t:fail({no,{gen_event_EXIT, dummy1_h, normal}})
  232:	  end,
  233:
  234:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, {dummy_h,3},
  235:					 [self()]),
  236:    ?line {error, non_existing} =
  237:	gen_event:swap_sup_handler(my_dummy_handler, {faulty_h, swap},
  238:				   {dummy1_h, []}),
  239:    ?line ok =
<a name="240"></a>  240:	gen_event:swap_sup_handler(my_dummy_handler, {{dummy_h,3}, swap},
  241:				   {{dummy1_h,4}, swap}),
  242:    ?line [{dummy1_h,4}] = gen_event:which_handlers(my_dummy_handler),
  243:
  244:    ?line ok = gen_event:delete_handler(my_dummy_handler, {dummy1_h,4}, []),
  245:    ?line receive
  246:	      {gen_event_EXIT, {dummy1_h,4}, normal} -&gt;
  247:		  ok
  248:	  after 1000 -&gt;
  249:		  ?t:fail({no,{gen_event_EXIT, {dummy1_h,4}, normal}})
<a name="250"></a>  250:	  end,
  251:
  252:    ?line ok = gen_event:stop(my_dummy_handler),
  253:    ok.
  254:	
<a name=notify>  255:<b>notify</b></a>(doc) -&gt; [];
<a name=notify>  256:<b>notify</b></a>(suite) -&gt; [];
<a name=notify>  257:<b>notify</b></a>(Config) when list(Config) -&gt;
  258:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  259:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
<a name="260"></a>  260:    Event = {event, self()},
  261:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  262:    ?line ok = gen_event:notify(my_dummy_handler, Event),
  263:    ?line receive
  264:	      {dummy_h, Event} -&gt;
  265:		  ok
  266:	  end,
  267:    ?line ok = gen_event:notify(my_dummy_handler, {swap_event,dummy1_h,swap}),
  268:    ?t:sleep(1000),
  269:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
<a name="270"></a>  270:    ?line ok = gen_event:notify(my_dummy_handler, Event),
  271:    ?line receive
  272:	      {dummy1_h, Event} -&gt;
  273:		  ok
  274:	  end,
  275:    ?line ok = gen_event:notify(my_dummy_handler, delete_event),
  276:    ?line receive
  277:	      {dummy1_h, removed} -&gt;
  278:		  ok
  279:	  end,
<a name="280"></a>  280:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  281:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  282:
  283:    ?line ok = gen_event:notify(my_dummy_handler, error_event),
  284:    ?line receive
  285:	      {dummy_h, returned_error} -&gt;
  286:		  ok
  287:	  end,
  288:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  289:
<a name="290"></a>  290:    %% Handler with id, {Mod,Id}
  291:
  292:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,5}, [self()]),
  293:    ?line [{dummy_h,5}] = gen_event:which_handlers(my_dummy_handler),
  294:    ?line ok = gen_event:notify(my_dummy_handler, Event),
  295:    ?line receive
  296:	      {dummy_h, Event} -&gt;
  297:		  ok
  298:	  end,
  299:    ?line ok = gen_event:notify(my_dummy_handler,
<a name="300"></a>  300:				{swap_event, {dummy1_h, 9}, swap}),
  301:    ?t:sleep(1000),
  302:    ?line [{dummy1_h,9}] = gen_event:which_handlers(my_dummy_handler),
  303:    ?line ok = gen_event:notify(my_dummy_handler, Event),
  304:    ?line receive
  305:	      {dummy1_h, Event} -&gt;
  306:		  ok
  307:	  end,
  308:    ?line ok = gen_event:notify(my_dummy_handler, delete_event),
  309:    ?line receive
<a name="310"></a>  310:	      {dummy1_h, removed} -&gt;
  311:		  ok
  312:	  end,
  313:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  314:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,a}, [self()]),
  315:
  316:    ?line ok = gen_event:notify(my_dummy_handler, error_event),
  317:    ?line receive
  318:	      {dummy_h, returned_error} -&gt;
  319:		  ok
<a name="320"></a>  320:	  end,
  321:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  322:
  323:    %% Supervised handler.
  324:
  325:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  326:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  327:    ?line ok = gen_event:notify(my_dummy_handler, Event),
  328:    ?line receive
  329:	      {dummy_h, Event} -&gt;
<a name="330"></a>  330:		  ok
  331:	  end,
  332:
  333:    ?line ok = gen_event:notify(my_dummy_handler, do_crash),
  334:    ?line receive
  335:	      {gen_event_EXIT, dummy_h, {'EXIT',_}} -&gt;
  336:		  ok
  337:	  end,
  338:
  339:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
<a name="340"></a>  340:    ?line ok = gen_event:notify(my_dummy_handler, {swap_event,dummy1_h,swap}),
  341:    ?t:sleep(1000),
  342:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  343:
  344:    ?line ok = gen_event:notify(my_dummy_handler, do_crash),
  345:    ?line receive
  346:	      {gen_event_EXIT, dummy1_h, {'EXIT',_}} -&gt;
  347:		  ok
  348:	  end,
  349:
<a name="350"></a>  350:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  351:    ?line ok = gen_event:notify(my_dummy_handler, {swap_event,dummy1_h,swap}),
  352:    ?t:sleep(1000),
  353:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  354:
  355:    ?line ok = gen_event:notify(my_dummy_handler, delete_event),
  356:    ?line receive
  357:	      {dummy1_h, removed} -&gt;
  358:		  ok
  359:	  end,
<a name="360"></a>  360:
  361:    ?line receive
  362:	      {gen_event_EXIT, dummy1_h, normal} -&gt;
  363:		  ok
  364:	  end,
  365:
  366:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  367:
  368:    ?line ok = gen_event:stop(my_dummy_handler),
  369:    ok.
<a name="370"></a>  370:
<a name=sync_notify>  371:<b>sync_notify</b></a>(doc) -&gt; [];
<a name=sync_notify>  372:<b>sync_notify</b></a>(suite) -&gt; [];
<a name=sync_notify>  373:<b>sync_notify</b></a>(Config) when list(Config) -&gt;
  374:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  375:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  376:    Event = {event, self()},
  377:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  378:    ?line ok = gen_event:sync_notify(my_dummy_handler, Event),
  379:    ?line receive
<a name="380"></a>  380:	      {dummy_h, Event} -&gt;
  381:		  ok
  382:	  end,
  383:    ?line ok = gen_event:sync_notify(my_dummy_handler,
  384:				     {swap_event, dummy1_h, swap}),
  385:    ?t:sleep(1000),
  386:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  387:    ?line ok = gen_event:sync_notify(my_dummy_handler, Event),
  388:    ?line receive
  389:	      {dummy1_h, Event} -&gt;
<a name="390"></a>  390:		  ok
  391:	  end,
  392:    ?line ok = gen_event:sync_notify(my_dummy_handler, delete_event),
  393:    ?line receive
  394:	      {dummy1_h, removed} -&gt;
  395:		  ok
  396:	  end,
  397:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  398:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  399:
<a name="400"></a>  400:    ?line ok = gen_event:sync_notify(my_dummy_handler, error_event),
  401:    ?line receive
  402:	      {dummy_h, returned_error} -&gt;
  403:		  ok
  404:	  end,
  405:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  406:
  407:    %% Handler with id, {Mod,Id}
  408:
  409:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,5}, [self()]),
<a name="410"></a>  410:    ?line [{dummy_h,5}] = gen_event:which_handlers(my_dummy_handler),
  411:    ?line ok = gen_event:sync_notify(my_dummy_handler, Event),
  412:    ?line receive
  413:	      {dummy_h, Event} -&gt;
  414:		  ok
  415:	  end,
  416:    ?line ok = gen_event:sync_notify(my_dummy_handler,
  417:				     {swap_event, {dummy1_h, 9}, swap}),
  418:    ?t:sleep(1000),
  419:    ?line [{dummy1_h,9}] = gen_event:which_handlers(my_dummy_handler),
<a name="420"></a>  420:    ?line ok = gen_event:sync_notify(my_dummy_handler, Event),
  421:    ?line receive
  422:	      {dummy1_h, Event} -&gt;
  423:		  ok
  424:	  end,
  425:    ?line ok = gen_event:sync_notify(my_dummy_handler, delete_event),
  426:    ?line receive
  427:	      {dummy1_h, removed} -&gt;
  428:		  ok
  429:	  end,
<a name="430"></a>  430:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  431:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,a}, [self()]),
  432:
  433:    ?line ok = gen_event:sync_notify(my_dummy_handler, error_event),
  434:    ?line receive
  435:	      {dummy_h, returned_error} -&gt;
  436:		  ok
  437:	  end,
  438:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  439:
<a name="440"></a>  440:    %% Supervised handler.
  441:
  442:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  443:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  444:    ?line ok = gen_event:sync_notify(my_dummy_handler, Event),
  445:    ?line receive
  446:	      {dummy_h, Event} -&gt;
  447:		  ok
  448:	  end,
  449:
<a name="450"></a>  450:    ?line ok = gen_event:sync_notify(my_dummy_handler, do_crash),
  451:    ?line receive
  452:	      {gen_event_EXIT, dummy_h, {'EXIT',_}} -&gt;
  453:		  ok
  454:	  end,
  455:
  456:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  457:    ?line ok = gen_event:sync_notify(my_dummy_handler,
  458:				     {swap_event,dummy1_h,swap}),
  459:    ?t:sleep(1000),
<a name="460"></a>  460:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  461:
  462:    ?line ok = gen_event:sync_notify(my_dummy_handler, do_crash),
  463:    ?line receive
  464:	      {gen_event_EXIT, dummy1_h, {'EXIT',_}} -&gt;
  465:		  ok
  466:	  end,
  467:
  468:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  469:    ?line ok = gen_event:sync_notify(my_dummy_handler,
<a name="470"></a>  470:				     {swap_event,dummy1_h,swap}),
  471:    ?t:sleep(1000),
  472:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  473:
  474:    ?line ok = gen_event:sync_notify(my_dummy_handler, delete_event),
  475:    ?line receive
  476:	      {dummy1_h, removed} -&gt;
  477:		  ok
  478:	  end,
  479:
<a name="480"></a>  480:    ?line receive
  481:	      {gen_event_EXIT, dummy1_h, normal} -&gt;
  482:		  ok
  483:	  end,
  484:
  485:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  486:
  487:    ?line ok = gen_event:stop(my_dummy_handler),
  488:    ok.
  489:
<a name=call><a name="490"></a>  490:<b>call</b></a>(doc) -&gt; [];
<a name=call>  491:<b>call</b></a>(suite) -&gt; [];
<a name=call>  492:<b>call</b></a>(Config) when list(Config) -&gt;
  493:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  494:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  495:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h, 1}, [self()]),
  496:    ?line [{dummy_h, 1}, dummy_h] = gen_event:which_handlers(my_dummy_handler),
  497:    ?line {'EXIT',_} = (catch gen_event:call(non_exist, dummy_h, hejsan)),
  498:    ?line {error, bad_module} =
  499:	gen_event:call(my_dummy_handler, bad_h, hejsan),
<a name="500"></a>  500:    ?line {ok, hejhopp} = gen_event:call(my_dummy_handler, dummy_h, hejsan),
  501:    ?line {ok, hejhopp} = gen_event:call(my_dummy_handler, {dummy_h, 1},
  502:					 hejsan),
  503:    ?line {ok, hejhopp} = gen_event:call(my_dummy_handler, dummy_h, hejsan,
  504:					 10000),
  505:    ?line {'EXIT', {timeout, _}} =
  506:	(catch gen_event:call(my_dummy_handler, dummy_h, hejsan, 0)),
  507:    flush(),
  508:    ?line ok = gen_event:delete_handler(my_dummy_handler, {dummy_h, 1}, []),
  509:    ?line {ok, swapped} = gen_event:call(my_dummy_handler, dummy_h,
<a name="510"></a>  510:					 {swap_call,dummy1_h,swap}),
  511:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  512:    ?line {error, bad_module} =
  513:	gen_event:call(my_dummy_handler, dummy_h, hejsan),
  514:    ?line ok = gen_event:call(my_dummy_handler, dummy1_h, delete_call),
  515:    ?line receive
  516:	      {dummy1_h, removed} -&gt;
  517:		  ok
  518:	  end,
  519:    ?line [] = gen_event:which_handlers(my_dummy_handler),
<a name="520"></a>  520:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  521:
  522:    ?line {error, {return, faulty}} =
  523:	gen_event:call(my_dummy_handler, dummy_h, error_call),
  524:    ?line receive
  525:	      {dummy_h, returned_error} -&gt;
  526:		  ok
  527:	  end,
  528:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  529:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
<a name="530"></a>  530:
  531:    ?line {error, {'EXIT', _}} =
  532:	gen_event:call(my_dummy_handler, dummy_h, exit_call),
  533:
  534:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  535:
  536:    %% Handler with id, {Mod,Id}
  537:
  538:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,1}, [self()]),
  539:    ?line [{dummy_h,1}] = gen_event:which_handlers(my_dummy_handler),
<a name="540"></a>  540:    ?line {error, bad_module} =
  541:	gen_event:call(my_dummy_handler, bad_h, hejsan),
  542:    ?line {ok, hejhopp} = gen_event:call(my_dummy_handler, {dummy_h,1},
  543:					 hejsan),
  544:    ?line {ok, swapped} = gen_event:call(my_dummy_handler, {dummy_h,1},
  545:					 {swap_call,{dummy1_h,2},swap}),
  546:    ?line [{dummy1_h,2}] = gen_event:which_handlers(my_dummy_handler),
  547:    ?line {error, bad_module} =
  548:	gen_event:call(my_dummy_handler, dummy_h, hejsan),
  549:    ?line ok = gen_event:call(my_dummy_handler, {dummy1_h,2}, delete_call),
<a name="550"></a>  550:    ?line receive
  551:	      {dummy1_h, removed} -&gt;
  552:		  ok
  553:	  end,
  554:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  555:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,3}, [self()]),
  556:
  557:    ?line {error, {return, faulty}} =
  558:	gen_event:call(my_dummy_handler, {dummy_h,3}, error_call),
  559:    ?line receive
<a name="560"></a>  560:	      {dummy_h, returned_error} -&gt;
  561:		  ok
  562:	  end,
  563:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  564:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,4}, [self()]),
  565:
  566:    ?line {error, {'EXIT', _}} =
  567:	gen_event:call(my_dummy_handler, {dummy_h,4}, exit_call),
  568:
  569:    ?line [] = gen_event:which_handlers(my_dummy_handler),
<a name="570"></a>  570:
  571:    %% Supervised handler.
  572:
  573:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  574:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  575:    ?line {error, bad_module} =
  576:	gen_event:call(my_dummy_handler, bad_h, hejsan),
  577:    ?line {ok, hejhopp} = gen_event:call(my_dummy_handler, dummy_h, hejsan),
  578:    ?line {ok, swapped} = gen_event:call(my_dummy_handler, dummy_h,
  579:					 {swap_call,dummy1_h,swap}),
<a name="580"></a>  580:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  581:    ?line {error, bad_module} =
  582:	gen_event:call(my_dummy_handler, dummy_h, hejsan),
  583:    ?line ok = gen_event:call(my_dummy_handler, dummy1_h, delete_call),
  584:    ?line receive
  585:	      {dummy1_h, removed} -&gt;
  586:		  ok
  587:	  end,
  588:
  589:    ?line receive
<a name="590"></a>  590:	      {gen_event_EXIT, dummy1_h, normal} -&gt;
  591:		  ok
  592:	  end,
  593:
  594:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  595:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  596:
  597:    ?line {error, {return, faulty}} =
  598:	gen_event:call(my_dummy_handler, dummy_h, error_call),
  599:    ?line receive
<a name="600"></a>  600:	      {dummy_h, returned_error} -&gt;
  601:		  ok
  602:	  end,
  603:
  604:    ?line receive
  605:	      {gen_event_EXIT, dummy_h, {return,faulty}} -&gt;
  606:		  ok
  607:	  after 1000 -&gt;
  608:		  ?t:fail({no, {gen_event_EXIT, dummy_h, {return,faulty}}})
  609:	  end,
<a name="610"></a>  610:
  611:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  612:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  613:
  614:    ?line {error, {'EXIT', _}} =
  615:	gen_event:call(my_dummy_handler, dummy_h, exit_call),
  616:
  617:    ?line receive
  618:	      {gen_event_EXIT, dummy_h, {'EXIT',_}} -&gt;
  619:		  ok
<a name="620"></a>  620:	  after 1000 -&gt;
  621:		  ?t:fail({no, {gen_event_EXIT, dummy_h, {'EXIT','_'}}})
  622:	  end,
  623:
  624:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  625:
  626:    ?line ok = gen_event:stop(my_dummy_handler),
  627:    ok.
  628:
<a name=flush>  629:<b>flush</b></a>() -&gt;
<a name="630"></a>  630:    receive _ -&gt; flush() after 0 -&gt; ok end.
  631:
<a name=info>  632:<b>info</b></a>(doc) -&gt; [];
<a name=info>  633:<b>info</b></a>(suite) -&gt; [];
<a name=info>  634:<b>info</b></a>(Config) when list(Config) -&gt;
  635:    ?line {ok,_} = gen_event:start({local, my_dummy_handler}),
  636:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  637:    Info = {info, self()},
  638:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  639:    ?line my_dummy_handler ! Info,
<a name="640"></a>  640:    ?line receive
  641:	      {dummy_h, Info} -&gt;
  642:		  ok
  643:	  end,
  644:    ?line my_dummy_handler ! {swap_info,dummy1_h,swap},
  645:    ?t:sleep(1000),
  646:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  647:    ?line my_dummy_handler ! Info,
  648:    ?line receive
  649:	      {dummy1_h, Info} -&gt;
<a name="650"></a>  650:		  ok
  651:	  end,
  652:    ?line my_dummy_handler ! delete_info,
  653:    ?line receive
  654:	      {dummy1_h, removed} -&gt;
  655:		  ok
  656:	  end,
  657:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  658:    ?line ok = gen_event:add_handler(my_dummy_handler, dummy_h, [self()]),
  659:
<a name="660"></a>  660:    ?line my_dummy_handler ! error_info,
  661:    ?line receive
  662:	      {dummy_h, returned_error} -&gt;
  663:		  ok
  664:	  end,
  665:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  666:
  667:    %% Handler with id, {Mod,Id}
  668:
  669:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,1}, [self()]),
<a name="670"></a>  670:    ?line [{dummy_h,1}] = gen_event:which_handlers(my_dummy_handler),
  671:    ?line my_dummy_handler ! Info,
  672:    ?line receive
  673:	      {dummy_h, Info} -&gt;
  674:		  ok
  675:	  end,
  676:    ?line my_dummy_handler ! {swap_info,{dummy1_h,2},swap},
  677:    ?t:sleep(1000),
  678:    ?line [{dummy1_h,2}] = gen_event:which_handlers(my_dummy_handler),
  679:    ?line my_dummy_handler ! Info,
<a name="680"></a>  680:    ?line receive
  681:	      {dummy1_h, Info} -&gt;
  682:		  ok
  683:	  end,
  684:    ?line my_dummy_handler ! delete_info,
  685:    ?line receive
  686:	      {dummy1_h, removed} -&gt;
  687:		  ok
  688:	  end,
  689:    ?line [] = gen_event:which_handlers(my_dummy_handler),
<a name="690"></a>  690:    ?line ok = gen_event:add_handler(my_dummy_handler, {dummy_h,3}, [self()]),
  691:
  692:    ?line my_dummy_handler ! error_info,
  693:    ?line receive
  694:	      {dummy_h, returned_error} -&gt;
  695:		  ok
  696:	  end,
  697:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  698:
  699:    %% Supervised handler
<a name="700"></a>  700:
  701:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  702:    ?line [dummy_h] = gen_event:which_handlers(my_dummy_handler),
  703:    ?line my_dummy_handler ! Info,
  704:    ?line receive
  705:	      {dummy_h, Info} -&gt;
  706:		  ok
  707:	  end,
  708:    ?line my_dummy_handler ! {swap_info,dummy1_h,swap},
  709:    ?t:sleep(1000),
<a name="710"></a>  710:    ?line [dummy1_h] = gen_event:which_handlers(my_dummy_handler),
  711:    ?line my_dummy_handler ! Info,
  712:    ?line receive
  713:	      {dummy1_h, Info} -&gt;
  714:		  ok
  715:	  end,
  716:    ?line my_dummy_handler ! delete_info,
  717:    ?line receive
  718:	      {dummy1_h, removed} -&gt;
  719:		  ok
<a name="720"></a>  720:	  end,
  721:
  722:    ?line receive
  723:	      {gen_event_EXIT, dummy1_h, normal} -&gt;
  724:		  ok
  725:	  after 1000 -&gt;
  726:		  ?t:fail({no, {gen_event_EXIT, dummy1_h, normal}})
  727:	  end,
  728:
  729:    ?line [] = gen_event:which_handlers(my_dummy_handler),
<a name="730"></a>  730:
  731:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  732:
  733:    ?line my_dummy_handler ! error_info,
  734:    ?line receive
  735:	      {dummy_h, returned_error} -&gt;
  736:		  ok
  737:	  end,
  738:
  739:    ?line receive
<a name="740"></a>  740:	      {gen_event_EXIT, dummy_h, {return,faulty}} -&gt;
  741:		  ok
  742:	  after 1000 -&gt;
  743:		  ?t:fail({no, {gen_event_EXIT, dummy_h, {return,faulty}}})
  744:	  end,
  745:
  746:    ?line ok = gen_event:add_sup_handler(my_dummy_handler, dummy_h, [self()]),
  747:    ?line my_dummy_handler ! do_crash,
  748:
  749:    ?line receive
<a name="750"></a>  750:	      {gen_event_EXIT, dummy_h, {'EXIT',_}} -&gt;
  751:		  ok
  752:	  after 1000 -&gt;
  753:		  ?t:fail({no, {gen_event_EXIT, dummy_h, {'EXIT','_'}}})
  754:	  end,
  755:
  756:    ?line [] = gen_event:which_handlers(my_dummy_handler),
  757:
  758:    ?line ok = gen_event:stop(my_dummy_handler),
  759:    ok.
</pre>
<hr size=1><i>The transformation of this file (760 lines) took 0.02 seconds</i><br>
</body>
</html>
