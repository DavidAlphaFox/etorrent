<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/y2k_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:<i>%% File:     y2k_SUITE.erl</i>
   19:<i>%% Purpose:  Year 2000 tests.</i>
<a name="20"></a>   20:
   21:-<b>module</b>(y2k_SUITE).
   22:
   23:-<b>include</b>("test_server.hrl").
   24:
   25:-<b>export</b>([all/1,
   26:	 date_1999_01_01/1, date_1999_02_28/1, 
   27:	 date_1999_09_09/1, date_2000_01_01/1, 
   28:	 date_2000_02_29/1, date_2001_01_01/1, 
   29:	 date_2001_02_29/1, date_2004_02_29/1
<a name="30"></a>   30:	]).
   31:
<a name=all>   32:<b>all</b></a>(doc) -&gt;
   33:    "This is the test suite for year 2000. Eight dates according "
   34:    "to Ericsson Corporate Millennium Test Specification "
   35:    "(LME/DT-98:1097 are tested.";
   36:
<a name=all>   37:<b>all</b></a>(suite) -&gt;
   38:    [date_1999_01_01, 
   39:     date_1999_02_28,
<a name="40"></a>   40:     date_1999_09_09,
   41:     date_2000_01_01,
   42:     date_2000_02_29,
   43:     date_2001_01_01,
   44:     date_2001_02_29,
   45:     date_2004_02_29
   46:    ].
   47:
<a name=date_1999_01_01>   48:<b>date_1999_01_01</b></a>(doc) -&gt;
   49:    "#1 : 1999-01-01: test roll-over from 1998-12-31 to 1999-01-01.";
<a name=date_1999_01_01><a name="50"></a>   50:<b>date_1999_01_01</b></a>(suite) -&gt;
   51:    [];
<a name=date_1999_01_01>   52:<b>date_1999_01_01</b></a>(Config) when list(Config) -&gt;
   53:    ?line Date = {1998, 12, 31}, NextDate = {1999, 1, 1},
   54:    ?line match(next_date(Date), NextDate),
   55:    TZD = tzd(Date),
   56:    if 
   57:	TZD &gt; 0 -&gt;
   58:	    ?line Time = {24 - TZD, 0, 0},
   59:	    ?line {NDate, NTime} = 
<a name="60"></a>   60:		erlang:localtime_to_universaltime({Date, Time}),
   61:	    ?line match(NDate, NextDate);
   62:	TZD &lt; 0  -&gt;
   63:	    ?line Time = {24 + TZD, 0, 0},
   64:	    ?line {NDate, NTime} = 
   65:		erlang:universaltime_to_localtime({Date, Time}),
   66:	    ?line match(NDate, NextDate);
   67:	true  -&gt;
   68:	    ok
   69:    end.
<a name="70"></a>   70:    
<a name=date_1999_02_28>   71:<b>date_1999_02_28</b></a>(doc) -&gt;
   72:    "#2 : 1999-02-28: test roll-over from 1999-02-28 to 1999-03-01.";
<a name=date_1999_02_28>   73:<b>date_1999_02_28</b></a>(suite) -&gt;
   74:    [];
<a name=date_1999_02_28>   75:<b>date_1999_02_28</b></a>(Config) when list(Config) -&gt;
   76:    ?line Date = {1999, 2, 28}, NextDate = {1999, 3, 1},
   77:    ?line match(next_date(Date), NextDate),
   78:    ?line match(tz_next_date(Date), NextDate).
   79:
<a name=date_1999_09_09><a name="80"></a>   80:<b>date_1999_09_09</b></a>(doc) -&gt;
   81:    "#3 : 1999-09-09: test roll-over from 1999-09-08 to 1999-09-09.";
<a name=date_1999_09_09>   82:<b>date_1999_09_09</b></a>(suite) -&gt;
   83:    [];
<a name=date_1999_09_09>   84:<b>date_1999_09_09</b></a>(Config) when list(Config) -&gt;
   85:    ?line Date = {1999, 9, 8}, NextDate = {1999, 9, 9},
   86:    ?line match(next_date(Date), NextDate),
   87:    ?line match(tz_next_date(Date), NextDate).
   88:
<a name=date_2000_01_01>   89:<b>date_2000_01_01</b></a>(doc) -&gt;
<a name="90"></a>   90:    "#4 : 2000-01-01: test roll-over from 1999-12-31 to 2000-01-01 to "
   91:    "2000-01-02.";
<a name=date_2000_01_01>   92:<b>date_2000_01_01</b></a>(suite) -&gt;
   93:    [];
<a name=date_2000_01_01>   94:<b>date_2000_01_01</b></a>(Config) when list(Config) -&gt;
   95:    ?line Date = {1999, 12, 31}, NextDate = {2000, 1, 1},
   96:    ?line match(next_date(Date), NextDate),
   97:    ?line match(tz_next_date(Date), NextDate),
   98:    ?line NextDate1 = {2000, 1, 2},
   99:    ?line match(next_date(NextDate), NextDate1),
<a name="100"></a>  100:    ?line match(tz_next_date(NextDate), NextDate1).
  101:
<a name=date_2000_02_29>  102:<b>date_2000_02_29</b></a>(doc) -&gt;
  103:    "#5 : 2000-02-29: test roll-over from 2000-02-28 to 2000-02-29 to "
  104:    "2000-03-01.";
<a name=date_2000_02_29>  105:<b>date_2000_02_29</b></a>(suite) -&gt;
  106:    [];
<a name=date_2000_02_29>  107:<b>date_2000_02_29</b></a>(Config) when list(Config) -&gt;
  108:    ?line Date = {2000, 2, 28}, NextDate = {2000, 2, 29},
  109:    ?line match(next_date(Date), NextDate),
<a name="110"></a>  110:    ?line match(tz_next_date(Date), NextDate),
  111:    ?line NextDate1 = {2000, 3, 1},
  112:    ?line match(next_date(NextDate), NextDate1),
  113:    ?line match(tz_next_date(NextDate), NextDate1).
  114:
<a name=date_2001_01_01>  115:<b>date_2001_01_01</b></a>(doc) -&gt;
  116:    "#6 : 2001-01-01: test roll-over from 2000-12-31 to 2001-01-01.";
<a name=date_2001_01_01>  117:<b>date_2001_01_01</b></a>(suite) -&gt;
  118:    [];
<a name=date_2001_01_01>  119:<b>date_2001_01_01</b></a>(Config) when list(Config) -&gt;
<a name="120"></a>  120:    ?line Date = {2000, 12, 31}, NextDate = {2001, 1, 1},
  121:    ?line match(next_date(Date), NextDate),
  122:    ?line match(tz_next_date(Date), NextDate).
  123:
<a name=date_2001_02_29>  124:<b>date_2001_02_29</b></a>(doc) -&gt;
  125:    "#7 : 2001-02-29: test roll-over from 2001-02-28 to 2001-03-01.";
<a name=date_2001_02_29>  126:<b>date_2001_02_29</b></a>(suite) -&gt;
  127:    [];
<a name=date_2001_02_29>  128:<b>date_2001_02_29</b></a>(Config) when list(Config) -&gt;
  129:    ?line Date = {2001, 2, 28}, NextDate = {2001, 3, 1},
<a name="130"></a>  130:    ?line match(next_date(Date), NextDate),
  131:    ?line match(tz_next_date(Date), NextDate).
  132:
<a name=date_2004_02_29>  133:<b>date_2004_02_29</b></a>(doc) -&gt;
  134:    "#8 : 2004-02-29: test roll-over from 2004-02-28 to 2004-02-29 to "
  135:    "2004-03-01.";
<a name=date_2004_02_29>  136:<b>date_2004_02_29</b></a>(suite) -&gt;
  137:    [];
<a name=date_2004_02_29>  138:<b>date_2004_02_29</b></a>(Config) when list(Config) -&gt;
  139:    ?line Date = {2004, 2, 28}, NextDate = {2004, 2, 29},
<a name="140"></a>  140:    ?line match(next_date(Date), NextDate),
  141:    ?line match(tz_next_date(Date), NextDate),
  142:    ?line NextDate1 = {2004, 3, 1},
  143:    ?line match(next_date(NextDate), NextDate1),
  144:    ?line match(tz_next_date(NextDate), NextDate1).
  145:   
  146:<i>%%</i>
  147:<i>%% Local functions</i>
  148:<i>%%</i>
<a name=next_date>  149:<b>next_date</b></a>(Date) -&gt;
<a name="150"></a>  150:    calendar:gregorian_days_to_date(calendar:date_to_gregorian_days(Date) + 1).
  151:<i>%%</i>
  152:<i>%% timezonediff</i>
  153:<i>%%</i>
<a name=tzd>  154:<b>tzd</b></a>(Date) -&gt;
  155:    ?line {LDate, {LH, LM, LS}} = 
  156:	erlang:universaltime_to_localtime({Date, {12, 0, 0}}),
  157:    12 - LH.
  158:
<a name=tz_next_date>  159:<b>tz_next_date</b></a>(Date) -&gt;
<a name="160"></a>  160:    TZD = tzd(Date),
  161:    if 
  162:	TZD &gt; 0 -&gt;
  163:	    ?line Time = {24 - TZD, 0, 0},
  164:	    ?line {NDate, NTime} = 
  165:		erlang:localtime_to_universaltime({Date, Time}),
  166:	    ?line NDate;
  167:	TZD &lt; 0  -&gt;
  168:	    ?line Time = {24 + TZD, 0, 0},
  169:	    ?line {NDate, NTime} = 
<a name="170"></a>  170:		erlang:universaltime_to_localtime({Date, Time}),
  171:	    ?line NDate;
  172:	true  -&gt;
  173:	    Date
  174:    end.
  175:
  176:<i>%%</i>
  177:<i>%% match({X, X}) -&gt;</i>
  178:<i>%%    ok.</i>
  179:
<a name=match><a name="180"></a>  180:<b>match</b></a>(X, X) -&gt;
  181:    ok.
  182:
  183:
  184:
</pre>
<hr size=1><i>The transformation of this file (185 lines) took 0.00 seconds</i><br>
</body>
</html>
