<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/digraph_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:<i>%%</i>
   19:-<b>module</b>(digraph_SUITE).
<a name="20"></a>   20:
   21:<i>%-define(STANDALONE,1).</i>
   22:
   23:-<b>ifdef</b>(STANDALONE).
   24:-<b>define</b>(line, put(line, ?LINE), ).
   25:-<b>else</b>.
   26:-<b>include</b>("test_server.hrl").
   27:-<b>endif</b>.
   28:
   29:-<b>export</b>([all/1]).
<a name="30"></a>   30:
   31:-<b>export</b>([opts/1, degree/1, path/1, cycle/1, misc/1, vertices/1,
   32:	 edges/1, data/1, tickets/1, otp_3522/1, otp_3630/1]).
   33:
   34:-<b>export</b>([spawn_graph/2]).
   35:
   36:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
   37:
<a name=all>   38:<b>all</b></a>(suite) -&gt; {req, [stdlib], [opts, degree, path, cycle, misc, tickets]}.
   39:
<a name="40"></a>   40:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
   41:
<a name=opts>   42:<b>opts</b></a>(doc) -&gt; [];
<a name=opts>   43:<b>opts</b></a>(suite) -&gt; [];
<a name=opts>   44:<b>opts</b></a>(Config) when list(Config) -&gt;
   45:    ?line {P1,G1} = spawn_graph([public]),
   46:    ?line digraph:add_vertex(G1, x),
   47:    ?line kill_graph(P1),
   48:    ?line {P2,G2} = spawn_graph([private]),
   49:    ?line {'EXIT',{badarg,_}} = (catch digraph:add_vertex(G2, x)),
<a name="50"></a>   50:    ?line kill_graph(P2),
   51:    ?line {P3,G3} = spawn_graph([protected]),
   52:    ?line {'EXIT',{badarg,_}} = (catch digraph:add_vertex(G3, x)),
   53:    ?line kill_graph(P3),
   54:    ?line Template = [{v1,[v2]}, {v2,[v3]}, {v3,[v4]}, {v4,[]}],
   55:    ?line G4 = build_graph([], Template),
   56:    ?line e = digraph:add_edge(G4, e, v4, v1, []),
   57:    ?line digraph:delete(G4),
   58:    ?line G5 = build_graph([cyclic], Template),
   59:    ?line e = digraph:add_edge(G5, e, v4, v1, []),
<a name="60"></a>   60:    ?line digraph:delete(G5),
   61:    ?line G6 = build_graph([acyclic], Template),
   62:    ?line {error, {bad_edge,_}} = digraph:add_edge(G6, v4, v1),
   63:    ?line digraph:delete(G6),
   64:    ok.
   65:    
   66:
   67:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
   68:
<a name=degree>   69:<b>degree</b></a>(doc) -&gt; [];
<a name=degree><a name="70"></a>   70:<b>degree</b></a>(suite) -&gt; [];
<a name=degree>   71:<b>degree</b></a>(Config) when list(Config) -&gt;
   72:    ?line G = build_graph([], [{x1,[]}, {x2,[x1]}, {x3,[x1,x2]},
   73:			       {x4,[x1,x2,x3]}, {x5,[x1,x2,x3,x4]}]),
   74:    %% out degree
   75:    ?line 0 = digraph:out_degree(G, x1),
   76:    ?line 1 = digraph:out_degree(G, x2),
   77:    ?line 2 = digraph:out_degree(G, x3),
   78:    ?line 3 = digraph:out_degree(G, x4),
   79:    ?line 4 = digraph:out_degree(G, x5),
<a name="80"></a>   80:    %% out neighbours
   81:    ?line [] = check(digraph:out_neighbours(G, x1), []),
   82:    ?line [] = check(digraph:out_neighbours(G, x2), [x1]),
   83:    ?line [] = check(digraph:out_neighbours(G, x3), [x1,x2]),
   84:    ?line [] = check(digraph:out_neighbours(G, x4), [x1,x2,x3]),
   85:    ?line [] = check(digraph:out_neighbours(G, x5), [x1,x2,x3,x4]),
   86:
   87:    %% in degree
   88:    ?line 4 = digraph:in_degree(G, x1),
   89:    ?line 3 = digraph:in_degree(G, x2),
<a name="90"></a>   90:    ?line 2 = digraph:in_degree(G, x3),
   91:    ?line 1 = digraph:in_degree(G, x4),
   92:    ?line 0 = digraph:in_degree(G, x5),
   93:    %% in neighbours
   94:    ?line [] = check(digraph:in_neighbours(G, x1), [x2,x3,x4,x5]),
   95:    ?line [] = check(digraph:in_neighbours(G, x2), [x3,x4,x5]),
   96:    ?line [] = check(digraph:in_neighbours(G, x3), [x4,x5]),
   97:    ?line [] = check(digraph:in_neighbours(G, x4), [x5]),
   98:    ?line [] = check(digraph:in_neighbours(G, x5), []),
   99:    digraph:delete(G),
<a name="100"></a>  100:    ok.
  101:
  102:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
  103:
<a name=path>  104:<b>path</b></a>(doc) -&gt; [];
<a name=path>  105:<b>path</b></a>(suite) -&gt; [];
<a name=path>  106:<b>path</b></a>(Config) when list(Config) -&gt;
  107:    ?line G = build_graph([], [{x1,[x2,x3]}, {x2,[x4]}, {x3,[x4]},
  108:			       {x4,[x5,x6]}, {x5,[x7]}, {x6,[x7]}]),
  109:    ?line Vi = case digraph:get_path(G, x1, x7) of
<a name="110"></a>  110:		   [x1,x2,x4,x5,x7] -&gt; digraph:del_vertex(G, x5), x6;
  111:		   [x1,x2,x4,x6,x7] -&gt; digraph:del_vertex(G, x6), x5;
  112:		   [x1,x3,x4,x5,x7] -&gt; digraph:del_vertex(G, x5), x6;
  113:		   [x1,x3,x4,x6,x7] -&gt; digraph:del_vertex(G, x6), x5
  114:	       end,
  115:    ?line Vj = case digraph:get_path(G, x1, x7) of
  116:		   [x1,x2,x4,Vi,x7] -&gt; digraph:del_vertex(G,x2), x3;
  117:		   [x1,x3,x4,Vi,x7] -&gt; digraph:del_vertex(G,x3), x2
  118:	       end,
  119:    ?line [x1,Vj,x4,Vi,x7] = digraph:get_path(G, x1, x7),
<a name="120"></a>  120:    ?line digraph:del_vertex(G, Vj),
  121:    ?line false = digraph:get_path(G, x1, x7),
  122:    ?line [] = check(digraph:vertices(G), [x1,x4,Vi,x7]),
  123:    digraph:delete(G),
  124:    ok.
  125:
  126:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
  127:
<a name=cycle>  128:<b>cycle</b></a>(doc) -&gt; [];
<a name=cycle>  129:<b>cycle</b></a>(suite) -&gt; [];
<a name=cycle><a name="130"></a>  130:<b>cycle</b></a>(Config) when list(Config) -&gt;
  131:    ?line G = build_graph([], [{x1,[x2,x3]}, {x2,[x4]}, {x3,[x4]},
  132:			       {x4,[x5,x6]}, {x5,[x7]}, {x6,[x7,x8]},
  133:			       {x8,[x3,x8]}]), 
  134:    ?line false = digraph:get_cycle(G, x1),
  135:    ?line false = digraph:get_cycle(G, x2),
  136:    ?line false = digraph:get_cycle(G, x5),
  137:    ?line false = digraph:get_cycle(G, x7),
  138:    ?line [x3,x4,x6,x8,x3] = digraph:get_cycle(G, x3),
  139:    ?line [x4,x6,x8,x3,x4] = digraph:get_cycle(G, x4),
<a name="140"></a>  140:    ?line [x6,x8,x3,x4,x6] = digraph:get_cycle(G, x6),
  141:    ?line [x8,x3,x4,x6,x8] = digraph:get_cycle(G, x8),
  142:    ?line digraph:del_vertex(G, x4),
  143:    ?line [x8] = digraph:get_cycle(G, x8),
  144:    digraph:delete(G),
  145:    ok.
  146:
  147:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
  148:
  149:
<a name=misc><a name="150"></a>  150:<b>misc</b></a>(suite) -&gt; [vertices, edges, data].
  151:
<a name=vertices>  152:<b>vertices</b></a>(doc) -&gt; [];
<a name=vertices>  153:<b>vertices</b></a>(suite) -&gt; [];
<a name=vertices>  154:<b>vertices</b></a>(Config) when list(Config) -&gt;
  155:    ?line G = build_graph([], [{x,[]}, {y,[]}]),
  156:    ?line [] = check(digraph:vertices(G), [x,y]),
  157:    ?line digraph:del_vertices(G, [x,y]),
  158:    ?line [] = digraph:vertices(G),
  159:    ?line digraph:delete(G),
<a name="160"></a>  160:    ok.
  161:
<a name=edges>  162:<b>edges</b></a>(doc) -&gt; [];
<a name=edges>  163:<b>edges</b></a>(suite) -&gt; [];
<a name=edges>  164:<b>edges</b></a>(Config) when list(Config) -&gt;
  165:    ?line G = build_graph([], [{x, [{exy,y},{exx,x}]},
  166:			       {y, [{eyx,x}]}
  167:			      ]),
  168:    ?line [] = check(digraph:edges(G), [exy, eyx, exx]),
  169:    ?line [] = check(digraph:out_edges(G, x), [exy,exx]),
<a name="170"></a>  170:    ?line [] = check(digraph:in_edges(G, x), [eyx,exx]),
  171:    ?line [] = check(digraph:out_edges(G, y), [eyx]),
  172:    ?line [] = check(digraph:in_edges(G, y), [exy]),
  173:    ?line digraph:del_edges(G, [exy, eyx]),
  174:    ?line [exx] = digraph:edges(G),
  175:    ?line [] = check(digraph:out_edges(G, x), [exx]),
  176:    ?line [] = check(digraph:in_edges(G, x), [exx]),
  177:    ?line [] = check(digraph:out_edges(G, y), []),
  178:    ?line [] = check(digraph:in_edges(G, y), []),
  179:    ?line digraph:del_vertices(G, [x,y]),
<a name="180"></a>  180:    ?line [] = digraph:edges(G),
  181:    ?line [] = digraph:vertices(G),
  182:    ?line digraph:delete(G),
  183:    ok.
  184:
<a name=data>  185:<b>data</b></a>(doc) -&gt; [];
<a name=data>  186:<b>data</b></a>(suite) -&gt; [];
<a name=data>  187:<b>data</b></a>(Config) when list(Config) -&gt;
  188:    ?line G = build_graph([], [{x, [{exy, y}]}, {y, []}]),
  189:    
<a name="190"></a>  190:    ?line {x,[]} = digraph:vertex(G, x),
  191:    ?line {y,[]} = digraph:vertex(G, y),
  192:    ?line {exy,x,y,[]} = digraph:edge(G, exy),
  193:
  194:    ?line digraph:add_edge(G, exy, x, y, {data,x,y}),
  195:    ?line digraph:add_vertex(G, x, {any}),
  196:    ?line digraph:add_vertex(G, y, '_'),
  197:
  198:    ?line {x,{any}} = digraph:vertex(G, x),
  199:    ?line {y,'_'} = digraph:vertex(G, y),
<a name="200"></a>  200:    ?line {exy,x,y,{data,x,y}} = digraph:edge(G, exy),
  201:    ?line digraph:delete(G),
  202:    ok.
  203:
  204:
  205:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
  206:
  207:
<a name=tickets>  208:<b>tickets</b></a>(suite) -&gt; [otp_3522, otp_3630].
  209:
<a name=otp_3522><a name="210"></a>  210:<b>otp_3522</b></a>(doc) -&gt; [];
<a name=otp_3522>  211:<b>otp_3522</b></a>(suite) -&gt; [];
<a name=otp_3522>  212:<b>otp_3522</b></a>(Config) when list(Config) -&gt;
  213:    ?line G1 = build_graph([acyclic], [{x, []}]),
  214:    ?line {error, {bad_edge,_}} = digraph:add_edge(G1, x, x),
  215:    ?line true = digraph:delete(G1),
  216:
  217:    ?line G = digraph:new(),
  218:    ?line 0 = digraph:no_vertices(G),
  219:    ?line 0 = digraph:no_edges(G),
<a name="220"></a>  220:    ?line V1 = digraph:add_vertex(G),
  221:    ?line '$vid' = digraph:add_vertex(G, '$vid'),
  222:    ?line V2 = digraph:add_vertex(G),
  223:    ?line '$eid' = digraph:add_edge(G, '$eid', V1, V2, []),
  224:    ?line E = digraph:add_edge(G, V1, V2),
  225:    ?line 3 = digraph:no_vertices(G),
  226:    ?line 2 = digraph:no_edges(G),
  227:    ?line cyclic = info(G, cyclicity),
  228:    ?line protected = info(G, protection),
  229:
<a name="230"></a>  230:    ?line [] = check(digraph:in_edges(G, V2), ['$eid', E]),
  231:    ?line [] = check(digraph:out_edges(G, V1), ['$eid', E]),
  232:    ?line [] = check(digraph:vertices(G), [V1,V2,'$vid']),
  233:    ?line [] = check(digraph:edges(G), [E, '$eid']),
  234:    ?line true = digraph:delete(G),
  235:    ok.
  236:
<a name=otp_3630>  237:<b>otp_3630</b></a>(doc) -&gt; [];
<a name=otp_3630>  238:<b>otp_3630</b></a>(suite) -&gt; [];
<a name=otp_3630>  239:<b>otp_3630</b></a>(Config) when list(Config) -&gt;
<a name="240"></a>  240:    ?line G = build_graph([], [{x, [{exy,y},{exx,x}]},
  241:			       {y, [{eyy,y},{eyx,x}]}
  242:			      ]),
  243:    ?line [x,y] = digraph:get_path(G, x, y),
  244:    ?line [y,x] = digraph:get_path(G, y, x),
  245:
  246:    ?line [x,x] = digraph:get_short_path(G, x, x),
  247:    ?line [y,y] = digraph:get_short_path(G, y, y),
  248:    ?line true = digraph:delete(G),
  249:
<a name="250"></a>  250:    ?line G1 = build_graph([], [{1, [{12,2},{13,3},{11,1}]},
  251:				{2, [{23,3}]},
  252:				{3, [{34,4},{35,5}]},
  253:				{4, [{45,5}]},
  254:				{5, [{56,6},{57,7}]},
  255:				{6, [{67,7}]},
  256:				{7, [{71,1}]}
  257:			       ]),
  258:    
  259:    ?line [1,3,5,7] = digraph:get_short_path(G1, 1, 7),
<a name="260"></a>  260:    ?line [3,5,7,1,3] = digraph:get_short_cycle(G1, 3),
  261:    ?line [1,1] = digraph:get_short_cycle(G1, 1),
  262:    ?line true = digraph:delete(G1),
  263:
  264:    F = 0.0, I = round(F),
  265:    ?line G2 = digraph:new([acyclic]),
  266:    ?line digraph:add_vertex(G2, F),
  267:    ?line digraph:add_vertex(G2, I),
  268:    ?line E = digraph:add_edge(G2, F, I),
  269:    ?line true = not is_tuple(E),
<a name="270"></a>  270:    ?line true = digraph:delete(G2),
  271:
  272:    ok.
  273:
  274:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
  275:
<a name=build_graph>  276:<b>build_graph</b></a>(Opts, Gs) -&gt;
  277:    G = digraph:new(Opts),
  278:    build_g(G, Gs).
  279:
<a name=build_g><a name="280"></a>  280:<b>build_g</b></a>(G, [{V,Ns} | Gs]) -&gt;
  281:    digraph:add_vertex(G, V),
  282:    build_ns(G, V, Ns),
  283:    build_g(G, Gs);
<a name=build_g>  284:<b>build_g</b></a>(G, []) -&gt; G.
  285:
<a name=build_ns>  286:<b>build_ns</b></a>(G, V, [{E,W} | Ns]) -&gt;
  287:    digraph:add_vertex(G, W),
  288:    digraph:add_edge(G, E, V, W, []),
  289:    build_ns(G, V, Ns);
<a name=build_ns><a name="290"></a>  290:<b>build_ns</b></a>(G, V, [W | Ns]) -&gt;
  291:    digraph:add_vertex(G, W),
  292:    digraph:add_edge(G, V, W),
  293:    build_ns(G, V, Ns);
<a name=build_ns>  294:<b>build_ns</b></a>(_G, _V, []) -&gt;
  295:    true.
  296:
  297:<i>%% Spawn a process that create a graph return {Pid, Graph}</i>
  298:
<a name=spawn_graph>  299:<b>spawn_graph</b></a>(Opts) -&gt;
<a name="300"></a>  300:    Pid = spawn(?MODULE, spawn_graph, [self(),Opts]),
  301:    receive
  302:	{Pid, G} -&gt; {Pid,G}
  303:    end.
  304:
  305:<i>%% Create a graph and wait for die message</i>
<a name=spawn_graph>  306:<b>spawn_graph</b></a>(Starter, Opts) -&gt;
  307:    G = digraph:new(Opts),
  308:    Starter ! {self(), G},
  309:    receive
<a name="310"></a>  310:	die -&gt; true
  311:    end.
  312:
<a name=info>  313:<b>info</b></a>(G, What) -&gt;
  314:    case lists:keysearch(What, 1, digraph:info(G)) of
  315:	{value, {What, Value}} -&gt; Value;
  316:	false -&gt; []
  317:    end.
  318:
  319:<i>%% Kill process created by spawn_graph</i>
<a name=kill_graph><a name="320"></a>  320:<b>kill_graph</b></a>(Pid) -&gt;
  321:    Pid ! die.
  322:
<a name=check>  323:<b>check</b></a>(R0, E0) -&gt;
  324:    R = lists:sort(R0),
  325:    E = lists:sort(E0),
  326:    case R of
  327:	E -&gt;
  328:	    [];
  329:	_ -&gt;
<a name="330"></a>  330:	    (R -- E) ++ (E -- R)
  331:    end.
</pre>
<hr size=1><i>The transformation of this file (332 lines) took 0.00 seconds</i><br>
</body>
</html>
