<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/calendar_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:-<b>module</b>(calendar_SUITE).
   19:
<a name="20"></a>   20:-<b>include</b>("test_server.hrl").
   21:
   22:-<b>export</b>([all/1, 
   23:	 gregorian_days/1,
   24:	 gregorian_seconds/1,
   25:	 day_of_the_week/1,
   26:	 day_of_the_week_calibrate/1,
   27:	 leap_years/1,
   28:	 last_day_of_the_month/1,
   29:	 local_time_to_universal_time_dst/1]).
<a name="30"></a>   30:
   31:-<b>define</b>(START_YEAR, 1947).			
   32:-<b>define</b>(END_YEAR, 2012).
   33:
<a name=all>   34:<b>all</b></a>(suite) -&gt; [gregorian_days,
   35:	       gregorian_seconds,
   36:	       day_of_the_week,
   37:	       day_of_the_week_calibrate,
   38:	       leap_years,
   39:	       last_day_of_the_month,
<a name="40"></a>   40:	       local_time_to_universal_time_dst];
   41:
<a name=all>   42:<b>all</b></a>(doc) -&gt; "This is the test suite for calendar.erl".
   43:
<a name=gregorian_days>   44:<b>gregorian_days</b></a>(doc) -&gt;
   45:    "Tests that date_to_gregorian_days and gregorian_days_to_date "
   46:    "are each others inverses from ?START_YEAR-01-01 up to ?END_YEAR-01-01. "
   47:    "At the same time valid_date is tested.";
<a name=gregorian_days>   48:<b>gregorian_days</b></a>(suite) -&gt;
   49:    [];
<a name=gregorian_days><a name="50"></a>   50:<b>gregorian_days</b></a>(Config) when list(Config) -&gt;
   51:    ?line Days = calendar:date_to_gregorian_days({?START_YEAR, 1, 1}),
   52:    ?line MaxDays = calendar:date_to_gregorian_days({?END_YEAR, 1, 1}),
   53:    ?line check_gregorian_days(Days, MaxDays).
   54:
<a name=gregorian_seconds>   55:<b>gregorian_seconds</b></a>(doc) -&gt;
   56:    "Tests that datetime_to_gregorian_seconds and "
   57:    "gregorian_seconds_to_date are each others inverses for a sampled "
   58:    "number of seconds from ?START_YEAR-01-01 up to ?END_YEAR-01-01: We check "
   59:    "every 2 days + 1 second.";
<a name=gregorian_seconds><a name="60"></a>   60:<b>gregorian_seconds</b></a>(suite) -&gt;
   61:    [];
<a name=gregorian_seconds>   62:<b>gregorian_seconds</b></a>(Config) when list(Config) -&gt;
   63:    ?line Secs = calendar:datetime_to_gregorian_seconds({{?START_YEAR, 1, 1},
   64:							 {0, 0, 0}}),
   65:    ?line MaxSecs = calendar:datetime_to_gregorian_seconds({{?END_YEAR, 1, 1},
   66:							    {0, 0, 0}}),
   67:    ?line check_gregorian_seconds(Secs, MaxSecs).
   68:
<a name=day_of_the_week>   69:<b>day_of_the_week</b></a>(doc) -&gt;
<a name="70"></a>   70:    "Tests that day_of_the_week reports correctly the day of the week from "
   71:    "year ?START_YEAR up to ?END_YEAR.";
<a name=day_of_the_week>   72:<b>day_of_the_week</b></a>(suite) -&gt;
   73:    [];
<a name=day_of_the_week>   74:<b>day_of_the_week</b></a>(Config) when list(Config) -&gt;
   75:    ?line Days = calendar:date_to_gregorian_days({?START_YEAR, 1, 1}),
   76:    ?line MaxDays = calendar:date_to_gregorian_days({?END_YEAR, 1, 1}),
   77:    ?line DayNumber = calendar:day_of_the_week({?START_YEAR, 1, 1}),
   78:    ?line check_day_of_the_week(Days, MaxDays, DayNumber).
   79:
<a name=day_of_the_week_calibrate><a name="80"></a>   80:<b>day_of_the_week_calibrate</b></a>(doc) -&gt;
   81:    "Tests that day_of_the_week for 1997-11-11 is Tuesday (2)";
<a name=day_of_the_week_calibrate>   82:<b>day_of_the_week_calibrate</b></a>(suite) -&gt;
   83:    [];
<a name=day_of_the_week_calibrate>   84:<b>day_of_the_week_calibrate</b></a>(Config) when list(Config) -&gt;
   85:    ?line 2 = calendar:day_of_the_week({1997, 11, 11}).
   86:
<a name=leap_years>   87:<b>leap_years</b></a>(doc) -&gt;
   88:    "Tests that is_leap_year reports correctly the leap years from "
   89:    "year ?START_YEAR up to ?END_YEAR.";
<a name=leap_years><a name="90"></a>   90:<b>leap_years</b></a>(suite) -&gt;
   91:    [];
<a name=leap_years>   92:<b>leap_years</b></a>(Config) when list(Config) -&gt;
   93:    ?line check_leap_years(?START_YEAR, ?END_YEAR).
   94:
<a name=last_day_of_the_month>   95:<b>last_day_of_the_month</b></a>(doc) -&gt;
   96:    "Tests that last_day_of_the_month reports correctly from "
   97:    "year ?START_YEAR up to ?END_YEAR.";
<a name=last_day_of_the_month>   98:<b>last_day_of_the_month</b></a>(suite) -&gt;
   99:    [];
<a name=last_day_of_the_month><a name="100"></a>  100:<b>last_day_of_the_month</b></a>(Config) when list(Config) -&gt;
  101:    ?line check_last_day_of_the_month({?START_YEAR, 1}, {?END_YEAR, 1}).
  102:
<a name=local_time_to_universal_time_dst>  103:<b>local_time_to_universal_time_dst</b></a>(doc) -&gt;
  104:    "Tests local_time_to_universal_time_dst for MET";
<a name=local_time_to_universal_time_dst>  105:<b>local_time_to_universal_time_dst</b></a>(suite) -&gt;
  106:    [];
<a name=local_time_to_universal_time_dst>  107:<b>local_time_to_universal_time_dst</b></a>(Config) when list(Config) -&gt;
  108:    %% Assumes MET (UTC+1 / UTC+2(dst)
  109:    ?line LtW   = {{2003,01,15},{14,00,00}}, % Winter
<a name="110"></a>  110:    ?line UtW   = {{2003,01,15},{13,00,00}}, % 
  111:    ?line UtWd  = {{2003,01,15},{12,00,00}}, % dst
  112:    ?line LtS   = {{2003,07,15},{14,00,00}}, % Summer
  113:    ?line UtS   = {{2003,07,15},{13,00,00}}, % 
  114:    ?line UtSd  = {{2003,07,15},{12,00,00}}, % dst
  115:    ?line LtWS  = {{2003,03,30},{02,30,00}}, % Winter-&gt;Summer
  116:    ?line UtWS  = {{2003,03,30},{01,30,00}}, % 
  117:    ?line UtWSd = {{2003,03,30},{00,30,00}}, % dst
  118:    ?line LtSW  = {{2003,10,26},{02,30,00}}, % Summer-&gt;Winter
  119:    ?line UtSW  = {{2003,10,26},{01,30,00}}, % 
<a name="120"></a>  120:    ?line UtSWd = {{2003,10,26},{00,30,00}}, % dst
  121:    %%
  122:    ?line UtW   = calendar:local_time_to_universal_time(LtW, false),
  123:    ?line UtWd  = calendar:local_time_to_universal_time(LtW, true),
  124:    ?line UtW   = calendar:local_time_to_universal_time(LtW, undefined),
  125:    %%
  126:    ?line UtS   = calendar:local_time_to_universal_time(LtS, false),
  127:    ?line UtSd  = calendar:local_time_to_universal_time(LtS, true),
  128:    ?line UtSd  = calendar:local_time_to_universal_time(LtS, undefined),
  129:    %%
<a name="130"></a>  130:    ?line UtWS  = calendar:local_time_to_universal_time(LtWS, false),
  131:    ?line UtWSd = calendar:local_time_to_universal_time(LtWS, true),
  132:    ?line []    = calendar:local_time_to_universal_time_dst(LtWS),
  133:    %%
  134:    ?line UtSW  = calendar:local_time_to_universal_time(LtSW, false),
  135:    ?line UtSWd = calendar:local_time_to_universal_time(LtSW, true),
  136:    ?line [UtSWd, UtSW] = calendar:local_time_to_universal_time_dst(LtSW),
  137:    %%
  138:    ok.
  139:
<a name="140"></a>  140:<i>%%</i>
  141:<i>%% LOCAL FUNCTIONS</i>
  142:<i>%%</i>
  143:
  144:<i>%% check_gregorian_days</i>
  145:<i>%% </i>
<a name=check_gregorian_days>  146:<b>check_gregorian_days</b></a>(Days, MaxDays) when Days &lt; MaxDays -&gt;
  147:    ?line Date = calendar:gregorian_days_to_date(Days), 
  148:    ?line true = calendar:valid_date(Date),
  149:    ?line Days = calendar:date_to_gregorian_days(Date),
<a name="150"></a>  150:    ?line check_gregorian_days(Days + 1, MaxDays);
<a name=check_gregorian_days>  151:<b>check_gregorian_days</b></a>(_Days, _MaxDays) -&gt;
  152:    ok.
  153:
  154:<i>%% check_gregorian_seconds</i>
  155:<i>%% </i>
  156:<i>%% We increment with something prime (172801 = 2 days + 1 second).</i>
  157:<i>%%</i>
<a name=check_gregorian_seconds>  158:<b>check_gregorian_seconds</b></a>(Secs, MaxSecs) when Secs &lt; MaxSecs -&gt;
  159:    ?line DateTime = calendar:gregorian_seconds_to_datetime(Secs), 
<a name="160"></a>  160:    ?line Secs = calendar:datetime_to_gregorian_seconds(DateTime),
  161:    ?line check_gregorian_seconds(Secs + 172801, MaxSecs);
<a name=check_gregorian_seconds>  162:<b>check_gregorian_seconds</b></a>(_Secs, _MaxSecs) -&gt;
  163:    ok.
  164:
  165:
  166:<i>%% check_day_of_the_week</i>
  167:<i>%%</i>
<a name=check_day_of_the_week>  168:<b>check_day_of_the_week</b></a>(Days, MaxDays, DayNumber) when Days &lt; MaxDays -&gt;
  169:    ?line Date = calendar:gregorian_days_to_date(Days),
<a name="170"></a>  170:    ?line DayNumber = calendar:day_of_the_week(Date),
  171:    ?line check_day_of_the_week(Days + 1, MaxDays, 
  172:				((DayNumber rem 7) + 1));
<a name=check_day_of_the_week>  173:<b>check_day_of_the_week</b></a>(_Days, _MaxDays, _DayNumber) -&gt;
  174:    ok.
  175:
  176:<i>%% check_leap_years</i>
  177:<i>%%</i>
  178:<i>%% SYr must be larger than 1800, and EYr must be less than ?END_YEAR.</i>
  179:<i>%%</i>
<a name=check_leap_years><a name="180"></a>  180:<b>check_leap_years</b></a>(SYr, EYr) when SYr &lt; EYr -&gt;
  181:    ?line Rem = SYr rem 4,
  182:    case Rem of
  183:	0 -&gt;
  184:	    case SYr of
  185:		1900 -&gt;
  186:		    ?line false = calendar:is_leap_year(SYr);
  187:		2000 -&gt;
  188:		    ?line true = calendar:is_leap_year(SYr);
  189:		_  -&gt;
<a name="190"></a>  190:		    ?line true = calendar:is_leap_year(SYr)
  191:	    end;
  192:	_ -&gt;
  193:	    ?line false = calendar:is_leap_year(SYr)
  194:    end,
  195:    check_leap_years(SYr + 1, EYr);
<a name=check_leap_years>  196:<b>check_leap_years</b></a>(_SYr, _EYr) -&gt;
  197:    ok.
  198:
<a name=check_last_day_of_the_month>  199:<b>check_last_day_of_the_month</b></a>({SYr, SMon}, {EYr, EMon}) when SYr &lt; EYr -&gt;
<a name="200"></a>  200:    ?line LastDay = calendar:last_day_of_the_month(SYr, SMon),
  201:    ?line LastDay = case SMon of
  202:			 1 -&gt; 31;
  203:			 2 -&gt;
  204:			     case calendar:is_leap_year(SYr) of
  205:				 true -&gt; 29;
  206:				 false  -&gt; 28
  207:			     end;
  208:			 3 -&gt; 31;
  209:			 4 -&gt; 30;
<a name="210"></a>  210:			 5 -&gt; 31;
  211:			 6 -&gt; 30;
  212:			 7 -&gt; 31;
  213:			 8 -&gt; 31;
  214:			 9 -&gt; 30;
  215:			 10 -&gt; 31;
  216:			 11 -&gt; 30;
  217:			 12 -&gt; 31
  218:		     end,
  219:    ?line NYr = case SMon of
<a name="220"></a>  220:		    12 -&gt; SYr + 1;
  221:		    _ -&gt; SYr
  222:		end,
  223:    ?line check_last_day_of_the_month({NYr, (SMon rem 12) + 1}, 
  224:				      {EYr, EMon});
<a name=check_last_day_of_the_month>  225:<b>check_last_day_of_the_month</b></a>(_, _) -&gt;
  226:    ok.
  227:
  228:
  229:    
<a name="230"></a>  230:
  231:
</pre>
<hr size=1><i>The transformation of this file (232 lines) took 0.01 seconds</i><br>
</body>
</html>
