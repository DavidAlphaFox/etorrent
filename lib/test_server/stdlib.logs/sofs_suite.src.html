<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/sofs_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id $</i>
   17:<i>%%</i>
   18:-<b>module</b>(sofs_SUITE).
   19:
<a name="20"></a>   20:<i>%-define(debug, true).</i>
   21:
   22:-<b>ifdef</b>(debug).
   23:-<b>define</b>(format(S, A), io:format(S, A)).
   24:-<b>define</b>(line, put(line, ?LINE), ).
   25:-<b>define</b>(config(X,Y), foo).
   26:-<b>define</b>(t, test_server).
   27:-<b>else</b>.
   28:-<b>include</b>("test_server.hrl").
   29:-<b>define</b>(format(S, A), ok).
<a name="30"></a>   30:-<b>endif</b>.
   31:
   32:-<b>export</b>([all/1]).
   33:
   34:-<b>export</b>([sofs/1, from_term_1/1, set_1/1, from_sets_1/1, relation_1/1,
   35:	 a_function_1/1, family_1/1, projection/1,
   36:	 relation_to_family_1/1, domain_1/1, range_1/1, image/1,
   37:	 inverse_image/1, inverse_1/1, converse_1/1, no_elements_1/1,
   38:	 substitution/1, restriction/1, drestriction/1,
   39:	 strict_relation_1/1, extension/1, weak_relation_1/1,
<a name="40"></a>   40:	 to_sets_1/1, specification/1, union_1/1, intersection_1/1,
   41:	 difference/1, symdiff/1, symmetric_partition/1,
   42:	 is_sofs_set_1/1, is_set_1/1, is_equal/1, is_subset/1,
   43:	 is_a_function_1/1, is_disjoint/1, join/1, canonical/1,
   44:	 composite_1/1, relative_product_1/1, relative_product_2/1,
   45:	 product_1/1, partition_1/1, partition_3/1,
   46:	 multiple_relative_product/1, digraph/1, constant_function/1,
   47:	 misc/1]).
   48:
   49:-<b>export</b>([sofs_family/1, family_specification/1,
<a name="50"></a>   50:         family_domain_1/1, family_range_1/1,
   51:	 family_to_relation_1/1, 
   52:         union_of_family_1/1, intersection_of_family_1/1,
   53:         family_projection/1, family_difference/1, 
   54:         family_intersection_1/1, family_union_1/1,
   55:         family_intersection_2/1, family_union_2/1,
   56:         partition_family/1]).
   57:
   58:-<b>import</b>(sofs, 
   59:	[a_function/1, a_function/2, constant_function/2,
<a name="60"></a>   60:	 canonical_relation/1, composite/2, condensation/1,
   61:	 converse/1, extension/3, from_term/1, from_term/2,
   62:	 difference/2, domain/1, empty_set/0, family_difference/2,
   63:	 family_intersection/1, family_intersection/2, family_union/1,
   64:	 family_union/2, family/1, family/2, family_specification/2,
   65:	 family_domain/1, family_range/1, family_field/1,
   66:	 family_projection/2, family_to_relation/1, union_of_family/1,
   67:	 field/1, from_external/2, image/2, intersection/1,
   68:	 intersection/2, intersection_of_family/1, inverse/1,
   69:	 inverse_image/2, is_disjoint/2, is_empty_set/1, is_equal/2,
<a name="70"></a>   70:	 is_a_function/1, is_set/1, is_sofs_set/1, is_subset/2,
   71:	 join/4, from_sets/1, multiple_relative_product/2,
   72:	 no_elements/1, partition/1, partition/2, partition/3,
   73:	 partition_family/2, product/1, product/2, projection/2,
   74:	 range/1, relation/1, relation/2, relation_to_family/1,
   75:	 relative_product/1, relative_product/2, relative_product1/2,
   76:	 strict_relation/1, weak_relation/1, restriction/2,
   77:	 restriction/3, drestriction/2, drestriction/3, to_sets/1,
   78:	 is_type/1, set/1, set/2, specification/2, substitution/2,
   79:	 symdiff/2, symmetric_partition/2, to_external/1, type/1,
<a name="80"></a>   80:	 union/1, union/2, family_to_digraph/1, family_to_digraph/2,
   81:	 digraph_to_family/1, digraph_to_family/2]).
   82:
   83:-<b>export</b>([init_per_testcase/2, fin_per_testcase/2]).
   84:
   85:-<b>compile</b>({inline,[{eval,2}]}).
   86:
<a name=all>   87:<b>all</b></a>(suite) -&gt;
   88:    [sofs, sofs_family].
   89:
<a name=init_per_testcase><a name="90"></a>   90:<b>init_per_testcase</b></a>(_Case, Config) -&gt;
   91:    Dog=?t:timetrap(?t:minutes(2)),
   92:    [{watchdog, Dog}|Config].
   93:
<a name=fin_per_testcase>   94:<b>fin_per_testcase</b></a>(_Case, Config) -&gt;
   95:    Dog=?config(watchdog, Config),
   96:    test_server:timetrap_cancel(Dog),
   97:    ok.
   98:
   99:<i>%% [{2,b},{1,a,b}] == lists:sort([{2,b},{1,a,b}])</i>
<a name="100"></a>  100:<i>%% [{1,a,b},{2,b}] == lists:keysort(1,[{2,b},{1,a,b}])</i>
  101:
<a name=sofs>  102:<b>sofs</b></a>(suite) -&gt;
  103:    [from_term_1, set_1, from_sets_1, relation_1, a_function_1,
  104:     family_1, relation_to_family_1, domain_1, range_1, image,
  105:     inverse_image, inverse_1, converse_1, no_elements_1,
  106:     substitution, restriction, drestriction, projection,
  107:     strict_relation_1, extension, weak_relation_1, to_sets_1,
  108:     specification, union_1, intersection_1, difference, symdiff,
  109:     symmetric_partition, is_sofs_set_1, is_set_1, is_equal,
<a name="110"></a>  110:     is_subset, is_a_function_1, is_disjoint, join, canonical,
  111:     composite_1, relative_product_1, relative_product_2, product_1,
  112:     partition_1, partition_3, multiple_relative_product, digraph,
  113:     constant_function, misc].
  114:
<a name=from_term_1>  115:<b>from_term_1</b></a>(suite) -&gt; [];
<a name=from_term_1>  116:<b>from_term_1</b></a>(doc) -&gt; [""];
<a name=from_term_1>  117:<b>from_term_1</b></a>(Conf) when list(Conf) -&gt;
  118:    %% would go wrong: projection(1,from_term([{2,b},{1,a,b}])),
  119:
<a name="120"></a>  120:    ?line {'EXIT', {badarg, _}} = (catch from_term([], {atom,'_',atom})),
  121:    ?line {'EXIT', {badarg, _}} = (catch from_term([], [])),
  122:    ?line {'EXIT', {badarg, _}} = (catch from_term([], [atom,atom])),
  123:
  124:    ?line [] = to_external(from_term([])),
  125:    ?line eval(from_term([]), empty_set()),
  126:    ?line [] = to_external(from_term([], ['_'])),
  127:    ?line eval(from_term([], ['_']), empty_set()),
  128:    ?line [[]] = to_external(from_term([[]])),
  129:    ?line [[['_']]] = type(from_term([[],[[]]])),
<a name="130"></a>  130:    ?line [[],[[]]] = to_external(from_term([[],[[]]])),
  131:    ?line [[['_']]] = type(from_term([[],[[]]])),
  132:    ?line eval(from_term([a],['_']), set([a])),
  133:    ?line [[],[a]] = to_external(from_term([[],[a]])),
  134:    ?line [[],[{a}]] = to_external(from_term([[{a}],[]])),
  135:    ?line [{[],[{a,b,[d]}]},{[{a,b}],[]}] =
  136:	to_external(from_term([{[],[{a,b,[d]}]},{[{a,b}],[]}])),
  137:
  138:    ?line [{[a,b],[c,d]}] = to_external(from_term([{[a,b],[c,d]}])),
  139:    ?line [{{a,b},[a,b],{{a},{b}}}] =
<a name="140"></a>  140:	to_external(from_term([{{a,b},[a,b],{{a},{b}}}])),
  141:    ?line [{{a,{[a,b]},a}},{{z,{[y,z]},z}}] =
  142:	to_external(from_term([{{a,{[a,b,a]},a}},{{z,{[y,y,z]},z}}])),
  143:    ?line {'EXIT', {badarg, _}} = 
  144:	(catch from_term([{m1,[{m1,f1,1},{m1,f2,2}]},{m2,[]},{m3,[a]}])),
  145:    ?line MS1 = [{m1,[{m1,f1,1},{m1,f2,2}]},{m2,[]},{m3,[{m3,f3,3}]}],
  146:    ?line eval(to_external(from_term(MS1)), MS1),
  147:
  148:    ?line eval(to_external(from_term(a)), a),
  149:    ?line eval(to_external(from_term({a})), {a}),
<a name="150"></a>  150:
  151:    ?line eval(to_external(from_term([[a],[{b,c}]],[[atomic]])),
  152:	       [[a],[{b,c}]]),
  153:    ?line eval(type(from_term([[a],[{b,c}]],[[atomic]])),
  154:	       [[atomic]]),
  155:
  156:    ?line {'EXIT', {badarg, _}} = (catch from_term([[],[],a])),
  157:    ?line {'EXIT', {badarg, _}} = (catch from_term([{[a,b],[c,{d}]}])),
  158:    ?line {'EXIT', {badarg, _}} = (catch from_term([[],[a],[{a}]])),
  159:    ?line {'EXIT', {badarg, _}} = (catch from_term([a,{a,b}])),
<a name="160"></a>  160:    ?line {'EXIT', {badarg, _}} = (catch from_term([[a],[{b,c}]],[['_']])),
  161:    ?line {'EXIT', {badarg, _}} = (catch from_term([a | {a,b}])),
  162:    ?line {'EXIT', {badarg, _}} = 
  163:	(catch from_term([{{a},b,c},{d,e,f}],[{{atom},atom,atom}])),
  164:    ?line {'EXIT', {badarg, _}} = 
  165:	(catch from_term([{a,{b,c}} | tail], [{atom,{atom,atom}}])),
  166:    ?line {'EXIT', {badarg, _}} = (catch from_term({})),
  167:    ?line {'EXIT', {badarg, _}} = (catch from_term([{}])),
  168:
  169:    ?line [{foo,bar},[b,a]] = 
<a name="170"></a>  170:        to_external(from_term([[b,a],{foo,bar},[b,a]], [atom])),
  171:    ?line [{[atom],{atom,atom}}] = 
  172:	type(from_term([{[], {a,b}},{[a,b],{e,f}}])),
  173:    ?line [{[atom],{atom,atom}}] = 
  174:	type(from_term([{[], {a,b}},{[a,b],{e,f}}], [{[atom],{atom,atom}}])),
  175:    ?line [[atom]] = type(from_term([[a],[{b,c}]],[[atom]])),
  176:
  177:    ?line {atom, atom} = type(from_term({a,b}, {atom, atom})),
  178:    ?line atom = type(from_term(a, atom)),
  179:    ?line {'EXIT', {badarg, _}} = (catch from_term({a,b},{atom})),
<a name="180"></a>  180:    ?line [{{a},b,c},{{d},e,f}] = 
  181:	to_external(from_term([{{a},b,c},{{a},b,c},{{d},e,f}],
  182:			      [{{atom},atom,atom}])),
  183:
  184:    %% from_external too...
  185:    ?line e = to_external(from_external(e, atom)),
  186:    ?line {e} = to_external(from_external({e}, {atom})),
  187:    ?line [e] = to_external(from_external([e], [atom])),
  188:
  189:    %% and is_type...
<a name="190"></a>  190:    ?line true = is_type(['_']),
  191:    ?line false = is_type('_'),
  192:    ?line true = is_type([['_']]),
  193:    ?line false = is_type({atom,[],atom}),
  194:    ?line false = is_type({atom,'_',atom}),
  195:    ?line true = is_type({atom,atomic,atom}),
  196:    ?line true = is_type({atom,atom}),
  197:    ?line true = is_type(atom),
  198:    ?line true = is_type([atom]),
  199:    ?line true = is_type(type),
<a name="200"></a>  200:
  201:    ok.
  202:
<a name=set_1>  203:<b>set_1</b></a>(suite) -&gt; [];
<a name=set_1>  204:<b>set_1</b></a>(doc) -&gt; [""];
<a name=set_1>  205:<b>set_1</b></a>(Conf) when list(Conf) -&gt;
  206:    %% set/1
  207:    ?line {'EXIT', {badarg, _}} = (catch set(a)),
  208:    ?line {'EXIT', {badarg, _}} = (catch set({a})),
  209:    ?line eval(set([]), from_term([],[atom])),
<a name="210"></a>  210:    ?line eval(set([a,b,c]), from_term([a,b,c])),
  211:    ?line eval(set([a,b,a,a,b]), from_term([a,b])),
  212:    ?line eval(set([a,b,c,a,d,d,c,1]), from_term([1,a,b,c,d])),
  213:    ?line eval(set([a,b,d,a,c]), from_term([a,b,c,d])),
  214:    ?line eval(set([f,e,d,c,d]), from_term([c,d,e,f])),
  215:    ?line eval(set([h,f,d,g,g,d,c]), from_term([c,d,f,g,h])),
  216:    ?line eval(set([h,e,d,k,l]), from_term([d,e,h,k,l])),
  217:    ?line eval(set([h,e,c,k,d]), from_term([c,d,e,h,k])),
  218:
  219:    %% set/2
<a name="220"></a>  220:    ?line {'EXIT', {badarg, _}} = (catch set(a, [a])),
  221:    ?line {'EXIT', {badarg, _}} = (catch set({a}, [a])),
  222:    ?line {'EXIT', {badarg, _}} = (catch set([a], {a})),
  223:    ?line {'EXIT', {badarg, _}} = (catch set([a], a)),
  224:    ?line {'EXIT', {badarg, _}} = (catch set([a], [a,b])),
  225:    ?line {'EXIT', {badarg, _}} = (catch set([a | b],[foo])),
  226:    ?line {'EXIT', {badarg, _}} = (catch set([a | b],['_'])),
  227:    ?line {'EXIT', {badarg, _}} = (catch set([a | b],[[atom]])),
  228:    ?line {'EXIT', {badarg, _}} = (catch set([{}],[{}])),
  229:    ?line eval(set([a],['_']), from_term([a],['_'])),
<a name="230"></a>  230:    ?line eval(set([], ['_']), empty_set()),
  231:    ?line eval(set([a,b,a,b],[foo]), from_term([a,b],[foo])),
  232:
  233:    ok.
  234:
<a name=from_sets_1>  235:<b>from_sets_1</b></a>(suite) -&gt; [];
<a name=from_sets_1>  236:<b>from_sets_1</b></a>(doc) -&gt; [""];
<a name=from_sets_1>  237:<b>from_sets_1</b></a>(Conf) when list(Conf) -&gt;
  238:    ?line E = empty_set(),
  239:
<a name="240"></a>  240:    %% unordered
  241:    ?line eval(from_sets([]), E),
  242:    ?line {'EXIT', {type_mismatch, _}} = 
  243:	(catch from_sets([from_term([{a,b}]), 
  244:                          E,
  245:                          from_term([{a,b,c}])])),
  246:    ?line eval(from_sets([from_term([{a,b}]), E]), 
  247:               from_term([[],[{a,b}]])),
  248:
  249:    ?line eval(from_sets([from_term({a,b},{atom,atom}), 
<a name="250"></a>  250:                          from_term({b,c},{atom,atom})]),
  251:	       relation([{a,b}, {b,c}])),
  252:    ?line {'EXIT', {type_mismatch, _}} = 
  253:	(catch from_sets([from_term({a,b},{atom,atom}), 
  254:			  from_term({a,b,c},{atom,atom,atom})])),
  255:    ?line {'EXIT', {badarg, _}} = (catch from_sets(foo)),
  256:    ?line eval(from_sets([E]), from_term([[]])),
  257:    ?line eval(from_sets([E,E]), from_term([[]])),
  258:    ?line eval(from_sets([E,set([a])]), from_term([[],[a]])),
  259:    ?line {'EXIT', {badarg, _}} = (catch from_sets([E,{a}])),
<a name="260"></a>  260:    ?line {'EXIT', {type_mismatch, _}} = 
  261:	(catch from_sets([E,from_term({a}),E])),
  262:    ?line {'EXIT', {type_mismatch, _}} = (catch from_sets([from_term({a}),E])),
  263:
  264:    %% ordered
  265:    ?line O = {from_term(a,atom), from_term({b}, {atom}), set([c,d])},
  266:    ?line eval(from_sets(O), from_term({a,{b},[c,d]}, {atom,{atom},[atom]})),
  267:    ?line {'EXIT', {badarg, _}} = (catch from_sets([a,b])),
  268:    ?line {'EXIT', {badarg, _}} = (catch from_sets({a,b})),
  269:    ?line eval(from_sets({from_term({a}),E}), from_term({{a},[]})),
<a name="270"></a>  270:    ok.
  271:
<a name=relation_1>  272:<b>relation_1</b></a>(suite) -&gt; [];
<a name=relation_1>  273:<b>relation_1</b></a>(doc) -&gt; [""];
<a name=relation_1>  274:<b>relation_1</b></a>(Conf) when list(Conf) -&gt;
  275:    %% relation/1
  276:    ?line eval(relation([]), from_term([], [{atom,atom}])),
  277:    ?line eval(from_term([{a}]), relation([{a}])),
  278:    ?line {'EXIT', {badarg, _}} = (catch relation(a)),
  279:    ?line {'EXIT', {badarg, _}} = (catch relation([{a} | a])),
<a name="280"></a>  280:    ?line {'EXIT', {badarg, _}} = (catch relation([{}])),
  281:    ?line {'EXIT', {badarg, _}} = (catch relation([],0)),
  282:
  283:    %% relation/2
  284:    ?line eval(relation([{a},{b}], 1), from_term([{a},{b}])),
  285:    ?line eval(relation([{1,a},{2,b},{1,a}], [{x,y}]),
  286:	       from_term([{1,a},{2,b}], [{x,y}])),
  287:    ?line eval(relation([{[1,2],a},{[2,1],b},{[2,1],a}], [{[x],y}]),
  288:	       from_term([{[1,2],a},{[1,2],b}], [{[x],y}])),
  289:    ?line {'EXIT', {badarg, _}} = (catch relation([{1,a},{2,b}], [{[x],y}])),
<a name="290"></a>  290:    ?line {'EXIT', {badarg, _}} = (catch relation([{1,a},{1,a,b}], [{x,y}])),
  291:    ?line {'EXIT', {badarg, _}} = (catch relation([{a}], 2)),
  292:    ?line {'EXIT', {badarg, _}} = (catch relation([{a},{b},{c,d}], 1)),
  293:    ?line eval(relation([{{a},[{foo,bar}]}], ['_']), 
  294:	       from_term([{{a},[{foo,bar}]}], ['_'])),
  295:    ?line eval(relation([], ['_']), from_term([], ['_'])),
  296:    ?line {'EXIT', {badarg, _}} = (catch relation([[a]],['_'])),
  297:    ?line eval(relation([{[a,b,a]}], [{[atom]}]), from_term([{[a,b,a]}])),
  298:    ?line eval(relation([{[a,b,a],[[d,e,d]]}], [{[atom],[[atom]]}]), 
  299:	       from_term([{[a,b,a],[[d,e,d]]}])),
<a name="300"></a>  300:    ?line eval(relation([{[a,b,a],[[d,e,d]]}], [{atom,[[atom]]}]), 
  301:	       from_term([{[a,b,a],[[d,e,d]]}], [{atom,[[atom]]}])),
  302:    ok.
  303:
<a name=a_function_1>  304:<b>a_function_1</b></a>(suite) -&gt; [];
<a name=a_function_1>  305:<b>a_function_1</b></a>(doc) -&gt; [""];
<a name=a_function_1>  306:<b>a_function_1</b></a>(Conf) when list(Conf) -&gt;
  307:    %% a_function/1
  308:    ?line eval(a_function([]), from_term([], [{atom,atom}])),
  309:    ?line eval(a_function([{a,b},{a,b},{b,c}]), from_term([{a,b},{b,c}])),
<a name="310"></a>  310:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a}])),
  311:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a},{b},{c,d}])),
  312:    ?line {'EXIT', {badarg, _}} = (catch a_function(a)),
  313:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a,b} | a])),
  314:    ?line {'EXIT', {bad_function, _}} = 
  315:	(catch a_function([{a,b},{b,c},{a,c}])),
  316:    F = 0.0, I = round(F),
  317:    if
  318:        F == I -&gt; % term ordering
  319:            ?line {'EXIT', {bad_function, _}} = 
<a name="320"></a>  320:                (catch a_function([{I,a},{F,b}])),
  321:            ?line {'EXIT', {bad_function, _}} = 
  322:                 (catch a_function([{[I],a},{[F],b}],[{[a],b}]));
  323:        true -&gt; 
  324:            ?line 2 = no_elements(a_function([{I,a},{F,b}])),
  325:            ?line 2 = no_elements(a_function([{[I],a},{[F],b}],[{[a],b}]))
  326:    end,
  327:
  328:    %% a_function/2
  329:    FT = [{atom,atom}],
<a name="330"></a>  330:    ?line eval(a_function([], FT), from_term([], FT)),
  331:    ?line eval(a_function([{a,b},{b,c},{b,c}], FT), 
  332:	       from_term([{a,b},{b,c}], FT)),
  333:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a,b}], [{a}])),
  334:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a,b}], [{a,[b,c]}])),
  335:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a}], FT)),
  336:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a},{b},{c,d}], FT)),
  337:    ?line {'EXIT', {badarg, _}} = (catch a_function(a, FT)),
  338:    ?line {'EXIT', {badarg, _}} = (catch a_function([{a,b} | a], FT)),
  339:    ?line eval(a_function([{{a},[{foo,bar}]}], ['_']),
<a name="340"></a>  340:	       from_term([{{a},[{foo,bar}]}], ['_'])),
  341:    ?line eval(a_function([], ['_']), from_term([], ['_'])),
  342:    ?line {'EXIT', {badarg, _}} = (catch a_function([[a]],['_'])),
  343:    ?line {'EXIT', {bad_function, _}} = 
  344:	(catch a_function([{a,b},{b,c},{a,c}], FT)),
  345:    ?line eval(a_function([{a,[a]},{a,[a,a]}], [{atom,[atom]}]),
  346:	       from_term([{a,[a]}])),
  347:    ?line eval(a_function([{[b,a],c},{[a,b],c}], [{[atom],atom}]),
  348:	       from_term([{[a,b],c}])),
  349:    ok.
<a name="350"></a>  350:
<a name=family_1>  351:<b>family_1</b></a>(suite) -&gt; [];
<a name=family_1>  352:<b>family_1</b></a>(doc) -&gt; [""];
<a name=family_1>  353:<b>family_1</b></a>(Conf) when list(Conf) -&gt;
  354:    %% family/1
  355:    ?line eval(family([]), from_term([],[{atom,[atom]}])),
  356:    ?line {'EXIT', {badarg, _}} = (catch family(a)),
  357:    ?line {'EXIT', {badarg, _}} = (catch family([a])),
  358:    ?line {'EXIT', {badarg, _}} = (catch family([{a,b}])),
  359:    ?line {'EXIT', {badarg, _}} = (catch family([{a,[]} | a])),
<a name="360"></a>  360:    ?line {'EXIT', {badarg, _}} = (catch family([{a,[a|b]}])),
  361:    ?line {'EXIT', {bad_function, _}} = 
  362:        (catch family([{a,[a]},{a,[]}])),
  363:    ?line {'EXIT', {bad_function, _}} = 
  364:	(catch family([{a,[]},{b,[]},{a,[a]}])),
  365:    F = 0.0, I = round(F),
  366:    if
  367:        F == I -&gt; % term ordering
  368:            ?line {'EXIT', {bad_function, _}} = 
  369:                (catch family([{I,[a]},{F,[b]}])),
<a name="370"></a>  370:            ?line true = (1 =:= no_elements(family([{a,[I]},{a,[F]}])));
  371:        true -&gt; 
  372:            ?line {'EXIT', {bad_function, _}} = 
  373:                (catch family([{a,[I]},{a,[F]}]))
  374:    end,
  375:    ?line eval(family([{a,[]},{b,[b]},{a,[]}]), from_term([{a,[]},{b,[b]}])),
  376:    ?line eval(to_external(family([{b,[{hej,san},tjo]},{a,[]}])),
  377:               [{a,[]},{b,[tjo,{hej,san}]}]),
  378:    ?line eval(family([{a,[a]},{a,[a,a]}]), family([{a,[a]}])),
  379:
<a name="380"></a>  380:    %% family/2
  381:    FT = [{a,[a]}],
  382:    ?line eval(family([], FT), from_term([],FT)),
  383:    ?line {'EXIT', {badarg, _}} = (catch family(a,FT)),
  384:    ?line {'EXIT', {badarg, _}} = (catch family([a],FT)),
  385:    ?line {'EXIT', {badarg, _}} = (catch family([{a,b}],FT)),
  386:    ?line {'EXIT', {badarg, _}} = (catch family([{a,[]} | a],FT)),
  387:    ?line {'EXIT', {badarg, _}} = (catch family([{a,[a|b]}], FT)),
  388:    ?line {'EXIT', {bad_function, _}} = 
  389:        (catch family([{a,[a]},{a,[]}], FT)),
<a name="390"></a>  390:    ?line {'EXIT', {bad_function, _}} = 
  391:	(catch family([{a,[]},{b,[]},{a,[a]}], FT)),
  392:    ?line eval(family([{a,[]},{b,[b,b]},{a,[]}], FT), 
  393:	       from_term([{a,[]},{b,[b]}], FT)),
  394:    ?line eval(to_external(family([{b,[{hej,san},tjo]},{a,[]}], FT)),
  395:               [{a,[]},{b,[tjo,{hej,san}]}]),
  396:
  397:    ?line eval(family([{{a},[{foo,bar}]}], ['_']),
  398:	       from_term([{{a},[{foo,bar}]}], ['_'])),
  399:    ?line eval(family([], ['_']), from_term([], ['_'])),
<a name="400"></a>  400:    ?line {'EXIT', {badarg, _}} = (catch family([[a]],['_'])),
  401:    ?line {'EXIT', {badarg, _}} = (catch family([{a,b}],['_'])),
  402:    ?line {'EXIT', {badarg, _}} = 
  403:	(catch family([{a,[foo]}], [{atom,atom}])),
  404:    ?line eval(family([{{a},[{foo,bar}]}], [{{dt},[{r1,t2}]}]),
  405:	       from_term([{{a},[{foo,bar}]}], [{{dt},[{r1,t2}]}])),
  406:    ?line eval(family([{a,[a]},{a,[a,a]}],[{atom,[atom]}]),
  407:	       family([{a,[a]}])),
  408:    ?line eval(family([{[a,b],[a]},{[b,a],[a,a]}],[{[atom],[atom]}]),
  409:	       from_term([{[a,b],[a]},{[b,a],[a,a]}])),
<a name="410"></a>  410:    ok.
  411:
<a name=projection>  412:<b>projection</b></a>(suite) -&gt; [];
<a name=projection>  413:<b>projection</b></a>(doc) -&gt; [""];
<a name=projection>  414:<b>projection</b></a>(Conf) when list(Conf) -&gt;
  415:    ?line E = empty_set(),
  416:    ?line ER = relation([]),
  417:
  418:    %% set of ordered sets
  419:    ?line S1 = relation([{a,1},{b,2},{b,22},{c,0}]),
<a name="420"></a>  420:    ?line S2 = relation([{a,1},{a,2},{a,3},{b,4},{b,5},{b,6}]),
  421:
  422:    ?line eval(projection(1, E), E),
  423:    ?line eval(projection(1, ER), set([])),
  424:    ?line eval(projection(1, relation([{a,1}])), set([a])),
  425:    ?line eval(projection(1, S1), set([a,b,c])),
  426:    ?line eval(projection(1, S2), set([a,b])),
  427:    ?line eval(projection(2, S1), set([0,1,2,22])),
  428:    ?line eval(projection(2, relation([{1,a},{2,a},{3,b}])), set([a,b])),
  429:    ?line eval(projection(1, relation([{a},{b},{c}])), set([a,b,c])),
<a name="430"></a>  430:
  431:    Fun1 = {external, fun({A,B,C}) -&gt; {A,{B,C}} end},
  432:    ?line eval(projection(Fun1, E), E),
  433:    %% No check here:
  434:    ?line eval(projection(3, projection(Fun1, empty_set())), E),
  435:    ?line E2 = relation([], 3),
  436:    ?line eval(projection(Fun1, E2), from_term([], [{atom,{atom,atom}}])),
  437:
  438:    Fun2 = {external, fun({A,_B}) -&gt; {A} end},
  439:    ?line eval(projection(Fun2, ER), from_term([], [{atom}])),
<a name="440"></a>  440:    ?line eval(projection(Fun2, relation([{a,1}])), relation([{a}])),
  441:    ?line eval(projection(Fun2, relation([{a,1},{b,3},{a,2}])), 
  442:               relation([{a},{b}])),
  443:    Fun3 = {external, fun({A,_B,C}) -&gt; {C,{A},C} end}, 
  444:    ?line eval(projection(Fun3, relation([{a,1,x},{b,3,y},{a,2,z}])),
  445:               from_term([{x,{a},x},{y,{b},y},{z,{a},z}])),
  446:    Fun4 = {external, fun(A={B,_C,_D}) -&gt; {B, A} end},
  447:    ?line eval(projection(Fun4, relation([{a,1,x},{b,3,y},{a,2,z}])),
  448:               from_term([{a,{a,1,x}},{b,{b,3,y}},{a,{a,2,z}}])),
  449:
<a name="450"></a>  450:    ?line eval(projection({external, fun({A,B,_C,D}) -&gt; {A,B,A,D} end},
  451:			  relation([{1,1,1,2}, {1,1,3,1}])),
  452:               relation([{1,1,1,1}, {1,1,1,2}])),
  453:
  454:    ?line {'EXIT', {badarg, _}} = (catch projection(1, set([]))),
  455:    ?line {'EXIT', {function_clause, _}} = 
  456:	(catch projection({external, fun({A}) -&gt; A end}, S1)),
  457:    ?line {'EXIT', {badarg, _}} = 
  458:	(catch projection({external, fun({A,_}) -&gt; {A,0} end}, 
  459:			  from_term([{1,a}]))),
<a name="460"></a>  460:
  461:    %% {} is not an ordered set
  462:    ?line {'EXIT', {badarg, _}} = 
  463:        (catch projection({external, fun(_) -&gt; {} end}, ER)),
  464:    ?line {'EXIT', {badarg, _}} = 
  465:        (catch projection({external, fun(_) -&gt; {{}} end}, ER)),
  466:    ?line eval(projection({external, fun({T,_}) -&gt; T end}, 
  467:			  relation([{{},a},{{},b}])),
  468:	       set([{}])),
  469:    ?line eval(projection({external, fun({T}) -&gt; T end}, relation([{{}}])),
<a name="470"></a>  470:	       set([{}])),
  471:
  472:    ?line eval(projection({external, fun(A) -&gt; {A} end}, 
  473:			  relation([{1,a},{2,b}])), 
  474:	       from_term([{{1,a}},{{2,b}}])),
  475:    ?line eval(projection({external, fun({A,B}) -&gt; {B,A} end}, 
  476:			  relation([{1,a},{2,b}])),
  477:	       relation([{a,1},{b,2}])),
  478:    ?line eval(projection({external, fun(X=Y=A) -&gt; {X,Y,A} end}, set([a,b,c])),
  479:	       relation([{a,a,a},{b,b,b},{c,c,c}])),
<a name="480"></a>  480:
  481:    ?line eval(projection({external, fun({A,{_},B}) -&gt; {A,B} end}, 
  482:			  from_term([{a,{a},b},{a,{b},c}])),
  483:               relation([{a,b},{a,c}])),
  484:    ?line eval(projection({external, fun({A,_,B}) -&gt; {A,B} end},
  485:			  relation([{a,{},b},{a,{},c}])),
  486:               relation([{a,b},{a,c}])),
  487:    Fun5 = fun(S) -&gt; from_term({to_external(S),0}, {type(S),atom}) end,
  488:    ?line eval(projection(Fun5, E), E),
  489:    ?line eval(projection(Fun5, set([a,b])), from_term([{a,0},{b,0}])),
<a name="490"></a>  490:    ?line eval(projection(Fun5, relation([{a,1},{b,2}])),
  491:	       from_term([{{a,1},0},{{b,2},0}])),
  492:    ?line eval(projection(Fun5, from_term([[a],[b]])),
  493:	       from_term([{[a],0},{[b],0}])),
  494:
  495:    F = 0.0, I = round(F),
  496:    ?line FR = relation([{I},{F}]),
  497:    if
  498:        F == I -&gt; % term ordering
  499:            true = (no_elements(projection(1, FR)) =:= 1);
<a name="500"></a>  500:        true -&gt; 
  501:            eval(projection(1, FR), set([I,F]))
  502:    end,
  503:
  504:    %% set of sets
  505:    ?line {'EXIT', {badarg, _}} = 
  506:        (catch projection({external, fun(X) -&gt; X end}, 
  507:			  from_term([], [[atom]]))),
  508:    ?line {'EXIT', {badarg, _}} = 
  509:        (catch projection({external, fun(X) -&gt; X end}, from_term([[a]]))),
<a name="510"></a>  510:    ?line eval(projection({sofs,union}, 
  511:			  from_term([[[1,2],[2,3]], [[a,b],[b,c]]])),
  512:               from_term([[1,2,3], [a,b,c]])),
  513:    ?line eval(projection(fun(_) -&gt; from_term([a]) end, 
  514:			  from_term([[b]], [[a]])),
  515:               from_term([[a]])),
  516:    ?line eval(projection(fun(_) -&gt; from_term([a]) end, 
  517:			  from_term([[1,2],[3,4]])),
  518:               from_term([[a]])),
  519:    Fun10 = fun(S) -&gt;
<a name="520"></a>  520:                   %% Cheating a lot...
  521:                   case to_external(S) of
  522:                       [1] -&gt; from_term({1,1});
  523:                       _ -&gt; S
  524:                   end
  525:           end,
  526:    ?line eval(projection(Fun10, from_term([[1]])), from_term([{1,1}])),
  527:    ?line eval(projection(fun(_) -&gt; from_term({a}) end, from_term([[a]])),
  528:	       from_term([{a}])),
  529:    ?line {'EXIT', {badarg, _}} = 
<a name="530"></a>  530:	(catch projection(fun(_) -&gt; {a} end, from_term([[a]]))),
  531:
  532:    ok.
  533:
<a name=substitution>  534:<b>substitution</b></a>(suite) -&gt; [];
<a name=substitution>  535:<b>substitution</b></a>(doc) -&gt; [""];
<a name=substitution>  536:<b>substitution</b></a>(Conf) when list(Conf) -&gt;
  537:    ?line E = empty_set(),
  538:    ?line ER = relation([]),
  539:
<a name="540"></a>  540:    %% set of ordered sets
  541:    ?line S1 = relation([{a,1},{b,2},{b,22},{c,0}]),
  542:    ?line S2 = relation([{a,1},{a,2},{a,3},{b,4},{b,5},{b,6}]),
  543:
  544:    ?line eval(substitution(1, E), E),
  545:    %% No check here:
  546:    Fun0 = {external, fun({A,B,C}) -&gt; {A,{B,C}} end},
  547:    ?line eval(substitution(3, substitution(Fun0, empty_set())), E),
  548:    ?line eval(substitution(1, ER), from_term([],[{{atom,atom},atom}])),
  549:    ?line eval(substitution(1, relation([{a,1}])), from_term([{{a,1},a}])),
<a name="550"></a>  550:    ?line eval(substitution(1, S1), 
  551:               from_term([{{a,1},a},{{b,2},b},{{b,22},b},{{c,0},c}])),
  552:    ?line eval(substitution(1, S2), 
  553:               from_term([{{a,1},a},{{a,2},a},{{a,3},a},{{b,4},b},
  554:                          {{b,5},b},{{b,6},b}])),
  555:    ?line eval(substitution(2, S1), 
  556:               from_term([{{a,1},1},{{b,2},2},{{b,22},22},{{c,0},0}])),
  557:    
  558:    Fun1 = fun({A,_B}) -&gt; {A} end, 
  559:    XFun1 = {external, Fun1},
<a name="560"></a>  560:    ?line eval(substitution(XFun1, E), E),
  561:    ?line eval(substitution(Fun1, E), E),
  562:    ?line eval(substitution(XFun1, ER), from_term([], [{{atom,atom},{atom}}])),
  563:    ?line eval(substitution(XFun1, relation([{a,1}])), 
  564:	       from_term([{{a,1},{a}}])),
  565:    ?line eval(substitution(XFun1, relation([{a,1},{b,3},{a,2}])), 
  566:               from_term([{{a,1},{a}},{{a,2},{a}},{{b,3},{b}}])),
  567:    ?line eval(substitution({external, fun({A,_B,C}) -&gt; {C,A,C} end}, 
  568:			    relation([{a,1,x},{b,3,y},{a,2,z}])),
  569:               from_term([{{a,1,x},{x,a,x}},{{a,2,z},{z,a,z}},
<a name="570"></a>  570:                          {{b,3,y},{y,b,y}}])),
  571:    Fun2 = fun(S) -&gt; {A,_B} = to_external(S), from_term({A}) end,
  572:    ?line eval(substitution(Fun2, ER), E),
  573:    ?line eval(substitution(Fun2, relation([{a,1}])), 
  574:	       from_term([{{a,1},{a}}])),
  575:    Fun3 = fun(S) -&gt; from_term({to_external(S),0}, {type(S),atom}) end,
  576:    ?line eval(substitution(Fun3, E), E),
  577:    ?line eval(substitution(Fun3, set([a,b])),
  578:	       from_term([{a,{a,0}},{b,{b,0}}])),
  579:    ?line eval(substitution(Fun3, relation([{a,1},{b,2}])),
<a name="580"></a>  580:	       from_term([{{a,1},{{a,1},0}},{{b,2},{{b,2},0}}])),
  581:    ?line eval(substitution(Fun3, from_term([[a],[b]])),
  582:	       from_term([{[a],{[a],0}},{[b],{[b],0}}])),
  583:    
  584:    ?line eval(substitution(fun(_) -&gt; E end, from_term([[a],[b]])),
  585:	       from_term([{[a],[]},{[b],[]}])),
  586:
  587:    ?line {'EXIT', {badarg, _}} = (catch substitution(1, set([]))),
  588:    ?line eval(substitution(1, ER), from_term([], [{{atom,atom},atom}])),
  589:    ?line {'EXIT', {function_clause, _}} = 
<a name="590"></a>  590:	(catch substitution({external, fun({A,_}) -&gt; A end}, set([]))),
  591:    ?line {'EXIT', {badarg, _}} = 
  592:	(catch substitution({external, fun({A,_}) -&gt; {A,0} end}, 
  593:			    from_term([{1,a}]))),
  594:
  595:    %% set of sets
  596:    ?line {'EXIT', {badarg, _}} = 
  597:        (catch substitution({external, fun(X) -&gt; X end}, 
  598:			    from_term([], [[atom]]))),
  599:    ?line {'EXIT', {badarg, _}} = 
<a name="600"></a>  600:        (catch substitution({external, fun(X) -&gt; X end}, from_term([[a]]))),
  601:    ?line eval(substitution(fun(X) -&gt; X end, from_term([], [[atom]])), E),
  602:    ?line eval(substitution({sofs,union}, 
  603:                            from_term([[[1,2],[2,3]], [[a,b],[b,c]]])),
  604:               from_term([{[[1,2],[2,3]],[1,2,3]}, {[[a,b],[b,c]],[a,b,c]}])),
  605:    ?line eval(substitution(fun(_) -&gt; from_term([a]) end, 
  606:			    from_term([[b]], [[a]])),
  607:               from_term([{[b],[a]}], [{[a],[atom]}])),
  608:    ?line eval(substitution(fun(_) -&gt; from_term([a]) end, 
  609:			    from_term([[1,2],[3,4]])),
<a name="610"></a>  610:               from_term([{[1,2],[a]},{[3,4],[a]}])),
  611:    Fun10 = fun(S) -&gt;
  612:                   %% Cheating a lot...
  613:                   case to_external(S) of
  614:                       [1] -&gt; from_term({1,1});
  615:                       _ -&gt; S
  616:                   end
  617:           end,
  618:    ?line eval(substitution(Fun10, from_term([[1]])), 
  619:	       from_term([{[1],{1,1}}])),
<a name="620"></a>  620:    ?line {'EXIT', {type_mismatch, _}} =
  621:        (catch substitution(Fun10, from_term([[1],[2]]))),
  622:    ?line {'EXIT', {type_mismatch, _}} =
  623:        (catch substitution(Fun10, from_term([[1],[0]]))),
  624:
  625:    ?line eval(substitution(fun(_) -&gt; from_term({a}) end, from_term([[a]])),
  626:	       from_term([{[a],{a}}])),
  627:    ?line {'EXIT', {badarg, _}} = 
  628:	(catch substitution(fun(_) -&gt; {a} end, from_term([[a]]))),
  629:
<a name="630"></a>  630:    ok.
  631:
<a name=restriction>  632:<b>restriction</b></a>(suite) -&gt; [];
<a name=restriction>  633:<b>restriction</b></a>(doc) -&gt; [""];
<a name=restriction>  634:<b>restriction</b></a>(Conf) when list(Conf) -&gt;
  635:    ?line E = empty_set(),
  636:    ?line ER = relation([], 2),
  637:
  638:    %% set of ordered sets
  639:    ?line S1 = relation([{a,1},{b,2},{b,22},{c,0}]),
<a name="640"></a>  640:    ?line eval(restriction(S1, set([a,b])), 
  641:               relation([{a,1},{b,2},{b,22}])),
  642:    ?line eval(restriction(2, S1, set([1,2])),  
  643:               relation([{a,1},{b,2}])),
  644:    ?line eval(restriction(S1, set([a,b,c])), S1),
  645:    ?line eval(restriction(1, S1, set([0,1,d,e])), ER),
  646:    ?line eval(restriction(1, S1, E), ER),
  647:    ?line eval(restriction({external, fun({_A,B,C}) -&gt; {B,C} end}, 
  648:                           relation([{a,aa,1},{b,bb,2},{c,cc,3}]),
  649:                           relation([{bb,2},{cc,3}])),
<a name="650"></a>  650:               relation([{b,bb,2},{c,cc,3}])),
  651:    R1 = relation([],[{a,b}]),
  652:    ?line eval(restriction(2, R1,sofs:set([],[b])), R1),
  653:    Id = fun(X) -&gt; X end,
  654:    XId = {external, Id},
  655:    ?line eval(restriction(XId, relation([{a,b}]), E), ER),
  656:    ?line eval(restriction(XId, E, relation([{b,d}])), E),
  657:    Fun1 = fun(S) -&gt; {_A,B,C} = to_external(S), from_term({B,C}) end,
  658:    ?line eval(restriction(Fun1,
  659:                           relation([{a,aa,1},{b,bb,2},{c,cc,3}]),
<a name="660"></a>  660:                           relation([{bb,2},{cc,3}])),
  661:               relation([{b,bb,2},{c,cc,3}])),
  662:    ?line eval(restriction({external, fun({_,{A},B}) -&gt; {A,B} end},
  663:                           from_term([{a,{aa},1},{b,{bb},2},{c,{cc},3}]), 
  664:                           from_term([{bb,2},{cc,3}])),
  665:               from_term([{b,{bb},2},{c,{cc},3}])),
  666:    S5 = relation([{1,a},{2,b},{3,c}]),
  667:    ?line eval(restriction(2, S5, set([b,c])), relation([{2,b},{3,c}])),
  668:    S4 = relation([{a,1},{b,2},{b,27},{c,0}]),
  669:    ?line eval(restriction(2, S4, E), ER),
<a name="670"></a>  670:    S6 = relation([{1,a},{2,c},{3,b}]),
  671:    ?line eval(restriction(2, S6, set([d,e])), ER),
  672:    ?line eval(restriction(2, 
  673:			   relation([{1,d},{2,c},{3,b},{4,a},{5,e}]), 
  674:			   set([c])),
  675:	       relation([{2,c}])),
  676:    ?line eval(restriction(XId, 
  677:			   relation([{1,a},{3,b},{4,c},{4,d}]), 
  678:			   relation([{2,a},{2,c},{4,c}])),
  679:	       relation([{4,c}])),
<a name="680"></a>  680:    ?line eval(restriction(2, relation([{a,b}]), E), ER),
  681:    ?line eval(restriction(2, E, relation([{b,d}])), E),
  682:    ?line eval(restriction(2, relation([{b,d}]), E), ER),
  683:    ?line eval(restriction(XId, E, set([a])), E),
  684:    ?line eval(restriction(1, S1, E), ER),
  685:    ?line {'EXIT', {badarg, _}} =
  686:	(catch restriction(3, relation([{a,b}]), E)),
  687:    ?line {'EXIT', {badarg, _}} =
  688:	(catch restriction(3, relation([{a,b}]), relation([{b,d}]))),
  689:    ?line {'EXIT', {badarg, _}} =
<a name="690"></a>  690:	(catch restriction(3, relation([{a,b}]), set([{b,d}]))),
  691:    ?line {'EXIT', {type_mismatch, _}} =
  692:	(catch restriction(2, relation([{a,b}]), relation([{b,d}]))),
  693:    ?line {'EXIT', {type_mismatch, _}} =
  694:	(catch restriction({external, fun({A,_B}) -&gt; A end}, 
  695:			   relation([{a,b}]), relation([{b,d}]))),
  696:    ?line {'EXIT', {badarg, _}} = 
  697:	(catch restriction({external, fun({A,_}) -&gt; {A,0} end}, 
  698:			   from_term([{1,a}]),
  699:			   from_term([{1,0}]))),
<a name="700"></a>  700:    ?line eval(restriction(2, relation([{a,d},{b,e},{c,b},{d,c}]), set([b,d])),
  701:	       relation([{a,d},{c,b}])),
  702:    ?line {'EXIT', {function_clause, _}} =
  703:	(catch restriction({external, fun({A,_B}) -&gt; A end}, set([]), E)),
  704:
  705:    Fun3 = fun(S) -&gt; from_term({to_external(S),0}, {type(S),atom}) end,
  706:    ?line eval(restriction(Fun3, set([1,2]), from_term([{1,0}])),
  707:	       from_term([1])),
  708:
  709:    %% set of sets
<a name="710"></a>  710:    ?line {'EXIT', {badarg, _}} = 
  711:        (catch restriction({external, fun(X) -&gt; X end}, 
  712:			   from_term([], [[atom]]), set([a]))),
  713:    S2 = from_term([], [[atom]]),
  714:    ?line eval(restriction(Id, S2, E), E),
  715:    S3 = from_term([[a],[b]], [[atom]]),
  716:    ?line eval(restriction(Id, S3, E), E),
  717:    ?line eval(restriction(Id, from_term([], [[atom]]), set([a])),
  718:	       from_term([], [[atom]])),
  719:    ?line eval(restriction({sofs,union}, 
<a name="720"></a>  720:                           from_term([[[a],[b]], [[b],[c]], 
  721:                                      [[], [a,b]], [[1],[2]]]), 
  722:                           from_term([[a,b],[1,2,3],[b,c]])),
  723:               from_term([[[],[a,b]], [[a],[b]],[[b],[c]]])),
  724:    ?line eval(restriction(fun(_) -&gt; from_term([a]) end, 
  725:                           from_term([], [[atom]]),
  726:                           from_term([], [[a]])),
  727:               from_term([], [[atom]])),
  728:    ?line {'EXIT', {type_mismatch, _}} =
  729:        (catch restriction(fun(_) -&gt; from_term([a]) end, 
<a name="730"></a>  730:                           from_term([[1,2],[3,4]]),
  731:                           from_term([], [atom]))),
  732:    Fun10 = fun(S) -&gt;
  733:                   %% Cheating a lot...
  734:                   case to_external(S) of
  735:                       [1] -&gt; from_term({1,1});
  736:                       _ -&gt; S
  737:                   end
  738:           end,
  739:    ?line {'EXIT', {type_mismatch, _}} =
<a name="740"></a>  740:        (catch restriction(Fun10, from_term([[1]]), from_term([], [[atom]]))),
  741:    ?line {'EXIT', {type_mismatch, _}} = 
  742:        (catch restriction(fun(_) -&gt; from_term({a}) end, 
  743:                           from_term([[a]]),
  744:                           from_term([], [atom]))),
  745:    ?line {'EXIT', {badarg, _}} = 
  746:        (catch restriction(fun(_) -&gt; {a} end, 
  747:                           from_term([[a]]),
  748:                           from_term([], [atom]))),
  749:    ok.
<a name="750"></a>  750:
<a name=drestriction>  751:<b>drestriction</b></a>(suite) -&gt; [];
<a name=drestriction>  752:<b>drestriction</b></a>(doc) -&gt; [""];
<a name=drestriction>  753:<b>drestriction</b></a>(Conf) when list(Conf) -&gt;
  754:    ?line E = empty_set(),
  755:    ?line ER = relation([], 2),
  756:
  757:    %% set of ordered sets
  758:    ?line S1 = relation([{a,1},{b,2},{b,22},{c,0}]),
  759:    ?line eval(drestriction(S1, set([a,b])), relation([{c,0}])),
<a name="760"></a>  760:    ?line eval(drestriction(2, S1, set([1,2])),  
  761:               relation([{b,22},{c,0}])),
  762:    ?line eval(drestriction(S1, set([a,b,c])), ER),
  763:    ?line eval(drestriction(2, ER, set([a,b])), ER),
  764:    ?line eval(drestriction(1, S1, set([0,1,d,e])), S1),
  765:    ?line eval(drestriction(1, S1, E), S1),
  766:    ?line eval(drestriction({external, fun({_A,B,C}) -&gt; {B,C} end}, 
  767:                            relation([{a,aa,1},{b,bb,2},{c,cc,3}]),
  768:                            relation([{bb,2},{cc,3}])),
  769:               relation([{a,aa,1}])),
<a name="770"></a>  770:    Id = fun(X) -&gt; X end,
  771:    XId = {external, Id},
  772:    ?line eval(drestriction(XId, relation([{a,b}]), E), relation([{a,b}])),
  773:    ?line eval(drestriction(XId, E, relation([{b,d}])), E),
  774:    Fun1 = fun(S) -&gt; {_A,B,C} = to_external(S), from_term({B,C}) end,
  775:    ?line eval(drestriction(Fun1,
  776:                            relation([{a,aa,1},{b,bb,2},{c,cc,3}]),
  777:                            relation([{bb,2},{cc,3}])),
  778:               relation([{a,aa,1}])),
  779:    ?line eval(drestriction({external, fun({_,{A},B}) -&gt; {A,B} end},
<a name="780"></a>  780:                            from_term([{a,{aa},1},{b,{bb},2},{c,{cc},3}]), 
  781:                            from_term([{bb,2},{cc,3}])),
  782:               from_term([{a,{aa},1}])),
  783:    S5 = relation([{1,a},{2,b},{3,c}]),
  784:    ?line eval(drestriction(2, S5, set([b,c])), relation([{1,a}])),
  785:    S4 = relation([{a,1},{b,2},{b,27},{c,0}]),
  786:    ?line eval(drestriction(2, S4, set([])), S4),
  787:    S6 = relation([{1,a},{2,c},{3,b}]),
  788:    ?line eval(drestriction(2, S6, set([d,e])), S6),
  789:    ?line eval(drestriction(2, 
<a name="790"></a>  790:			    relation([{1,d},{2,c},{3,b},{4,a},{5,e}]), 
  791:			    set([c])),
  792:	       relation([{1,d},{3,b},{4,a},{5,e}])),
  793:    ?line eval(drestriction(XId, 
  794:			    relation([{1,a},{3,b},{4,c},{4,d}]), 
  795:			    relation([{2,a},{2,c},{4,c}])),
  796:	       relation([{1,a},{3,b},{4,d}])),
  797:    ?line eval(drestriction(2, relation([{a,b}]), E), relation([{a,b}])),
  798:    ?line eval(drestriction(2, E, relation([{b,d}])), E),
  799:    ?line eval(drestriction(2, relation([{b,d}]), E), relation([{b,d}])),
<a name="800"></a>  800:    ?line eval(drestriction(XId, E, set([a])), E),
  801:    ?line eval(drestriction(1, S1, E), S1),
  802:    ?line {'EXIT', {badarg, _}} =
  803:	(catch drestriction(3, relation([{a,b}]), E)),
  804:    ?line {'EXIT', {badarg, _}} =
  805:	(catch drestriction(3, relation([{a,b}]), relation([{b,d}]))),
  806:    ?line {'EXIT', {badarg, _}} =
  807:	(catch drestriction(3, relation([{a,b}]), set([{b,d}]))),
  808:    ?line {'EXIT', {type_mismatch, _}} =
  809:	(catch drestriction(2, relation([{a,b}]), relation([{b,d}]))),
<a name="810"></a>  810:    ?line {'EXIT', {type_mismatch, _}} =
  811:	(catch drestriction({external, fun({A,_B}) -&gt; A end}, 
  812:			    relation([{a,b}]), relation([{b,d}]))),
  813:    ?line {'EXIT', {badarg, _}} = 
  814:	(catch drestriction({external, fun({A,_}) -&gt; {A,0} end}, 
  815:			    from_term([{1,a}]),
  816:			    from_term([{1,0}]))),
  817:    ?line eval(drestriction(2, relation([{a,d},{b,e},{c,b},{d,c}]), set([b,d])),
  818:	       relation([{b,e},{d,c}])),
  819:    ?line {'EXIT', {function_clause, _}} =
<a name="820"></a>  820:	(catch drestriction({external, fun({A,_B}) -&gt; A end}, set([]), E)),
  821:
  822:    Fun3 = fun(S) -&gt; from_term({to_external(S),0}, {type(S),atom}) end,
  823:    ?line eval(drestriction(Fun3, set([1,2]), from_term([{1,0}])),
  824:	       from_term([2])),
  825:
  826:    %% set of sets
  827:    ?line {'EXIT', {badarg, _}} = 
  828:        (catch drestriction({external, fun(X) -&gt; X end}, 
  829:			    from_term([], [[atom]]), set([a]))),
<a name="830"></a>  830:    S2 = from_term([], [[atom]]),
  831:    ?line eval(drestriction(Id, S2, E), S2),
  832:    S3 = from_term([[a],[b]], [[atom]]),
  833:    ?line eval(drestriction(Id, S3, E), S3),
  834:    ?line eval(drestriction(Id, from_term([], [[atom]]), set([a])),
  835:	       from_term([], [[atom]])),
  836:    ?line eval(drestriction({sofs,union}, 
  837:                            from_term([[[a],[b]], [[b],[c]], 
  838:                                       [[], [a,b]], [[1],[2]]]), 
  839:                            from_term([[a,b],[1,2,3],[b,c]])),
<a name="840"></a>  840:               from_term([[[1],[2]]])),
  841:    ?line eval(drestriction(fun(_) -&gt; from_term([a]) end, 
  842:                            from_term([], [[atom]]),
  843:                            from_term([], [[a]])),
  844:               from_term([], [[atom]])),
  845:    ?line {'EXIT', {type_mismatch, _}} =
  846:        (catch drestriction(fun(_) -&gt; from_term([a]) end, 
  847:                            from_term([[1,2],[3,4]]),
  848:                            from_term([], [atom]))),
  849:    Fun10 = fun(S) -&gt;
<a name="850"></a>  850:                   %% Cheating a lot...
  851:                   case to_external(S) of
  852:                       [1] -&gt; from_term({1,1});
  853:                       _ -&gt; S
  854:                   end
  855:           end,
  856:    ?line {'EXIT', {type_mismatch, _}} =
  857:        (catch drestriction(Fun10, from_term([[1]]), from_term([], [[atom]]))),
  858:    ?line {'EXIT', {type_mismatch, _}} = 
  859:        (catch drestriction(fun(_) -&gt; from_term({a}) end, 
<a name="860"></a>  860:                            from_term([[a]]),
  861:                            from_term([], [atom]))),
  862:    ?line {'EXIT', {badarg, _}} = 
  863:        (catch drestriction(fun(_) -&gt; {a} end, 
  864:			    from_term([[a]]),
  865:			    from_term([], [atom]))),
  866:    ok.
  867:
<a name=strict_relation_1>  868:<b>strict_relation_1</b></a>(suite) -&gt; [];
<a name=strict_relation_1>  869:<b>strict_relation_1</b></a>(doc) -&gt; [""];
<a name=strict_relation_1><a name="870"></a>  870:<b>strict_relation_1</b></a>(Conf) when list(Conf) -&gt;
  871:    ?line E = empty_set(),
  872:    ?line ER = relation([], 2),
  873:    ?line eval(strict_relation(E), E),
  874:    ?line eval(strict_relation(ER), ER),
  875:    ?line eval(strict_relation(relation([{1,a},{a,a},{2,b}])),
  876:               relation([{1,a},{2,b}])),
  877:    ?line {'EXIT', {badarg, _}} = 
  878:        (catch strict_relation(relation([{1,2,3}]))),
  879:    F = 0.0, I = round(F),
<a name="880"></a>  880:    ?line FR = relation([{F,I}]),
  881:    if
  882:        F == I -&gt; % term ordering
  883:            eval(strict_relation(FR), ER);
  884:        true -&gt; 
  885:            eval(strict_relation(FR), FR)
  886:    end,
  887:    ok.
  888:
<a name=extension>  889:<b>extension</b></a>(suite) -&gt; [];
<a name=extension><a name="890"></a>  890:<b>extension</b></a>(doc) -&gt; [""];
<a name=extension>  891:<b>extension</b></a>(Conf) when list(Conf) -&gt;
  892:    ?line E = empty_set(),
  893:    ?line ER = relation([], 2),
  894:    ?line EF = family([]),
  895:    ?line C1 = from_term(3),
  896:    ?line C2 = from_term([3]),
  897:    ?line {'EXIT', {function_clause, _}} = (catch extension(foo, E, C1)),
  898:    ?line {'EXIT', {function_clause, _}} = (catch extension(ER, foo, C1)),
  899:    ?line {'EXIT', {{case_clause, _},_}} = (catch extension(ER, E, foo)),
<a name="900"></a>  900:    ?line {'EXIT', {type_mismatch, _}} = (catch extension(ER, E, E)),
  901:    ?line {'EXIT', {badarg, _}} = (catch extension(C2, E, E)),
  902:    ?line eval(E, extension(E, E, E)),
  903:    ?line eval(EF, extension(EF, E, E)),
  904:    ?line eval(family([{3,[]}]), extension(EF, set([3]), E)),
  905:    ?line eval(ER, extension(ER, E, C1)),
  906:    ?line eval(E, extension(E, ER, E)),
  907:    ?line eval(from_term([],[{{atom,atom},type(ER)}]), extension(E, ER, ER)),
  908:
  909:    ?line R1 = relation([{c,7},{c,9},{c,11},{d,17},{f,20}]),
<a name="910"></a>  910:    ?line S1 = set([a,c,d,e]),
  911:    ?line eval(extension(R1, S1, C1), lextension(R1, S1, C1)),
  912:
  913:    ?line S2 = set([1,2,3]),
  914:    ?line eval(extension(ER, S2, C1), lextension(ER, S2, C1)),
  915:
  916:    ?line R3 = relation([{4,a},{8,b}]),
  917:    ?line S3 = set([1,2,3,4,5,6,7,8,9,10,11]),
  918:    ?line eval(extension(R3, S3, C1), lextension(R3, S3, C1)),
  919:
<a name="920"></a>  920:    ?line R4 = relation([{2,b},{4,d},{6,f}]),
  921:    ?line S4 = set([1,3,5,7]),
  922:    ?line eval(extension(R4, S4, C1), lextension(R4, S4, C1)),
  923:
  924:    ?line F1 = family([{a,[1]},{c,[2]}]),
  925:    ?line S5 = set([a,b,c,d]),
  926:    ?line eval(extension(F1, S5, C2), lextension(F1, S5, C2)),
  927:    ok.
  928:
<a name=lextension>  929:<b>lextension</b></a>(R, S, C) -&gt;
<a name="930"></a>  930:    union(R, drestriction(1, constant_function(S, C), domain(R))).
  931:
<a name=weak_relation_1>  932:<b>weak_relation_1</b></a>(suite) -&gt; [];
<a name=weak_relation_1>  933:<b>weak_relation_1</b></a>(doc) -&gt; [""];
<a name=weak_relation_1>  934:<b>weak_relation_1</b></a>(Conf) when list(Conf) -&gt;
  935:    ?line E = empty_set(),
  936:    ?line ER = relation([], 2),
  937:    ?line eval(weak_relation(E), E),
  938:    ?line eval(weak_relation(ER), ER),
  939:    ?line eval(weak_relation(relation([{a,1},{a,2},{b,2},{c,c}])),
<a name="940"></a>  940:               relation([{1,1},{2,2},{a,1},{a,2},{a,a},{b,2},{b,b},{c,c}])),
  941:    ?line eval(weak_relation(relation([{a,1},{a,a},{a,b}])),
  942:               relation([{1,1},{a,1},{a,a},{a,b},{b,b}])),
  943:    ?line eval(weak_relation(relation([{a,1},{a,b},{7,w}])),
  944:               relation([{1,1},{7,7},{7,w},{a,1},{a,a},{a,b},{b,b},{w,w}])),
  945:    ?line {'EXIT', {badarg, _}} = 
  946:	(catch weak_relation(from_term([{{a},a}]))),
  947:    ?line {'EXIT', {badarg, _}} = 
  948:	(catch weak_relation(from_term([{a,a}],[{d,r}]))),
  949:    ?line {'EXIT', {badarg, _}} = (catch weak_relation(relation([{1,2,3}]))),
<a name="950"></a>  950:
  951:    F = 0.0, I = round(F),
  952:    if
  953:        F == I -&gt; % term ordering
  954:            ?line FR1 = relation([{F,I}]),
  955:            eval(weak_relation(FR1), FR1),
  956:            ?line FR2 = relation([{F,2},{I,1}]),
  957:            true = no_elements(weak_relation(FR2)) =:= 5,
  958:            ?line FR3 = relation([{1,0},{1.0,1}]),
  959:            true = no_elements(weak_relation(FR3)) =:= 3;
<a name="960"></a>  960:        true -&gt; 
  961:            ok
  962:    end,
  963:    ok.
  964:
<a name=to_sets_1>  965:<b>to_sets_1</b></a>(suite) -&gt;  [];
<a name=to_sets_1>  966:<b>to_sets_1</b></a>(doc) -&gt; [""];
<a name=to_sets_1>  967:<b>to_sets_1</b></a>(Conf) when list(Conf) -&gt;
  968:    ?line {'EXIT', {badarg, _}} = (catch to_sets(from_term(a))),
  969:    ?line {'EXIT', {function_clause, _}} = (catch to_sets(a)),
<a name="970"></a>  970:    %% unordered
  971:    ?line [] = to_sets(empty_set()),
  972:    ?line eval(to_sets(from_term([a])), [from_term(a)]),
  973:    ?line eval(to_sets(from_term([[]],[[atom]])), [set([])]),
  974:
  975:    ?line L = [from_term([a,b]),from_term([c,d])],
  976:    ?line eval(to_sets(from_sets(L)), L),
  977:
  978:    ?line eval(to_sets(relation([{a,1},{b,2}])),
  979:               [from_term({a,1},{atom,atom}), from_term({b,2},{atom,atom})]),
<a name="980"></a>  980:
  981:    %% ordered
  982:    ?line O = {from_term(a,atom), from_term({b}, {atom}), set([c,d])},
  983:    ?line eval(to_sets(from_sets(O)), O),
  984:    ok.
  985:
  986:
<a name=specification>  987:<b>specification</b></a>(suite) -&gt; [];
<a name=specification>  988:<b>specification</b></a>(doc) -&gt; [""];
<a name=specification>  989:<b>specification</b></a>(Conf) when list(Conf) -&gt;
<a name="990"></a>  990:    Fun = {external, fun(I) when integer(I) -&gt; true; (_) -&gt; false end},
  991:    ?line [1,2,3] = to_external(specification(Fun, set([a,1,b,2,c,3]))),
  992:
  993:    Fun2 = fun(S) -&gt; is_subset(S, set([1,3,5,7,9])) end,
  994:    S2 = from_term([[1],[2],[3],[4],[5],[6],[7]]),
  995:    ?line eval(specification(Fun2, S2), from_term([[1],[3],[5],[7]])),
  996:    Fun2x = fun([1]) -&gt; true;
  997:	       ([3]) -&gt; true;
  998:	       (_) -&gt; false 
  999:	    end,
<a name="1000"></a> 1000:    ?line eval(specification({external,Fun2x}, S2), from_term([[1],[3]])),
 1001:
 1002:    Fun3 = fun(_) -&gt; neither_true_or_false end,
 1003:    ?line {'EXIT', {badarg, _}} = 
 1004:	(catch specification(Fun3, set([a]))),
 1005:    ?line {'EXIT', {badarg, _}} = 
 1006:	(catch specification({external, Fun3}, set([a]))),
 1007:    ?line {'EXIT', {badarg, _}} = 
 1008:	(catch specification(Fun3, from_term([[a]]))),
 1009:    ?line {'EXIT', {function_clause, _}} = 
<a name="1010"></a> 1010:	(catch specification(Fun, a)),
 1011:    ok.
 1012:
<a name=union_1> 1013:<b>union_1</b></a>(suite) -&gt; [];
<a name=union_1> 1014:<b>union_1</b></a>(doc) -&gt; [""];
<a name=union_1> 1015:<b>union_1</b></a>(Conf) when list(Conf) -&gt;
 1016:    ?line E = empty_set(),
 1017:    ?line ER = relation([], 2),
 1018:    ?line {'EXIT', {badarg, _}} = (catch union(ER)),
 1019:    ?line {'EXIT', {type_mismatch, _}} =
<a name="1020"></a> 1020:	(catch union(relation([{a,b}]), relation([{a,b,c}]))),
 1021:    ?line {'EXIT', {type_mismatch, _}} =
 1022:	(catch union(from_term([{a,b}]), from_term([{c,[x]}]))),
 1023:    ?line {'EXIT', {type_mismatch, _}} =
 1024:	(catch union(from_term([{a,b}]), from_term([{c,d}], [{d,r}]))),
 1025:    ?line {'EXIT', {badarg, _}} = (catch union(set([a,b,c]))),
 1026:    ?line eval(union(E), E),
 1027:    ?line eval(union(from_term([[]],[[atom]])), set([])),
 1028:    ?line eval(union(from_term([[{a,b},{b,c}],[{b,c}]])), 
 1029:               relation([{a,b},{b,c}])),
<a name="1030"></a> 1030:    ?line eval(union(from_term([[1,2,3],[2,3,4],[3,4,5]])), 
 1031:               set([1,2,3,4,5])),
 1032:
 1033:    ?line eval(union(from_term([{[a],[],c}]), from_term([{[],[],q}])),
 1034:	       from_term([{[a],[],c},{[],[],q}])),
 1035:
 1036:    ?line eval(union(E, E), E),
 1037:    ?line eval(union(set([a,b]), E), set([a,b])),
 1038:    ?line eval(union(E, set([a,b])), set([a,b])),
 1039:
<a name="1040"></a> 1040:    ?line eval(union(from_term([[a,b]])), from_term([a,b])),
 1041:    ok.
 1042:
<a name=intersection_1> 1043:<b>intersection_1</b></a>(suite) -&gt; [];
<a name=intersection_1> 1044:<b>intersection_1</b></a>(doc) -&gt; [""];
<a name=intersection_1> 1045:<b>intersection_1</b></a>(Conf) when list(Conf) -&gt;
 1046:    ?line E = empty_set(),
 1047:    ?line {'EXIT', {badarg, _}} = (catch intersection(from_term([a,b]))),
 1048:    ?line {'EXIT', {badarg, _}} = (catch intersection(E)),
 1049:    ?line {'EXIT', {type_mismatch, _}} =
<a name="1050"></a> 1050:	(catch intersection(relation([{a,b}]), relation([{a,b,c}]))),
 1051:    ?line {'EXIT', {type_mismatch, _}} =
 1052:	(catch intersection(relation([{a,b}]), from_term([{a,b}],[{d,r}]))),
 1053:
 1054:    ?line eval(intersection(from_term([[a,b,c],[d,e,f],[g,h,i]])), set([])),
 1055:
 1056:    ?line eval(intersection(E, E), E),
 1057:    ?line eval(intersection(set([a,b,c]),set([0,b,q])), 
 1058:               set([b])),
 1059:    ?line eval(intersection(set([0,b,q]),set([a,b,c])), 
<a name="1060"></a> 1060:               set([b])),
 1061:    ?line eval(intersection(set([a,b,c]),set([a,b,c])), 
 1062:               set([a,b,c])),
 1063:    ?line eval(intersection(set([a,b,d]),set([c,d])), 
 1064:               set([d])),
 1065:    ok.
 1066:
<a name=difference> 1067:<b>difference</b></a>(suite) -&gt; [];
<a name=difference> 1068:<b>difference</b></a>(doc) -&gt; [""];
<a name=difference> 1069:<b>difference</b></a>(Conf) when list(Conf) -&gt;
<a name="1070"></a> 1070:    ?line E = empty_set(),
 1071:    ?line {'EXIT', {type_mismatch, _}} =
 1072:	(catch difference(relation([{a,b}]), relation([{a,b,c}]))),
 1073:    ?line eval(difference(E, E), E),
 1074:    ?line {'EXIT', {type_mismatch, _}} =
 1075:	(catch difference(relation([{a,b}]), from_term([{a,c}],[{d,r}]))),
 1076:    ?line eval(difference(set([a,b,c,d,f]), set([a,d,e,g])), 
 1077:               set([b,c,f])),
 1078:    ?line eval(difference(set([a,b,c]), set([d,e,f])), 
 1079:               set([a,b,c])),
<a name="1080"></a> 1080:    ?line eval(difference(set([a,b,c]), set([a,b,c,d,e,f])), 
 1081:               set([])),
 1082:    ?line eval(difference(set([e,f,g]), set([a,b,c,e])), 
 1083:               set([f,g])),
 1084:    ?line eval(difference(set([a,b,d,e,f]), set([c])), 
 1085:               set([a,b,d,e,f])),
 1086:    ok.
 1087:
<a name=symdiff> 1088:<b>symdiff</b></a>(suite) -&gt; [];
<a name=symdiff> 1089:<b>symdiff</b></a>(doc) -&gt; [""];
<a name=symdiff><a name="1090"></a> 1090:<b>symdiff</b></a>(Conf) when list(Conf) -&gt;
 1091:    ?line E = empty_set(),
 1092:    ?line {'EXIT', {type_mismatch, _}} =
 1093:	(catch symdiff(relation([{a,b}]), relation([{a,b,c}]))),
 1094:    ?line {'EXIT', {type_mismatch, _}} =
 1095:	(catch symdiff(relation([{a,b}]), from_term([{a,b}], [{d,r}]))),
 1096:    ?line eval(symdiff(E, E), E),
 1097:    ?line eval(symdiff(set([a,b,c,d,e,f]), set([0,1,a,c])),
 1098:               union(set([b,d,e,f]), set([0,1]))),
 1099:    ?line eval(symdiff(set([a,b,c]), set([q,v,w,x,y])),
<a name="1100"></a> 1100:               union(set([a,b,c]), set([q,v,w,x,y]))),
 1101:    ?line eval(symdiff(set([a,b,c,d,e,f]), set([a,b,c])),
 1102:               set([d,e,f])),
 1103:    ?line eval(symdiff(set([c,e,g,h,i]), set([b,d,f])),
 1104:               union(set([c,e,g,h,i]), set([b,d,f]))),
 1105:    ?line eval(symdiff(set([c,d,g,h,k,l]), 
 1106:                       set([a,b,e,f,i,j,m,n])),
 1107:               union(set([c,d,g,h,k,l]), set([a,b,e,f,i,j,m,n]))),
 1108:    ?line eval(symdiff(set([c,d,g,h,k,l]), 
 1109:                       set([d,e,h,i,l,m,n,o,p])),
<a name="1110"></a> 1110:               union(set([c,g,k]), set([e,i,m,n,o,p]))),
 1111:    ok.
 1112:
<a name=symmetric_partition> 1113:<b>symmetric_partition</b></a>(suite) -&gt; [];
<a name=symmetric_partition> 1114:<b>symmetric_partition</b></a>(doc) -&gt; [""];
<a name=symmetric_partition> 1115:<b>symmetric_partition</b></a>(Conf) when list(Conf) -&gt;
 1116:    ?line E = set([]),
 1117:    ?line S1 = set([1,2,3,4]),
 1118:    ?line S2 = set([3,4,5,6]),
 1119:    ?line S3 = set([3,4]),
<a name="1120"></a> 1120:    ?line S4 = set([1,2,3,4,5,6]),
 1121:    ?line T1 = set([1,2]),
 1122:    ?line T2 = set([3,4]),
 1123:    ?line T3 = set([5,6]),
 1124:    ?line T4 = set([1,2,5,6]),
 1125:    ?line {'EXIT', {type_mismatch, _}} =
 1126:	(catch symmetric_partition(relation([{a,b}]), relation([{a,b,c}]))),
 1127:    ?line {E, E, E} = symmetric_partition(E, E),
 1128:    ?line {'EXIT', {type_mismatch, _}} =
 1129:	(catch symmetric_partition(relation([{a,b}]), 
<a name="1130"></a> 1130:                                   from_term([{a,c}],[{d,r}]))),
 1131:    ?line {E, E, S1} = symmetric_partition(E, S1),
 1132:    ?line {S1, E, E} = symmetric_partition(S1, E),
 1133:    ?line {T1, T2, T3} = symmetric_partition(S1, S2),
 1134:    ?line {T3, T2, T1} = symmetric_partition(S2, S1),
 1135:    ?line {E, T2, T4} = symmetric_partition(S3, S4),
 1136:    ?line {T4, T2, E} = symmetric_partition(S4, S3),
 1137:
 1138:    ?line S5 = set([1,3,5]),
 1139:    ?line S6 = set([2,4,6,7,8]),
<a name="1140"></a> 1140:    ?line {S5, E, S6} = symmetric_partition(S5, S6),
 1141:    ?line {S6, E, S5} = symmetric_partition(S6, S5),
 1142:    ?line EE = empty_set(),
 1143:    ?line {EE, EE, EE} = symmetric_partition(EE, EE),
 1144:
 1145:    ok.
 1146:
<a name=is_sofs_set_1> 1147:<b>is_sofs_set_1</b></a>(suite) -&gt; [];
<a name=is_sofs_set_1> 1148:<b>is_sofs_set_1</b></a>(doc) -&gt; [""];
<a name=is_sofs_set_1> 1149:<b>is_sofs_set_1</b></a>(Conf) when list(Conf) -&gt;
<a name="1150"></a> 1150:    ?line E = empty_set(),
 1151:    ?line true = is_sofs_set(E),
 1152:    ?line true = is_sofs_set(from_term([a])),
 1153:    ?line true = is_sofs_set(from_term({a})),
 1154:    ?line true = is_sofs_set(from_term(a)),
 1155:    ?line false = is_sofs_set(a),
 1156:    ok.
 1157:
<a name=is_set_1> 1158:<b>is_set_1</b></a>(suite) -&gt; [];
<a name=is_set_1> 1159:<b>is_set_1</b></a>(doc) -&gt; [""];
<a name=is_set_1><a name="1160"></a> 1160:<b>is_set_1</b></a>(Conf) when list(Conf) -&gt;
 1161:    ?line E = empty_set(),
 1162:    ?line true = is_set(E),
 1163:    ?line true = is_set(from_term([a])),
 1164:    ?line false = is_set(from_term({a})),
 1165:    ?line false = is_set(from_term(a)),
 1166:    ?line {'EXIT', _} = (catch is_set(a)),
 1167:
 1168:    ?line true = is_empty_set(E),
 1169:    ?line false = is_empty_set(from_term([a])),
<a name="1170"></a> 1170:    ?line false = is_empty_set(from_term({a})),
 1171:    ?line false = is_empty_set(from_term(a)),
 1172:    ?line {'EXIT', _} = (catch is_empty_set(a)),
 1173:
 1174:    ok.
 1175:
<a name=is_equal> 1176:<b>is_equal</b></a>(suite) -&gt; [];
<a name=is_equal> 1177:<b>is_equal</b></a>(doc) -&gt; [""];
<a name=is_equal> 1178:<b>is_equal</b></a>(Conf) when list(Conf) -&gt;
 1179:    ?line E = empty_set(),
<a name="1180"></a> 1180:    ?line true = is_equal(E, E),
 1181:    ?line false = is_equal(from_term([a]), E),
 1182:    ?line {'EXIT', {type_mismatch, _}} =
 1183:	(catch is_equal(intersection(set([a]), set([b])),
 1184:			intersection(from_term([{a}]), from_term([{b}])))),
 1185:    ?line {'EXIT', {type_mismatch, _}} =
 1186:	(catch is_equal(from_term([],[{[atom],atom,[atom]}]), 
 1187:			from_term([],[{[atom],{atom},[atom]}]))),
 1188:    ?line {'EXIT', {type_mismatch, _}} =
 1189:	(catch is_equal(set([a]), from_term([a],[type]))),
<a name="1190"></a> 1190:
 1191:    ?line E2 = from_sets({from_term(a,atom)}),
 1192:    ?line true = is_equal(E2, E2),
 1193:    ?line true = is_equal(from_term({a}, {atom}), E2),
 1194:    ?line false = is_equal(from_term([{[a],[],c}]), 
 1195:			   from_term([{[],[],q}])),
 1196:
 1197:    ?line {'EXIT', {type_mismatch, _}} =
 1198:        (catch is_equal(E, E2)),
 1199:    ?line {'EXIT', {type_mismatch, _}} =
<a name="1200"></a> 1200:        (catch is_equal(E2, E)),
 1201:    ?line true = is_equal(from_term({[],a,[]},{[atom],atom,[atom]}), 
 1202:                          from_term({[],a,[]},{[atom],atom,[atom]})),
 1203:    ?line {'EXIT', {type_mismatch, _}} =
 1204:	(catch is_equal(from_term({[],a,[]},{[atom],atom,[atom]}), 
 1205:			from_term({[],{a},[]},{[atom],{atom},[atom]}))),
 1206:    ?line {'EXIT', {type_mismatch, _}} =
 1207:	(catch is_equal(from_term({a}), from_term({a},{type}))),
 1208:
 1209:    ok.
<a name="1210"></a> 1210:
<a name=is_subset> 1211:<b>is_subset</b></a>(suite) -&gt; [];
<a name=is_subset> 1212:<b>is_subset</b></a>(doc) -&gt; [""];
<a name=is_subset> 1213:<b>is_subset</b></a>(Conf) when list(Conf) -&gt;
 1214:    ?line E = empty_set(),
 1215:    ?line true = is_subset(E, E),
 1216:    ?line true = is_subset(set([a,c,e]), set([a,b,c,d,e])),
 1217:    ?line false = is_subset(set([a,b]), E),
 1218:    ?line false = is_subset(set([d,e,f]), set([b,c,d,e])),
 1219:    ?line false = is_subset(set([a,b,c]), set([b,c])),
<a name="1220"></a> 1220:    ?line false = is_subset(set([b,c]), set([a,c])),
 1221:    ?line false = is_subset(set([d,e]), set([a,b])),
 1222:    ?line {'EXIT', {type_mismatch, _}} =
 1223:	(catch is_subset(intersection(set([a]), set([b])),
 1224:			 intersection(from_term([{a}]), from_term([{b}])))),
 1225:    ?line {'EXIT', {type_mismatch, _}} =
 1226:        (catch is_subset(set([a]), from_term([a,b], [at]))),
 1227:    ok.
 1228:
<a name=is_a_function_1> 1229:<b>is_a_function_1</b></a>(suite) -&gt; [];
<a name=is_a_function_1><a name="1230"></a> 1230:<b>is_a_function_1</b></a>(doc) -&gt; [""];
<a name=is_a_function_1> 1231:<b>is_a_function_1</b></a>(Conf) when list(Conf) -&gt;
 1232:    ?line E = empty_set(),
 1233:    ?line ER = relation([], 2),
 1234:    ?line {'EXIT', {badarg, _}} = (catch is_a_function(set([a,b]))),
 1235:    ?line true = is_a_function(E),
 1236:    ?line true = is_a_function(ER),
 1237:    ?line true = is_a_function(relation([])),
 1238:    ?line true = is_a_function(relation([],2)),
 1239:    ?line true = is_a_function(relation([{a,b},{b,c}])),
<a name="1240"></a> 1240:    ?line false = is_a_function(relation([{a,b},{b,c},{b,d},{e,f}])),
 1241:    ?line IS = relation([{{a,b},c},{{a,b},d}]),
 1242:    ?line false = is_a_function(IS),
 1243:    F = 0.0, I = round(F),
 1244:    ?line FR = relation([{I,F},{F,1}]),
 1245:    if
 1246:        F == I -&gt; % term ordering
 1247:            false = is_a_function(FR);
 1248:        true -&gt; 
 1249:            true = is_a_function(FR)
<a name="1250"></a> 1250:    end,
 1251:    ok.
 1252:
<a name=is_disjoint> 1253:<b>is_disjoint</b></a>(suite) -&gt; [];
<a name=is_disjoint> 1254:<b>is_disjoint</b></a>(doc) -&gt; [""];
<a name=is_disjoint> 1255:<b>is_disjoint</b></a>(Conf) when list(Conf) -&gt;
 1256:    ?line E = empty_set(),
 1257:    ?line {'EXIT', {type_mismatch, _}} = 
 1258:	(catch is_disjoint(relation([{a,1}]), set([a,b]))),
 1259:    ?line {'EXIT', {type_mismatch, _}} = 
<a name="1260"></a> 1260:	(catch is_disjoint(set([a]), from_term([a],[mota]))),
 1261:    ?line true = is_disjoint(E, E),
 1262:    ?line false = is_disjoint(set([a,b,c]),set([b,c,d])),
 1263:    ?line false = is_disjoint(set([b,c,d]),set([a,b,c])),
 1264:    ?line true = is_disjoint(set([a,c,e]),set([b,d,f])),
 1265:    ok.
 1266:
<a name=join> 1267:<b>join</b></a>(suite) -&gt; [];
<a name=join> 1268:<b>join</b></a>(doc) -&gt; [""];
<a name=join> 1269:<b>join</b></a>(Conf) when list(Conf) -&gt;
<a name="1270"></a> 1270:    ?line E = empty_set(),
 1271:
 1272:    ?line {'EXIT', {badarg, _}} = (catch join(relation([{a,1}]), 3, E, 5)),
 1273:    ?line {'EXIT', {badarg, _}} = (catch join(E, 1, relation([{a,1}]), 3)),
 1274:    ?line {'EXIT', {badarg, _}} = (catch join(E, 1, from_term([a]), 1)),
 1275:
 1276:    ?line eval(join(E, 1, E, 2), E),
 1277:    ?line eval(join(E, 1, from_term([{{a},b}]), 2), E),
 1278:    ?line eval(join(from_term([{{a},b}]), 2, E, 1), E),
 1279:    ?line eval(join(from_term([{{a},b,e}]), 2, from_term([{c,{d}}]), 1),
<a name="1280"></a> 1280:               from_term([], [{{atom},atom,atom,{atom}}])),
 1281:    ?line eval(join(relation([{a}]), 1, relation([{1,a},{2,a}]), 2),
 1282:               relation([{a,1},{a,2}])),
 1283:    ?line eval(join(relation([{a,b,c},{b,c,d}]), 2, 
 1284:                    relation([{1,b},{2,a},{3,c}]), 2),
 1285:               relation([{a,b,c,1},{b,c,d,3}])),
 1286:    ?line eval(join(relation([{1,a,aa},{1,b,bb},{1,c,cc},{2,a,aa},{2,b,bb}]), 
 1287:                    1,
 1288:                    relation([{1,c,cc},{1,d,dd},{1,e,ee},{2,c,cc},{2,d,dd}]),
 1289:                    1),
<a name="1290"></a> 1290:             relation([{1,a,aa,c,cc},{1,a,aa,d,dd},{1,a,aa,e,ee},{1,b,bb,c,cc},
 1291:		       {1,b,bb,d,dd},{1,b,bb,e,ee},{1,c,cc,c,cc},{1,c,cc,d,dd},
 1292:		       {1,c,cc,e,ee},{2,a,aa,c,cc},{2,a,aa,d,dd},{2,b,bb,c,cc},
 1293:		       {2,b,bb,d,dd}])),
 1294:
 1295:    R1 = relation([{a,b},{b,c}]),
 1296:    R2 = relation([{b,1},{a,2},{c,3},{c,4}]),
 1297:    ?line eval(join(R1, 1, R2, 1), from_term([{a,b,2},{b,c,1}])),
 1298:    ?line eval(join(R1, 2, R2, 1), from_term([{a,b,1},{b,c,3},{b,c,4}])),
 1299:    ?line eval(join(R1, 1, converse(R2), 2),
<a name="1300"></a> 1300:	       from_term([{a,b,2},{b,c,1}])),
 1301:    ?line eval(join(R1, 2, converse(R2), 2),
 1302:	       from_term([{a,b,1},{b,c,3},{b,c,4}])),
 1303:    ok.
 1304:
<a name=canonical> 1305:<b>canonical</b></a>(suite) -&gt; [];
<a name=canonical> 1306:<b>canonical</b></a>(doc) -&gt; [""];
<a name=canonical> 1307:<b>canonical</b></a>(Conf) when list(Conf) -&gt;
 1308:    ?line E = empty_set(),    
 1309:    ?line {'EXIT', {badarg, _}} = 
<a name="1310"></a> 1310:        (catch canonical_relation(set([a,b]))),
 1311:    ?line eval(canonical_relation(E), E),
 1312:    ?line eval(canonical_relation(from_term([[]])), E),
 1313:    ?line eval(canonical_relation(from_term([[a,b,c]])),
 1314:               from_term([{a,[a,b,c]},{b,[a,b,c]},{c,[a,b,c]}])),
 1315:    ok.
 1316:
<a name=relation_to_family_1> 1317:<b>relation_to_family_1</b></a>(suite) -&gt; [];
<a name=relation_to_family_1> 1318:<b>relation_to_family_1</b></a>(doc) -&gt; [""];
<a name=relation_to_family_1> 1319:<b>relation_to_family_1</b></a>(Conf) when list(Conf) -&gt;
<a name="1320"></a> 1320:    ?line E = empty_set(),
 1321:    ?line EF = family([]),
 1322:    ?line eval(relation_to_family(E), E),
 1323:    ?line eval(relation_to_family(relation([])), EF),
 1324:    ?line eval(relation_to_family(relation([], 2)), EF),
 1325:    ?line R = relation([{b,1},{c,7},{c,9},{c,11}]),
 1326:    ?line F = family([{b,[1]},{c,[7,9,11]}]),
 1327:    ?line eval(relation_to_family(R), F),
 1328:    ?line eval(sofs:rel2fam(R), F),
 1329:    ?line {'EXIT', {badarg, _}} = (catch relation_to_family(set([a]))),
<a name="1330"></a> 1330:    ok.
 1331:
<a name=domain_1> 1332:<b>domain_1</b></a>(suite) -&gt; [];
<a name=domain_1> 1333:<b>domain_1</b></a>(doc) -&gt; [""];
<a name=domain_1> 1334:<b>domain_1</b></a>(Conf) when list(Conf) -&gt;
 1335:    ?line E = empty_set(),
 1336:    ?line ER = relation([]),
 1337:    ?line {'EXIT', {badarg, _}} = (catch domain(relation([],3))),
 1338:    ?line eval(domain(E), E),
 1339:    ?line eval(domain(ER), set([])),
<a name="1340"></a> 1340:    ?line eval(domain(relation([{1,a},{1,b},{2,a},{2,b}])), set([1,2])),
 1341:    ?line eval(domain(relation([{a,1},{b,2},{c,3}])), set([a,b,c])),
 1342:    ?line eval(field(relation([{a,1},{b,2},{c,3}])), 
 1343:               set([a,b,c,1,2,3])),
 1344:    F = 0.0, I = round(F),
 1345:    ?line FR = relation([{I,a},{F,b}]),
 1346:    if
 1347:        F == I -&gt; % term ordering
 1348:            ?line true = (1 =:= no_elements(domain(FR)));
 1349:        true -&gt; 
<a name="1350"></a> 1350:            ?line true = (2 =:= no_elements(domain(FR)))
 1351:    end,
 1352:    ok.
 1353:
<a name=range_1> 1354:<b>range_1</b></a>(suite) -&gt; [];
<a name=range_1> 1355:<b>range_1</b></a>(doc) -&gt; [""];
<a name=range_1> 1356:<b>range_1</b></a>(Conf) when list(Conf) -&gt;
 1357:    ?line E = empty_set(),
 1358:    ?line ER = relation([]),
 1359:    ?line {'EXIT', {badarg, _}} = (catch range(relation([],3))),
<a name="1360"></a> 1360:    ?line eval(range(E), E),
 1361:    ?line eval(range(ER), set([])),
 1362:    ?line eval(range(relation([{1,a},{1,b},{2,a},{2,b}])), set([a,b])),
 1363:    ?line eval(range(relation([{a,1},{b,2},{c,3}])), set([1,2,3])),
 1364:    ok.
 1365:    
<a name=inverse_1> 1366:<b>inverse_1</b></a>(suite) -&gt; [];
<a name=inverse_1> 1367:<b>inverse_1</b></a>(doc) -&gt; [""];
<a name=inverse_1> 1368:<b>inverse_1</b></a>(Conf) when list(Conf) -&gt;
 1369:    ?line E = empty_set(),
<a name="1370"></a> 1370:    ?line ER = relation([]),
 1371:    ?line {'EXIT', {badarg, _}} = (catch inverse(relation([],3))),
 1372:    ?line {'EXIT', {bad_function, _}} = 
 1373:	(catch inverse(relation([{1,a},{1,b}]))),
 1374:    ?line {'EXIT', {bad_function, _}} = 
 1375:	(catch inverse(relation([{1,a},{2,a}]))),
 1376:    ?line eval(inverse(E), E),
 1377:    ?line eval(inverse(ER), ER),
 1378:    ?line eval(inverse(relation([{a,1},{b,2},{c,3}])),
 1379:               relation([{1,a},{2,b},{3,c}])),
<a name="1380"></a> 1380:    F = 0.0, I = round(F),
 1381:    ?line FR = relation([{I,a},{F,b}]),
 1382:    if
 1383:        F == I -&gt; % term ordering
 1384:            ?line {'EXIT', {bad_function, _}} = (catch inverse(FR));
 1385:        true -&gt; 
 1386:            ?line eval(inverse(FR), relation([{a,I},{b,F}]))
 1387:    end,
 1388:    ok.
 1389:    
<a name=converse_1><a name="1390"></a> 1390:<b>converse_1</b></a>(suite) -&gt; [];
<a name=converse_1> 1391:<b>converse_1</b></a>(doc) -&gt; [""];
<a name=converse_1> 1392:<b>converse_1</b></a>(Conf) when list(Conf) -&gt;
 1393:    ?line E = empty_set(),
 1394:    ?line ER = relation([]),
 1395:    ?line {'EXIT', {badarg, _}} = (catch converse(relation([],3))),
 1396:    ?line eval(converse(ER), ER),
 1397:    ?line eval(converse(E), E),
 1398:    ?line eval(converse(relation([{a,1},{b,2},{c,3}])),
 1399:               relation([{1,a},{2,b},{3,c}])),
<a name="1400"></a> 1400:    ?line eval(converse(relation([{1,a},{1,b}])),
 1401:	       relation([{a,1},{b,1}])),
 1402:    ?line eval(converse(relation([{1,a},{2,a}])),
 1403:	       relation([{a,1},{a,2}])),
 1404:    ok.
 1405:    
<a name=no_elements_1> 1406:<b>no_elements_1</b></a>(suite) -&gt; [];
<a name=no_elements_1> 1407:<b>no_elements_1</b></a>(doc) -&gt; [""];
<a name=no_elements_1> 1408:<b>no_elements_1</b></a>(Conf) when list(Conf) -&gt;
 1409:    ?line 0 = no_elements(empty_set()),
<a name="1410"></a> 1410:    ?line 0 = no_elements(set([])),
 1411:    ?line 1 = no_elements(from_term([a])),
 1412:    ?line 10 = no_elements(from_term(lists:seq(1,10))),
 1413:    ?line 3 = no_elements(from_term({a,b,c},{atom,atom,atom})),
 1414:    ?line {'EXIT', {badarg, _}} = (catch no_elements(from_term(a))),
 1415:    ?line {'EXIT', {function_clause, _}} = (catch no_elements(a)),
 1416:    ok.
 1417:
<a name=image> 1418:<b>image</b></a>(suite) -&gt; [];
<a name=image> 1419:<b>image</b></a>(doc) -&gt; [""];
<a name=image><a name="1420"></a> 1420:<b>image</b></a>(Conf) when list(Conf) -&gt;
 1421:    ?line E = empty_set(),
 1422:    ?line ER = relation([]),
 1423:    ?line eval(image(E, E), E),
 1424:    ?line eval(image(ER, E), set([])),
 1425:    ?line eval(image(relation([{a,1},{b,2},{c,3},{f,6}]), set([a,b,c,d,f])), 
 1426:               set([1,2,3,6])),
 1427:    ?line eval(image(relation([{a,1},{b,2},{c,3},{d,4},{r,17}]), 
 1428:		     set([b,c,q,r])), 
 1429:               set([2,3,17])),
<a name="1430"></a> 1430:    ?line eval(image(from_term([{[a],{1}},{[b],{2}}]), from_term([[a]])),
 1431:	       from_term([{1}])),
 1432:    ?line eval(image(relation([{1,a},{2,a},{3,a},{4,b},{2,b}]), set([1,2,4])),
 1433:	       set([a,b])),
 1434:    ?line {'EXIT', {badarg, _}} =
 1435:	(catch image(from_term([a,b]), E)),
 1436:    ?line {'EXIT', {type_mismatch, _}} =
 1437:	(catch image(from_term([{[a],1}]), set([[a]]))),
 1438:    ok.
 1439:
<a name=inverse_image><a name="1440"></a> 1440:<b>inverse_image</b></a>(suite) -&gt; [];
<a name=inverse_image> 1441:<b>inverse_image</b></a>(doc) -&gt; [""];
<a name=inverse_image> 1442:<b>inverse_image</b></a>(Conf) when list(Conf) -&gt;
 1443:    ?line E = empty_set(),
 1444:    ?line ER = relation([]),
 1445:    ?line eval(inverse_image(E, E), E),
 1446:    ?line eval(inverse_image(ER, E), set([])),
 1447:    ?line eval(inverse_image(converse(relation([{a,1},{b,2},{c,3},{f,6}])), 
 1448:			     set([a,b,c,d,f])), 
 1449:               set([1,2,3,6])),
<a name="1450"></a> 1450:    ?line eval(inverse_image(converse(relation([{a,1},{b,2},{c,3},
 1451:						{d,4},{r,17}])), 
 1452:			     set([b,c,q,r])), 
 1453:               set([2,3,17])),
 1454:    ?line eval(inverse_image(converse(from_term([{[a],{1}},{[b],{2}}])), 
 1455:			     from_term([[a]])),
 1456:	       from_term([{1}])),
 1457:    ?line eval(inverse_image(converse(relation([{1,a},{2,a},
 1458:						{3,a},{4,b},{2,b}])), 
 1459:			     set([1,2,4])),
<a name="1460"></a> 1460:	       set([a,b])),
 1461:    ?line {'EXIT', {badarg, _}} =
 1462:	(catch inverse_image(from_term([a,b]), E)),
 1463:    ?line {'EXIT', {type_mismatch, _}} =
 1464:	(catch inverse_image(converse(from_term([{[a],1}])), set([[a]]))),
 1465:    ok.
 1466:
<a name=composite_1> 1467:<b>composite_1</b></a>(suite) -&gt; [];
<a name=composite_1> 1468:<b>composite_1</b></a>(doc) -&gt; [""];
<a name=composite_1> 1469:<b>composite_1</b></a>(Conf) when list(Conf) -&gt;
<a name="1470"></a> 1470:    ?line E = empty_set(),
 1471:    ?line EF = a_function([]),
 1472:    ?line eval(composite(E, E), E),
 1473:    ?line eval(composite(E, a_function([{a,b}])), E),
 1474:    ?line eval(composite(relation([{a,b}]), E), E),
 1475:    ?line {'EXIT', {bad_function, _}} = 
 1476:	(catch composite(EF, relation([{a,b},{a,c}]))),
 1477:    ?line {'EXIT', {bad_function, _}} = 
 1478:	(catch composite(a_function([{b,a}]), EF)),
 1479:    ?line {'EXIT', {bad_function, _}} = 
<a name="1480"></a> 1480:	(catch composite(relation([{1,a},{2,b},{2,a}]), 
 1481:			 a_function([{a,1},{b,3}]))),
 1482:    ?line {'EXIT', {bad_function, _}} = 
 1483:	 (catch composite(a_function([{1,a},{2,b}]), a_function([{b,3}]))),
 1484:    ?line eval(composite(EF, EF), EF),
 1485:    ?line eval(composite(a_function([{b,a}]), from_term([{a,{b,c}}])),
 1486:               from_term([{b,{b,c}}])),
 1487:    ?line eval(composite(a_function([{q,1},{z,2}]), 
 1488:			 a_function([{1,a},{2,a}])),
 1489:               a_function([{q,a},{z,a}])),
<a name="1490"></a> 1490:    ?line eval(composite(a_function([{a,0},{b,0},{c,1},{d,1},{e,2},{f,3}]), 
 1491:			 a_function([{0,p},{1,q},{2,r},{3,w},{4,aa}])),
 1492:               a_function([{c,q},{d,q},{f,w},{e,r},{a,p},{b,p}])),
 1493:    ?line eval(composite(a_function([{1,c}]), 
 1494:			 a_function([{a,1},{b,3},{c,4}])),
 1495:	       a_function([{1,4}])),
 1496:    ?line {'EXIT', {bad_function, _}} = 
 1497:	(catch composite(a_function([{1,a},{2,b}]), 
 1498:			 a_function([{a,1},{c,3}]))),
 1499:    ?line {'EXIT', {badarg, _}} = 
<a name="1500"></a> 1500:	(catch composite(from_term([a,b]), E)),
 1501:    ?line {'EXIT', {badarg, _}} = 
 1502:	(catch composite(E, from_term([a,b]))),
 1503:    ?line {'EXIT', {type_mismatch, _}} = 
 1504:        (catch composite(from_term([{a,b}]), from_term([{{a},b}]))),
 1505:    ?line {'EXIT', {type_mismatch, _}} = 
 1506:        (catch composite(from_term([{a,b}]), 
 1507:			 from_term([{b,c}], [{d,r}]))),
 1508:    F = 0.0, I = round(F),
 1509:    ?line FR1 = relation([{1,c}]),
<a name="1510"></a> 1510:    ?line FR2 = relation([{I,1},{F,3},{c,4}]),
 1511:    if
 1512:        F == I -&gt; % term ordering
 1513:            ?line {'EXIT', {bad_function, _}} = (catch composite(FR1, FR2));
 1514:        true -&gt; 
 1515:            ?line eval(composite(FR1, FR2), a_function([{1,4}]))
 1516:    end,
 1517:    ok.
 1518:
<a name=relative_product_1> 1519:<b>relative_product_1</b></a>(suite) -&gt; [];
<a name=relative_product_1><a name="1520"></a> 1520:<b>relative_product_1</b></a>(doc) -&gt; [""];
<a name=relative_product_1> 1521:<b>relative_product_1</b></a>(Conf) when list(Conf) -&gt;
 1522:    ?line E = empty_set(),
 1523:    ?line ER = relation([]),
 1524:    ?line eval(relative_product1(E, E), E),
 1525:    ?line eval(relative_product1(E, relation([{a,b}])), E),
 1526:    ?line eval(relative_product1(relation([{a,b}]), E), E),
 1527:    ?line eval(relative_product1(relation([{a,b}]), from_term([{a,{b,c}}])),
 1528:               from_term([{b,{b,c}}])),
 1529:    ?line eval(relative_product1(relation([{1,z},{1,q},{2,z}]), 
<a name="1530"></a> 1530:				 relation([{1,a},{1,b},{2,a}])),
 1531:               relation([{q,a},{q,b},{z,a},{z,b}])),
 1532:    ?line eval(relative_product1(relation([{0,a},{0,b},{1,c},
 1533:					   {1,d},{2,e},{3,f}]), 
 1534:				 relation([{1,q},{3,w}])),
 1535:               relation([{c,q},{d,q},{f,w}])),
 1536:    ?line {'EXIT', {badarg, _}} = 
 1537:	(catch relative_product1(from_term([a,b]), ER)),
 1538:    ?line {'EXIT', {badarg, _}} = 
 1539:	(catch relative_product1(ER, from_term([a,b]))),
<a name="1540"></a> 1540:    ?line {'EXIT', {type_mismatch, _}} = 
 1541:        (catch relative_product1(from_term([{a,b}]), from_term([{{a},b}]))),
 1542:    ?line {'EXIT', {type_mismatch, _}} = 
 1543:        (catch relative_product1(from_term([{a,b}]), 
 1544:				 from_term([{b,c}], [{d,r}]))),
 1545:    ok.
 1546:
<a name=relative_product_2> 1547:<b>relative_product_2</b></a>(suite) -&gt; [];
<a name=relative_product_2> 1548:<b>relative_product_2</b></a>(doc) -&gt; [""];
<a name=relative_product_2> 1549:<b>relative_product_2</b></a>(Conf) when list(Conf) -&gt;
<a name="1550"></a> 1550:    ?line E = empty_set(),
 1551:    ?line ER = relation([]),
 1552:
 1553:    ?line {'EXIT', {badarg, _}} = (catch relative_product({from_term([a,b])})),
 1554:    ?line {'EXIT', {type_mismatch, _}} =
 1555:	(catch relative_product({from_term([{a,b}]), from_term([{{a},b}])})),
 1556:    ?line {'EXIT', {badarg, _}} = (catch relative_product({})), 
 1557:    ?line true = is_equal(relative_product({ER}), 
 1558:			  from_term([], [{atom,{atom}}])),
 1559:    ?line eval(relative_product({relation([{a,b},{c,a}]),
<a name="1560"></a> 1560:				 relation([{a,1},{a,2}]),
 1561:				 relation([{a,aa},{c,1}])}),
 1562:               from_term([{a,{b,1,aa}},{a,{b,2,aa}}])),
 1563:    ?line eval(relative_product({relation([{a,b}])}, E), E),
 1564:    ?line eval(relative_product({E}, relation([{a,b}])), E),
 1565:    ?line eval(relative_product({E,from_term([], [{{atom,atom,atom},atom}])}),
 1566:	       E),
 1567:    ?line {'EXIT', {badarg, _}} = 
 1568:        (catch relative_product({from_term([a,b])}, E)),
 1569:    ?line {'EXIT', {badarg, _}} = 
<a name="1570"></a> 1570:	(catch relative_product({relation([])}, set([]))),
 1571:    ?line {'EXIT', {type_mismatch, _}} =
 1572:	(catch relative_product({from_term([{a,b}]), 
 1573:				 from_term([{{a},b}])}, ER)),
 1574:
 1575:    ?line {'EXIT', {badarg, _}} = (catch relative_product({}, ER)),
 1576:    ?line eval(relative_product({relation([{a,b}])}, 
 1577:				from_term([],[{{atom},atom}])), 
 1578:               ER),
 1579:    ?line eval(relative_product({relation([{a,b}]),relation([{a,1}])}, 
<a name="1580"></a> 1580:				from_term([{{b,1},{tjo,hej,sa}}])),
 1581:               from_term([{a,{tjo,hej,sa}}])),
 1582:    ?line eval(relative_product({relation([{a,b}]), ER}, 
 1583:				from_term([{{a,b},b}])), 
 1584:               ER),
 1585:    ?line eval(relative_product({relation([{a,b},{c,a}]), 
 1586:				 relation([{a,1},{a,2}])},
 1587:				from_term([{{b,1},b1},{{b,2},b2}])),
 1588:               relation([{a,b1},{a,b2}])),
 1589:    ?line eval(relative_product({relation([{a,b}]), ER}), 
<a name="1590"></a> 1590:               from_term([],[{atom,{atom,atom}}])),
 1591:    ?line eval(relative_product({from_term([{{a,[a,b]},[a]}]),
 1592:				 from_term([{{a,[a,b]},[[a,b]]}])}),
 1593:               from_term([{{a,[a,b]},{[a],[[a,b]]}}])),
 1594:    ok.
 1595:
<a name=product_1> 1596:<b>product_1</b></a>(suite) -&gt; [];
<a name=product_1> 1597:<b>product_1</b></a>(doc) -&gt; [""];
<a name=product_1> 1598:<b>product_1</b></a>(Conf) when list(Conf) -&gt;
 1599:    ?line E = empty_set(),
<a name="1600"></a> 1600:    ?line eval(product(E, E), E),
 1601:    ?line eval(product(relation([]), E), E),
 1602:    ?line eval(product(E, relation([])), E),
 1603:    ?line eval(product(relation([{a,b}]),relation([{c,d}])),
 1604:               from_term([{{a,b},{c,d}}],[{{atom,atom},{atom,atom}}])),
 1605:
 1606:    ?line eval(product({E, set([a,b,c])}), E),
 1607:    ?line eval(product({set([a,b,c]), E}), E),
 1608:    ?line eval(product({set([a,b,c]), E, E}), E),
 1609:    ?line eval(product({E,E}), E),
<a name="1610"></a> 1610:    ?line eval(product({set([a,b]),set([1,2])}), 
 1611:               relation([{a,1},{a,2},{b,1},{b,2}])),
 1612:    ?line eval(product({from_term([a,b]), from_term([{a,b},{c,d}]),
 1613:                        from_term([1])}),
 1614:               from_term([{a,{a,b},1},{a,{c,d},1},{b,{a,b},1},{b,{c,d},1}])),
 1615:    ?line {'EXIT', {badarg, _}} = (catch product({})),
 1616:    ?line {'EXIT', {badarg, _}} = (catch product({foo})),
 1617:    ?line eval(product({E}), E),
 1618:    ?line eval(product({E, E}), E),
 1619:    ?line eval(product(set([a,b]), set([1,2])),
<a name="1620"></a> 1620:               relation([{a,1},{a,2},{b,1},{b,2}])),
 1621:    ?line eval(product({relation([]), E}), E),
 1622:    ok.
 1623:
<a name=partition_1> 1624:<b>partition_1</b></a>(suite) -&gt; [];
<a name=partition_1> 1625:<b>partition_1</b></a>(doc) -&gt; [""];
<a name=partition_1> 1626:<b>partition_1</b></a>(Conf) when list(Conf) -&gt;
 1627:    ?line E = empty_set(),
 1628:    ?line ER = relation([]),
 1629:    ?line Id = fun(A) -&gt; A end,
<a name="1630"></a> 1630:    ?line S1 = relation([{a,1},{b,2},{b,22},{c,0}]),
 1631:    ?line eval(partition(1, E), E),
 1632:    ?line eval(partition(2, E), E),
 1633:    ?line eval(partition(1, ER), from_term([], [type(ER)])),
 1634:    ?line eval(partition(2, ER), from_term([], [type(ER)])),
 1635:    ?line eval(partition(1, relation([{1,a},{1,b},{2,c},{2,d}])), 
 1636:	       from_term([[{1,a},{1,b}],[{2,c},{2,d}]])),
 1637:    ?line eval(partition(2, relation([{1,a},{1,b},{2,a},{2,b},{3,c}])), 
 1638:	       from_term([[{1,a},{2,a}],[{1,b},{2,b}],[{3,c}]])),
 1639:    ?line eval(partition(2, relation([{1,a}])), from_term([[{1,a}]])),
<a name="1640"></a> 1640:    ?line eval(partition(2, relation([{1,a},{2,b}])),
 1641:			 from_term([[{1,a}],[{2,b}]])),
 1642:    ?line eval(partition(2, relation([{1,a},{2,a},{3,a}])), 
 1643:	       from_term([[{1,a},{2,a},{3,a}]])),
 1644:    ?line eval(partition(2, relation([{1,b},{2,a}])), % OTP-4516
 1645:	       from_term([[{1,b}],[{2,a}]])),
 1646:    ?line eval(union(partition(Id, S1)), S1),
 1647:    ?line eval(partition({external, fun({A,{B,_}}) -&gt; {A,B} end}, 
 1648:                         from_term([{a,{b,c}},{b,{c,d}},{a,{b,f}}])),
 1649:               from_term([[{a,{b,c}},{a,{b,f}}],[{b,{c,d}}]])),
<a name="1650"></a> 1650:    F = 0.0, I = round(F),
 1651:    ?line FR = relation([{I,a},{F,b}]),
 1652:    if
 1653:        F == I -&gt; % term ordering
 1654:            ?line eval(partition(1, FR), from_term([[{I,a},{F,b}]]));
 1655:        true -&gt; 
 1656:            ?line eval(partition(1, FR), from_term([[{I,a}],[{F,b}]]))
 1657:    end,
 1658:    ?line {'EXIT', {badarg, _}} = (catch partition(2, set([a]))),
 1659:    ?line {'EXIT', {badarg, _}} = (catch partition(1, set([a]))),
<a name="1660"></a> 1660:    ?line eval(partition(Id, set([a])), from_term([[a]])),
 1661:
 1662:    ?line eval(partition(E), E),
 1663:    ?line P1 = from_term([[a,b,c],[d,e,f],[g,h]]),
 1664:    ?line P2 = from_term([[a,d],[b,c,e,f,q,v]]),
 1665:    ?line eval(partition(union(P1, P2)), 
 1666:               from_term([[a],[b,c],[d],[e,f],[g,h],[q,v]])),
 1667:    ?line {'EXIT', {badarg, _}} = (catch partition(from_term([a]))),
 1668:    ok.
 1669:
<a name=partition_3><a name="1670"></a> 1670:<b>partition_3</b></a>(suite) -&gt; [];
<a name=partition_3> 1671:<b>partition_3</b></a>(doc) -&gt; [""];
<a name=partition_3> 1672:<b>partition_3</b></a>(Conf) when list(Conf) -&gt;
 1673:    ?line E = empty_set(),
 1674:    ?line ER = relation([]),
 1675:
 1676:    %% set of ordered sets
 1677:    ?line S1 = relation([{a,1},{b,2},{b,22},{c,0}]),
 1678:    ?line eval(partition(1, S1, set([0,1,d,e])),
 1679:	       lpartition(1, S1, set([0,1,d,e]))),
<a name="1680"></a> 1680:    ?line eval(partition(1, S1, E), lpartition(1, S1, E)),
 1681:    ?line eval(partition(2, ER, set([a,b])), lpartition(2, ER, set([a,b]))),
 1682:
 1683:    XFun1 = {external, fun({_A,B,C}) -&gt; {B,C} end},
 1684:    R1a = relation([{a,aa,1},{b,bb,2},{c,cc,3}]),
 1685:    R1b = relation([{bb,2},{cc,3}]),
 1686:    ?line eval(partition(XFun1, R1a, R1b), lpartition(XFun1, R1a, R1b)),
 1687:
 1688:    Id = fun(X) -&gt; X end,
 1689:    XId = {external, Id},
<a name="1690"></a> 1690:    R2 = relation([{a,b}]),
 1691:    ?line eval(partition(XId, R2, E), lpartition(XId, R2, E)),
 1692:
 1693:    R3 = relation([{b,d}]),
 1694:    ?line eval(partition(XId, E, R3), lpartition(XId, E, R3)),
 1695:
 1696:    Fun1 = fun(S) -&gt; {_A,B,C} = to_external(S), from_term({B,C}) end,
 1697:    R4a = relation([{a,aa,1},{b,bb,2},{c,cc,3}]),
 1698:    R4b = relation([{bb,2},{cc,3}]),
 1699:    ?line eval(partition(Fun1,R4a,R4b), lpartition(Fun1,R4a,R4b)),
<a name="1700"></a> 1700:
 1701:    XFun2 = {external, fun({_,{A},B}) -&gt; {A,B} end},
 1702:    R5a = from_term([{a,{aa},1},{b,{bb},2},{c,{cc},3}]),
 1703:    R5b = from_term([{bb,2},{cc,3}]),
 1704:    ?line eval(partition(XFun2,R5a, R5b), lpartition(XFun2,R5a, R5b)),
 1705:
 1706:    R6 = relation([{a,b}]),
 1707:    ?line eval(partition(2, R6, E), lpartition(2, R6, E)),
 1708:
 1709:    R7 = relation([{b,d}]),
<a name="1710"></a> 1710:    ?line eval(partition(2, E, R7), lpartition(2, E, R7)),
 1711:
 1712:    S2 = set([a]),
 1713:    ?line eval(partition(XId, E, S2), lpartition(XId, E, S2)),
 1714:    ?line eval(partition(XId, S1, E), lpartition(XId, S1, E)),
 1715:    ?line {'EXIT', {badarg, _}} =
 1716:	(catch partition(3, relation([{a,b}]), E)),
 1717:    ?line {'EXIT', {badarg, _}} =
 1718:	(catch partition(3, relation([{a,b}]), relation([{b,d}]))),
 1719:    ?line {'EXIT', {badarg, _}} =
<a name="1720"></a> 1720:	(catch partition(3, relation([{a,b}]), set([{b,d}]))),
 1721:    ?line {'EXIT', {type_mismatch, _}} =
 1722:	(catch partition(2, relation([{a,b}]), relation([{b,d}]))),
 1723:    ?line {'EXIT', {type_mismatch, _}} =
 1724:	(catch partition({external, fun({A,_B}) -&gt; A end}, 
 1725:			 relation([{a,b}]), relation([{b,d}]))),
 1726:    ?line {'EXIT', {badarg, _}} = 
 1727:	(catch partition({external, fun({A,_}) -&gt; {A,0} end}, 
 1728:			 from_term([{1,a}]),
 1729:			 from_term([{1,0}]))),
<a name="1730"></a> 1730:
 1731:    S18a = relation([{1,e},{2,b},{3,c},{4,b},{5,a},{6,0}]),
 1732:    S18b = set([b,d,f]),
 1733:    ?line eval(partition({external,fun({_,X}) -&gt; X end}, S18a, S18b),
 1734:	       lpartition({external,fun({_,X}) -&gt; X end}, S18a, S18b)),
 1735:    S19a = sofs:relation([{3,a},{8,b}]),
 1736:    S19b = set([2,6,7]),
 1737:    ?line eval(partition({external,fun({X,_}) -&gt; X end}, S19a, S19b),
 1738:	       lpartition({external,fun({X,_}) -&gt; X end}, S19a, S19b)),
 1739:
<a name="1740"></a> 1740:    R8a = relation([{a,d},{b,e},{c,b},{d,c}]),
 1741:    S8 = set([b,d]),
 1742:    ?line eval(partition(2, R8a, S8), lpartition(2, R8a, S8)),
 1743:
 1744:    S16a = relation([{1,e},{2,b},{3,c},{4,b},{5,a},{6,0}]),
 1745:    S16b = set([b,c,d]),
 1746:    ?line eval(partition(2, S16a, S16b), lpartition(2, S16a, S16b)),
 1747:    S17a = relation([{e,1},{b,2},{c,3},{b,4},{a,5},{0,6}]),
 1748:    S17b = set([b,c,d]),
 1749:    ?line eval(partition(1, S17a, S17b), lpartition(1, S17a, S17b)),
<a name="1750"></a> 1750:
 1751:    ?line {'EXIT', {function_clause, _}} =
 1752:	(catch partition({external, fun({A,_B}) -&gt; A end}, set([]), E)),
 1753:
 1754:    Fun3 = fun(S) -&gt; from_term({to_external(S),0}, {type(S),atom}) end,
 1755:    S9a = set([1,2]),
 1756:    S9b = from_term([{1,0}]),
 1757:    ?line eval(partition(Fun3, S9a, S9b), lpartition(Fun3, S9a, S9b)),
 1758:
 1759:    S14a = relation([{1,a},{2,b},{3,c},{0,0}]),
<a name="1760"></a> 1760:    S14b = set([b,c]),
 1761:    ?line eval(partition(2, S14a, S14b), lpartition(2, S14a, S14b)),
 1762:    S15a = relation([{a,1},{b,2},{c,3},{0,0}]),
 1763:    S15b = set([b,c]),
 1764:    ?line eval(partition(1, S15a, S15b), lpartition(1, S15a, S15b)),
 1765:
 1766:    %% set of sets
 1767:    ?line {'EXIT', {badarg, _}} = 
 1768:        (catch partition({external, fun(X) -&gt; X end}, 
 1769:			 from_term([], [[atom]]), set([a]))),
<a name="1770"></a> 1770:
 1771:    S10 = from_term([], [[atom]]),
 1772:    ?line eval(partition(Id, S10, E), lpartition(Id, S10, E)),
 1773:
 1774:    S10e = from_term([[a],[b]], [[atom]]),
 1775:    ?line eval(partition(Id, S10e, E), lpartition(Id, S10e, E)),
 1776:
 1777:    S11a = from_term([], [[atom]]),
 1778:    S11b = set([a]),
 1779:    ?line eval(partition(Id, S11a, S11b), lpartition(Id, S11a, S11b)),
<a name="1780"></a> 1780:
 1781:    S12a = from_term([[[a],[b]], [[b],[c]], [[], [a,b]], [[1],[2]]]),
 1782:    S12b = from_term([[a,b],[1,2,3],[b,c]]),
 1783:    ?line eval(partition({sofs,union}, S12a, S12b),
 1784:	       lpartition({sofs,union}, S12a, S12b)),
 1785:
 1786:    Fun13 = fun(_) -&gt; from_term([a]) end,
 1787:    S13a = from_term([], [[atom]]),
 1788:    S13b = from_term([], [[a]]),
 1789:    ?line eval(partition(Fun13, S13a, S13b), lpartition(Fun13, S13a, S13b)),
<a name="1790"></a> 1790:
 1791:    ?line {'EXIT', {type_mismatch, _}} =
 1792:        (catch partition(fun(_) -&gt; from_term([a]) end, 
 1793:			 from_term([[1,2],[3,4]]),
 1794:			 from_term([], [atom]))),
 1795:    Fun10 = fun(S) -&gt;
 1796:                   %% Cheating a lot...
 1797:                   case to_external(S) of
 1798:                       [1] -&gt; from_term({1,1});
 1799:                       _ -&gt; S
<a name="1800"></a> 1800:                   end
 1801:           end,
 1802:    ?line {'EXIT', {type_mismatch, _}} =
 1803:        (catch partition(Fun10, from_term([[1]]), from_term([], [[atom]]))),
 1804:    ?line {'EXIT', {type_mismatch, _}} = 
 1805:        (catch partition(fun(_) -&gt; from_term({a}) end, 
 1806:			 from_term([[a]]),
 1807:			 from_term([], [atom]))),
 1808:    ?line {'EXIT', {badarg, _}} = 
 1809:        (catch partition(fun(_) -&gt; {a} end, 
<a name="1810"></a> 1810:			 from_term([[a]]),
 1811:			 from_term([], [atom]))),
 1812:    ok.
 1813:
<a name=lpartition> 1814:<b>lpartition</b></a>(F, S1, S2) -&gt;
 1815:    {restriction(F, S1, S2), drestriction(F, S1, S2)}.
 1816:
<a name=multiple_relative_product> 1817:<b>multiple_relative_product</b></a>(suite) -&gt; [];
<a name=multiple_relative_product> 1818:<b>multiple_relative_product</b></a>(doc) -&gt; [""];
<a name=multiple_relative_product> 1819:<b>multiple_relative_product</b></a>(Conf) when list(Conf) -&gt;
<a name="1820"></a> 1820:    ?line E = empty_set(),
 1821:    ?line ER = relation([]),
 1822:    ?line T = relation([{a,1},{a,11},{b,2},{c,3},{c,33},{d,4}]), 
 1823:    ?line {'EXIT', {badarg, _}} = 
 1824:        (catch multiple_relative_product({}, ER)),
 1825:    ?line {'EXIT', {badarg, _}} = 
 1826:	(catch multiple_relative_product({}, relation([{a,b}]))),
 1827:    ?line eval(multiple_relative_product({E,T,T}, relation([], 3)), E),
 1828:    ?line eval(multiple_relative_product({T,T,T}, E), E),
 1829:    ?line eval(multiple_relative_product({T,T,T}, relation([],3)), 
<a name="1830"></a> 1830:               from_term([],[{{atom,atom,atom},{atom,atom,atom}}])),
 1831:    ?line eval(multiple_relative_product({T,T,T}, 
 1832:                                   relation([{a,b,c},{c,d,a}])),
 1833:               from_term([{{a,b,c},{1,2,3}}, {{a,b,c},{1,2,33}},
 1834:                          {{a,b,c},{11,2,3}}, {{a,b,c},{11,2,33}},
 1835:                          {{c,d,a},{3,4,1}}, {{c,d,a},{3,4,11}},
 1836:                          {{c,d,a},{33,4,1}}, {{c,d,a},{33,4,11}}])),
 1837:    ?line {'EXIT', {type_mismatch, _}} =
 1838:	(catch multiple_relative_product({T}, from_term([{{a}}]))), 
 1839:    ok.
<a name="1840"></a> 1840:
<a name=digraph> 1841:<b>digraph</b></a>(suite) -&gt; [];
<a name=digraph> 1842:<b>digraph</b></a>(doc) -&gt; [""];
<a name=digraph> 1843:<b>digraph</b></a>(Conf) when list(Conf) -&gt;
 1844:    ?line T0 = ets:all(),
 1845:    ?line E = empty_set(),
 1846:    ?line R = relation([{a,b},{b,c},{c,d},{d,a}]),
 1847:    ?line F = relation_to_family(R),
 1848:    Type = type(F),
 1849:
<a name="1850"></a> 1850:    ?line {'EXIT', {badarg, _}} = 
 1851:        (catch family_to_digraph(set([a]))),
 1852:    ?line {'EXIT', {badarg, _}} = 
 1853:        (catch family_to_digraph(set([a]), [foo])),
 1854:    ?line {'EXIT', {badarg, _}} = 
 1855:        (catch family_to_digraph(F, [foo])),
 1856:    ?line {'EXIT', {cyclic, _}} = 
 1857:        (catch family_to_digraph(family([{a,[a]}]),[acyclic])),
 1858:
 1859:    ?line G1 = family_to_digraph(E),
<a name="1860"></a> 1860:    ?line {'EXIT', {badarg, _}} = (catch digraph_to_family(G1, foo)),
 1861:    ?line {'EXIT', {badarg, _}} = (catch digraph_to_family(G1, atom)),
 1862:    ?line true = [] == to_external(digraph_to_family(G1)),
 1863:    ?line true = [] == to_external(digraph_to_family(G1, Type)),
 1864:    ?line true = digraph:delete(G1),
 1865:
 1866:    ?line G1a = family_to_digraph(E, [protected]),
 1867:    ?line true = [] == to_external(digraph_to_family(G1a)),
 1868:    ?line true = [] == to_external(digraph_to_family(G1a, Type)),
 1869:    ?line true = digraph:delete(G1a),
<a name="1870"></a> 1870:
 1871:    ?line G2 = family_to_digraph(F),
 1872:    ?line true = F == digraph_to_family(G2),
 1873:    ?line true = F == digraph_to_family(G2, type(F)),
 1874:    ?line true = digraph:delete(G2),
 1875:
 1876:    ?line R2 = from_term([{{a},b},{{c},d}]),
 1877:    ?line F2 = relation_to_family(R2),
 1878:    ?line Type2 = type(F2),
 1879:    ?line G3 = family_to_digraph(F2, [protected]),
<a name="1880"></a> 1880:    ?line true = is_subset(F2, digraph_to_family(G3, Type2)),
 1881:    ?line true = digraph:delete(G3),
 1882:
 1883:    Fl = 0.0, I = round(Fl),
 1884:    if
 1885:        Fl == I -&gt; % term ordering
 1886:            ?line G4 = digraph:new(),
 1887:            digraph:add_vertex(G4, Fl),
 1888:            digraph:add_vertex(G4, I),
 1889:            ?line {'EXIT', {badarg, _}} = 
<a name="1890"></a> 1890:                (catch digraph_to_family(G4, Type)),
 1891:            ?line {'EXIT', {badarg, _}} = 
 1892:                (catch digraph_to_family(G4)),
 1893:            ?line true = digraph:delete(G4);
 1894:        true -&gt; ok
 1895:    end,
 1896:    
 1897:    ?line true = T0 == ets:all(),
 1898:    ok.
 1899:
<a name=constant_function><a name="1900"></a> 1900:<b>constant_function</b></a>(suite) -&gt; [];
<a name=constant_function> 1901:<b>constant_function</b></a>(doc) -&gt; [""];
<a name=constant_function> 1902:<b>constant_function</b></a>(Conf) when list(Conf) -&gt;
 1903:    ?line E = empty_set(),
 1904:    ?line C = from_term(3),
 1905:    ?line eval(constant_function(E, C), E),
 1906:    ?line eval(constant_function(set([a,b]), E), from_term([{a,[]},{b,[]}])),
 1907:    ?line eval(constant_function(set([a,b]), C), from_term([{a,3},{b,3}])),
 1908:    ?line {'EXIT', {badarg, _}} = (catch constant_function(C, C)),
 1909:    ?line {'EXIT', {badarg, _}} = (catch constant_function(set([]), foo)),
<a name="1910"></a> 1910:    ok.
 1911:
<a name=misc> 1912:<b>misc</b></a>(suite) -&gt; [];
<a name=misc> 1913:<b>misc</b></a>(doc) -&gt; [""];
<a name=misc> 1914:<b>misc</b></a>(Conf) when list(Conf) -&gt;
 1915:    % find "relational" part of relation:
 1916:    ?line S = relation([{a,b},{b,c},{b,d},{c,d}]),
 1917:    Id = fun(A) -&gt; A end,
 1918:    ?line RR = relational_restriction(S),
 1919:    ?line eval(union(difference(partition(Id,S), partition(1,S))), RR),
<a name="1920"></a> 1920:    ?line eval(union(difference(partition(1,S), partition(Id,S))), RR),
 1921:
 1922:    % the "functional" part:
 1923:    ?line eval(union(intersection(partition(1,S), partition(Id,S))),
 1924:               difference(S, RR)),
 1925:
 1926:    %% The function external:foo/1 is undefined.
 1927:    ?line {'EXIT', {undef, _}} =    
 1928: 	(catch projection({external,foo}, set([a,b,c]))),
 1929:    ok.
<a name="1930"></a> 1930:
<a name=relational_restriction> 1931:<b>relational_restriction</b></a>(R) -&gt;
 1932:    Fun = fun(S) -&gt; no_elements(S) &gt; 1 end,
 1933:    family_to_relation(family_specification(Fun, relation_to_family(R))).
 1934:
<a name=sofs_family> 1935:<b>sofs_family</b></a>(suite) -&gt;
 1936:    [family_specification, family_domain_1, family_range_1, 
 1937:     family_to_relation_1, union_of_family_1, intersection_of_family_1, 
 1938:     family_projection, family_difference, 
 1939:     family_intersection_1, family_intersection_2, 
<a name="1940"></a> 1940:     family_union_1, family_union_2, partition_family].
 1941:
<a name=family_specification> 1942:<b>family_specification</b></a>(suite) -&gt; [];
<a name=family_specification> 1943:<b>family_specification</b></a>(doc) -&gt; [""];
<a name=family_specification> 1944:<b>family_specification</b></a>(Conf) when list(Conf) -&gt;
 1945:    E = empty_set(),
 1946:    %% internal
 1947:    ?line eval(family_specification({sofs, is_set}, E), E),
 1948:    ?line {'EXIT', {badarg, _}} =    
 1949: 	(catch family_specification({sofs,is_set}, set([]))),
<a name="1950"></a> 1950:    ?line F1 = from_term([{1,[1]}]),
 1951:    ?line eval(family_specification({sofs,is_set}, F1), F1),
 1952:    Fun = fun(S) -&gt; is_subset(S, set([0,1,2,3,4])) end,
 1953:    ?line F2 = family([{a,[1,2]},{b,[3,4,5]}]),
 1954:    ?line eval(family_specification(Fun, F2), family([{a,[1,2]}])),
 1955:    ?line F3 = from_term([{a,[]},{b,[]}]),
 1956:    ?line eval(family_specification({sofs,is_set}, F3), F3),
 1957:    Fun2 = fun(_) -&gt; throw(fippla) end, 
 1958:    ?line fippla = (catch family_specification(Fun2, family([{a,[1]}]))),
 1959:    Fun3 = fun(_) -&gt; neither_true_or_false end,
<a name="1960"></a> 1960:    ?line {'EXIT', {badarg, _}} = 
 1961:	(catch family_specification(Fun3, F3)),
 1962:
 1963:    %% external
 1964:    IsList = {external, fun(L) when list(L) -&gt; true; (_) -&gt; false end},
 1965:    ?line eval(family_specification(IsList, E), E),
 1966:    ?line eval(family_specification(IsList, F1), F1),
 1967:    MF = {external, fun(L) -&gt; lists:member(3, L) end},
 1968:    ?line eval(family_specification(MF, F2), family([{b,[3,4,5]}])),
 1969:    ?line fippla = (catch family_specification(Fun2, family([{a,[1]}]))),
<a name="1970"></a> 1970:    ?line {'EXIT', {badarg, _}} = 
 1971:	(catch family_specification({external, Fun3}, F3)),
 1972:    ok.
 1973:
<a name=family_domain_1> 1974:<b>family_domain_1</b></a>(suite) -&gt; [];
<a name=family_domain_1> 1975:<b>family_domain_1</b></a>(doc) -&gt; [""];
<a name=family_domain_1> 1976:<b>family_domain_1</b></a>(Conf) when list(Conf) -&gt;
 1977:    ?line E = empty_set(),
 1978:    ?line ER = from_term([{a,[]},{b,[]}],[{atom,[{atom,atom}]}]),
 1979:    ?line EF = from_term([{a,[]},{b,[]}],[{atom,[atom]}]),
<a name="1980"></a> 1980:    ?line eval(family_domain(E), E),
 1981:    ?line eval(family_domain(ER), EF),
 1982:    ?line FR = from_term([{a,[{1,a},{2,b},{3,c}]},{b,[]},{c,[{4,d},{5,e}]}]),
 1983:    ?line eval(family_domain(FR), from_term([{a,[1,2,3]},{b,[]},{c,[4,5]}])),
 1984:    ?line eval(family_field(E), E),
 1985:    ?line eval(family_field(FR), 
 1986:               from_term([{a,[a,b,c,1,2,3]},{b,[]},{c,[d,e,4,5]}])),
 1987:    ?line eval(family_domain(from_term([{{a},[{{1,[]},c}]}])),
 1988:               from_term([{{a},[{1,[]}]}])),
 1989:    ?line eval(family_domain(from_term([{{a},[{{1,[a]},c}]}])),
<a name="1990"></a> 1990:               from_term([{{a},[{1,[a]}]}])),
 1991:    ?line eval(family_domain(from_term([{{a},[]}])),
 1992:	       from_term([{{a},[]}])),
 1993:    ?line eval(family_domain(from_term([], type(FR))), 
 1994:               from_term([], [{atom,[atom]}])),
 1995:    ?line {'EXIT', {badarg, _}} = (catch family_domain(set([a]))),
 1996:    ?line {'EXIT', {badarg, _}} = (catch family_field(set([a]))),
 1997:    ?line {'EXIT', {badarg, _}} = (catch family_domain(set([{a,[b]}]))),
 1998:    ok.
 1999:
<a name=family_range_1><a name="2000"></a> 2000:<b>family_range_1</b></a>(suite) -&gt; [];
<a name=family_range_1> 2001:<b>family_range_1</b></a>(doc) -&gt; [""];
<a name=family_range_1> 2002:<b>family_range_1</b></a>(Conf) when list(Conf) -&gt;
 2003:    ?line E = empty_set(),
 2004:    ?line ER = from_term([{a,[]},{b,[]}],[{atom,[{atom,atom}]}]),
 2005:    ?line EF = from_term([{a,[]},{b,[]}],[{atom,[atom]}]),
 2006:    ?line eval(family_range(E), E),
 2007:    ?line eval(family_range(ER), EF),
 2008:    ?line FR = from_term([{a,[{1,a},{2,b},{3,c}]},{b,[]},{c,[{4,d},{5,e}]}]),
 2009:    ?line eval(family_range(FR), from_term([{a,[a,b,c]},{b,[]},{c,[d,e]}])),
<a name="2010"></a> 2010:    ?line eval(family_range(from_term([{{a},[{c,{1,[a]}}]}])),
 2011:               from_term([{{a},[{1,[a]}]}])),
 2012:    ?line eval(family_range(from_term([{{a},[{c,{1,[]}}]}])),
 2013:               from_term([{{a},[{1,[]}]}])),
 2014:    ?line eval(family_range(from_term([{{a},[]}])),
 2015:	       from_term([{{a},[]}])),
 2016:    ?line eval(family_range(from_term([], type(FR))), 
 2017:               from_term([], [{atom,[atom]}])),
 2018:    ?line {'EXIT', {badarg, _}} = (catch family_range(set([a]))),
 2019:    ?line {'EXIT', {badarg, _}} = (catch family_range(set([{a,[b]}]))),
<a name="2020"></a> 2020:    ok.
 2021:
<a name=family_to_relation_1> 2022:<b>family_to_relation_1</b></a>(suite) -&gt; [];
<a name=family_to_relation_1> 2023:<b>family_to_relation_1</b></a>(doc) -&gt; [""];
<a name=family_to_relation_1> 2024:<b>family_to_relation_1</b></a>(Conf) when list(Conf) -&gt;
 2025:    ?line E = empty_set(),
 2026:    ?line ER = relation([]),
 2027:    ?line EF = family([]),
 2028:    ?line eval(family_to_relation(E), E),
 2029:    ?line eval(family_to_relation(EF), ER),
<a name="2030"></a> 2030:    ?line eval(sofs:fam2rel(EF), ER),
 2031:    ?line F = family([{a,[]},{b,[1]},{c,[7,9,11]}]),
 2032:    ?line eval(family_to_relation(F), relation([{b,1},{c,7},{c,9},{c,11}])),
 2033:    ?line {'EXIT', {badarg, _}} = (catch family_to_relation(set([a]))),
 2034:    ok.
 2035:
<a name=union_of_family_1> 2036:<b>union_of_family_1</b></a>(suite) -&gt; [];
<a name=union_of_family_1> 2037:<b>union_of_family_1</b></a>(doc) -&gt; [""];
<a name=union_of_family_1> 2038:<b>union_of_family_1</b></a>(Conf) when list(Conf) -&gt;
 2039:    ?line E = empty_set(),
<a name="2040"></a> 2040:    ?line EF = from_term([{a,[]},{b,[]}],[{atom,[atom]}]),
 2041:    ?line eval(union_of_family(E), E),
 2042:    ?line eval(union_of_family(EF), set([])),
 2043:    ?line eval(union_of_family(family([])), set([])),
 2044:    ?line FR = from_term([{a,[1,2,3]},{b,[]},{c,[4,5]}]),
 2045:    ?line eval(union_of_family(FR), set([1,2,3,4,5])),
 2046:    ?line eval(union_of_family(sofs:family([{a,[1,2]},{b,[1,2]}])),
 2047:	       set([1,2])),
 2048:    ?line {'EXIT', {badarg, _}} = (catch union_of_family(set([a]))),
 2049:    ok.
<a name="2050"></a> 2050:
<a name=intersection_of_family_1> 2051:<b>intersection_of_family_1</b></a>(suite) -&gt; [];
<a name=intersection_of_family_1> 2052:<b>intersection_of_family_1</b></a>(doc) -&gt; [""];
<a name=intersection_of_family_1> 2053:<b>intersection_of_family_1</b></a>(Conf) when list(Conf) -&gt;
 2054:    ?line EF = from_term([{a,[]},{b,[]}],[{atom,[atom]}]),
 2055:    ?line eval(intersection_of_family(EF), set([])),
 2056:    ?line FR = from_term([{a,[1,2,3]},{b,[2,3]},{c,[3,4,5]}]),
 2057:    ?line eval(intersection_of_family(FR), set([3])),
 2058:    ?line {'EXIT', {badarg, _}} = 
 2059:        (catch intersection_of_family(family([]))),
<a name="2060"></a> 2060:    ?line EE = from_term([], [[atom]]),
 2061:    ?line {'EXIT', {badarg, _}} = (catch intersection_of_family(EE)),
 2062:    ?line {'EXIT', {badarg, _}} = (catch intersection_of_family(set([a]))),
 2063:    ok.
 2064:
<a name=family_projection> 2065:<b>family_projection</b></a>(suite) -&gt; [];
<a name=family_projection> 2066:<b>family_projection</b></a>(doc) -&gt; [""];
<a name=family_projection> 2067:<b>family_projection</b></a>(Conf) when list(Conf) -&gt;
 2068:    SSType = [{atom,[[atom]]}],
 2069:    SRType = [{atom,[{atom,atom}]}],
<a name="2070"></a> 2070:    ?line E = empty_set(),
 2071:
 2072:    ?line eval(family_projection(fun(X) -&gt; X end, family([])), E),
 2073:    ?line L1 = [{a,[]}],
 2074:    ?line eval(family_projection({sofs,union}, E), E),
 2075:    ?line eval(family_projection({sofs,union}, from_term(L1, SSType)),
 2076:               family(L1)),
 2077:    ?line {'EXIT', {badarg, _}} =    
 2078: 	(catch family_projection({sofs,union}, set([]))),
 2079:    ?line {'EXIT', {badarg, _}} =
<a name="2080"></a> 2080:        (catch family_projection({sofs,union}, from_term([{1,[1]}]))),
 2081:
 2082:    ?line F2 = from_term([{a,[[1],[2]]},{b,[[3,4],[5]]}], SSType),
 2083:    ?line eval(family_projection({sofs,union}, F2),
 2084:               family_union(F2)),
 2085:
 2086:    ?line F3 = from_term([{1,[{a,b},{b,c},{c,d}]},{3,[]},{5,[{3,5}]}],
 2087:                         SRType),
 2088:    ?line eval(family_projection({sofs,domain}, F3), family_domain(F3)),
 2089:    ?line eval(family_projection({sofs,range}, F3), family_range(F3)),
<a name="2090"></a> 2090:
 2091:    ?line eval(family_projection(fun(_) -&gt; E end, family([{a,[b,c]}])),
 2092:	       from_term([{a,[]}])),
 2093:
 2094:    Fun1 = fun(S) -&gt;
 2095:                   case to_external(S) of
 2096:                       [1] -&gt; from_term({1,1});
 2097:                       _ -&gt; S
 2098:                   end
 2099:           end,
<a name="2100"></a> 2100:    ?line eval(family_projection(Fun1, family([{a,[1]}])), 
 2101:	       from_term([{a,{1,1}}])),
 2102:    Fun2 = fun(_) -&gt; throw(fippla) end, 
 2103:    ?line fippla = 
 2104:        (catch family_projection(Fun2, family([{a,[1]}]))),
 2105:    ?line {'EXIT', {type_mismatch, _}} =
 2106:        (catch family_projection(Fun1, from_term([{1,[1]},{2,[2]}]))),
 2107:    ?line {'EXIT', {type_mismatch, _}} =
 2108:        (catch family_projection(Fun1, from_term([{1,[1]},{0,[0]}]))),
 2109:
<a name="2110"></a> 2110:    ?line eval(family_projection(fun(_) -&gt; E end, from_term([{a,[]}])),
 2111:	       from_term([{a,[]}])),
 2112:    F4 = from_term([{a,[{1,2,3}]},{b,[{4,5,6}]},{c,[]},{m3,[]}]),
 2113:    Z = from_term(0),
 2114:    ?line eval(family_projection(fun(S) -&gt; local_adjoin(S, Z) end, F4),
 2115:	      from_term([{a,[{{1,2,3},0}]},{b,[{{4,5,6},0}]},{c,[]},{m3,[]}])),
 2116:    ?line {'EXIT', {badarg, _}} =
 2117:        (catch family_projection({external, fun(X) -&gt; X end}, 
 2118:				 from_term([{1,[1]}]))),
 2119:
<a name="2120"></a> 2120:    %% ordered set element
 2121:    ?line eval(family_projection(fun(_) -&gt; from_term(a, atom) end, 
 2122:				 from_term([{1,[a]}])),
 2123:	       from_term([{1,a}])),
 2124:    ok.
 2125:
<a name=family_difference> 2126:<b>family_difference</b></a>(suite) -&gt; [];
<a name=family_difference> 2127:<b>family_difference</b></a>(doc) -&gt; [""];
<a name=family_difference> 2128:<b>family_difference</b></a>(Conf) when list(Conf) -&gt;
 2129:    ?line E = empty_set(),
<a name="2130"></a> 2130:    ?line EF = family([]),
 2131:    ?line F9 = from_term([{b,[b,c]}]),
 2132:    ?line F10 = from_term([{a,[b,c]}]),
 2133:    ?line eval(family_difference(E, E), E),
 2134:    ?line eval(family_difference(E, F10), from_term([], type(F10))),
 2135:    ?line eval(family_difference(F10, E), F10),
 2136:    ?line eval(family_difference(F9, F10), F9),
 2137:    ?line eval(family_difference(F10, F10), family([{a,[]}])),
 2138:    ?line F20 = from_term([{a,[1,2,3]},{b,[1,2,3]},{c,[1,2,3]}]),
 2139:    ?line F21 = from_term([{b,[1,2,3]},{c,[1,2,3]}]),
<a name="2140"></a> 2140:    ?line eval(family_difference(F20, from_term([{a,[2]}])),
 2141:               from_term([{a,[1,3]},{b,[1,2,3]},{c,[1,2,3]}])),
 2142:    ?line eval(family_difference(F20, from_term([{0,[2]},{q,[1,2]}])), F20),
 2143:    ?line eval(family_difference(F20, F21),
 2144:               from_term([{a,[1,2,3]},{b,[]},{c,[]}])),
 2145:
 2146:    ?line eval(family_difference(from_term([{e,[f,g]}]), family([])),
 2147:               from_term([{e,[f,g]}])),
 2148:    ?line eval(family_difference(from_term([{e,[f,g]}]), EF),
 2149:               from_term([{e,[f,g]}])),
<a name="2150"></a> 2150:    ?line eval(family_difference(from_term([{a,[a,b,c,d]},{c,[b,c]}]),
 2151:                                 from_term([{a,[b,c]},{b,[d]},{d,[e,f]}])),
 2152:               from_term([{a,[a,d]},{c,[b,c]}])),
 2153:    ?line {'EXIT', {badarg, _}} = 
 2154:	(catch family_difference(set([]), set([]))),
 2155:    ?line {'EXIT', {type_mismatch, _}} =    
 2156:	(catch family_difference(from_term([{a,[b,c]}]),
 2157:                                 from_term([{e,[{f}]}]))),
 2158:    ?line {'EXIT', {type_mismatch, _}} =    
 2159:	(catch family_difference(from_term([{a,[b]}]),
<a name="2160"></a> 2160:                                 from_term([{c,[d]}], [{i,[s]}]))),
 2161:    ok.
 2162:
<a name=family_intersection_1> 2163:<b>family_intersection_1</b></a>(suite) -&gt; [];
<a name=family_intersection_1> 2164:<b>family_intersection_1</b></a>(doc) -&gt; [""];
<a name=family_intersection_1> 2165:<b>family_intersection_1</b></a>(Conf) when list(Conf) -&gt;
 2166:    ?line E = empty_set(),
 2167:    ?line EF = family([]),
 2168:    ?line ES = from_term([], [{atom,[[atom]]}]),
 2169:    ?line eval(family_intersection(E), E),
<a name="2170"></a> 2170:    ?line {'EXIT', {badarg, _}} = (catch family_intersection(EF)),
 2171:    ?line eval(family_intersection(ES), EF),
 2172:    ?line {'EXIT', {badarg, _}} = (catch family_intersection(set([]))),
 2173:    ?line {'EXIT', {badarg, _}} = 
 2174:        (catch family_intersection(from_term([{a,[1,2]}]))),
 2175:    ?line F1 = from_term([{a,[[1],[2],[2,3]]},{b,[]},{c,[[4]]}]),
 2176:    ?line {'EXIT', {badarg, _}} = (catch family_intersection(F1)),
 2177:    ?line F2 = from_term([{b,[[1],[2],[2,3]]},{a,[]},{c,[[4]]}]),
 2178:    ?line {'EXIT', {badarg, _}} = (catch family_intersection(F2)),
 2179:    ?line F3 = from_term([{a,[[1,2,3],[2],[2,3]]},{c,[[4,5,6],[5,6,7]]}]),
<a name="2180"></a> 2180:    ?line eval(family_intersection(F3), family([{a,[2]},{c,[5,6]}])),
 2181:    ok.
 2182:
<a name=family_intersection_2> 2183:<b>family_intersection_2</b></a>(suite) -&gt; [];
<a name=family_intersection_2> 2184:<b>family_intersection_2</b></a>(doc) -&gt; [""];
<a name=family_intersection_2> 2185:<b>family_intersection_2</b></a>(Conf) when list(Conf) -&gt;
 2186:    ?line E = empty_set(),
 2187:    ?line EF = family([]),
 2188:    ?line F1 = from_term([{a,[1,2]},{b,[4,5]},{c,[7,8]},{d,[10,11]}]),
 2189:    ?line F2 = from_term([{c,[6,7]},{d,[9,10,11]},{q,[1]}]),
<a name="2190"></a> 2190:    ?line F3 = from_term([{a,[1,2]},{b,[4,5]},{c,[6,7,8]},{d,[9,10,11]},
 2191:                          {q,[1]}]),
 2192:
 2193:    ?line eval(family_intersection(E, E), E),
 2194:    ?line eval(family_intersection(EF, EF), EF),
 2195:    ?line eval(family_intersection(F1, F2), 
 2196:               from_term([{c,[7]},{d,[10,11]}])),
 2197:    ?line eval(family_intersection(F1, F3), F1),
 2198:    ?line eval(family_intersection(F2, F3), F2),
 2199:
<a name="2200"></a> 2200:    ?line eval(family_intersection(EF, from_term([{e,[f,g]}])), EF),
 2201:    ?line eval(family_intersection(E, from_term([{e,[f,g]}])), EF),
 2202:    ?line eval(family_intersection(from_term([{e,[f,g]}]), EF), EF),
 2203:    ?line eval(family_intersection(from_term([{e,[f,g]}]), E), EF),
 2204:    ?line {'EXIT', {type_mismatch, _}} =    
 2205:	(catch family_intersection(from_term([{a,[b,c]}]),
 2206:                                   from_term([{e,[{f}]}]))),
 2207:
 2208:    ?line F11 = family([{a,[1,2,3]},{b,[0,2,4]},{c,[0,3,6,9]}]),
 2209:    ?line eval(union_of_family(F11), set([0,1,2,3,4,6,9])),
<a name="2210"></a> 2210:    ?line F12 = from_term([{a,[1,2,3,4]},{b,[0,2,4]},{c,[2,3,4,5]}]),
 2211:    ?line eval(intersection_of_family(F12), set([2,4])),
 2212:    ok.
 2213:
<a name=family_union_1> 2214:<b>family_union_1</b></a>(suite) -&gt; [];
<a name=family_union_1> 2215:<b>family_union_1</b></a>(doc) -&gt; [""];
<a name=family_union_1> 2216:<b>family_union_1</b></a>(Conf) when list(Conf) -&gt;
 2217:    ?line E = empty_set(),
 2218:    ?line EF = family([]),
 2219:    ?line ES = from_term([], [{atom,[[atom]]}]),
<a name="2220"></a> 2220:    ?line eval(family_union(E), E),
 2221:    ?line eval(family_union(ES), EF),
 2222:    ?line {'EXIT', {badarg, _}} = (catch family_union(set([]))),
 2223:    ?line {'EXIT', {badarg, _}} = 
 2224:        (catch family_union(from_term([{a,[1,2]}]))),
 2225:    ?line eval(family_union(from_term([{a,[[1],[2],[2,3]]},{b,[]},{c,[[4]]}])),
 2226:               family([{a,[1,2,3]},{b,[]},{c,[4]}])),
 2227:    ok.
 2228:
<a name=family_union_2> 2229:<b>family_union_2</b></a>(suite) -&gt; [];
<a name=family_union_2><a name="2230"></a> 2230:<b>family_union_2</b></a>(doc) -&gt; [""];
<a name=family_union_2> 2231:<b>family_union_2</b></a>(Conf) when list(Conf) -&gt;
 2232:    ?line E = empty_set(),
 2233:    ?line EF = family([]),
 2234:    ?line F1 = from_term([{a,[1,2]},{b,[4,5]},{c,[7,8]},{d,[10,11]}]),
 2235:    ?line F2 = from_term([{c,[6,7]},{d,[9,10,11]},{q,[1]}]),
 2236:    ?line F3 = from_term([{a,[1,2]},{b,[4,5]},{c,[6,7,8]},{d,[9,10,11]},
 2237:                          {q,[1]}]),
 2238:
 2239:    ?line eval(family_union(E, E), E),
<a name="2240"></a> 2240:    ?line eval(family_union(F1, E), F1),
 2241:    ?line eval(family_union(E, F2), F2),
 2242:    ?line eval(family_union(F1, F2), F3),
 2243:    ?line eval(family_union(F2, F1), F3),
 2244:
 2245:    ?line eval(family_union(E, from_term([{e,[f,g]}])),
 2246:               from_term([{e,[f,g]}])),
 2247:    ?line eval(family_union(EF, from_term([{e,[f,g]}])),
 2248:               from_term([{e,[f,g]}])),
 2249:    ?line eval(family_union(from_term([{e,[f,g]}]), E), 
<a name="2250"></a> 2250:               from_term([{e,[f,g]}])),
 2251:    ?line {'EXIT', {badarg, _}} = 
 2252:	(catch family_union(set([]),set([]))),
 2253:    ?line {'EXIT', {type_mismatch, _}} =    
 2254:	(catch family_union(from_term([{a,[b,c]}]), 
 2255:                            from_term([{e,[{f}]}]))),
 2256:    ok.
 2257:
<a name=partition_family> 2258:<b>partition_family</b></a>(suite) -&gt; [];
<a name=partition_family> 2259:<b>partition_family</b></a>(doc) -&gt; [""];
<a name=partition_family><a name="2260"></a> 2260:<b>partition_family</b></a>(Conf) when list(Conf) -&gt;
 2261:    ?line E = empty_set(),
 2262:
 2263:    %% set of ordered sets
 2264:    ?line ER = relation([]),
 2265:    ?line EF = from_term([], [{atom,[{atom,atom}]}]),
 2266:
 2267:    ?line eval(partition_family(1, E), E),
 2268:    ?line eval(partition_family(2, E), E),
 2269:    ?line eval(partition_family({sofs,union}, E), E),
<a name="2270"></a> 2270:    ?line eval(partition_family(1, ER), EF),
 2271:    ?line eval(partition_family(2, ER), EF),
 2272:    ?line {'EXIT', {badarg, _}} = (catch partition_family(1, set([]))),
 2273:    ?line {'EXIT', {badarg, _}} = (catch partition_family(2, set([]))),
 2274:    ?line {'EXIT', {function_clause, _}} =
 2275:	(catch partition_family(fun({_A,B}) -&gt; {B} end, from_term([{1}]))),
 2276:    ?line eval(partition_family(1, relation([{1,a},{1,b},{2,c},{2,d}])), 
 2277:	       from_term([{1,[{1,a},{1,b}]},{2,[{2,c},{2,d}]}])),
 2278:    ?line eval(partition_family(1, relation([{1,a},{2,b}])),
 2279:	       from_term([{1,[{1,a}]},{2,[{2,b}]}])),
<a name="2280"></a> 2280:    ?line eval(partition_family(2, relation([{1,a},{1,b},{2,a},{2,b},{3,c}])), 
 2281:	       from_term([{a,[{1,a},{2,a}]},{b,[{1,b},{2,b}]},{c,[{3,c}]}])),
 2282:    ?line eval(partition_family(2, relation([{1,a}])), 
 2283:	       from_term([{a,[{1,a}]}])),
 2284:    ?line eval(partition_family(2, relation([{1,a},{2,a},{3,a}])), 
 2285:	       from_term([{a,[{1,a},{2,a},{3,a}]}])),
 2286:    ?line eval(partition_family(2, relation([{1,a},{2,b}])),
 2287:	       from_term([{a,[{1,a}]},{b,[{2,b}]}])),
 2288:    ?line F13 = from_term([{a,b,c},{a,b,d},{b,b,c},{a,c,c},{a,c,d},{b,c,c}]),
 2289:    ?line eval(partition_family(2, F13),
<a name="2290"></a> 2290:               from_term([{b,[{a,b,c},{a,b,d},{b,b,c}]},
 2291:                          {c,[{a,c,c},{a,c,d},{b,c,c}]}])),
 2292:
 2293:    Fun1 = {external, fun({A,_B}) -&gt; {A} end}, 
 2294:    ?line eval(partition_family(Fun1, relation([{a,1},{a,2},{b,3}])),
 2295:	       from_term([{{a},[{a,1},{a,2}]},{{b},[{b,3}]}])),
 2296:    Fun2 = fun(S) -&gt; {A,_B} = to_external(S), from_term({A}) end,
 2297:    ?line eval(partition_family(Fun2, relation([{a,1},{a,2},{b,3}])),
 2298:	       from_term([{{a},[{a,1},{a,2}]},{{b},[{b,3}]}])),
 2299:
<a name="2300"></a> 2300:    ?line {'EXIT', {badarg, _}} = 
 2301:	(catch partition_family({external, fun({A,_}) -&gt; {A,0} end}, 
 2302:				from_term([{1,a}]))),
 2303:    ?line [{{atom,atom},[{atom,atom,atom,atom}]}] = 
 2304:	type(partition_family({external, fun({A,_B,C,_D}) -&gt; {C,A} end}, 
 2305:			      relation([],4))),
 2306:
 2307:    Fun3 = fun(S) -&gt; from_term({to_external(S),0}, {type(S),atom}) end,
 2308:    ?line eval(partition_family(Fun3, E), E),
 2309:    ?line eval(partition_family(Fun3, set([a,b])),
<a name="2310"></a> 2310:	       from_term([{{a,0},[a]}, {{b,0},[b]}])),
 2311:    ?line eval(partition_family(Fun3, relation([{a,1},{b,2}])),
 2312:	       from_term([{{{a,1},0},[{a,1}]},{{{b,2},0},[{b,2}]}])),
 2313:    ?line eval(partition_family(Fun3, from_term([[a],[b]])),
 2314:	       from_term([{{[a],0},[[a]]}, {{[b],0},[[b]]}])),
 2315:    ?line partition_family({external, fun(X) -&gt; X end}, E),
 2316:
 2317:    F = 0.0, I = round(F),
 2318:    ?line FR = relation([{I,a},{F,b}]),
 2319:    if
<a name="2320"></a> 2320:        F == I -&gt; % term ordering
 2321:            ?line true = (1 =:= no_elements(partition_family(1, FR)));
 2322:        true -&gt; 
 2323:            ?line eval(partition_family(1, FR), 
 2324:                       from_term([{I,[{I,a}]},{F,[{F,b}]}]))
 2325:    end,
 2326:    %% set of sets
 2327:    ?line {'EXIT', {badarg, _}} = 
 2328:        (catch partition_family({external, fun(X) -&gt; X end}, 
 2329:				from_term([], [[atom]]))),
<a name="2330"></a> 2330:    ?line {'EXIT', {badarg, _}} = 
 2331:        (catch partition_family({external, fun(X) -&gt; X end}, 
 2332:				from_term([[a]]))),
 2333:    ?line eval(partition_family({sofs,union}, 
 2334:				from_term([[[1],[1,2]], [[1,2]]])),
 2335:	       from_term([{[1,2], [[[1],[1,2]],[[1,2]]]}])),
 2336:    ?line eval(partition_family(fun(X) -&gt; X end, 
 2337:				from_term([[1],[1,2],[1,2,3]])),
 2338:	       from_term([{[1],[[1]]},{[1,2],[[1,2]]},{[1,2,3],[[1,2,3]]}])),
 2339:
<a name="2340"></a> 2340:    ?line eval(partition_family(fun(_) -&gt; from_term([a]) end, 
 2341:                                from_term([], [[atom]])),
 2342:	       E),
 2343:    Fun10 = fun(S) -&gt;
 2344:                   %% Cheating a lot...
 2345:                   case to_external(S) of
 2346:                       [1] -&gt; from_term({1,1});
 2347:                       _ -&gt; S
 2348:                   end
 2349:           end,
<a name="2350"></a> 2350:
 2351:    ?line eval(partition_family(Fun10, from_term([[1]])),
 2352:	       from_term([{{1,1},[[1]]}])),
 2353:    ?line eval(partition_family(fun(_) -&gt; from_term({a}) end, 
 2354:                                from_term([[a]])),
 2355:	       from_term([{{a},[[a]]}])),
 2356:    ?line {'EXIT', {badarg, _}} = 
 2357:         (catch partition_family(fun(_) -&gt; {a} end, from_term([[a]]))),
 2358:    ok.
 2359:
<a name="2360"></a> 2360:<i>%% Not meant to be efficient...</i>
<a name=local_adjoin> 2361:<b>local_adjoin</b></a>(S, C) -&gt;
 2362:    X = to_external(C),
 2363:    T = type(C),
 2364:    F = fun(Y) -&gt; from_term({to_external(Y),X}, {type(Y),T}) end,
 2365:    projection(F, S).
 2366:
<a name=eval> 2367:<b>eval</b></a>(R, E) when R == E -&gt;
 2368:    R;
<a name=eval> 2369:<b>eval</b></a>(R, E) -&gt;
<a name="2370"></a> 2370:    io:format("expected ~p~n got ~p~n", [E, R]),
 2371:    exit({R,E}).
 2372:
</pre>
<hr size=1><i>The transformation of this file (2373 lines) took 0.10 seconds</i><br>
</body>
</html>
