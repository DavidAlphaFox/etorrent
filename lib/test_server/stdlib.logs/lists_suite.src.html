<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/lists_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:<i>%%%----------------------------------------------------------------</i>
   19:<i>%%% Purpose:Test Suite for the 'lists' module.</i>
<a name="20"></a>   20:<i>%%%-----------------------------------------------------------------</i>
   21:-<b>module</b>(lists_SUITE).
   22:-<b>include</b>("test_server.hrl").
   23:
   24:
   25:<i>% Default timetrap timeout (set in init_per_testcase).</i>
   26:<i>% This should be set relatively high (10-15 times the expected</i>
   27:<i>% max testcasetime).</i>
   28:-<b>define</b>(default_timeout, ?t:seconds(60)).
   29:
<a name="30"></a>   30:<i>% Test server specific exports</i>
   31:-<b>export</b>([all/1]).
   32:-<b>export</b>([init_per_testcase/2, fin_per_testcase/2]).
   33:
   34:<i>% Test cases must be exported.</i>
   35:-<b>export</b>([member/1, reverse/1,
   36:	 keymember/1, keysearch/1,
   37:	 append/1, append_1/1, append_2/1,
   38:	 seq/1, seq_loop/1, seq_2/1, seq_3/1, seq_2_e/1, seq_3_e/1,
   39:	 sublist/1, flatten/1,
<a name="40"></a>   40:	 sublist_2/1, sublist_3/1, sublist_2_e/1, sublist_3_e/1,
   41:	 flatten_1/1, flatten_2/1, flatten_1_e/1, flatten_2_e/1,
   42:	 sort/1, sort_1/1, sort_stable/1, merge/1, rmerge/1, sort_rand/1,
   43:         usort/1, usort_1/1, usort_stable/1, umerge/1, rumerge/1,usort_rand/1,
   44:	 keymerge/1, rkeymerge/1,
   45:	 keysort/1, keysort_1/1, keysort_i/1, keysort_stable/1,
   46:	 keysort_rand/1, keysort_error/1,
   47:	 ukeymerge/1, rukeymerge/1,
   48:	 ukeysort/1, ukeysort_1/1, ukeysort_i/1, ukeysort_stable/1,
   49:	 ukeysort_rand/1, ukeysort_error/1,
<a name="50"></a>   50:	 funmerge/1, rfunmerge/1,
   51:	 funsort/1, funsort_1/1, funsort_stable/1, funsort_rand/1,
   52:	 funsort_error/1,
   53:	 ufunmerge/1, rufunmerge/1,
   54:	 ufunsort/1, ufunsort_1/1, ufunsort_stable/1, ufunsort_rand/1,
   55:	 ufunsort_error/1]).
   56:
   57:<i>%% Sort randomized lists until stopped.</i>
   58:<i>%%</i>
   59:<i>%% If you update some of the sort or merge functions, you should</i>
<a name="60"></a>   60:<i>%% definitely let sort_loop work for a couple of hours or days. Try</i>
   61:<i>%% both sort_loop/0 and sort_loop/1 with a small argument (30-50 say).</i>
   62:
   63:-<b>export</b>([sort_loop/0, sort_loop/1, sloop/1]).
   64:
   65:<i>%% Internal export.</i>
   66:-<b>export</b>([make_fun/1]).
   67:
   68:<i>%%</i>
   69:<i>%% all/1</i>
<a name="70"></a>   70:<i>%%</i>
<a name=all>   71:<b>all</b></a>(doc) -&gt;
   72:    [];
<a name=all>   73:<b>all</b></a>(suite) -&gt;
   74:    [append, reverse, member, keymember, keysearch,
   75:     sort, usort, keysort, ukeysort, 
   76:     funsort, ufunsort, sublist, flatten, seq].
   77:
<a name=init_per_testcase>   78:<b>init_per_testcase</b></a>(Case, Config) -&gt;
   79:    ?line Dog=test_server:timetrap(?default_timeout),
<a name="80"></a>   80:    [{watchdog, Dog}|Config].
   81:
<a name=fin_per_testcase>   82:<b>fin_per_testcase</b></a>(Case, Config) -&gt;
   83:    Dog=?config(watchdog, Config),
   84:    test_server:timetrap_cancel(Dog),
   85:    ok.
   86:
   87:<i>%</i>
   88:<i>% Test cases starts here.</i>
   89:<i>%</i>
<a name=append><a name="90"></a>   90:<b>append</b></a>(doc) -&gt;
   91:    ["Tests lists:append/1 &amp; lists:append/2"];
<a name=append>   92:<b>append</b></a>(suite) -&gt;
   93:    [append_1, append_2].
   94:
<a name=append_1>   95:<b>append_1</b></a>(doc) -&gt;   [];
<a name=append_1>   96:<b>append_1</b></a>(suite) -&gt; [];
<a name=append_1>   97:<b>append_1</b></a>(Config) when list(Config) -&gt;
   98:    ?line "abcdef"=lists:append(["abc","def"]),
   99:    ?line [hej, du,[glade, [bagare]]]=
<a name="100"></a>  100:	lists:append([[hej], [du], [[glade, [bagare]]]]),
  101:    ?line [10, [elem]]=lists:append([[10], [[elem]]]),
  102:    ok.
  103:
<a name=append_2>  104:<b>append_2</b></a>(doc) -&gt;   [];
<a name=append_2>  105:<b>append_2</b></a>(suite) -&gt; [];
<a name=append_2>  106:<b>append_2</b></a>(Config) when list(Config) -&gt;
  107:    ?line "abcdef"=lists:append("abc", "def"),
  108:    ?line [hej, du]=lists:append([hej], [du]),
  109:    ?line [10, [elem]]=lists:append([10], [[elem]]),
<a name="110"></a>  110:    ok.
  111:
<a name=reverse>  112:<b>reverse</b></a>(suite) -&gt;
  113:    [];
<a name=reverse>  114:<b>reverse</b></a>(doc) -&gt;
  115:    ["Tests the lists:reverse() implementation. The function is "
  116:     "`non-blocking', and only processes a fixed number of elements "
  117:     "at a time."];
<a name=reverse>  118:<b>reverse</b></a>(Config) when list(Config) -&gt;
  119:    ?line reverse_test(0),
<a name="120"></a>  120:    ?line reverse_test(1),
  121:    ?line reverse_test(2),
  122:    ?line reverse_test(128),
  123:    ?line reverse_test(256),
  124:    ?line reverse_test(1000),
  125:    ?line reverse_test(1998),
  126:    ?line reverse_test(1999),
  127:    ?line reverse_test(2000),
  128:    ?line reverse_test(2001),
  129:    ?line reverse_test(3998),
<a name="130"></a>  130:    ?line reverse_test(3999),
  131:    ?line reverse_test(4000),
  132:    ?line reverse_test(4001),
  133:    ?line reverse_test(60001),
  134:    ?line reverse_test(100007),
  135:    ok.
  136:
<a name=reverse_test>  137:<b>reverse_test</b></a>(0) -&gt;
  138:    case lists:reverse([]) of
  139:	[] -&gt;
<a name="140"></a>  140:	    ok;
  141:	_Other -&gt;
  142:	    error
  143:    end;
<a name=reverse_test>  144:<b>reverse_test</b></a>(Num) -&gt;
  145:    List0 = ['The Element'|lists:duplicate(Num, 'Ele')],
  146:    List = lists:reverse(List0),
  147:    ['Ele'|_] = List,
  148:    'The Element' = lists:last(List),
  149:    List0 = lists:reverse(List),
<a name="150"></a>  150:    ok.
  151:
<a name=member>  152:<b>member</b></a>(doc) -&gt;
  153:    ["Tests the lists:member() implementation."
  154:     "This test case depends on lists:reverse() to work, "
  155:     "wich is tested in a separate test case."];
<a name=member>  156:<b>member</b></a>(Config) when list(Config) -&gt;
  157:    ?line {'EXIT',{badarg,_}} = (catch lists:member(45, {a,b,c})),
  158:    ?line false = lists:member(4233, []),
  159:    ?line member_test(1),
<a name="160"></a>  160:    ?line member_test(100),
  161:    ?line member_test(256),
  162:    ?line member_test(1000),
  163:    ?line member_test(1998),
  164:    ?line member_test(1999),
  165:    ?line member_test(2000),
  166:    ?line member_test(2001),
  167:    ?line member_test(3998),
  168:    ?line member_test(3999),
  169:    ?line member_test(4000),
<a name="170"></a>  170:    ?line member_test(4001),
  171:    ?line member_test(100008),
  172:    ok.
  173:
<a name=member_test>  174:<b>member_test</b></a>(Num) -&gt;
  175:    List0 = ['The Element'|lists:duplicate(Num, 'Elem')],
  176:    true = lists:member('The Element', List0),
  177:    true = lists:member('Elem', List0),
  178:    false = lists:member(arne_anka, List0),
  179:    false = lists:member({a,b,c}, List0),
<a name="180"></a>  180:    List = lists:reverse(List0),
  181:    true = lists:member('The Element', List),
  182:    true = lists:member('Elem', List),
  183:    false = lists:member(arne_anka, List),
  184:    false = lists:member({a,b,c}, List).
  185:
<a name=keymember>  186:<b>keymember</b></a>(Config) when is_list(Config) -&gt;
  187:    ?line false = lists:keymember(anything_goes, 1, []),
  188:    ?line {'EXIT',{badarg,_}} = (catch lists:keymember(anything_goes, -1, [])),
  189:    ?line {'EXIT',{badarg,_}} = (catch lists:keymember(anything_goes, 0, [])),
<a name="190"></a>  190:    ?line {'EXIT',{badarg,_}} = (catch lists:keymember(anything_goes, 1, {1,2,3})),
  191:    List = [{52.0,a},{-19,b,c},{37.5,d},an_atom,42.0,{39},{45,{x,y,z}}],
  192:
  193:    ?line false = lists:keymember(333, 5, List),
  194:    ?line false = lists:keymember(333, 999, List),
  195:    ?line false = lists:keymember(37, 1, List),
  196:
  197:    ?line true = lists:keymember(52.0, 1, List),
  198:    ?line true = lists:keymember(52, 1, List),
  199:    ?line true = lists:keymember(-19, 1, List),
<a name="200"></a>  200:    ?line true = lists:keymember(-19.0, 1, List),
  201:    ?line true = lists:keymember(37.5, 1, List),
  202:    ?line true = lists:keymember(39, 1, List),
  203:    ?line true = lists:keymember(39.0, 1, List),
  204:    ?line true = lists:keymember(45, 1, List),
  205:    ?line true = lists:keymember(45.0, 1, List),
  206:
  207:    ?line true = lists:keymember(a, 2, List),
  208:    ?line true = lists:keymember(b, 2, List),
  209:    ?line true = lists:keymember(c, 3, List),
<a name="210"></a>  210:    ?line true = lists:keymember(d, 2, List),
  211:    ?line true = lists:keymember({x,y,z}, 2, List),
  212:
  213:    ?line Long0 = lists:seq(1, 100007),
  214:    ?line false = lists:keymember(kalle, 1, Long0),
  215:    ?line Long = lists:foldl(fun(E, A) -&gt; [{1/E,E}|A] end, [], Long0),
  216:    ?line true = lists:keymember(1, 2, Long),
  217:    ?line true = lists:keymember(2, 2, Long),
  218:    ?line true = lists:keymember(1.0, 2, Long),
  219:    ?line true = lists:keymember(2.0, 2, Long),
<a name="220"></a>  220:    ?line true = lists:keymember(100006, 2, Long),
  221:    ok.
  222:
<a name=keysearch>  223:<b>keysearch</b></a>(Config) when is_list(Config) -&gt;
  224:    ?line false = lists:keysearch(anything_goes, 1, []),
  225:    ?line {'EXIT',{badarg,_}} = (catch lists:keysearch(anything_goes, -1, [])),
  226:    ?line {'EXIT',{badarg,_}} = (catch lists:keysearch(anything_goes, 0, [])),
  227:    ?line {'EXIT',{badarg,_}} = (catch lists:keysearch(anything_goes, 1, {1,2,3})),
  228:
  229:    First = {x,42.0},
<a name="230"></a>  230:    Second = {y,-77},
  231:    Third = {z,[a,b,c],{5.0}},
  232:    List = [First,Second,Third],
  233:    
  234:    ?line false = lists:keysearch(333, 1, []),
  235:    ?line false = lists:keysearch(333, 5, List),
  236:    ?line false = lists:keysearch(333, 999, List),
  237:    ?line false = lists:keysearch(37, 1, List),
  238:
  239:    ?line {value,First} = lists:keysearch(42, 2, List),
<a name="240"></a>  240:    ?line {value,First} = lists:keysearch(42.0, 2, List),
  241:
  242:    ?line {value,Second} = lists:keysearch(-77, 2, List),
  243:    ?line {value,Second} = lists:keysearch(-77.0, 2, List),
  244:
  245:    ?line {value,Third} = lists:keysearch(z, 1, List),
  246:    ?line {value,Third} = lists:keysearch([a,b,c], 2, List),
  247:    ?line {value,Third} = lists:keysearch({5}, 3, List),
  248:    ?line {value,Third} = lists:keysearch({5.0}, 3, List),
  249:
<a name="250"></a>  250:    ?line Long0 = lists:seq(1, 100007),
  251:    ?line false = lists:keysearch(kalle, 1, Long0),
  252:    ?line Long = lists:foldl(fun(E, A) -&gt; [{1/E,float(E)}|A] end, [], Long0),
  253:    ?line {value,{_,1.0}} = lists:keysearch(1, 2, Long),
  254:    ?line {value,{_,1.0}} = lists:keysearch(1.0, 2, Long),
  255:    ?line {value,{_,2.0}} = lists:keysearch(2, 2, Long),
  256:    ?line {value,{_,2.0}} = lists:keysearch(2.0, 2, Long),
  257:    ?line {value,{_,33988.0}} = lists:keysearch(33988, 2, Long),
  258:    ?line {value,{_,33988.0}} = lists:keysearch(33988.0, 2, Long),
  259:    ok.
<a name="260"></a>  260:
<a name=sort>  261:<b>sort</b></a>(doc) -&gt;
  262:    ["Tests merge functions and lists:sort/1"];
<a name=sort>  263:<b>sort</b></a>(suite) -&gt;
  264:    %% [merge, rmerge, sort_1, sort_rand, sort_stable].
  265:    [merge, rmerge, sort_1, sort_rand].
  266:
<a name=merge>  267:<b>merge</b></a>(doc) -&gt;   ["merge functions"];
<a name=merge>  268:<b>merge</b></a>(suite) -&gt; [];
<a name=merge>  269:<b>merge</b></a>(Config) when list(Config) -&gt;
<a name="270"></a>  270:
  271:    %% merge list of lists
  272:    ?line [] = lists:merge([]),
  273:    ?line [] = lists:merge([[]]),
  274:    ?line [] = lists:merge([[],[]]),
  275:    ?line [] = lists:merge([[],[],[]]),
  276:    ?line [1] = lists:merge([[1]]),
  277:    ?line [1,1,2,2] = lists:merge([[1,2],[1,2]]),
  278:    ?line [1] = lists:merge([[1],[],[]]),
  279:    ?line [1] = lists:merge([[],[1],[]]),
<a name="280"></a>  280:    ?line [1] = lists:merge([[],[],[1]]),
  281:    ?line [1,2] = lists:merge([[1],[2],[]]),
  282:    ?line [1,2] = lists:merge([[1],[],[2]]),
  283:    ?line [1,2] = lists:merge([[],[1],[2]]),
  284:    ?line [1,2,3,4,5,6] = lists:merge([[1,2],[],[5,6],[],[3,4],[]]),
  285:    ?line [1,2,3,4] = lists:merge([[4],[3],[2],[1]]),
  286:    ?line [1,2,3,4,5] = lists:merge([[1],[2],[3],[4],[5]]),
  287:    ?line [1,2,3,4,5,6] = lists:merge([[1],[2],[3],[4],[5],[6]]),
  288:    ?line [1,2,3,4,5,6,7,8,9] = 
  289:	lists:merge([[1],[2],[3],[4],[5],[6],[7],[8],[9]]),
<a name="290"></a>  290:    Seq = lists:seq(1,100),
  291:    ?line true = Seq == lists:merge(lists:map(fun(E) -&gt; [E] end, Seq)),
  292:
  293:    Two = [1,2],
  294:    Six = [1,2,3,4,5,6],
  295:
  296:    %% 2-way merge
  297:    ?line [] = lists:merge([], []),
  298:    ?line Two = lists:merge(Two, []),
  299:    ?line Two = lists:merge([], Two),
<a name="300"></a>  300:    ?line Six = lists:merge([1,3,5], [2,4,6]),
  301:    ?line Six = lists:merge([2,4,6], [1,3,5]),
  302:    ?line Six = lists:merge([1,2,3], [4,5,6]),
  303:    ?line Six = lists:merge([4,5,6], [1,2,3]),
  304:    ?line Six = lists:merge([1,2,5],[3,4,6]),
  305:    ?line [1,2,3,5,7] = lists:merge([1,3,5,7], [2]),
  306:    ?line [1,2,3,4,5,7] = lists:merge([1,3,5,7], [2,4]),
  307:    ?line [1,2,3,4,5,6,7] = lists:merge([1,3,5,7], [2,4,6]),
  308:    ?line [1,2,3,5,7] = lists:merge([2], [1,3,5,7]),
  309:    ?line [1,2,3,4,5,7] = lists:merge([2,4], [1,3,5,7]),
<a name="310"></a>  310:    ?line [1,2,3,4,5,6,7] = lists:merge([2,4,6], [1,3,5,7]),
  311:
  312:    %% 3-way merge
  313:    ?line [] = lists:merge3([], [], []),
  314:    ?line Two = lists:merge3([], [], Two),
  315:    ?line Two = lists:merge3([], Two, []),
  316:    ?line Two = lists:merge3(Two, [], []),
  317:    ?line Six = lists:merge3([], [1,3,5], [2,4,6]),
  318:    ?line Six = lists:merge3([1,3,5], [], [2,4,6]),
  319:    ?line Six = lists:merge3([1,3,5], [2,4,6], []),
<a name="320"></a>  320:    ?line Nine = lists:merge3([1,4,7],[2,5,8],[3,6,9]),
  321:    ?line Nine = lists:merge3([1,4,7],[3,6,9],[2,5,8]),
  322:    ?line Nine = lists:merge3([3,6,9],[1,4,7],[2,5,8]),
  323:    ?line Nine = lists:merge3([4,5,6],[1,2,3],[7,8,9]),
  324:    ?line Nine = lists:merge3([1,2,3],[4,5,6],[7,8,9]),
  325:    ?line Nine = lists:merge3([7,8,9],[4,5,6],[1,2,3]),
  326:    ?line Nine = lists:merge3([4,5,6],[7,8,9],[1,2,3]),
  327:
  328:    ok.
  329:
<a name=rmerge><a name="330"></a>  330:<b>rmerge</b></a>(doc) -&gt;   ["reverse merge functions"];
<a name=rmerge>  331:<b>rmerge</b></a>(suite) -&gt; [];
<a name=rmerge>  332:<b>rmerge</b></a>(Config) when list(Config) -&gt;
  333:
  334:    Two = [2,1],
  335:    Six = [6,5,4,3,2,1],
  336:
  337:    %% 2-way reversed merge
  338:    ?line [] = lists:rmerge([], []),
  339:    ?line Two = lists:rmerge(Two, []),
<a name="340"></a>  340:    ?line Two = lists:rmerge([], Two),
  341:    ?line Six = lists:rmerge([5,3,1], [6,4,2]),
  342:    ?line Six = lists:rmerge([6,4,2], [5,3,1]),
  343:    ?line Six = lists:rmerge([3,2,1], [6,5,4]),
  344:    ?line Six = lists:rmerge([6,5,4], [3,2,1]),
  345:    ?line Six = lists:rmerge([4,3,2],[6,5,1]),
  346:    ?line [7,6,5,3,1] = lists:rmerge([7,5,3,1], [6]),
  347:    ?line [7,6,5,4,3,1] = lists:rmerge([7,5,3,1], [6,4]),
  348:    ?line [7,6,5,4,3,2,1] = lists:rmerge([7,5,3,1], [6,4,2]),
  349:    ?line [7,5,3,2,1] = lists:rmerge([2], [7,5,3,1]),
<a name="350"></a>  350:    ?line [7,5,4,3,2,1] = lists:rmerge([4,2], [7,5,3,1]),
  351:    ?line [7,6,5,4,3,2,1] = lists:rmerge([6,4,2], [7,5,3,1]),
  352:
  353:    Nine = [9,8,7,6,5,4,3,2,1],
  354:
  355:    %% 3-way reversed merge
  356:    ?line [] = lists:rmerge3([], [], []),
  357:    ?line Two = lists:rmerge3([], [], Two),
  358:    ?line Two = lists:rmerge3([], Two, []),
  359:    ?line Two = lists:rmerge3(Two, [], []),
<a name="360"></a>  360:    ?line Six = lists:rmerge3([], [5,3,1], [6,4,2]),
  361:    ?line Six = lists:rmerge3([5,3,1], [], [6,4,2]),
  362:    ?line Six = lists:rmerge3([5,3,1], [6,4,2], []),
  363:    ?line Nine = lists:rmerge3([7,4,1],[8,5,2],[9,6,3]),
  364:    ?line Nine = lists:rmerge3([7,4,1],[9,6,3],[8,5,2]),
  365:    ?line Nine = lists:rmerge3([9,6,3],[7,4,1],[8,5,2]),
  366:    ?line Nine = lists:rmerge3([6,5,4],[3,2,1],[9,8,7]),
  367:    ?line Nine = lists:rmerge3([3,2,1],[6,5,4],[9,8,7]),
  368:    ?line Nine = lists:rmerge3([9,8,7],[6,5,4],[3,2,1]),
  369:    ?line Nine = lists:rmerge3([6,5,4],[9,8,7],[3,2,1]),
<a name="370"></a>  370:
  371:    ok.
  372:
<a name=sort_1>  373:<b>sort_1</b></a>(doc) -&gt;   ["sort/1"];
<a name=sort_1>  374:<b>sort_1</b></a>(suite) -&gt; [];
<a name=sort_1>  375:<b>sort_1</b></a>(Config) when list(Config) -&gt;
  376:    ?line [] = lists:sort([]),
  377:    ?line [a] = lists:sort([a]),
  378:    ?line [a,a] = lists:sort([a,a]),
  379:    ?line [a,b] = lists:sort([a,b]),
<a name="380"></a>  380:    ?line [a,b] = lists:sort([b,a]),
  381:    ?line [1,1] = lists:sort([1,1]),
  382:    ?line [1,1,2,3] = lists:sort([1,1,3,2]),
  383:    ?line [1,2,3,3] = lists:sort([3,3,1,2]),
  384:    ?line [1,1,1,1] = lists:sort([1,1,1,1]),
  385:    ?line [1,1,1,2,2,2,3,3,3] = lists:sort([3,3,3,2,2,2,1,1,1]),
  386:    ?line [1,1,1,2,2,2,3,3,3] = lists:sort([1,1,1,2,2,2,3,3,3]),
  387:
  388:    ?line lists:foreach(fun check/1, perms([1,2,3])),
  389:    ?line lists:foreach(fun check/1, perms([1,2,3,4,5,6,7,8])),
<a name="390"></a>  390:    ok.
  391:
<a name=sort_rand>  392:<b>sort_rand</b></a>(doc) -&gt;   ["sort/1 on big randomized lists"];
<a name=sort_rand>  393:<b>sort_rand</b></a>(suite) -&gt; [];
<a name=sort_rand>  394:<b>sort_rand</b></a>(Config) when list(Config) -&gt;
  395:    ?line ok = check(biglist(10)),
  396:    ?line ok = check(biglist(100)),
  397:    ?line ok = check(biglist(1000)),
  398:    ?line ok = check(biglist(10000)),
  399:    ok.
<a name="400"></a>  400:
  401:<i>%% sort/1 was really stable for a while - the order of equal elements</i>
  402:<i>%% was kept - but since the performance suffered a bit, this "feature"</i>
  403:<i>%% was removed.</i>
<a name=sort_stable>  404:<b>sort_stable</b></a>(doc) -&gt;   ["sort/1 should be stable for equal terms."];
<a name=sort_stable>  405:<b>sort_stable</b></a>(suite) -&gt; [];
<a name=sort_stable>  406:<b>sort_stable</b></a>(Config) when list(Config) -&gt;
  407:    ?line ok = check_stability(bigfunlist(10)),
  408:    ?line ok = check_stability(bigfunlist(100)),
  409:    ?line ok = check_stability(bigfunlist(1000)),
<a name="410"></a>  410:    ?line ok = check_stability(bigfunlist(10000)),
  411:    ok.
  412:
<a name=check>  413:<b>check</b></a>([]) -&gt;
  414:    ok;
<a name=check>  415:<b>check</b></a>(L) -&gt;
  416:    S = lists:sort(L),
  417:    case {length(L) == length(S), check(hd(S), tl(S))} of
  418:	{true,ok} -&gt;
  419:	    ok;
<a name="420"></a>  420:	_ -&gt;
  421:	    io:format("~w~n", [L]),
  422:	    erlang:fault(check)
  423:    end.
  424:
<a name=check>  425:<b>check</b></a>(_A, []) -&gt;
  426:    ok;
<a name=check>  427:<b>check</b></a>(A, [B | L]) when A =&lt; B -&gt;
  428:    check(B, L);
<a name=check>  429:<b>check</b></a>(_A, _L) -&gt;
<a name="430"></a>  430:    no.
  431:
  432:<i>%% The check that sort/1 is stable is no longer used.</i>
  433:<i>%% Equal elements are no longer always kept in order.</i>
<a name=check_stability>  434:<b>check_stability</b></a>(L) -&gt;
  435:    S = lists:sort(L),
  436:    LP = explicit_pid(L),
  437:    SP = explicit_pid(S),
  438:    check_sorted(1, 2, LP, SP).
  439:
<a name=explicit_pid><a name="440"></a>  440:<b>explicit_pid</b></a>(L) -&gt;
  441:    lists:reverse(expl_pid(L, [])).
  442:
<a name=expl_pid>  443:<b>expl_pid</b></a>([{I,F} | T], L) when is_function(F) -&gt;
  444:    expl_pid(T, [{I,fun_pid(F)} | L]);
<a name=expl_pid>  445:<b>expl_pid</b></a>([], L) -&gt;
  446:    L.
  447:
<a name=usort>  448:<b>usort</b></a>(doc) -&gt;
  449:    ["Tests unique merge functions and lists:usort/1"];
<a name=usort><a name="450"></a>  450:<b>usort</b></a>(suite) -&gt;
  451:    [umerge, rumerge, usort_1, usort_rand, usort_stable].
  452:
<a name=usort_1>  453:<b>usort_1</b></a>(suite) -&gt; [];
<a name=usort_1>  454:<b>usort_1</b></a>(doc) -&gt; [""];
<a name=usort_1>  455:<b>usort_1</b></a>(Conf) when list(Conf) -&gt;
  456:    ?line [] = lists:usort([]),
  457:    ?line [1] = lists:usort([1]), 
  458:    ?line [1] = lists:usort([1,1]),
  459:    ?line [1] = lists:usort([1,1,1,1,1]),
<a name="460"></a>  460:    ?line [1,2] = lists:usort([1,2]),
  461:    ?line [1,2] = lists:usort([1,2,1]),
  462:    ?line [1,2] = lists:usort([1,2,2]),
  463:    ?line [1,2,3] = lists:usort([1,3,2]),
  464:    ?line [1,3] = lists:usort([3,1,3]),
  465:    ?line [0,1,3] = lists:usort([3,1,0]),
  466:    ?line [1,2,3] = lists:usort([3,1,2]),
  467:    ?line [1,2] = lists:usort([2,1,1]),
  468:    ?line [1,2] = lists:usort([2,1]),
  469:    ?line [0,3,4,8,9] = lists:usort([3,8,9,0,9,4]),
<a name="470"></a>  470:
  471:    ?line lists:foreach(fun ucheck/1, perms([1,2,3])),
  472:    ?line lists:foreach(fun ucheck/1, perms([1,2,3,4,5,6,2,1])),
  473:
  474:    ok.
  475:
<a name=umerge>  476:<b>umerge</b></a>(suite) -&gt; [];
<a name=umerge>  477:<b>umerge</b></a>(doc) -&gt; [""];
<a name=umerge>  478:<b>umerge</b></a>(Conf) when list(Conf) -&gt;
  479:    %% merge list of lists
<a name="480"></a>  480:    ?line [] = lists:umerge([]),
  481:    ?line [] = lists:umerge([[]]),
  482:    ?line [] = lists:umerge([[],[]]),
  483:    ?line [] = lists:umerge([[],[],[]]),
  484:    ?line [1] = lists:umerge([[1]]),
  485:    ?line [1,2] = lists:umerge([[1,2],[1,2]]),
  486:    ?line [1] = lists:umerge([[1],[],[]]),
  487:    ?line [1] = lists:umerge([[],[1],[]]),
  488:    ?line [1] = lists:umerge([[],[],[1]]),
  489:    ?line [1,2] = lists:umerge([[1],[2],[]]),
<a name="490"></a>  490:    ?line [1,2] = lists:umerge([[1],[],[2]]),
  491:    ?line [1,2] = lists:umerge([[],[1],[2]]),
  492:    ?line [1,2,3,4,5,6] = lists:umerge([[1,2],[],[5,6],[],[3,4],[]]),
  493:    ?line [1,2,3,4] = lists:umerge([[4],[3],[2],[1]]),
  494:    ?line [1,2,3,4,5] = lists:umerge([[1],[2],[3],[4],[5]]),
  495:    ?line [1,2,3,4,5,6] = lists:umerge([[1],[2],[3],[4],[5],[6]]),
  496:    ?line [1,2,3,4,5,6,7,8,9] = 
  497:        lists:umerge([[1],[2],[3],[4],[5],[6],[7],[8],[9]]),
  498:    ?line [1,2,4,6,8] = lists:umerge([[1,2],[2,4,6,8]]),
  499:    Seq = lists:seq(1,100),
<a name="500"></a>  500:    ?line true = Seq == lists:umerge(lists:map(fun(E) -&gt; [E] end, Seq)),
  501:
  502:    Two = [1,2],
  503:    Six = [1,2,3,4,5,6],
  504:
  505:    %% 2-way unique merge
  506:    ?line [] = lists:umerge([], []),
  507:    ?line Two = lists:umerge(Two, []),
  508:    ?line Two = lists:umerge([], Two),
  509:    ?line Six = lists:umerge([1,3,5], [2,4,6]),
<a name="510"></a>  510:    ?line Six = lists:umerge([2,4,6], [1,3,5]),
  511:    ?line Six = lists:umerge([1,2,3], [4,5,6]),
  512:    ?line Six = lists:umerge([4,5,6], [1,2,3]),
  513:    ?line Six = lists:umerge([1,2,5],[3,4,6]),
  514:    ?line [1,2,3,5,7] = lists:umerge([1,3,5,7], [2]),
  515:    ?line [1,2,3,4,5,7] = lists:umerge([1,3,5,7], [2,4]),
  516:    ?line [1,2,3,4,5,6,7] = lists:umerge([1,3,5,7], [2,4,6]),
  517:    ?line [1,2,3,5,7] = lists:umerge([2], [1,3,5,7]),
  518:    ?line [1,2,3,4,5,7] = lists:umerge([2,4], [1,3,5,7]),
  519:    ?line [1,2,3,4,5,6,7] = lists:umerge([2,4,6], [1,3,5,7]),
<a name="520"></a>  520:
  521:    ?line [1,2,3,5,7] = lists:umerge([1,2,3,5,7], [2]),
  522:    ?line [1,2,3,4,5,7] = lists:umerge([1,2,3,4,5,7], [2,4]),
  523:    ?line [1,2,3,4,5,6,7] = lists:umerge([1,2,3,4,5,6,7], [2,4,6]),
  524:    ?line [1,2,3,5,7] = lists:umerge([2], [1,2,3,5,7]),
  525:    ?line [1,2,3,4,5,7] = lists:umerge([2,4], [1,2,3,4,5,7]),
  526:    ?line [1,2,3,4,5,6,7] = lists:umerge([2,4,6], [1,2,3,4,5,6,7]),
  527:
  528:    %% 3-way unique merge
  529:    ?line [] = lists:umerge3([], [], []),
<a name="530"></a>  530:    ?line Two = lists:umerge3([], [], Two),
  531:    ?line Two = lists:umerge3([], Two, []),
  532:    ?line Two = lists:umerge3(Two, [], []),
  533:    ?line Six = lists:umerge3([], [1,3,5], [2,4,6]),
  534:    ?line Six = lists:umerge3([1,3,5], [], [2,4,6]),
  535:    ?line Six = lists:umerge3([1,3,5], [2,4,6], []),
  536:    ?line Nine = lists:umerge3([1,4,7],[2,5,8],[3,6,9]),
  537:    ?line Nine = lists:umerge3([1,4,7],[3,6,9],[2,5,8]),
  538:    ?line Nine = lists:umerge3([3,6,9],[1,4,7],[2,5,8]),
  539:    ?line Nine = lists:umerge3([4,5,6],[1,2,3],[7,8,9]),
<a name="540"></a>  540:    ?line Nine = lists:umerge3([1,2,3],[4,5,6],[7,8,9]),
  541:    ?line Nine = lists:umerge3([7,8,9],[4,5,6],[1,2,3]),
  542:    ?line Nine = lists:umerge3([4,5,6],[7,8,9],[1,2,3]),
  543:
  544:    ?line [1,2,3] = lists:umerge3([1,2,3],[1,2,3],[1,2,3]),
  545:    ?line [1,2,3,4] = lists:umerge3([2,3,4],[1,2,3],[2,3,4]),
  546:    ?line [1,2,3] = lists:umerge3([1,2,3],[2,3],[1,2,3]),
  547:    ?line [1,2,3,4] = lists:umerge3([2,3,4],[3,4],[1,2,3]),
  548:
  549:    ok.
<a name="550"></a>  550:
<a name=rumerge>  551:<b>rumerge</b></a>(suite) -&gt; [];
<a name=rumerge>  552:<b>rumerge</b></a>(doc) -&gt; [""];
<a name=rumerge>  553:<b>rumerge</b></a>(Conf) when list(Conf) -&gt;
  554:    Two = [2,1],
  555:    Six = [6,5,4,3,2,1],
  556:
  557:    %% 2-way reversed unique merge
  558:    ?line [] = lists:rumerge([], []),
  559:    ?line Two = lists:rumerge(Two, []),
<a name="560"></a>  560:    ?line Two = lists:rumerge([], Two),
  561:    ?line Six = lists:rumerge([5,3,1], [6,4,2]),
  562:    ?line Six = lists:rumerge([6,4,2], [5,3,1]),
  563:    ?line Six = lists:rumerge([3,2,1], [6,5,4]),
  564:    ?line Six = lists:rumerge([6,5,4], [3,2,1]),
  565:    ?line Six = lists:rumerge([4,3,2],[6,5,1]),
  566:    ?line [7,6,5,3,1] = lists:rumerge([7,5,3,1], [6]),
  567:    ?line [7,6,5,4,3,1] = lists:rumerge([7,5,3,1], [6,4]),
  568:    ?line [7,6,5,4,3,2,1] = lists:rumerge([7,5,3,1], [6,4,2]),
  569:    ?line [7,5,3,2,1] = lists:rumerge([2], [7,5,3,1]),
<a name="570"></a>  570:    ?line [7,5,4,3,2,1] = lists:rumerge([4,2], [7,5,3,1]),
  571:    ?line [7,6,5,4,3,2,1] = lists:rumerge([6,4,2], [7,5,3,1]),
  572:
  573:    ?line [7,6,5,3,1] = lists:rumerge([7,6,5,3,1], [6]),
  574:    ?line [7,6,5,4,3,1] = lists:rumerge([7,6,5,4,3,1], [6,4]),
  575:    ?line [7,6,5,4,3,2,1] = lists:rumerge([7,6,5,4,3,2,1], [6,4,2]),
  576:    ?line [7,5,3,2,1] = lists:rumerge([2], [7,5,3,2,1]),
  577:    ?line [7,5,4,3,2,1] = lists:rumerge([4,2], [7,5,4,3,2,1]),
  578:    ?line [7,6,5,4,3,2,1] = lists:rumerge([6,4,2], [7,6,5,4,3,2,1]),
  579:
<a name="580"></a>  580:    Nine = [9,8,7,6,5,4,3,2,1],
  581:
  582:    %% 3-way reversed unique merge
  583:    ?line [] = lists:rumerge3([], [], []),
  584:    ?line Two = lists:rumerge3([], [], Two),
  585:    ?line Two = lists:rumerge3([], Two, []),
  586:    ?line Two = lists:rumerge3(Two, [], []),
  587:    ?line Six = lists:rumerge3([], [5,3,1], [6,4,2]),
  588:    ?line Six = lists:rumerge3([5,3,1], [], [6,4,2]),
  589:    ?line Six = lists:rumerge3([5,3,1], [6,4,2], []),
<a name="590"></a>  590:    ?line Nine = lists:rumerge3([7,4,1],[8,5,2],[9,6,3]),
  591:    ?line Nine = lists:rumerge3([7,4,1],[9,6,3],[8,5,2]),
  592:    ?line Nine = lists:rumerge3([9,6,3],[7,4,1],[8,5,2]),
  593:    ?line Nine = lists:rumerge3([6,5,4],[3,2,1],[9,8,7]),
  594:    ?line Nine = lists:rumerge3([3,2,1],[6,5,4],[9,8,7]),
  595:    ?line Nine = lists:rumerge3([9,8,7],[6,5,4],[3,2,1]),
  596:    ?line Nine = lists:rumerge3([6,5,4],[9,8,7],[3,2,1]),
  597:
  598:    ?line [3,2,1] = lists:rumerge3([3,2,1],[3,2,1],[3,2,1]),
  599:    ?line [4,3,2,1] = lists:rumerge3([4,3,2],[3,2,1],[3,2,1]),
<a name="600"></a>  600:    ?line [5,4,3,2,1] = lists:rumerge3([4,3,2],[5,4,3,2],[5,4,3,2,1]),
  601:    ?line [6,5,4,3,2] = lists:rumerge3([4,3,2],[5,4,3,2],[6,5,4,3]),
  602:
  603:    L1 = [c,d,e],
  604:    L2 = [b,c,d],
  605:    ?line true = 
  606:	lists:umerge(L1, L2) == 
  607:	lists:reverse(lists:rumerge(lists:reverse(L1), lists:reverse(L2))),
  608:    ok.
  609:
<a name=usort_rand><a name="610"></a>  610:<b>usort_rand</b></a>(doc) -&gt;   ["usort/1 on big randomized lists"];
<a name=usort_rand>  611:<b>usort_rand</b></a>(suite) -&gt; [];
<a name=usort_rand>  612:<b>usort_rand</b></a>(Config) when list(Config) -&gt;
  613:    ?line ok = ucheck(biglist(10)),
  614:    ?line ok = ucheck(biglist(100)),
  615:    ?line ok = ucheck(biglist(1000)),
  616:    ?line ok = ucheck(biglist(10000)),
  617:
  618:    ?line ok = ucheck(ubiglist(10)),
  619:    ?line ok = ucheck(ubiglist(100)),
<a name="620"></a>  620:    ?line ok = ucheck(ubiglist(1000)),
  621:    ?line ok = ucheck(ubiglist(10000)),
  622:    ok.
  623:
<a name=usort_stable>  624:<b>usort_stable</b></a>(doc) -&gt;   ["usort/1 should keep the first duplicate."];
<a name=usort_stable>  625:<b>usort_stable</b></a>(suite) -&gt; [];
<a name=usort_stable>  626:<b>usort_stable</b></a>(Config) when list(Config) -&gt;
  627:    ?line ok = ucheck_stability(bigfunlist(3)),
  628:    ?line ok = ucheck_stability(bigfunlist(10)),
  629:    ?line ok = ucheck_stability(bigfunlist(100)),
<a name="630"></a>  630:    ?line ok = ucheck_stability(bigfunlist(1000)),
  631:    ?line ok = ucheck_stability(bigfunlist(10000)),
  632:    ok.
  633:
<a name=ucheck>  634:<b>ucheck</b></a>([]) -&gt;
  635:    ok;
<a name=ucheck>  636:<b>ucheck</b></a>(L) -&gt;
  637:    S = lists:usort(L),
  638:    case ucheck(hd(S), tl(S)) of
  639:	ok -&gt;
<a name="640"></a>  640:	    ok;
  641:	_ -&gt;
  642:	    io:format("~w~n", [L]),
  643:	    erlang:fault(ucheck)
  644:    end.
  645:
<a name=ucheck>  646:<b>ucheck</b></a>(_A, []) -&gt;
  647:    ok;
<a name=ucheck>  648:<b>ucheck</b></a>(A, [B | L]) when A &lt; B -&gt;
  649:    ucheck(B, L);
<a name=ucheck><a name="650"></a>  650:<b>ucheck</b></a>(_A, _L) -&gt;
  651:    no.
  652:
  653:<i>%% Check that usort/1 is stable and correct relative ukeysort/2.</i>
<a name=ucheck_stability>  654:<b>ucheck_stability</b></a>(L) -&gt;
  655:    S = no_dups(lsort(L)),
  656:    U = lists:usort(L),
  657:    check_stab(L, U, S, "usort/1", "ukeysort/2").
  658:
<a name=keysort>  659:<b>keysort</b></a>(doc) -&gt;
<a name="660"></a>  660:    ["Tests lists:keysort/2"];
<a name=keysort>  661:<b>keysort</b></a>(suite) -&gt;
  662:    [keymerge, rkeymerge,
  663:     keysort_1, keysort_rand, keysort_i, keysort_stable, keysort_error].
  664:
<a name=keymerge>  665:<b>keymerge</b></a>(doc) -&gt; ["Key merge two lists."];
<a name=keymerge>  666:<b>keymerge</b></a>(suite) -&gt; [];
<a name=keymerge>  667:<b>keymerge</b></a>(Config) when list(Config) -&gt;
  668:
  669:    Two = [{1,a},{2,b}],
<a name="670"></a>  670:    Six = [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f}],
  671:
  672:    %% 2-way keymerge
  673:    ?line [] = lists:keymerge(1, [], []),
  674:    ?line Two = lists:keymerge(1, Two, []),
  675:    ?line Two = lists:keymerge(1, [], Two),
  676:    ?line Six = lists:keymerge(1, [{1,a},{3,c},{5,e}], [{2,b},{4,d},{6,f}]),
  677:    ?line Six = lists:keymerge(1, [{2,b},{4,d},{6,f}], [{1,a},{3,c},{5,e}]),
  678:    ?line Six = lists:keymerge(1, [{1,a},{2,b},{3,c}], [{4,d},{5,e},{6,f}]),
  679:    ?line Six = lists:keymerge(1, [{4,d},{5,e},{6,f}], [{1,a},{2,b},{3,c}]),
<a name="680"></a>  680:    ?line Six = lists:keymerge(1, [{1,a},{2,b},{5,e}],[{3,c},{4,d},{6,f}]),
  681:    ?line [{1,a},{2,b},{3,c},{5,e},{7,g}] = 
  682:	lists:keymerge(1, [{1,a},{3,c},{5,e},{7,g}], [{2,b}]),
  683:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}] = 
  684:	lists:keymerge(1, [{1,a},{3,c},{5,e},{7,g}], [{2,b},{4,d}]),
  685:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}] = 
  686:	lists:keymerge(1, [{1,a},{3,c},{5,e},{7,g}], [{2,b},{4,d},{6,f}]),
  687:    ?line [{1,a},{2,b},{3,c},{5,e},{7,g}] = 
  688:	lists:keymerge(1, [{2,b}], [{1,a},{3,c},{5,e},{7,g}]),
  689:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}] = 
<a name="690"></a>  690:	lists:keymerge(1, [{2,b},{4,d}], [{1,a},{3,c},{5,e},{7,g}]),
  691:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}] = 
  692:	lists:keymerge(1, [{2,b},{4,d},{6,f}], [{1,a},{3,c},{5,e},{7,g}]),
  693:
  694:    ?line [{b,2},{c,11},{c,12},{c,21},{c,22},{e,5}] =
  695:	lists:keymerge(1,[{c,11},{c,12},{e,5}], [{b,2},{c,21},{c,22}]),
  696:
  697:    ok.
  698:
<a name=rkeymerge>  699:<b>rkeymerge</b></a>(doc) -&gt; ["Reverse key merge two lists."];
<a name=rkeymerge><a name="700"></a>  700:<b>rkeymerge</b></a>(suite) -&gt; [];
<a name=rkeymerge>  701:<b>rkeymerge</b></a>(Config) when list(Config) -&gt;
  702:
  703:    Two = [{2,b},{1,a}],
  704:    Six = [{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}],
  705:
  706:    %% 2-way reversed keymerge
  707:    ?line [] = lists:rkeymerge(1, [], []),
  708:    ?line Two = lists:rkeymerge(1, Two, []),
  709:    ?line Two = lists:rkeymerge(1, [], Two),
<a name="710"></a>  710:    ?line Six = lists:rkeymerge(1, [{5,e},{3,c},{1,a}], [{6,f},{4,d},{2,b}]),
  711:    ?line Six = lists:rkeymerge(1, [{6,f},{4,d},{2,b}], [{5,e},{3,c},{1,a}]),
  712:    ?line Six = lists:rkeymerge(1, [{3,c},{2,b},{1,a}], [{6,f},{5,e},{4,d}]),
  713:    ?line Six = lists:rkeymerge(1, [{6,f},{5,e},{4,d}], [{3,c},{2,b},{1,a}]),
  714:    ?line Six = lists:rkeymerge(1, [{4,d},{3,c},{2,b}],[{6,f},{5,e},{1,a}]),
  715:    ?line [{7,g},{6,f},{5,e},{3,c},{1,a}] = 
  716:	lists:rkeymerge(1, [{7,g},{5,e},{3,c},{1,a}], [{6,f}]),
  717:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{1,a}] = 
  718:	lists:rkeymerge(1, [{7,g},{5,e},{3,c},{1,a}], [{6,f},{4,d}]),
  719:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
<a name="720"></a>  720:	lists:rkeymerge(1, [{7,g},{5,e},{3,c},{1,a}], [{6,f},{4,d},{2,b}]),
  721:    ?line [{7,g},{5,e},{3,c},{2,b},{1,a}] = 
  722:	lists:rkeymerge(1, [{2,b}], [{7,g},{5,e},{3,c},{1,a}]),
  723:    ?line [{7,g},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  724:	lists:rkeymerge(1, [{4,d},{2,b}], [{7,g},{5,e},{3,c},{1,a}]),
  725:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  726:	lists:rkeymerge(1, [{6,f},{4,d},{2,b}], [{7,g},{5,e},{3,c},{1,a}]),
  727:
  728:    L1 = [{c,11},{c,12},{e,5}],
  729:    L2 = [{b,2},{c,21},{c,22}],
<a name="730"></a>  730:    ?line true = 
  731:	lists:keymerge(1, L1, L2) == 
  732:	lists:reverse(lists:rkeymerge(1,lists:reverse(L1), 
  733:				      lists:reverse(L2))),
  734:
  735:    ok.
  736:
<a name=keysort_1>  737:<b>keysort_1</b></a>(doc) -&gt;   ["keysort"];
<a name=keysort_1>  738:<b>keysort_1</b></a>(suite) -&gt; [];
<a name=keysort_1>  739:<b>keysort_1</b></a>(Config) when list(Config) -&gt;
<a name="740"></a>  740:    ?line ok = keysort_check(1, [], []),
  741:    ?line ok = keysort_check(1, [{a,b}], [{a,b}]),
  742:    ?line ok = keysort_check(1, [{a,b},{a,b}], [{a,b},{a,b}]),
  743:    ?line ok = keysort_check(1, [{a,b},{b,c}], [{a,b},{b,c}]),
  744:    ?line ok = keysort_check(1, [{b,c},{a,b}], [{a,b},{b,c}]),
  745:    ?line ok = keysort_check(1,
  746:			     [{1,e},{3,f},{2,y},{0,z},{x,14}],
  747:			     [{0,z},{1,e},{2,y},{3,f},{x,14}]),
  748:    ?line ok = keysort_check(1,
  749:			     [{1,a},{1,a},{1,a},{1,a}],
<a name="750"></a>  750:			     [{1,a},{1,a},{1,a},{1,a}]),
  751:
  752:    ?line [{b,1},{c,1}] = lists:keysort(1, [{c,1},{b,1}]),
  753:    ?line [{a,0},{b,2},{c,3},{d,4}] = 
  754:	  lists:keysort(1, [{d,4},{c,3},{b,2},{a,0}]),
  755:    ?line [{a,0},{b,1},{b,2},{c,1}] =
  756:	  lists:keysort(1, [{c,1},{b,1},{b,2},{a,0}]),
  757:    ?line [{a,0},{b,1},{b,2},{c,1},{d,4}] =
  758:	  lists:keysort(1, [{c,1},{b,1},{b,2},{a,0},{d,4}]),
  759:
<a name="760"></a>  760:    SFun = fun(L) -&gt; fun(X) -&gt; keysort_check(1, X, L) end end,
  761:    L1 = [{1,a},{2,b},{3,c}],
  762:    ?line lists:foreach(SFun(L1), perms(L1)),
  763:    L2 = [{1,a},{1,a},{2,b}],
  764:    ?line lists:foreach(SFun(L2), perms(L2)),
  765:    L3 = [{1,a},{1,a},{1,a},{2,b}],
  766:    ?line lists:foreach(SFun(L3), perms(L3)),
  767:    L4 = [{a,1},{a,1},{b,2},{b,2},{c,3},{d,4},{e,5},{f,6}],
  768:    ?line lists:foreach(SFun(L4), perms(L4)),
  769:
<a name="770"></a>  770:    ok.
  771:
<a name=keysort_stable>  772:<b>keysort_stable</b></a>(doc) -&gt;   ["keysort should be stable"];
<a name=keysort_stable>  773:<b>keysort_stable</b></a>(suite) -&gt; [];
<a name=keysort_stable>  774:<b>keysort_stable</b></a>(Config) when list(Config) -&gt;
  775:    ?line ok = keysort_check(1, [{1,b},{1,c}], [{1,b},{1,c}]),
  776:    ?line ok = keysort_check(1, [{1,c},{1,b}], [{1,c},{1,b}]),
  777:    ?line ok = keysort_check(1,
  778:			     [{1,c},{1,b},{2,x},{3,p},{2,a}],
  779:			     [{1,c},{1,b},{2,x},{2,a},{3,p}]),
<a name="780"></a>  780:    ?line ok = keysort_check(1, 
  781:			     [{1,a},{1,b},{1,a},{1,a}],
  782:			     [{1,a},{1,b},{1,a},{1,a}]),
  783:    ok.
  784:
<a name=keysort_error>  785:<b>keysort_error</b></a>(doc) -&gt;   ["keysort should exit when given bad arguments"];
<a name=keysort_error>  786:<b>keysort_error</b></a>(suite) -&gt; [];
<a name=keysort_error>  787:<b>keysort_error</b></a>(Config) when list(Config) -&gt;
  788:    ?line {'EXIT', _} = (catch lists:keysort(0, [{1,b},{1,c}])),
  789:    ?line {'EXIT', _} = (catch lists:keysort(3, [{1,b},{1,c}])),
<a name="790"></a>  790:    ?line {'EXIT', _} = (catch lists:keysort(1.5, [{1,b},{1,c}])),
  791:    ?line {'EXIT', _} = (catch lists:keysort(x, [{1,b},{1,c}])),
  792:    ?line {'EXIT', _} = (catch lists:keysort(x, [])),
  793:    ?line {'EXIT', _} = (catch lists:keysort(x, [{1,b}])),
  794:    ?line {'EXIT', _} = (catch lists:keysort(1, [a,b])),
  795:    ?line {'EXIT', _} = (catch lists:keysort(1, [{1,b} | {1,c}])),
  796:    ok.
  797:
<a name=keysort_i>  798:<b>keysort_i</b></a>(doc) -&gt;   ["keysort with other key than first element"];
<a name=keysort_i>  799:<b>keysort_i</b></a>(suite) -&gt; [];
<a name=keysort_i><a name="800"></a>  800:<b>keysort_i</b></a>(Config) when list(Config) -&gt;
  801:    ?line ok = keysort_check(2, [{a,2},{b,1},{c,3}], [{b,1},{a,2},{c,3}]),
  802:    ok.
  803:
<a name=keysort_rand>  804:<b>keysort_rand</b></a>(doc) -&gt;   ["keysort on big randomized lists"];
<a name=keysort_rand>  805:<b>keysort_rand</b></a>(suite) -&gt; [];
<a name=keysort_rand>  806:<b>keysort_rand</b></a>(Config) when list(Config) -&gt;
  807:    ?line ok = keysort_check3(1, biglist(10)),
  808:    ?line ok = keysort_check3(1, biglist(100)),
  809:    ?line ok = keysort_check3(1, biglist(1000)),
<a name="810"></a>  810:    ?line ok = keysort_check3(1, biglist(10000)),
  811:
  812:    ?line ok = keysort_check3(2, biglist(10)),
  813:    ?line ok = keysort_check3(2, biglist(100)),
  814:    ?line ok = keysort_check3(2, biglist(1000)),
  815:    ?line ok = keysort_check3(2, biglist(10000)),
  816:    ok.
  817:
  818:<i>%%% Keysort a list, check that the returned list is what we expected,</i>
  819:<i>%%% and that it is actually sorted.</i>
<a name=keysort_check><a name="820"></a>  820:<b>keysort_check</b></a>(I, Input, Expected) -&gt;
  821:    ?line Expected = lists:keysort(I, Input),
  822:    check_sorted(I, Input, Expected).
  823:
<a name=keysort_check3>  824:<b>keysort_check3</b></a>(I, Input) -&gt;
  825:    check_sorted(I, 3, Input, lists:keysort(I, Input)).
  826:
<a name=check_sorted>  827:<b>check_sorted</b></a>(I, Input, L) -&gt;
  828:    check_sorted(I, I, Input, L).
  829:
<a name="830"></a>  830:<i>%%% Check that a list is keysorted by element I. Elements comparing equal</i>
  831:<i>%%% should be sorted according to element J.</i>
<a name=check_sorted>  832:<b>check_sorted</b></a>(_I, _J, _Input, []) -&gt;
  833:    ok;
<a name=check_sorted>  834:<b>check_sorted</b></a>(I, J, Input, [A | Rest]) -&gt;
  835:    case catch check_sorted1(I, J, A, Rest) of
  836:	{'EXIT', _} -&gt;
  837:	    io:format("~w~n", [Input]),
  838:	    erlang:fault(check_sorted);
  839:	Reply -&gt;
<a name="840"></a>  840:	    Reply
  841:    end.
  842:
<a name=check_sorted1>  843:<b>check_sorted1</b></a>(_I, _J, _A, []) -&gt;
  844:    ok;
<a name=check_sorted1>  845:<b>check_sorted1</b></a>(I, J, A, [B | Rest]) -&gt;
  846:    ok = keycompare(I, J, A, B),
  847:    check_sorted1(I, J, B, Rest).
  848:
<a name=keycompare>  849:<b>keycompare</b></a>(I, _J, A, B) when element(I, A) &lt; element(I, B) -&gt;
<a name="850"></a>  850:    ok;
<a name=keycompare>  851:<b>keycompare</b></a>(I, J, A, B) when element(I, A) == element(I, B), 
  852:			    element(J, A) =&lt; element(J, B) -&gt;
  853:    ok.
  854:
<a name=ukeysort>  855:<b>ukeysort</b></a>(doc) -&gt;
  856:    ["Tests lists:ukeysort/2"];
<a name=ukeysort>  857:<b>ukeysort</b></a>(suite) -&gt;
  858:    [ukeymerge, rukeymerge,
  859:     ukeysort_1, ukeysort_rand, ukeysort_i, ukeysort_stable, ukeysort_error].
<a name="860"></a>  860:
<a name=ukeymerge>  861:<b>ukeymerge</b></a>(suite) -&gt; [];
<a name=ukeymerge>  862:<b>ukeymerge</b></a>(doc) -&gt; ["Merge two lists while removing duplicates."];
<a name=ukeymerge>  863:<b>ukeymerge</b></a>(Conf) when list(Conf) -&gt;
  864:
  865:    Two = [{1,a},{2,b}],
  866:    Six = [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f}],
  867:
  868:    %% 2-way unique keymerge
  869:    ?line [] = lists:ukeymerge(1, [], []),
<a name="870"></a>  870:    ?line Two = lists:ukeymerge(1, Two, []),
  871:    ?line Two = lists:ukeymerge(1, [], Two),
  872:    ?line [] = lists:ukeymerge(1, [], []),
  873:    ?line Two = lists:ukeymerge(1, Two, []),
  874:    ?line Two = lists:ukeymerge(1, [], Two),
  875:    ?line Six = lists:ukeymerge(1, [{1,a},{3,c},{5,e}], [{2,b},{4,d},{6,f}]),
  876:    ?line Six = lists:ukeymerge(1, [{2,b},{4,d},{6,f}], [{1,a},{3,c},{5,e}]),
  877:    ?line Six = lists:ukeymerge(1, [{1,a},{2,b},{3,c}], [{4,d},{5,e},{6,f}]),
  878:    ?line Six = lists:ukeymerge(1, [{4,d},{5,e},{6,f}], [{1,a},{2,b},{3,c}]),
  879:    ?line Six = lists:ukeymerge(1, [{1,a},{2,b},{5,e}],[{3,c},{4,d},{6,f}]),
<a name="880"></a>  880:    ?line [{1,a},{2,b},{3,c},{5,e},{7,g}] = 
  881:	lists:ukeymerge(1, [{1,a},{3,c},{5,e},{7,g}], [{2,b}]),
  882:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}] = 
  883:	lists:ukeymerge(1, [{1,a},{3,c},{5,e},{7,g}], [{2,b},{4,d}]),
  884:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}] = 
  885:	lists:ukeymerge(1, [{1,a},{3,c},{5,e},{7,g}], [{2,b},{4,d},{6,f}]),
  886:    ?line [{1,a},{2,b},{3,c},{5,e},{7,g}] = 
  887:	lists:ukeymerge(1, [{2,b}], [{1,a},{3,c},{5,e},{7,g}]),
  888:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}] = 
  889:	lists:ukeymerge(1, [{2,b},{4,d}], [{1,a},{3,c},{5,e},{7,g}]),
<a name="890"></a>  890:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}] = 
  891:	lists:ukeymerge(1, [{2,b},{4,d},{6,f}], [{1,a},{3,c},{5,e},{7,g}]),
  892:
  893:    ?line [{1,a},{2,b},{3,c},{5,e},{7,g}] = 
  894:	lists:ukeymerge(1, [{1,a},{2,b},{3,c},{5,e},{7,g}], [{2,b}]),
  895:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}] = 
  896:	lists:ukeymerge(1, [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}], 
  897:			[{2,b},{4,d}]),
  898:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}] = 
  899:	lists:ukeymerge(1, [{1,a},{3,c},{5,e},{6,f},{7,g}], 
<a name="900"></a>  900:			[{2,b},{4,d},{6,f}]),
  901:    ?line [{1,a},{2,b},{3,c},{5,e},{7,g}] = 
  902:	lists:ukeymerge(1, [{2,b}], [{1,a},{2,b},{3,c},{5,e},{7,g}]),
  903:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}] = 
  904:	lists:ukeymerge(1, [{2,b},{4,d}], 
  905:			[{1,a},{2,b},{3,c},{4,d},{5,e},{7,g}]),
  906:    ?line [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}] = 
  907:	lists:ukeymerge(1, [{2,b},{4,d},{6,f}], 
  908:		     [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{7,g}]),
  909:
<a name="910"></a>  910:    L1 = [{1,a},{1,b},{1,a}],
  911:    L2 = [{1,a},{1,b},{1,a}],
  912:    ?line [{1,a},{1,b},{1,a},{1,b},{1,a}] = lists:ukeymerge(1, L1, L2),
  913:    ?line [{b,2},{c,11},{c,12},{c,21},{c,22},{e,5}] =
  914:	lists:ukeymerge(1, [{c,11},{c,12},{e,5}], [{b,2},{c,21},{c,22}]),
  915:
  916:    ok.
  917:
<a name=rukeymerge>  918:<b>rukeymerge</b></a>(suite) -&gt; [];
<a name=rukeymerge>  919:<b>rukeymerge</b></a>(doc) -&gt; 
<a name="920"></a>  920:    ["Reverse merge two lists while removing duplicates."];
<a name=rukeymerge>  921:<b>rukeymerge</b></a>(Conf) when list(Conf) -&gt;
  922:
  923:    Two = [{2,b},{1,a}],
  924:    Six = [{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}],
  925:
  926:    %% 2-way reversed unique keymerge
  927:    ?line [] = lists:rukeymerge(1, [], []),
  928:    ?line Two = lists:rukeymerge(1, Two, []),
  929:    ?line Two = lists:rukeymerge(1, [], Two),
<a name="930"></a>  930:    ?line Six = lists:rukeymerge(1, [{5,e},{3,c},{1,a}], [{6,f},{4,d},{2,b}]),
  931:    ?line Six = lists:rukeymerge(1, [{6,f},{4,d},{2,b}], [{5,e},{3,c},{1,a}]),
  932:    ?line Six = lists:rukeymerge(1, [{3,c},{2,b},{1,a}], [{6,f},{5,e},{4,d}]),
  933:    ?line Six = lists:rukeymerge(1, [{6,f},{5,e},{4,d}], [{3,c},{2,b},{1,a}]),
  934:    ?line Six = lists:rukeymerge(1, [{4,d},{3,c},{2,b}],[{6,f},{5,e},{1,a}]),
  935:    ?line [{7,g},{6,f},{5,e},{3,c},{1,a}] = 
  936:	lists:rukeymerge(1, [{7,g},{5,e},{3,c},{1,a}], [{6,f}]),
  937:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{1,a}] = 
  938:	lists:rukeymerge(1, [{7,g},{5,e},{3,c},{1,a}], [{6,f},{4,d}]),
  939:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
<a name="940"></a>  940:	lists:rukeymerge(1, [{7,g},{5,e},{3,c},{1,a}], [{6,f},{4,d},{2,b}]),
  941:    ?line [{7,g},{5,e},{3,c},{2,b},{1,a}] = 
  942:	lists:rukeymerge(1, [{2,b}], [{7,g},{5,e},{3,c},{1,a}]),
  943:    ?line [{7,g},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  944:	lists:rukeymerge(1, [{4,d},{2,b}], [{7,g},{5,e},{3,c},{1,a}]),
  945:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  946:	lists:rukeymerge(1, [{6,f},{4,d},{2,b}], [{7,g},{5,e},{3,c},{1,a}]),
  947:
  948:    ?line [{7,g},{6,f},{5,e},{3,c},{1,a}] = 
  949:	lists:rukeymerge(1, [{7,g},{6,f},{5,e},{3,c},{1,a}], [{6,f}]),
<a name="950"></a>  950:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{1,a}] = 
  951:	lists:rukeymerge(1, [{7,g},{6,f},{5,e},{4,d},{3,c},{1,a}], 
  952:			 [{6,f},{4,d}]),
  953:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  954:	lists:rukeymerge(1, [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}], 
  955:		      [{6,f},{4,d},{2,b}]),
  956:    ?line [{7,g},{5,e},{3,c},{2,b},{1,a}] = 
  957:	lists:rukeymerge(1, [{2,b}], [{7,g},{5,e},{3,c},{2,b},{1,a}]),
  958:    ?line [{7,g},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  959:	lists:rukeymerge(1, [{4,d},{2,b}], 
<a name="960"></a>  960:			 [{7,g},{5,e},{4,d},{3,c},{2,b},{1,a}]),
  961:    ?line [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}] = 
  962:	lists:rukeymerge(1, [{6,f},{4,d},{2,b}], 
  963:		      [{7,g},{6,f},{5,e},{4,d},{3,c},{2,b},{1,a}]),
  964:
  965:    L1 = [{1,a},{1,b},{1,a}],
  966:    L2 = [{1,a},{1,b},{1,a}],
  967:    ?line true = 
  968:	lists:ukeymerge(1, L1, L2) == 
  969:	lists:reverse(lists:rukeymerge(1, lists:reverse(L1), 
<a name="970"></a>  970:				       lists:reverse(L2))),
  971:
  972:    L3 = [{c,11},{c,12},{e,5}],
  973:    L4 = [{b,2},{c,21},{c,22}],
  974:    ?line true = 
  975:	lists:ukeymerge(1, L3, L4) == 
  976:	lists:reverse(lists:rukeymerge(1,lists:reverse(L3), 
  977:				       lists:reverse(L4))),
  978:
  979:    ok.
<a name="980"></a>  980:
<a name=ukeysort_1>  981:<b>ukeysort_1</b></a>(doc) -&gt;   ["ukeysort"];
<a name=ukeysort_1>  982:<b>ukeysort_1</b></a>(suite) -&gt; [];
<a name=ukeysort_1>  983:<b>ukeysort_1</b></a>(Config) when list(Config) -&gt;
  984:    ?line ok = ukeysort_check(1, [], []),
  985:    ?line ok = ukeysort_check(1, [{a,b}], [{a,b}]),
  986:    ?line ok = ukeysort_check(1, [{a,b},{a,b}], [{a,b}]),
  987:    ?line ok = ukeysort_check(1, [{a,b},{b,c}], [{a,b},{b,c}]),
  988:    ?line ok = ukeysort_check(1, [{b,c},{a,b}], [{a,b},{b,c}]),
  989:    ?line ok = ukeysort_check(1,
<a name="990"></a>  990:                              [{1,e},{3,f},{2,y},{0,z},{x,14}],
  991:                              [{0,z},{1,e},{2,y},{3,f},{x,14}]),
  992:    ?line ok = ukeysort_check(1, [{1,a},{1,a},{1,a},{1,a}], [{1,a}]),
  993:
  994:    L1 = [{1,a},{1,b},{1,a}],
  995:    L2 = [{1,a},{1,b},{1,a}],
  996:    ?line ok = ukeysort_check(1, lists:keymerge(1, L1, L2), 
  997:                              lists:ukeymerge(1, L1, L2)),
  998:    L3 = [{1,a},{1,b},{1,a},{2,a}],
  999:    ?line ok = ukeysort_check(1, lists:keymerge(1, L3, L2), 
<a name="1000"></a> 1000:                              lists:ukeymerge(1, L3, L2)),
 1001:    L4 = [{1,b},{1,a}],
 1002:    ?line ok = ukeysort_check(1, lists:keymerge(1, L1, L4), 
 1003:                              lists:ukeymerge(1, L1, L4)),
 1004:    L5 = [{1,a},{1,b},{1,a},{2,a}],
 1005:    ?line ok = ukeysort_check(1, lists:keymerge(1, [], L5), 
 1006:                              lists:ukeymerge(1, [], L5)),
 1007:    ?line ok = ukeysort_check(1, lists:keymerge(1, L5, []), 
 1008:                              lists:ukeymerge(1, L5, [])),
 1009:    L6 = [{3,a}],
<a name="1010"></a> 1010:    ?line ok = ukeysort_check(1, lists:keymerge(1, L5, L6), 
 1011:                              lists:ukeymerge(1, L5, L6)),
 1012:
 1013:    ?line [{b,1},{c,1}] = lists:ukeysort(1, [{c,1},{c,1},{c,1},{c,1},{b,1}]),
 1014:    ?line [{a,0},{b,2},{c,3},{d,4}] = 
 1015:	  lists:ukeysort(1, [{d,4},{c,3},{b,2},{b,2},{a,0}]),
 1016:    ?line [{a,0},{b,1},{b,2},{c,1}] =
 1017:	  lists:ukeysort(1, [{c,1},{b,1},{b,1},{b,2},{b,2},{a,0}]),
 1018:    ?line [{a,0},{b,1},{b,2},{c,1},{d,4}] =
 1019:	  lists:ukeysort(1, [{c,1},{b,1},{b,2},{a,0},{a,0},{d,4},{d,4}]),
<a name="1020"></a> 1020:
 1021:    SFun = fun(L) -&gt; fun(X) -&gt; ukeysort_check(2, X, L) end end,
 1022:    PL = [{a,1},{b,2},{c,3},{d,4},{e,5},{f,6}],
 1023:    Ps = perms([{a,1},{b,2},{c,3},{d,4},{e,5},{f,6},{b,2},{a,1}]),
 1024:    ?line lists:foreach(SFun(PL), Ps),
 1025:
 1026:    M1L = [{1,a},{1,a},{2,b}],
 1027:    M1s = [{1,a},{2,b}],
 1028:    ?line lists:foreach(SFun(M1s), perms(M1L)),
 1029:    M3 = [{1,a},{2,b},{3,c}],
<a name="1030"></a> 1030:    ?line lists:foreach(SFun(M3), perms(M3)),
 1031:
 1032:    ok.
 1033:
<a name=ukeysort_stable> 1034:<b>ukeysort_stable</b></a>(doc) -&gt;   ["ukeysort should be stable"];
<a name=ukeysort_stable> 1035:<b>ukeysort_stable</b></a>(suite) -&gt; [];
<a name=ukeysort_stable> 1036:<b>ukeysort_stable</b></a>(Config) when list(Config) -&gt;
 1037:    ?line ok = ukeysort_check(1, [{1,b},{1,c}], [{1,b},{1,c}]),
 1038:    ?line ok = ukeysort_check(1, [{1,c},{1,b}], [{1,c},{1,b}]),
 1039:    ?line ok = ukeysort_check(1,
<a name="1040"></a> 1040:                              [{1,c},{1,b},{2,x},{3,p},{2,a}],
 1041:                              [{1,c},{1,b},{2,x},{2,a},{3,p}]),
 1042:
 1043:    ?line ok = ukeysort_check(1, [{1,a},{1,b},{1,b}], [{1,a},{1,b}]),
 1044:    ?line ok = ukeysort_check(1, [{2,a},{1,b},{2,a}], [{1,b},{2,a}]),
 1045:
 1046:    ?line ok = ukeysort_check_stability(bigfunlist(3)),
 1047:    ?line ok = ukeysort_check_stability(bigfunlist(10)),
 1048:    ?line ok = ukeysort_check_stability(bigfunlist(100)),
 1049:    ?line ok = ukeysort_check_stability(bigfunlist(1000)),
<a name="1050"></a> 1050:    ?line ok = ukeysort_check_stability(bigfunlist(10000)),
 1051:    ok.
 1052:
<a name=ukeysort_error> 1053:<b>ukeysort_error</b></a>(doc) -&gt;   ["ukeysort should exit when given bad arguments"];
<a name=ukeysort_error> 1054:<b>ukeysort_error</b></a>(suite) -&gt; [];
<a name=ukeysort_error> 1055:<b>ukeysort_error</b></a>(Config) when list(Config) -&gt;
 1056:    ?line {'EXIT', _} = (catch lists:ukeysort(0, [{1,b},{1,c}])),
 1057:    ?line {'EXIT', _} = (catch lists:ukeysort(3, [{1,b},{1,c}])),
 1058:    ?line {'EXIT', _} = (catch lists:ukeysort(1.5, [{1,b},{1,c}])),
 1059:    ?line {'EXIT', _} = (catch lists:ukeysort(x, [{1,b},{1,c}])),
<a name="1060"></a> 1060:    ?line {'EXIT', _} = (catch lists:ukeysort(x, [])),
 1061:    ?line {'EXIT', _} = (catch lists:ukeysort(x, [{1,b}])),
 1062:    ?line {'EXIT', _} = (catch lists:ukeysort(1, [a,b])),
 1063:    ?line {'EXIT', _} = (catch lists:ukeysort(1, [{1,b} | {1,c}])),
 1064:    ok.
 1065:
<a name=ukeysort_i> 1066:<b>ukeysort_i</b></a>(doc) -&gt;   ["ukeysort with other key than first element"];
<a name=ukeysort_i> 1067:<b>ukeysort_i</b></a>(suite) -&gt; [];
<a name=ukeysort_i> 1068:<b>ukeysort_i</b></a>(Config) when list(Config) -&gt;
 1069:    ?line ok = ukeysort_check(2, [{a,2},{b,1},{c,3}], [{b,1},{a,2},{c,3}]),
<a name="1070"></a> 1070:    ok.
 1071:
<a name=ukeysort_rand> 1072:<b>ukeysort_rand</b></a>(doc) -&gt;   ["ukeysort on big randomized lists"];
<a name=ukeysort_rand> 1073:<b>ukeysort_rand</b></a>(suite) -&gt; [];
<a name=ukeysort_rand> 1074:<b>ukeysort_rand</b></a>(Config) when list(Config) -&gt;
 1075:    ?line ok = ukeysort_check3(2, biglist(10)),
 1076:    ?line ok = ukeysort_check3(2, biglist(100)),
 1077:    ?line ok = ukeysort_check3(2, biglist(1000)),
 1078:    ?line ok = ukeysort_check3(2, biglist(10000)),
 1079:
<a name="1080"></a> 1080:    ?line ok = gen_ukeysort_check(1, ubiglist(10)),
 1081:    ?line ok = gen_ukeysort_check(1, ubiglist(100)),
 1082:    ?line ok = gen_ukeysort_check(1, ubiglist(1000)),
 1083:    ?line ok = gen_ukeysort_check(1, ubiglist(10000)),
 1084:    ok.
 1085:
 1086:<i>%% Check that ukeysort/2 is stable and correct relative keysort/2.</i>
 1087:<i>%% (this is not affected by the fact that keysort/2 is no longer really </i>
 1088:<i>%%  stable; ucheck_stability/1 checks ukeysort/2 (and usort/1, of course))</i>
<a name=gen_ukeysort_check> 1089:<b>gen_ukeysort_check</b></a>(I, Input) -&gt;
<a name="1090"></a> 1090:    U = lists:ukeysort(I, Input),
 1091:    S = lists:keysort(I, Input),
 1092:    case U == no_dups(S) of
 1093:	true -&gt;
 1094:	    ok;
 1095:	false -&gt;
 1096:	    io:format("~w~n", [Input]),
 1097:	    erlang:fault(gen_ukeysort_check)
 1098:    end.
 1099:
<a name="1100"></a> 1100:<i>%% Used for checking that the first copy is kept.</i>
<a name=ukeysort_check_stability> 1101:<b>ukeysort_check_stability</b></a>(L) -&gt;
 1102:    I = 1,
 1103:    U = lists:ukeysort(I, L),
 1104:    S = no_dups(lkeysort(I, L)),
 1105:    check_stab(L, U, S, "ukeysort/2", "usort/2").
 1106:
 1107:<i>%%% Uniquely keysort a list, check that the returned list is what we</i>
 1108:<i>%%% expected, and that it is actually sorted.</i>
<a name=ukeysort_check> 1109:<b>ukeysort_check</b></a>(I, Input, Expected) -&gt;
<a name="1110"></a> 1110:    ?line Expected = lists:ukeysort(I, Input),
 1111:    ucheck_sorted(I, Input, Expected).
 1112:
<a name=ukeysort_check3> 1113:<b>ukeysort_check3</b></a>(I, Input) -&gt;
 1114:    ucheck_sorted(I, 3, Input, lists:ukeysort(I, Input)).
 1115:
<a name=ucheck_sorted> 1116:<b>ucheck_sorted</b></a>(I, Input, L) -&gt;
 1117:    ucheck_sorted(I, I, Input, L).
 1118:
 1119:<i>%%% Check that a list is ukeysorted by element I. Elements comparing</i>
<a name="1120"></a> 1120:<i>%%% equal should be sorted according to element J.</i>
<a name=ucheck_sorted> 1121:<b>ucheck_sorted</b></a>(_I, _J, _Input, []) -&gt;
 1122:    ok;
<a name=ucheck_sorted> 1123:<b>ucheck_sorted</b></a>(I, J, Input, [A | Rest]) -&gt;
 1124:    case catch ucheck_sorted1(I, J, A, Rest) of
 1125:	{'EXIT', _} -&gt;
 1126:	    io:format("~w~n", [Input]),
 1127:	    erlang:fault(ucheck_sorted);
 1128:	Reply -&gt;
 1129:	    Reply
<a name="1130"></a> 1130:    end.
 1131:
<a name=ucheck_sorted1> 1132:<b>ucheck_sorted1</b></a>(_I, _J, _A, []) -&gt;
 1133:    ok;
<a name=ucheck_sorted1> 1134:<b>ucheck_sorted1</b></a>(I, J, A, [B | Rest]) -&gt;
 1135:    ok = ukeycompare(I, J, A, B),
 1136:    ucheck_sorted1(I, J, B, Rest).
 1137:
<a name=ukeycompare> 1138:<b>ukeycompare</b></a>(I, _J, A, B) when element(I, A) &lt; element(I, B) -&gt;
 1139:    ok;
<a name=ukeycompare><a name="1140"></a> 1140:<b>ukeycompare</b></a>(I, J, A, B) when A =/= B,
 1141:			     element(I, A) == element(I, B), 
 1142:			     element(J, A) =&lt; element(J, B) -&gt;
 1143:    ok.
 1144:
 1145:
<a name=funsort> 1146:<b>funsort</b></a>(doc) -&gt;
 1147:    ["Tests lists:sort/2"];
<a name=funsort> 1148:<b>funsort</b></a>(suite) -&gt;
 1149:    [funmerge, rfunmerge, 
<a name="1150"></a> 1150:     funsort_1, funsort_stable, funsort_error, funsort_rand].
 1151:
<a name=funmerge> 1152:<b>funmerge</b></a>(doc) -&gt; ["Merge two lists using a fun."];
<a name=funmerge> 1153:<b>funmerge</b></a>(suite) -&gt; [];
<a name=funmerge> 1154:<b>funmerge</b></a>(Config) when list(Config) -&gt;
 1155:
 1156:    Two = [1,2],
 1157:    Six = [1,2,3,4,5,6],
 1158:    F = fun(X, Y) -&gt; X =&lt; Y end,
 1159:
<a name="1160"></a> 1160:    %% 2-way merge
 1161:    ?line [] = lists:merge(F, [], []),
 1162:    ?line Two = lists:merge(F, Two, []),
 1163:    ?line Two = lists:merge(F, [], Two),
 1164:    ?line Six = lists:merge(F, [1,3,5], [2,4,6]),
 1165:    ?line Six = lists:merge(F, [2,4,6], [1,3,5]),
 1166:    ?line Six = lists:merge(F, [1,2,3], [4,5,6]),
 1167:    ?line Six = lists:merge(F, [4,5,6], [1,2,3]),
 1168:    ?line Six = lists:merge(F, [1,2,5],[3,4,6]),
 1169:    ?line [1,2,3,5,7] = lists:merge(F, [1,3,5,7], [2]),
<a name="1170"></a> 1170:    ?line [1,2,3,4,5,7] = lists:merge(F, [1,3,5,7], [2,4]),
 1171:    ?line [1,2,3,4,5,6,7] = lists:merge(F, [1,3,5,7], [2,4,6]),
 1172:    ?line [1,2,3,5,7] = lists:merge(F, [2], [1,3,5,7]),
 1173:    ?line [1,2,3,4,5,7] = lists:merge(F, [2,4], [1,3,5,7]),
 1174:    ?line [1,2,3,4,5,6,7] = lists:merge(F, [2,4,6], [1,3,5,7]),
 1175:
 1176:    F2 = fun(X,Y) -&gt; element(1,X) =&lt; element(1,Y) end,
 1177:    ?line [{b,2},{c,11},{c,12},{c,21},{c,22},{e,5}] =
 1178:	lists:merge(F2,[{c,11},{c,12},{e,5}], [{b,2},{c,21},{c,22}]),
 1179:
<a name="1180"></a> 1180:    ok.
 1181:
<a name=rfunmerge> 1182:<b>rfunmerge</b></a>(doc) -&gt; ["Reverse merge two lists using a fun."];
<a name=rfunmerge> 1183:<b>rfunmerge</b></a>(suite) -&gt; [];
<a name=rfunmerge> 1184:<b>rfunmerge</b></a>(Config) when list(Config) -&gt;
 1185:
 1186:    Two = [2,1],
 1187:    Six = [6,5,4,3,2,1],
 1188:    F = fun(X, Y) -&gt; X =&lt; Y end,
 1189:
<a name="1190"></a> 1190:    %% 2-way reversed merge
 1191:    ?line [] = lists:rmerge(F, [], []),
 1192:    ?line Two = lists:rmerge(F, Two, []),
 1193:    ?line Two = lists:rmerge(F, [], Two),
 1194:    ?line Six = lists:rmerge(F, [5,3,1], [6,4,2]),
 1195:    ?line Six = lists:rmerge(F, [6,4,2], [5,3,1]),
 1196:    ?line Six = lists:rmerge(F, [3,2,1], [6,5,4]),
 1197:    ?line Six = lists:rmerge(F, [6,5,4], [3,2,1]),
 1198:    ?line Six = lists:rmerge(F, [4,3,2],[6,5,1]),
 1199:    ?line [7,6,5,3,1] = lists:rmerge(F, [7,5,3,1], [6]),
<a name="1200"></a> 1200:    ?line [7,6,5,4,3,1] = lists:rmerge(F, [7,5,3,1], [6,4]),
 1201:    ?line [7,6,5,4,3,2,1] = lists:rmerge(F, [7,5,3,1], [6,4,2]),
 1202:    ?line [7,5,3,2,1] = lists:rmerge(F, [2], [7,5,3,1]),
 1203:    ?line [7,5,4,3,2,1] = lists:rmerge(F, [4,2], [7,5,3,1]),
 1204:    ?line [7,6,5,4,3,2,1] = lists:rmerge(F, [6,4,2], [7,5,3,1]),
 1205:
 1206:    F2 = fun(X,Y) -&gt; element(1,X) =&lt; element(1,Y) end,
 1207:    L1 = [{c,11},{c,12},{e,5}],
 1208:    L2 = [{b,2},{c,21},{c,22}],
 1209:    ?line true = 
<a name="1210"></a> 1210:	lists:merge(F2, L1, L2) == 
 1211:	lists:reverse(lists:rmerge(F2,lists:reverse(L1), lists:reverse(L2))),
 1212:
 1213:    ok.
 1214:
 1215:
<a name=funsort_1> 1216:<b>funsort_1</b></a>(doc) -&gt;   ["sort/2"];
<a name=funsort_1> 1217:<b>funsort_1</b></a>(suite) -&gt; [];
<a name=funsort_1> 1218:<b>funsort_1</b></a>(Config) when list(Config) -&gt;
 1219:    ?line ok = funsort_check(1, [], []),
<a name="1220"></a> 1220:    ?line ok = funsort_check(1, [{a,b}], [{a,b}]),
 1221:    ?line ok = funsort_check(1, [{a,b},{a,b}], [{a,b},{a,b}]),
 1222:    ?line ok = funsort_check(1, [{a,b},{b,c}], [{a,b},{b,c}]),
 1223:    ?line ok = funsort_check(1, [{b,c},{a,b}], [{a,b},{b,c}]),
 1224:    ?line ok = funsort_check(1,
 1225:			     [{1,e},{3,f},{2,y},{0,z},{x,14}],
 1226:			     [{0,z},{1,e},{2,y},{3,f},{x,14}]),
 1227:    F = funsort_fun(1),
 1228:
 1229:    ?line [{b,1},{c,1}] = lists:sort(F, [{c,1},{b,1}]),
<a name="1230"></a> 1230:    ?line [{a,0},{b,2},{c,3},{d,4}] = 
 1231:	  lists:sort(F, [{d,4},{c,3},{b,2},{a,0}]),
 1232:    ?line [{a,0},{b,1},{b,2},{c,1}] =
 1233:	  lists:sort(F, [{c,1},{b,1},{b,2},{a,0}]),
 1234:    ?line [{a,0},{b,1},{b,2},{c,1},{d,4}] =
 1235:	  lists:sort(F, [{c,1},{b,1},{b,2},{a,0},{d,4}]),
 1236:
 1237:    SFun = fun(L) -&gt; fun(X) -&gt; funsort_check(1, X, L) end end,
 1238:    L1 = [{1,a},{1,a},{2,b},{2,b},{3,c},{4,d},{5,e},{6,f}],
 1239:    ?line lists:foreach(SFun(L1), perms(L1)),
<a name="1240"></a> 1240:
 1241:    ok.
 1242:
<a name=funsort_stable> 1243:<b>funsort_stable</b></a>(doc) -&gt;   ["sort/2 should be stable"];
<a name=funsort_stable> 1244:<b>funsort_stable</b></a>(suite) -&gt; [];
<a name=funsort_stable> 1245:<b>funsort_stable</b></a>(Config) when list(Config) -&gt;
 1246:    ?line ok = funsort_check(1, [{1,b},{1,c}], [{1,b},{1,c}]),
 1247:    ?line ok = funsort_check(1, [{1,c},{1,b}], [{1,c},{1,b}]),
 1248:    ?line ok = funsort_check(1,
 1249:			     [{1,c},{1,b},{2,x},{3,p},{2,a}],
<a name="1250"></a> 1250:			     [{1,c},{1,b},{2,x},{2,a},{3,p}]),
 1251:    ok.
 1252:
<a name=funsort_error> 1253:<b>funsort_error</b></a>(doc) -&gt;   ["sort/2 should exit when given bad arguments"];
<a name=funsort_error> 1254:<b>funsort_error</b></a>(suite) -&gt; [];
<a name=funsort_error> 1255:<b>funsort_error</b></a>(Config) when list(Config) -&gt;
 1256:    ?line {'EXIT', _} = (catch lists:sort(1, [{1,b} , {1,c}])),
 1257:    ?line {'EXIT', _} = (catch lists:sort(fun(X,Y) -&gt; X =&lt; Y end, 
 1258:					  [{1,b} | {1,c}])),
 1259:    ok.
<a name="1260"></a> 1260:
<a name=funsort_rand> 1261:<b>funsort_rand</b></a>(doc) -&gt;   ["sort/2 on big randomized lists"];
<a name=funsort_rand> 1262:<b>funsort_rand</b></a>(suite) -&gt; [];
<a name=funsort_rand> 1263:<b>funsort_rand</b></a>(Config) when list(Config) -&gt;
 1264:    ?line ok = funsort_check3(1, biglist(10)),
 1265:    ?line ok = funsort_check3(1, biglist(100)),
 1266:    ?line ok = funsort_check3(1, biglist(1000)),
 1267:    ?line ok = funsort_check3(1, biglist(10000)),
 1268:    ok.
 1269:
<a name="1270"></a> 1270:<i>% Do a keysort</i>
<a name=funsort> 1271:<b>funsort</b></a>(I, L) -&gt;
 1272:    lists:sort(funsort_fun(I), L).
 1273:
<a name=funsort_check3> 1274:<b>funsort_check3</b></a>(I, Input) -&gt;
 1275:    check_sorted(I, 3, Input, funsort(I, Input)).
 1276:
 1277:<i>%%% Keysort a list, check that the returned list is what we expected,</i>
 1278:<i>%%% and that it is actually sorted.</i>
<a name=funsort_check> 1279:<b>funsort_check</b></a>(I, Input, Expected) -&gt;
<a name="1280"></a> 1280:    ?line Expected = funsort(I, Input),
 1281:    check_sorted(I, Input, Expected).
 1282:
<a name=ufunsort> 1283:<b>ufunsort</b></a>(doc) -&gt;
 1284:    ["Tests lists:usort/2"];
<a name=ufunsort> 1285:<b>ufunsort</b></a>(suite) -&gt;
 1286:    [ufunmerge, rufunmerge, 
 1287:     ufunsort_1, ufunsort_stable, ufunsort_error, ufunsort_rand].
 1288:
<a name=ufunmerge> 1289:<b>ufunmerge</b></a>(suite) -&gt; [];
<a name=ufunmerge><a name="1290"></a> 1290:<b>ufunmerge</b></a>(doc) -&gt; ["Merge two lists while removing duplicates using a fun."];
<a name=ufunmerge> 1291:<b>ufunmerge</b></a>(Conf) when list(Conf) -&gt;
 1292:
 1293:    Two = [1,2],
 1294:    Six = [1,2,3,4,5,6],
 1295:    F = fun(X, Y) -&gt; X =&lt; Y end,
 1296:
 1297:    %% 2-way unique merge
 1298:    ?line [] = lists:umerge(F, [], []),
 1299:    ?line Two = lists:umerge(F, Two, []),
<a name="1300"></a> 1300:    ?line Two = lists:umerge(F, [], Two),
 1301:    ?line Six = lists:umerge(F, [1,3,5], [2,4,6]),
 1302:    ?line Six = lists:umerge(F, [2,4,6], [1,3,5]),
 1303:    ?line Six = lists:umerge(F, [1,2,3], [4,5,6]),
 1304:    ?line Six = lists:umerge(F, [4,5,6], [1,2,3]),
 1305:    ?line Six = lists:umerge(F, [1,2,5],[3,4,6]),
 1306:    ?line [1,2,3,5,7] = lists:umerge(F, [1,3,5,7], [2]),
 1307:    ?line [1,2,3,4,5,7] = lists:umerge(F, [1,3,5,7], [2,4]),
 1308:    ?line [1,2,3,4,5,6,7] = lists:umerge(F, [1,3,5,7], [2,4,6]),
 1309:    ?line [1,2,3,5,7] = lists:umerge(F, [2], [1,3,5,7]),
<a name="1310"></a> 1310:    ?line [1,2,3,4,5,7] = lists:umerge(F, [2,4], [1,3,5,7]),
 1311:    ?line [1,2,3,4,5,6,7] = lists:umerge(F, [2,4,6], [1,3,5,7]),
 1312:
 1313:    ?line [1,2,3,5,7] = lists:umerge(F, [1,2,3,5,7], [2]),
 1314:    ?line [1,2,3,4,5,7] = lists:umerge(F, [1,2,3,4,5,7], [2,4]),
 1315:    ?line [1,2,3,4,5,6,7] = lists:umerge(F, [1,3,5,6,7], [2,4,6]),
 1316:    ?line [1,2,3,5,7] = lists:umerge(F, [2], [1,2,3,5,7]),
 1317:    ?line [1,2,3,4,5,7] = lists:umerge(F, [2,4], [1,2,3,4,5,7]),
 1318:    ?line [1,2,3,4,5,6,7] = lists:umerge(F, [2,4,6], [1,2,3,4,5,6,7]),
 1319:
<a name="1320"></a> 1320:    L1 = [{1,a},{1,b},{1,a}],
 1321:    L2 = [{1,a},{1,b},{1,a}],
 1322:    F2 = fun(X,Y) -&gt; element(1,X) =&lt; element(1,Y) end,
 1323:    ?line [{1,a},{1,b},{1,a},{1,b},{1,a}] = lists:umerge(F2, L1, L2),
 1324:    ?line [{b,2},{c,11},{c,12},{c,21},{c,22},{e,5}] =
 1325:	lists:umerge(F2, [{c,11},{c,12},{e,5}], [{b,2},{c,21},{c,22}]),
 1326:
 1327:    ok.
 1328:
<a name=rufunmerge> 1329:<b>rufunmerge</b></a>(suite) -&gt; [];
<a name=rufunmerge><a name="1330"></a> 1330:<b>rufunmerge</b></a>(doc) -&gt; 
 1331:    ["Reverse merge two lists while removing duplicates using a fun."];
<a name=rufunmerge> 1332:<b>rufunmerge</b></a>(Conf) when list(Conf) -&gt;
 1333:    Two = [2,1],
 1334:    Six = [6,5,4,3,2,1],
 1335:    F = fun(X, Y) -&gt; X =&lt; Y end,
 1336:
 1337:    %% 2-way reversed unique merge
 1338:    ?line [] = lists:rumerge(F, [], []),
 1339:    ?line Two = lists:rumerge(F, Two, []),
<a name="1340"></a> 1340:    ?line Two = lists:rumerge(F, [], Two),
 1341:    ?line Six = lists:rumerge(F, [5,3,1], [6,4,2]),
 1342:    ?line Six = lists:rumerge(F, [6,4,2], [5,3,1]),
 1343:    ?line Six = lists:rumerge(F, [3,2,1], [6,5,4]),
 1344:    ?line Six = lists:rumerge(F, [6,5,4], [3,2,1]),
 1345:    ?line Six = lists:rumerge(F, [4,3,2],[6,5,1]),
 1346:    ?line [7,6,5,3,1] = lists:rumerge(F, [7,5,3,1], [6]),
 1347:    ?line [7,6,5,4,3,1] = lists:rumerge(F, [7,5,3,1], [6,4]),
 1348:    ?line [7,6,5,4,3,2,1] = lists:rumerge(F, [7,5,3,1], [6,4,2]),
 1349:    ?line [7,5,3,2,1] = lists:rumerge(F, [2], [7,5,3,1]),
<a name="1350"></a> 1350:    ?line [7,5,4,3,2,1] = lists:rumerge(F, [4,2], [7,5,3,1]),
 1351:    ?line [7,6,5,4,3,2,1] = lists:rumerge(F, [6,4,2], [7,5,3,1]),
 1352:
 1353:    ?line [7,6,5,3,1] = lists:rumerge(F, [7,6,5,3,1], [6]),
 1354:    ?line [7,6,5,4,3,1] = lists:rumerge(F, [7,6,5,4,3,1], [6,4]),
 1355:    ?line [7,6,5,4,3,2,1] = lists:rumerge(F, [7,6,5,4,3,2,1], [6,4,2]),
 1356:    ?line [7,5,3,2,1] = lists:rumerge(F, [2], [7,5,3,2,1]),
 1357:    ?line [7,5,4,3,2,1] = lists:rumerge(F, [4,2], [7,5,4,3,2,1]),
 1358:    ?line [7,6,5,4,3,2,1] = lists:rumerge(F, [6,4,2], [7,6,5,4,3,2,1]),
 1359:
<a name="1360"></a> 1360:    F2 = fun(X,Y) -&gt; element(1,X) =&lt; element(1,Y) end,
 1361:    L1 = [{1,a},{1,b},{1,a}],
 1362:    L2 = [{1,a},{1,b},{1,a}],
 1363:    ?line true = lists:umerge(F2, L1, L2) == 
 1364:	lists:reverse(lists:rumerge(F, lists:reverse(L2), lists:reverse(L1))),
 1365:
 1366:    L3 = [{c,11},{c,12},{e,5}],
 1367:    L4 = [{b,2},{c,21},{c,22}],
 1368:    ?line true = 
 1369:	lists:umerge(F2, L3, L4) == 
<a name="1370"></a> 1370:	lists:reverse(lists:rumerge(F2,lists:reverse(L3), lists:reverse(L4))),
 1371:
 1372:    ok.
 1373:
<a name=ufunsort_1> 1374:<b>ufunsort_1</b></a>(doc) -&gt;   ["usort/2"];
<a name=ufunsort_1> 1375:<b>ufunsort_1</b></a>(suite) -&gt; [];
<a name=ufunsort_1> 1376:<b>ufunsort_1</b></a>(Config) when list(Config) -&gt;
 1377:    ?line ok = ufunsort_check(1, [], []),
 1378:    ?line ok = ufunsort_check(1, [{a,b}], [{a,b}]),
 1379:    ?line ok = ufunsort_check(1, [{a,b},{a,b}], [{a,b}]),
<a name="1380"></a> 1380:    ?line ok = ufunsort_check(1, [{a,b},{b,c}], [{a,b},{b,c}]),
 1381:    ?line ok = ufunsort_check(1, [{b,c},{a,b}], [{a,b},{b,c}]),
 1382:    ?line ok = ufunsort_check(1,
 1383:			      [{1,e},{3,f},{2,y},{0,z},{x,14}],
 1384:			      [{0,z},{1,e},{2,y},{3,f},{x,14}]),
 1385:    ?line ok = ufunsort_check(1,
 1386:			      [{1,a},{2,b},{3,c},{2,b},{1,a},{2,b},{3,c},
 1387:			       {2,b},{1,a}],
 1388:			      [{1,a},{2,b},{3,c}]),
 1389:    ?line ok = ufunsort_check(1, 
<a name="1390"></a> 1390:			      [{1,a},{1,a},{1,b},{1,b},{1,a},{2,a}],
 1391:			      [{1,a},{1,b},{1,a},{2,a}]),
 1392:
 1393:    F = funsort_fun(1),
 1394:    L1 = [{1,a},{1,b},{1,a}],
 1395:    L2 = [{1,a},{1,b},{1,a}],
 1396:    ?line ok = ufunsort_check(1, lists:keymerge(1, L1, L2), 
 1397:                              lists:umerge(F, L1, L2)),
 1398:    L3 = [{1,a},{1,b},{1,a},{2,a}],
 1399:    ?line ok = ufunsort_check(1, lists:keymerge(1, L3, L2), 
<a name="1400"></a> 1400:                              lists:umerge(F, L3, L2)),
 1401:    L4 = [{1,b},{1,a}],
 1402:    ?line ok = ufunsort_check(1, lists:keymerge(1, L1, L4), 
 1403:                              lists:umerge(F, L1, L4)),
 1404:    L5 = [{1,a},{1,b},{1,a},{2,a}],
 1405:    ?line ok = ufunsort_check(1, lists:keymerge(1, L5, []), 
 1406:                              lists:umerge(F, L5, [])),
 1407:    L6 = [{3,a}],
 1408:    ?line ok = ufunsort_check(1, lists:keymerge(1, L5, L6), 
 1409:                              lists:umerge(F, L5, L6)),
<a name="1410"></a> 1410:
 1411:    ?line [{b,1},{c,1}] = lists:usort(F, [{c,1},{c,1},{b,1}]),
 1412:    ?line [{a,0},{b,2},{c,3},{d,4}] = 
 1413:	  lists:usort(F, [{d,4},{c,3},{b,2},{b,2},{a,0}]),
 1414:    ?line [{a,0},{b,1},{b,2},{c,1}] =
 1415:	  lists:usort(F, [{c,1},{b,1},{b,1},{b,2},{b,2},{a,0}]),
 1416:    ?line [{a,0},{b,1},{b,2},{c,1},{d,4}] =
 1417:	  lists:usort(F, [{c,1},{b,1},{b,2},{a,0},{a,0},{d,4},{d,4}]),
 1418:
 1419:    SFun = fun(L) -&gt; fun(X) -&gt; ufunsort_check(1, X, L) end end,
<a name="1420"></a> 1420:    PL = [{1,a},{2,b},{3,c},{4,d},{5,e},{6,f}],
 1421:    Ps = perms([{1,a},{2,b},{3,c},{4,d},{5,e},{6,f},{2,b},{1,a}]),
 1422:    ?line lists:foreach(SFun(PL), Ps),
 1423:
 1424:    ok.
 1425:
<a name=ufunsort_stable> 1426:<b>ufunsort_stable</b></a>(doc) -&gt;   ["usort/2 should be stable"];
<a name=ufunsort_stable> 1427:<b>ufunsort_stable</b></a>(suite) -&gt; [];
<a name=ufunsort_stable> 1428:<b>ufunsort_stable</b></a>(Config) when list(Config) -&gt;
 1429:    ?line ok = ufunsort_check(1, [{1,b},{1,c}], [{1,b},{1,c}]),
<a name="1430"></a> 1430:    ?line ok = ufunsort_check(1, [{1,c},{1,b}], [{1,c},{1,b}]),
 1431:    ?line ok = ufunsort_check(1,
 1432:			      [{1,c},{1,b},{2,x},{3,p},{2,a}],
 1433:			      [{1,c},{1,b},{2,x},{2,a},{3,p}]),
 1434:
 1435:    ?line ok = ufunsort_check_stability(bigfunlist(10)),
 1436:    ?line ok = ufunsort_check_stability(bigfunlist(100)),
 1437:    ?line ok = ufunsort_check_stability(bigfunlist(1000)),
 1438:    ?line ok = ufunsort_check_stability(bigfunlist(10000)),
 1439:    ok.
<a name="1440"></a> 1440:
<a name=ufunsort_error> 1441:<b>ufunsort_error</b></a>(doc) -&gt;   ["usort/2 should exit when given bad arguments"];
<a name=ufunsort_error> 1442:<b>ufunsort_error</b></a>(suite) -&gt; [];
<a name=ufunsort_error> 1443:<b>ufunsort_error</b></a>(Config) when list(Config) -&gt;
 1444:    ?line {'EXIT', _} = (catch lists:usort(1, [{1,b} , {1,c}])),
 1445:    ?line {'EXIT', _} = (catch lists:usort(fun(X,Y) -&gt; X =&lt; Y end, 
 1446:					   [{1,b} | {1,c}])),
 1447:    ok.
 1448:
<a name=ufunsort_rand> 1449:<b>ufunsort_rand</b></a>(doc) -&gt;   ["usort/2 on big randomized lists"];
<a name=ufunsort_rand><a name="1450"></a> 1450:<b>ufunsort_rand</b></a>(suite) -&gt; [];
<a name=ufunsort_rand> 1451:<b>ufunsort_rand</b></a>(Config) when list(Config) -&gt;
 1452:    ?line ok = ufunsort_check3(1, biglist(10)),
 1453:    ?line ok = ufunsort_check3(1, biglist(100)),
 1454:    ?line ok = ufunsort_check3(1, biglist(1000)),
 1455:    ?line ok = ufunsort_check3(1, biglist(10000)),
 1456:
 1457:    ?line ok = gen_ufunsort_check(1, ubiglist(100)),
 1458:    ?line ok = gen_ufunsort_check(1, ubiglist(1000)),
 1459:    ?line ok = gen_ufunsort_check(1, ubiglist(10000)),
<a name="1460"></a> 1460:    ok.
 1461:
 1462:<i>%% Check that usort/2 is stable and correct relative sort/2.</i>
<a name=gen_ufunsort_check> 1463:<b>gen_ufunsort_check</b></a>(I, Input) -&gt;
 1464:    U = ufunsort(I, Input),
 1465:    S = funsort(I, Input),
 1466:    case U == no_dups(S) of
 1467:	true -&gt;
 1468:	    ok;
 1469:	false -&gt;
<a name="1470"></a> 1470:	    io:format("~w~n", [Input]),
 1471:	    erlang:fault(gen_ufunsort_check)
 1472:    end.
 1473:
 1474:<i>%% Used for checking that the first copy is kept.</i>
<a name=ufunsort_check_stability> 1475:<b>ufunsort_check_stability</b></a>(L) -&gt;
 1476:    I = 1,
 1477:    U = ufunsort(I, L),
 1478:    S = no_dups(funsort(I, L)),
 1479:    check_stab(L, U, S, "usort/2", "sort/2").
<a name="1480"></a> 1480:
<a name=ufunsort_check3> 1481:<b>ufunsort_check3</b></a>(I, Input) -&gt;
 1482:    ucheck_sorted(I, 3, Input, ufunsort(I, Input)).
 1483:
 1484:<i>%%% Keysort a list, check that the returned list is what we expected,</i>
 1485:<i>%%% and that it is actually sorted.</i>
<a name=ufunsort_check> 1486:<b>ufunsort_check</b></a>(I, Input, Expected) -&gt;
 1487:    ?line Expected = ufunsort(I, Input),
 1488:    ucheck_sorted(I, Input, Expected).
 1489:
<a name="1490"></a> 1490:<i>% Do a keysort</i>
<a name=ufunsort> 1491:<b>ufunsort</b></a>(I, L) -&gt;
 1492:    lists:usort(funsort_fun(I), L).
 1493:
<a name=funsort_fun> 1494:<b>funsort_fun</b></a>(I) -&gt;
 1495:    fun(A, B) when size(A) &gt;= I, size(B) &gt;= I, tuple(A), tuple(B) -&gt;
 1496:            element(I, A) =&lt; element(I, B)
 1497:    end.
 1498:
<a name=check_stab> 1499:<b>check_stab</b></a>(L, U, S, US, SS) -&gt;
<a name="1500"></a> 1500:    UP = explicit_pid(U),
 1501:    SP = explicit_pid(S),
 1502:    case UP == SP of
 1503:	true -&gt;
 1504:	    ok;
 1505:	false -&gt;
 1506:	    io:format("In: ~w~n", [explicit_pid(L)]),
 1507:	    io:format("~s: ~w~n", [US, UP]),
 1508:	    io:format("~s:  ~w~n", [SS, SP]),
 1509:	    erlang:fault(unstable)
<a name="1510"></a> 1510:    end.
 1511:
 1512:<i>%%%------------------------------------------------------------</i>
 1513:<i>%%% Generate lists of given length, containing 3-tuples with</i>
 1514:<i>%%% random integer elements in the range 0..44 as elements 1 and 2.</i>
 1515:<i>%%% Element 3 in the tuple is the position of the tuple in the list.</i>
 1516:
<a name=biglist> 1517:<b>biglist</b></a>(N) -&gt;
 1518:    {A, B, C} = get_seed(),
 1519:    random:seed(A, B, C),
<a name="1520"></a> 1520:    biglist(N, []).
 1521:
<a name=biglist> 1522:<b>biglist</b></a>(0, L) -&gt;
 1523:    L;
<a name=biglist> 1524:<b>biglist</b></a>(N, L) -&gt;
 1525:    E = random_tuple(45, N),
 1526:    biglist(N-1, [E|L]).
 1527:
 1528:<i>%%%------------------------------------------------------------</i>
 1529:<i>%%% Generate lists of given length, containing 2-tuples with</i>
<a name="1530"></a> 1530:<i>%%% random integer elements in the range 0..10 as element 1.</i>
 1531:<i>%%% Element 2 in the tuple is a random integer in the range 0..5.</i>
 1532:<i>%%% No sequence number.</i>
 1533:
<a name=ubiglist> 1534:<b>ubiglist</b></a>(N) -&gt;
 1535:    {A, B, C} = get_seed(),
 1536:    random:seed(A, B, C),
 1537:    ubiglist(N, []).
 1538:
<a name=ubiglist> 1539:<b>ubiglist</b></a>(0, L) -&gt;
<a name="1540"></a> 1540:    L;
<a name=ubiglist> 1541:<b>ubiglist</b></a>(N, L) -&gt;
 1542:    E = urandom_tuple(11, 6),
 1543:    ubiglist(N-1, [E|L]).
 1544:    
<a name=urandom_tuple> 1545:<b>urandom_tuple</b></a>(N, I) -&gt;
 1546:    R1 = randint(N),
 1547:    R2 = randint(I),
 1548:    {R1, R2}.
 1549:
<a name="1550"></a> 1550:<i>%%%------------------------------------------------------------</i>
 1551:<i>%%% Generate lists of given length, containing 2-tuples with random</i>
 1552:<i>%%% integer elements in the range 0..10 as elements 1. All tuples have</i>
 1553:<i>%%% the same function as element 2, but every function is created in a</i>
 1554:<i>%%% unique process. ==/2 will return 'true' for any pair of functions,</i>
 1555:<i>%%% but erlang:fun_info(Fun, pid) can be used for distinguishing</i>
 1556:<i>%%% functions created in different processes. The pid acts like a</i>
 1557:<i>%%% sequence number.</i>
 1558:
<a name=bigfunlist> 1559:<b>bigfunlist</b></a>(N) -&gt;
<a name="1560"></a> 1560:    {A, B, C} = get_seed(),
 1561:    random:seed(A, B, C),
 1562:    bigfunlist_1(N).
 1563:
<a name=bigfunlist_1> 1564:<b>bigfunlist_1</b></a>(N) when N &lt; 30000 -&gt; % Now (R8) max 32000 different pids.
 1565:    case catch bigfunlist(N, 0, []) of
 1566:	{'EXIT', _} -&gt;
 1567:	    bigfunlist_1(N);
 1568:	Reply -&gt;
 1569:	    Reply
<a name="1570"></a> 1570:    end.
 1571:
<a name=bigfunlist> 1572:<b>bigfunlist</b></a>(0, _P, L) -&gt;
 1573:    lists:reverse(L);
<a name=bigfunlist> 1574:<b>bigfunlist</b></a>(N, P, L) -&gt;
 1575:    {E, NP} = random_funtuple(P, 11),
 1576:    bigfunlist(N-1, NP, [E | L]).
 1577:    
<a name=random_funtuple> 1578:<b>random_funtuple</b></a>(P, N) -&gt;
 1579:    R = randint(N),
<a name="1580"></a> 1580:    F = make_fun(),
 1581:    NP = fun_pid(F),
 1582:    true = NP &gt; P,
 1583:    {{R, F}, NP}.
 1584:
<a name=make_fun> 1585:<b>make_fun</b></a>() -&gt;
 1586:    Pid = spawn(?MODULE, make_fun, [self()]),
 1587:    receive {Pid, Fun} -&gt; Fun end.
 1588:    
<a name=make_fun> 1589:<b>make_fun</b></a>(Pid) -&gt;
<a name="1590"></a> 1590:    Pid ! {self(), fun make_fun/1}.
 1591:
<a name=fun_pid> 1592:<b>fun_pid</b></a>(Fun) -&gt;
 1593:    erlang:fun_info(Fun, pid).
 1594:
<a name=get_seed> 1595:<b>get_seed</b></a>() -&gt;
 1596:    case random:seed() of
 1597:	undefined -&gt;
 1598:	    now();
 1599:	Tuple -&gt;
<a name="1600"></a> 1600:	    Tuple
 1601:    end.
 1602:
<a name=random_tuple> 1603:<b>random_tuple</b></a>(N, Seq) -&gt;
 1604:    R1 = randint(N),
 1605:    R2 = randint(N),
 1606:    {R1, R2, Seq}.
 1607:
<a name=randint> 1608:<b>randint</b></a>(N) -&gt;
 1609:    trunc(random:uniform() * N).
<a name="1610"></a> 1610:
 1611:<i>%% The first duplicate is kept.</i>
<a name=no_dups> 1612:<b>no_dups</b></a>([]) -&gt;
 1613:    [];
<a name=no_dups> 1614:<b>no_dups</b></a>([H | T]) -&gt;
 1615:    no_dups(H, T, []).
 1616:
<a name=no_dups> 1617:<b>no_dups</b></a>(H, [H1 | T], L) when H == H1 -&gt;
 1618:    no_dups(H, T, L);
<a name=no_dups> 1619:<b>no_dups</b></a>(H, [H1 | T], L) -&gt;
<a name="1620"></a> 1620:    no_dups(H1, T, [H | L]);
<a name=no_dups> 1621:<b>no_dups</b></a>(H, [], L) -&gt;
 1622:    lists:reverse([H | L]).
 1623:
<a name=perms> 1624:<b>perms</b></a>([]) -&gt;
 1625:    [[]];
<a name=perms> 1626:<b>perms</b></a>(L) -&gt;
 1627:    [[H|T] || H &lt;- L, T &lt;- perms(L--[H])].
 1628:
 1629:<i>%%%------------------------------------------------------------</i>
<a name="1630"></a> 1630:<i>%%% Test the sort routines with randomly generated lists.</i>
 1631:
 1632:-<b>record</b>(state, {sort = 0, usort = 0, stable = 0}).
 1633:
 1634:<i>%% Run it interactively. 'stop' or 'info' recognized commands.</i>
<a name=sort_loop> 1635:<b>sort_loop</b></a>() -&gt;
 1636:    sort_loop(5000).
 1637:
<a name=sort_loop> 1638:<b>sort_loop</b></a>(N) when integer(N), N &gt; 0 -&gt;
 1639:    Pid = spawn_link(?MODULE, sloop, [N]),
<a name="1640"></a> 1640:    sort_loop_1(Pid).
 1641:
<a name=sort_loop_1> 1642:<b>sort_loop_1</b></a>(Pid) -&gt;
 1643:    case io:get_line('? ') of
 1644:	eof -&gt;
 1645:	    ok;
 1646:	"stop\n" -&gt;
 1647:	    Pid ! {self(), stop},
 1648:	    receive {Pid, S} -&gt; display_state(S) end;
 1649:	"info\n" -&gt;
<a name="1650"></a> 1650:	    Pid ! {self(), info},
 1651:	    receive {Pid, S} -&gt; display_state(S) end,
 1652:	    sort_loop_1(Pid);
 1653:	_Other -&gt;
 1654:	    sort_loop_1(Pid)
 1655:    end.
 1656:
<a name=sloop> 1657:<b>sloop</b></a>(N) -&gt;
 1658:    {A, B, C} = get_seed(),
 1659:    random:seed(A, B, C),
<a name="1660"></a> 1660:    sloop(N, #state{}).
 1661:
<a name=sloop> 1662:<b>sloop</b></a>(N, S) -&gt;
 1663:    receive
 1664:	{From, stop} -&gt;
 1665:	    From ! {self(), S};
 1666:	{From, info} -&gt;
 1667:	    From ! {self(), S},
 1668:	    sloop(N, S)
 1669:    after 0 -&gt;
<a name="1670"></a> 1670:	    Len = randint(N),
 1671:	    NS = case randint(3) of
 1672:		     0 -&gt;
 1673:			 BL = biglist(Len, []),
 1674:			 ok = check(BL),
 1675:			 ok = keysort_check3(1, BL),
 1676:			 ok = funsort_check3(1, BL),
 1677:			 S#state{sort = S#state.sort + 1};
 1678:		     1 -&gt;
 1679:			 BL = ubiglist(Len, []),
<a name="1680"></a> 1680:			 ok = ucheck(BL),
 1681:			 ok = gen_ukeysort_check(1, BL),
 1682:			 ok = gen_ufunsort_check(1, BL),
 1683:			 S#state{usort = S#state.usort + 1};
 1684:		     2 -&gt;
 1685:			 BL = bigfunlist(Len),
 1686:			 %% ok = check_stability(BL),
 1687:			 ok = ucheck_stability(BL),
 1688:			 ok = ukeysort_check_stability(BL),
 1689:			 ok = ufunsort_check_stability(BL),
<a name="1690"></a> 1690:			 S#state{stable = S#state.stable + 1}
 1691:		 end,
 1692:	    sloop(N, NS)
 1693:    end.
 1694:	    
<a name=display_state> 1695:<b>display_state</b></a>(S) -&gt;    
 1696:    io:format("sort:   ~p~n", [S#state.sort]),
 1697:    io:format("usort:  ~p~n", [S#state.usort]),
 1698:    io:format("stable: ~p~n", [S#state.stable]).
 1699:
<a name="1700"></a> 1700:<i>%% This version of sort/1 is really stable; the order of equal</i>
 1701:<i>%% elements is kept. It is used for checking the current</i>
 1702:<i>%% implementation of usort/1 etc.</i>
 1703:
<a name=lsort> 1704:<b>lsort</b></a>([X, Y | L] = L0) when X =&lt; Y -&gt;
 1705:    case L of
 1706:	[] -&gt; 
 1707:	    L0;
 1708:	[Z] when Y =&lt; Z -&gt;
 1709:	    L0;
<a name="1710"></a> 1710:	[Z] when X =&lt; Z -&gt;
 1711:	    [X, Z, Y];
 1712:	[Z] -&gt;
 1713:	    [Z, X, Y];
 1714:	_ -&gt;
 1715:	    split_1(X, Y, L, [], [])
 1716:    end;
<a name=lsort> 1717:<b>lsort</b></a>([X, Y | L]) -&gt;
 1718:    case L of
 1719:	[] -&gt;
<a name="1720"></a> 1720:	    [Y, X];
 1721:	[Z] when X =&lt; Z -&gt;
 1722:	    [Y, X | L];
 1723:	[Z] when Y =&lt; Z -&gt;
 1724:	    [Y, Z, X];
 1725:	[Z] -&gt;
 1726:	    [Z, Y, X];
 1727:	_ -&gt;
 1728:	    split_2(X, Y, L, [], [])
 1729:    end;
<a name=lsort><a name="1730"></a> 1730:<b>lsort</b></a>([_] = L) -&gt;
 1731:    L;
<a name=lsort> 1732:<b>lsort</b></a>([] = L) -&gt;
 1733:    L.
 1734:
<a name=split_1> 1735:<b>split_1</b></a>(X, Y, [Z | L], R, Rs) when Z &gt;= Y -&gt;
 1736:    split_1(Y, Z, L, [X | R], Rs);
<a name=split_1> 1737:<b>split_1</b></a>(X, Y, [Z | L], R, Rs) when Z &gt;= X -&gt;
 1738:    split_1(Z, Y, L, [X | R], Rs);
<a name=split_1> 1739:<b>split_1</b></a>(X, Y, [Z | L], [], Rs) -&gt;
<a name="1740"></a> 1740:    split_1(X, Y, L, [Z], Rs);
<a name=split_1> 1741:<b>split_1</b></a>(X, Y, [Z | L], R, Rs) -&gt;
 1742:    split_1_1(X, Y, L, R, Rs, Z);
<a name=split_1> 1743:<b>split_1</b></a>(X, Y, [], R, Rs) -&gt;
 1744:    rmergel([[Y, X | R] | Rs], [], asc).
 1745:
<a name=split_1_1> 1746:<b>split_1_1</b></a>(X, Y, [Z | L], R, Rs, S) when Z &gt;= Y -&gt;
 1747:    split_1_1(Y, Z, L, [X | R], Rs, S);
<a name=split_1_1> 1748:<b>split_1_1</b></a>(X, Y, [Z | L], R, Rs, S) when Z &gt;= X -&gt;
 1749:    split_1_1(Z, Y, L, [X | R], Rs, S);
<a name=split_1_1><a name="1750"></a> 1750:<b>split_1_1</b></a>(X, Y, [Z | L], R, Rs, S) when S =&lt; Z -&gt;
 1751:    split_1(S, Z, L, [], [[Y, X | R] | Rs]);
<a name=split_1_1> 1752:<b>split_1_1</b></a>(X, Y, [Z | L], R, Rs, S) -&gt;
 1753:    split_1(Z, S, L, [], [[Y, X | R] | Rs]);
<a name=split_1_1> 1754:<b>split_1_1</b></a>(X, Y, [], R, Rs, S) -&gt;
 1755:    rmergel([[S], [Y, X | R] | Rs], [], asc).
 1756:
<a name=split_2> 1757:<b>split_2</b></a>(X, Y, [Z | L], R, Rs) when Z &lt; Y -&gt;
 1758:    split_2(Y, Z, L, [X | R], Rs);
<a name=split_2> 1759:<b>split_2</b></a>(X, Y, [Z | L], R, Rs) when Z &lt; X -&gt;
<a name="1760"></a> 1760:    split_2(Z, Y, L, [X | R], Rs);
<a name=split_2> 1761:<b>split_2</b></a>(X, Y, [Z | L], [], Rs) -&gt;
 1762:    split_2(X, Y, L, [Z], Rs);
<a name=split_2> 1763:<b>split_2</b></a>(X, Y, [Z | L], R, Rs) -&gt;
 1764:    split_2_1(X, Y, L, R, Rs, Z);
<a name=split_2> 1765:<b>split_2</b></a>(X, Y, [], R, Rs) -&gt;
 1766:    mergel([[Y, X | R] | Rs], [], desc).
 1767:
<a name=split_2_1> 1768:<b>split_2_1</b></a>(X, Y, [Z | L], R, Rs, S) when Z &lt; Y -&gt;
 1769:    split_2_1(Y, Z, L, [X | R], Rs, S);
<a name=split_2_1><a name="1770"></a> 1770:<b>split_2_1</b></a>(X, Y, [Z | L], R, Rs, S) when Z &lt; X -&gt;
 1771:    split_2_1(Z, Y, L, [X | R], Rs, S);
<a name=split_2_1> 1772:<b>split_2_1</b></a>(X, Y, [Z | L], R, Rs, S) when S &gt; Z -&gt;
 1773:    split_2(S, Z, L, [], [[Y, X | R] | Rs]);
<a name=split_2_1> 1774:<b>split_2_1</b></a>(X, Y, [Z | L], R, Rs, S) -&gt;
 1775:    split_2(Z, S, L, [], [[Y, X | R] | Rs]);
<a name=split_2_1> 1776:<b>split_2_1</b></a>(X, Y, [], R, Rs, S) -&gt;
 1777:    mergel([[S], [Y, X | R] | Rs], [], desc).
 1778:
<a name=mergel> 1779:<b>mergel</b></a>([[] | L], Acc, O) -&gt;
<a name="1780"></a> 1780:    mergel(L, Acc, O);
<a name=mergel> 1781:<b>mergel</b></a>([T1, [H2 | T2] | L], Acc, asc) -&gt;
 1782:    mergel(L, [merge2_1(T1, H2, T2, []) | Acc], asc);
<a name=mergel> 1783:<b>mergel</b></a>([[H2 | T2], T1 | L], Acc, desc) -&gt;
 1784:    mergel(L, [merge2_1(T1, H2, T2, []) | Acc], desc);
<a name=mergel> 1785:<b>mergel</b></a>([L], [], _O) -&gt;
 1786:    L;
<a name=mergel> 1787:<b>mergel</b></a>([L], Acc, O) -&gt;
 1788:    rmergel([lists:reverse(L, []) | Acc], [], O);
<a name=mergel> 1789:<b>mergel</b></a>([], [], _O) -&gt;
<a name="1790"></a> 1790:    [];
<a name=mergel> 1791:<b>mergel</b></a>([], Acc, O) -&gt;
 1792:    rmergel(Acc, [], O);
<a name=mergel> 1793:<b>mergel</b></a>([A, [] | L], Acc, O) -&gt;
 1794:    mergel([A | L], Acc, O);
<a name=mergel> 1795:<b>mergel</b></a>([A, B, [] | L], Acc, O) -&gt;
 1796:    mergel([A, B | L], Acc, O).
 1797:
<a name=rmergel> 1798:<b>rmergel</b></a>([[H2 | T2], T1 | L], Acc, asc) -&gt;
 1799:    rmergel(L, [rmerge2_1(T1, H2, T2, []) | Acc], asc);
<a name=rmergel><a name="1800"></a> 1800:<b>rmergel</b></a>([T1, [H2 | T2] | L], Acc, desc) -&gt;
 1801:    rmergel(L, [rmerge2_1(T1, H2, T2, []) | Acc], desc);
<a name=rmergel> 1802:<b>rmergel</b></a>([L], Acc, O) -&gt;
 1803:    mergel([lists:reverse(L, []) | Acc], [], O);
<a name=rmergel> 1804:<b>rmergel</b></a>([], Acc, O) -&gt;
 1805:    mergel(Acc, [], O).
 1806:
<a name=merge2_1> 1807:<b>merge2_1</b></a>([H1 | T1], H2, T2, M) when H1 =&lt; H2 -&gt;
 1808:    merge2_1(T1, H2, T2, [H1 | M]);
<a name=merge2_1> 1809:<b>merge2_1</b></a>([H1 | T1], H2, T2, M) -&gt;
<a name="1810"></a> 1810:    merge2_2(T1, H1, T2, [H2 | M]);
<a name=merge2_1> 1811:<b>merge2_1</b></a>([], H2, T2, M) -&gt;
 1812:    lists:reverse(T2, [H2 | M]).
 1813:
<a name=merge2_2> 1814:<b>merge2_2</b></a>(T1, H1, [H2 | T2], M) when H1 =&lt; H2 -&gt;
 1815:    merge2_1(T1, H2, T2, [H1 | M]);
<a name=merge2_2> 1816:<b>merge2_2</b></a>(T1, H1, [H2 | T2], M) -&gt;
 1817:    merge2_2(T1, H1, T2, [H2 | M]);
<a name=merge2_2> 1818:<b>merge2_2</b></a>(T1, H1, [], M) -&gt;
 1819:    lists:reverse(T1, [H1 | M]).
<a name="1820"></a> 1820:
<a name=rmerge2_1> 1821:<b>rmerge2_1</b></a>([H1 | T1], H2, T2, M) when H1 =&lt; H2 -&gt;
 1822:    rmerge2_2(T1, H1, T2, [H2 | M]);
<a name=rmerge2_1> 1823:<b>rmerge2_1</b></a>([H1 | T1], H2, T2, M) -&gt;
 1824:    rmerge2_1(T1, H2, T2, [H1 | M]);
<a name=rmerge2_1> 1825:<b>rmerge2_1</b></a>([], H2, T2, M) -&gt;
 1826:    lists:reverse(T2, [H2 | M]).
 1827:
<a name=rmerge2_2> 1828:<b>rmerge2_2</b></a>(T1, H1, [H2 | T2], M) when H1 =&lt; H2 -&gt;
 1829:    rmerge2_2(T1, H1, T2, [H2 | M]);
<a name=rmerge2_2><a name="1830"></a> 1830:<b>rmerge2_2</b></a>(T1, H1, [H2 | T2], M) -&gt;
 1831:    rmerge2_1(T1, H2, T2, [H1 | M]);
<a name=rmerge2_2> 1832:<b>rmerge2_2</b></a>(T1, H1, [], M) -&gt;
 1833:    lists:reverse(T1, [H1 | M]).
 1834:
 1835:
 1836:
 1837:<i>%% This version of keysort/2 is really stable; the order of equal</i>
 1838:<i>%% elements is kept. It is used for checking the current</i>
 1839:<i>%% implementation of ukeysort/2 etc.</i>
<a name="1840"></a> 1840:
<a name=lkeysort> 1841:<b>lkeysort</b></a>(Index, L) when integer(Index), Index &gt; 0 -&gt;
 1842:    case L of
 1843:	[] -&gt; L;
 1844:	[_] -&gt; L;
 1845:	[X, Y | T] -&gt;
 1846:	    EX = element(Index, X),
 1847:	    EY = element(Index, Y),
 1848:	    if
 1849:		EX =&lt; EY -&gt;
<a name="1850"></a> 1850:		    keysplit_1(Index, X, EX, Y, EY, T, [], []);
 1851:		true -&gt;
 1852:		    keysplit_2(Index, Y, EY, T, [X])
 1853:	    end
 1854:    end.
 1855:
<a name=keysplit_1> 1856:<b>keysplit_1</b></a>(I, X, EX, Y, EY, [Z | L], R, Rs) -&gt;
 1857:    EZ = element(I, Z),
 1858:    if 
 1859:	EY =&lt; EZ -&gt;
<a name="1860"></a> 1860:	    keysplit_1(I, Y, EY, Z, EZ, L, [X | R], Rs);
 1861:	EX =&lt; EZ -&gt;
 1862:	    keysplit_1(I, Z, EZ, Y, EY, L, [X | R], Rs);
 1863:	true, R == [] -&gt;
 1864:	    keysplit_1(I, X, EX, Y, EY, L, [Z], Rs);
 1865:	true -&gt;
 1866:	    keysplit_1_1(I, X, EX, Y, EY, L, R, Rs, Z, EZ)
 1867:    end;
<a name=keysplit_1> 1868:<b>keysplit_1</b></a>(I, X, _EX, Y, _EY, [], R, Rs) -&gt;
 1869:    rkeymergel(I, [[Y, X | R] | Rs], []).
<a name="1870"></a> 1870:
 1871:<i>%% One out-of-order element, S.</i>
<a name=keysplit_1_1> 1872:<b>keysplit_1_1</b></a>(I, X, EX, Y, EY, [Z | L], R, Rs, S, ES) -&gt;
 1873:    EZ = element(I, Z),
 1874:    if
 1875:	EY =&lt; EZ -&gt;
 1876:	    keysplit_1_1(I, Y, EY, Z, EZ, L, [X | R], Rs, S, ES);
 1877:	EX =&lt; EZ -&gt;
 1878:	    keysplit_1_1(I, Z, EZ, Y, EY, L, [X | R], Rs, S, ES);
 1879:	ES =&lt; EZ -&gt;
<a name="1880"></a> 1880:	    keysplit_1(I, S, ES, Z, EZ, L, [], [[Y, X | R] | Rs]);
 1881:	true -&gt;
 1882:	    keysplit_1(I, Z, EZ, S, ES, L, [], [[Y, X | R] | Rs])
 1883:    end;
<a name=keysplit_1_1> 1884:<b>keysplit_1_1</b></a>(I, X, _EX, Y, _EY, [], R, Rs, S, _ES) -&gt;
 1885:    rkeymergel(I, [[S], [Y, X | R] | Rs], []).
 1886:
 1887:<i>%% Descending.</i>
<a name=keysplit_2> 1888:<b>keysplit_2</b></a>(I, Y, EY, [Z | L], R) -&gt;
 1889:    EZ = element(I, Z),
<a name="1890"></a> 1890:    if
 1891:	EY =&lt; EZ -&gt;
 1892:            keysplit_1(I, Y, EY, Z, EZ, L, [], [lists:reverse(R, [])]);
 1893:        true -&gt;
 1894:            keysplit_2(I, Z, EZ, L, [Y | R])
 1895:    end;
<a name=keysplit_2> 1896:<b>keysplit_2</b></a>(_I, Y, _EY, [], R) -&gt;
 1897:    [Y | R].
 1898:
<a name=keymergel> 1899:<b>keymergel</b></a>(I, [T1, [H2 | T2] | L], Acc) -&gt;
<a name="1900"></a> 1900:    keymergel(I, L, [keymerge2_1(I, T1, element(I, H2), H2, T2, []) | Acc]);
<a name=keymergel> 1901:<b>keymergel</b></a>(_I, [L], []) -&gt;
 1902:    L;
<a name=keymergel> 1903:<b>keymergel</b></a>(I, [L], Acc) -&gt;
 1904:    rkeymergel(I, [lists:reverse(L, []) | Acc], []);
<a name=keymergel> 1905:<b>keymergel</b></a>(I, [], Acc) -&gt;
 1906:    rkeymergel(I, Acc, []).
 1907:
<a name=rkeymergel> 1908:<b>rkeymergel</b></a>(I, [[H2 | T2], T1 | L], Acc) -&gt;
 1909:    rkeymergel(I, L, [rkeymerge2_1(I, T1, element(I, H2), H2, T2, []) | Acc]);
<a name=rkeymergel><a name="1910"></a> 1910:<b>rkeymergel</b></a>(I, [L], Acc) -&gt;
 1911:    keymergel(I, [lists:reverse(L, []) | Acc], []);
<a name=rkeymergel> 1912:<b>rkeymergel</b></a>(I, [], Acc) -&gt;
 1913:    keymergel(I, Acc, []).
 1914:
<a name=keymerge2_1> 1915:<b>keymerge2_1</b></a>(I, [H1 | T1], E2, H2, T2, M) -&gt;
 1916:    E1 = element(I, H1),
 1917:    if 
 1918:	E1 =&lt; E2 -&gt;
 1919:	    keymerge2_1(I, T1, E2, H2, T2, [H1 | M]);
<a name="1920"></a> 1920:	true -&gt;
 1921:	    keymerge2_2(I, T1, E1, H1, T2, [H2 | M])
 1922:    end;
<a name=keymerge2_1> 1923:<b>keymerge2_1</b></a>(_I, [], _E2, H2, T2, M) -&gt;
 1924:    lists:reverse(T2, [H2 | M]).
 1925:
<a name=keymerge2_2> 1926:<b>keymerge2_2</b></a>(I, T1, E1, H1, [H2 | T2], M) -&gt;
 1927:    E2 = element(I, H2),
 1928:    if
 1929:	E1 =&lt; E2 -&gt;
<a name="1930"></a> 1930:	    keymerge2_1(I, T1, E2, H2, T2, [H1 | M]);
 1931:	true -&gt;
 1932:	    keymerge2_2(I, T1, E1, H1, T2, [H2 | M])
 1933:    end;
<a name=keymerge2_2> 1934:<b>keymerge2_2</b></a>(_I, T1, _E1, H1, [], M) -&gt;
 1935:    lists:reverse(T1, [H1 | M]).
 1936:
<a name=rkeymerge2_1> 1937:<b>rkeymerge2_1</b></a>(I, [H1 | T1], E2, H2, T2, M) -&gt;
 1938:    E1 = element(I, H1),
 1939:    if
<a name="1940"></a> 1940:	E1 =&lt; E2 -&gt;
 1941:	    rkeymerge2_2(I, T1, E1, T2, [H2 | M], H1);
 1942:	true -&gt;
 1943:	    rkeymerge2_1(I, T1, E2, H2, T2, [H1 | M])
 1944:    end;
<a name=rkeymerge2_1> 1945:<b>rkeymerge2_1</b></a>(_I, [], _E2, H2, T2, M) -&gt;
 1946:    lists:reverse(T2, [H2 | M]).
 1947:
<a name=rkeymerge2_2> 1948:<b>rkeymerge2_2</b></a>(I, T1, E1, [H2 | T2], M, H1) -&gt;
 1949:    E2 = element(I, H2),
<a name="1950"></a> 1950:    if
 1951:	E1 =&lt; E2 -&gt;
 1952:	    rkeymerge2_2(I, T1, E1, T2, [H2 | M], H1);
 1953:	true -&gt;
 1954:	    rkeymerge2_1(I, T1, E2, H2, T2, [H1 | M])
 1955:    end;
<a name=rkeymerge2_2> 1956:<b>rkeymerge2_2</b></a>(_I, T1, _E1, [], M, H1) -&gt;
 1957:    lists:reverse(T1, [H1 | M]).
 1958:
 1959:
<a name="1960"></a> 1960:<i>%%%------------------------------------------------------------</i>
 1961:
<a name=seq> 1962:<b>seq</b></a>(doc) -&gt;
 1963:    ["Tests lists:seq/3"];
<a name=seq> 1964:<b>seq</b></a>(suite) -&gt;
 1965:    [
 1966:     seq_loop,
 1967:     seq_2, seq_3, seq_2_e, seq_3_e].
 1968:
<a name=seq_loop> 1969:<b>seq_loop</b></a>(doc) -&gt;
<a name="1970"></a> 1970:    ["Test for infinite loop (OTP-2404)."];
<a name=seq_loop> 1971:<b>seq_loop</b></a>(suite) -&gt;
 1972:    [];
<a name=seq_loop> 1973:<b>seq_loop</b></a>(Config) when list(Config) -&gt;
 1974:    ?line _ = (catch lists:seq(1, 5, -1)),
 1975:    ok.
 1976:
<a name=seq_2> 1977:<b>seq_2</b></a>(doc) -&gt;
 1978:    ["Non-error cases for seq/2"];
<a name=seq_2> 1979:<b>seq_2</b></a>(suite) -&gt;
<a name="1980"></a> 1980:    [];
<a name=seq_2> 1981:<b>seq_2</b></a>(Config) when list(Config) -&gt;
 1982:    ?line [1,2,3] = lists:seq(1,3),
 1983:    ?line [1] = lists:seq(1,1),
 1984:    ?line Big = 748274827583793785928592859,
 1985:    ?line Big1 = Big+1,
 1986:    ?line Big2 = Big+2,
 1987:    ?line [Big, Big1, Big2] = lists:seq(Big, Big+2),
 1988:    ok.
 1989:
<a name=seq_2_e><a name="1990"></a> 1990:<b>seq_2_e</b></a>(doc) -&gt;
 1991:    ["Error cases for seq/2"];
<a name=seq_2_e> 1992:<b>seq_2_e</b></a>(suite) -&gt;
 1993:    [];
<a name=seq_2_e> 1994:<b>seq_2_e</b></a>(Config) when list(Config) -&gt;
 1995:    ?line seq_error([4, 3]),
 1996:    ?line seq_error([1, a]),
 1997:    ?line seq_error([1.0, 2.0]),
 1998:    ok.
 1999:
<a name=seq_error><a name="2000"></a> 2000:<b>seq_error</b></a>(Args) -&gt;
 2001:    {'EXIT', _} = (catch apply(lists, seq, Args)).
 2002:
<a name=seq_3> 2003:<b>seq_3</b></a>(doc) -&gt;
 2004:    ["Non-error cases for seq/3"];
<a name=seq_3> 2005:<b>seq_3</b></a>(suite) -&gt;
 2006:    [];
<a name=seq_3> 2007:<b>seq_3</b></a>(Config) when list(Config) -&gt;
 2008:    ?line [1,2,3] = lists:seq(1,3,1),
 2009:    ?line [1] = lists:seq(1,1,1),
<a name="2010"></a> 2010:    ?line Big = 748274827583793785928592859,
 2011:    ?line Big1 = Big+1,
 2012:    ?line Big2 = Big+2,
 2013:    ?line [Big, Big1, Big2] = lists:seq(Big, Big+2,1),
 2014:
 2015:    ?line [3,2,1] = lists:seq(3,1,-1),
 2016:    ?line [1] = lists:seq(1,1,-1),
 2017:
 2018:    ?line [3,1] = lists:seq(3,1,-2),
 2019:    ?line [1] = lists:seq(1, 10, 10),
<a name="2020"></a> 2020:    ?line [1, 4, 7, 10, 13, 16, 19] = lists:seq(1, 19, 3),
 2021:    ?line [1, 4, 7, 10, 13, 16, 19] = lists:seq(1, 20, 3),
 2022:    ?line [1, 4, 7, 10, 13, 16, 19] = lists:seq(1, 21, 3),
 2023:
 2024:    ?line [1] = lists:seq(1, 1, 0),		%OTP-2613
 2025:    ok.
 2026:
<a name=seq_3_e> 2027:<b>seq_3_e</b></a>(doc) -&gt;
 2028:    ["Error cases for seq/3"];
<a name=seq_3_e> 2029:<b>seq_3_e</b></a>(suite) -&gt;
<a name="2030"></a> 2030:    [];
<a name=seq_3_e> 2031:<b>seq_3_e</b></a>(Config) when list(Config) -&gt;
 2032:    ?line seq_error([4, 3, 1]),
 2033:    ?line seq_error([3, 4, -1]),
 2034:    ?line seq_error([1, a, 1]),
 2035:    ?line seq_error([1.0, 2.0, 1]),
 2036:
 2037:    ?line seq_error([1, 3, 1.0]),
 2038:    ?line seq_error([1, 3, a]),
 2039:    ?line seq_error([1, 3, 0]),
<a name="2040"></a> 2040:
 2041:    ?line seq_error([a, a, 0]),
 2042:    ok.
 2043:
 2044:<i>%%%------------------------------------------------------------</i>
 2045:
<a name=sublist> 2046:<b>sublist</b></a>(doc) -&gt;
 2047:    ["Tests lists:sublist/[2,3]"];
<a name=sublist> 2048:<b>sublist</b></a>(suite) -&gt;
 2049:    [sublist_2, sublist_3, sublist_2_e, sublist_3_e].
<a name="2050"></a> 2050:
 2051:-<b>define</b>(sublist_error2(X,Y), ?line {'EXIT', _} = (catch lists:sublist(X,Y))).
 2052:-<b>define</b>(sublist_error3(X,Y,Z), ?line {'EXIT', _} = (catch lists:sublist(X,Y,Z))).
 2053:
<a name=sublist_2> 2054:<b>sublist_2</b></a>(doc) -&gt;   ["sublist/2"];
<a name=sublist_2> 2055:<b>sublist_2</b></a>(suite) -&gt; [];
<a name=sublist_2> 2056:<b>sublist_2</b></a>(Config) when list(Config) -&gt;
 2057:    ?line [] = lists:sublist([], 0),
 2058:    ?line [] = lists:sublist([], 1),
 2059:    ?line [] = lists:sublist([a], 0),
<a name="2060"></a> 2060:    ?line [a] = lists:sublist([a], 1),
 2061:    ?line [a] = lists:sublist([a], 2),
 2062:    ?line [a] = lists:sublist([a|b], 1),
 2063:
 2064:    ?line [a,b] = lists:sublist([a,b|c], 2),
 2065:
 2066:    ok.
 2067:
<a name=sublist_2_e> 2068:<b>sublist_2_e</b></a>(doc) -&gt;   ["sublist/2 error cases"];
<a name=sublist_2_e> 2069:<b>sublist_2_e</b></a>(suite) -&gt; [];
<a name=sublist_2_e><a name="2070"></a> 2070:<b>sublist_2_e</b></a>(Config) when list(Config) -&gt;
 2071:    ?sublist_error2([], -1),
 2072:    ?sublist_error2(a, -1),
 2073:    ?sublist_error2(a, 0),
 2074:    ?sublist_error2([a|b], 2),
 2075:    ?sublist_error2([a], x),
 2076:    ?sublist_error2([a], 1.5),
 2077:    ?sublist_error2([], x),
 2078:    ?sublist_error2([], 1.5),
 2079:    ok.
<a name="2080"></a> 2080:
<a name=sublist_3> 2081:<b>sublist_3</b></a>(doc) -&gt;   ["sublist/3"];
<a name=sublist_3> 2082:<b>sublist_3</b></a>(suite) -&gt; [];
<a name=sublist_3> 2083:<b>sublist_3</b></a>(Config) when list(Config) -&gt;
 2084:    ?line [] = lists:sublist([], 1, 0),
 2085:    ?line [] = lists:sublist([], 1, 1),
 2086:    ?line [] = lists:sublist([a], 1, 0),
 2087:    ?line [a] = lists:sublist([a], 1, 1),
 2088:    ?line [a] = lists:sublist([a], 1, 2),
 2089:    ?line [a] = lists:sublist([a|b], 1, 1),
<a name="2090"></a> 2090:
 2091:    ?line [] = lists:sublist([], 1, 0),
 2092:    ?line [] = lists:sublist([], 1, 1),
 2093:    ?line [] = lists:sublist([a], 1, 0),
 2094:    ?line [a] = lists:sublist([a], 1, 1),
 2095:    ?line [a] = lists:sublist([a], 1, 2),
 2096:    ?line [] = lists:sublist([a], 2, 1),
 2097:    ?line [] = lists:sublist([a], 2, 2),
 2098:    ?line [] = lists:sublist([a], 2, 79),
 2099:    ?line [] = lists:sublist([a,b|c], 1, 0),
<a name="2100"></a> 2100:    ?line [] = lists:sublist([a,b|c], 2, 0),
 2101:    ?line [a] = lists:sublist([a,b|c], 1, 1),
 2102:    ?line [b] = lists:sublist([a,b|c], 2, 1),
 2103:    ?line [a,b] = lists:sublist([a,b|c], 1, 2),
 2104:
 2105:    ?line [] = lists:sublist([a], 2, 0),
 2106:
 2107:    ok.
 2108:
<a name=sublist_3_e> 2109:<b>sublist_3_e</b></a>(doc) -&gt;   ["sublist/3 error cases"];
<a name=sublist_3_e><a name="2110"></a> 2110:<b>sublist_3_e</b></a>(suite) -&gt; [];
<a name=sublist_3_e> 2111:<b>sublist_3_e</b></a>(Config) when list(Config) -&gt;
 2112:    ?sublist_error3([], 1, -1),
 2113:    ?sublist_error3(a, 1, -1),
 2114:    ?sublist_error3(a, 1, 0),
 2115:    ?sublist_error3([a|b], 1, 2),
 2116:    ?sublist_error3([a], 1, x),
 2117:    ?sublist_error3([a], 1, 1.5),
 2118:    ?sublist_error3([], 1, x),
 2119:    ?sublist_error3([], 1, 1.5),
<a name="2120"></a> 2120:
 2121:    ?sublist_error3([], -1, 0),
 2122:    ?sublist_error3(a, x, -1),
 2123:    ?sublist_error3([a,b], 0.5, 1),
 2124:    ?sublist_error3([a,b], 1.5, 1),
 2125:    ?sublist_error3([a], 1, x),
 2126:    ?sublist_error3([a], 1, 1.5),
 2127:    ?sublist_error3([], 1, x),
 2128:    ?sublist_error3([], 1, 1.5),
 2129:
<a name="2130"></a> 2130:    ?sublist_error3([a], 0, -1),
 2131:    ?sublist_error3([a], 1, -1),
 2132:    ?sublist_error3([a], 2, -1),
 2133:    ?sublist_error3([a], 0, 0),
 2134:    ?sublist_error3([a], 0, 1),
 2135:
 2136:    ?sublist_error3([a,b|c], 2, 2),
 2137:    ?sublist_error3([a,b|c], 3, 0),
 2138:    ?sublist_error3([a,b|c], 3, 1),
 2139:    ok.
<a name="2140"></a> 2140:
 2141:<i>%%%------------------------------------------------------------</i>
 2142:
<a name=flatten> 2143:<b>flatten</b></a>(doc) -&gt;
 2144:    ["Tests lists:flatten/[1,2]"];
<a name=flatten> 2145:<b>flatten</b></a>(suite) -&gt;
 2146:    [flatten_1, flatten_2, flatten_1_e, flatten_2_e].
 2147:
 2148:-<b>define</b>(flatten_error1(X), ?line {'EXIT', _} = (catch lists:flatten(X))).
 2149:-<b>define</b>(flatten_error2(X,Y), ?line {'EXIT', _} = (catch lists:flatten(X,Y))).
<a name="2150"></a> 2150:
<a name=flatten_1> 2151:<b>flatten_1</b></a>(doc) -&gt;   ["flatten/1"];
<a name=flatten_1> 2152:<b>flatten_1</b></a>(suite) -&gt; [];
<a name=flatten_1> 2153:<b>flatten_1</b></a>(Config) when list(Config) -&gt;
 2154:    ?line [] = lists:flatten([]),
 2155:    ?line [1,2] = lists:flatten([1,2]),
 2156:    ?line [1,2] = lists:flatten([1,[2]]),
 2157:    ?line [1,2] = lists:flatten([[1],2]),
 2158:    ?line [1,2] = lists:flatten([[1],[2]]),
 2159:    ?line [1,2] = lists:flatten([[1,2]]),
<a name="2160"></a> 2160:    ?line [a,b,c,d] = lists:flatten([[a],[b,c,[d]]]),
 2161:
 2162:    ok.
 2163:
<a name=flatten_1_e> 2164:<b>flatten_1_e</b></a>(doc) -&gt;   ["flatten/1 error cases"];
<a name=flatten_1_e> 2165:<b>flatten_1_e</b></a>(suite) -&gt; [];
<a name=flatten_1_e> 2166:<b>flatten_1_e</b></a>(Config) when list(Config) -&gt;
 2167:    ?flatten_error1(a),
 2168:    ?flatten_error1([a|b]),
 2169:    ?flatten_error1([[a],[b|c],[d]]),
<a name="2170"></a> 2170:    ok.
 2171:
 2172:<i>%%% [arndt] What if second arg isn't a proper list? This issue isn't</i>
 2173:<i>%%% clear-cut. Right now, I think that any term should be allowed.</i>
 2174:<i>%%% But I also wish this function didn't exist at all.</i>
 2175:
<a name=flatten_2> 2176:<b>flatten_2</b></a>(doc) -&gt;   ["flatten/2"];
<a name=flatten_2> 2177:<b>flatten_2</b></a>(suite) -&gt; [];
<a name=flatten_2> 2178:<b>flatten_2</b></a>(Config) when list(Config) -&gt;
 2179:    ?line [] = lists:flatten([]),
<a name="2180"></a> 2180:    ?line [a] = lists:flatten([a]),
 2181:    ok.
 2182:
<a name=flatten_2_e> 2183:<b>flatten_2_e</b></a>(doc) -&gt;   ["flatten/2 error cases"];
<a name=flatten_2_e> 2184:<b>flatten_2_e</b></a>(suite) -&gt; [];
<a name=flatten_2_e> 2185:<b>flatten_2_e</b></a>(Config) when list(Config) -&gt;
 2186:    ok.
</pre>
<hr size=1><i>The transformation of this file (2187 lines) took 0.10 seconds</i><br>
</body>
</html>
