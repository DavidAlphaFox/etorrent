<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/id_transform_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:-<b>module</b>(id_transform_SUITE).
    2:-<b>author</b>('pan@erix.ericsson.se').
    3:
    4:-<b>include_lib</b>("kernel/include/file.hrl").
    5:          
    6:-<b>compile</b>(export_all).
    7:
    8:<i>% Serves as test...</i>
    9:-<b>hej</b>(hopp).
<a name="10"></a>   10:-<b>include</b>("test_server.hrl").
   11:
<a name=all>   12:<b>all</b></a>(suite) -&gt; [id_transform].
   13:
<a name=id_transform>   14:<b>id_transform</b></a>(doc) -&gt; "Test erl_id_trans.";
<a name=id_transform>   15:<b>id_transform</b></a>(Config) when list(Config) -&gt;
   16:    ?line File=filename:join([code:lib_dir(stdlib),"examples",
   17:			      "erl_id_trans.erl"]),
   18:    ?line {ok,erl_id_trans,Bin}=compile:file(File,[binary]),
   19:    ?line {module,erl_id_trans}=code:load_binary(erl_id_trans,File,Bin),
<a name="20"></a>   20:    ?line run_in_test_suite().
   21:
<a name=run_in_test_suite>   22:<b>run_in_test_suite</b></a>() -&gt;
   23:    LibDir = code:lib_dir(),
   24:    SuperDir = 
   25:	filename:dirname(filename:dirname(code:which(?MODULE))),
   26:    TestDirs = filelib:wildcard(filename:join([SuperDir,"*_test"])),
   27:    {All, Res} = case LibDir of
   28:		     "/clearcase/otp/erts/lib" -&gt;
   29:			 %% Only test_suites cause clearcase is to slow...
<a name="30"></a>   30:			 {false, run_list(TestDirs,false)};
   31:		     _ -&gt;
   32:			 {true, run_codepath_and(TestDirs)}
   33:		 end,
   34:    Comment0 = case All of
   35:		   true -&gt;
   36:		       [];
   37:		   false -&gt;
   38:		       "Only testsuite directories traversed, "
   39:	       end,
<a name="40"></a>   40:    io:format("Result:~n~p~n", [Res]),
   41:    case Res of
   42:	{error, Reason} -&gt;
   43:	    {failed, Comment0 ++ lists:flatten(io_lib:format("~w",[Reason]))};
   44:	{ok, RL0} -&gt;
   45:	    RL = lists:map(fun({Key,Value}) when is_list(Value) -&gt;
   46:				   {Key,length(Value)};
   47:			      (Other) -&gt;
   48:				   Other
   49:			   end,
<a name="50"></a>   50:			   RL0),
   51:	    {comment,  Comment0 ++ lists:flatten(io_lib:format("~w",[RL]))}
   52:    end.
   53:
<a name=run>   54:<b>run</b></a>(Path) -&gt;
   55:    run_list([Path],true).
   56:
<a name=run_codepath>   57:<b>run_codepath</b></a>() -&gt;
   58:    run_codepath_and([]).
   59:
<a name=run_codepath_and><a name="60"></a>   60:<b>run_codepath_and</b></a>(DirList) -&gt;
   61:    ParentDirs = [filename:dirname(filename:absname(X)) || 
   62:		     X &lt;- code:get_path()],
   63:    LibDir = code:lib_dir(),
   64:    run_list([X || X &lt;- ParentDirs, lists:prefix(X,LibDir) =:= false] ++ 
   65:	     DirList,true).
   66:		    
   67:
<a name=run_list>   68:<b>run_list</b></a>(PathL,LibDirIncludes) -&gt;
   69:    io:format("Searching for header files...~n",[]),
<a name="70"></a>   70:    IP = build_ip(PathL,LibDirIncludes),
   71:    io:format("...done~n",[]),
   72:    io:format("Searching for erlang files ...~n",[]),
   73:    Erls = collect_erls(PathL,[]),
   74:    io:format("...done~n",[]),
   75:    io:format("Applying erl_id_trans to found erlang files...~n",[]),
   76:    Res = [do_trans(X,IP) || X &lt;- Erls],
   77:    io:format("...done~n",[]),
   78:    Successes = [X || {ok,X} &lt;- Res],
   79:    LintFailures = [{F,E} || {failed,{F,{lint,E}}} &lt;- Res],
<a name="80"></a>   80:    MnemosyneFailures = [F || {failed,{F,{mnemosyne,_E}}} &lt;- Res],
   81:    ParseFailures = [F || {failed,{F,{parse,_}}} &lt;- Res],
   82:    SevereFailures = [{F,E} || {failed,{F,{transform,E}}} &lt;- Res],
   83:    Stat = [{total_processed,length(Res)}, {success, length(Successes)},
   84:	    {lint_failures, LintFailures},{parse_failures, ParseFailures},
   85:	    {mnemosyne_failures, MnemosyneFailures}],
   86:    case length(SevereFailures) of
   87:	0 -&gt;
   88:	    {ok,Stat};
   89:	_Else -&gt;
<a name="90"></a>   90:	    {error, Stat ++ [{parse_transform_failed, SevereFailures}]}
   91:    end.
   92:    
   93:
<a name=collect_erls>   94:<b>collect_erls</b></a>([],Accu) -&gt;
   95:    Accu;
<a name=collect_erls>   96:<b>collect_erls</b></a>([Path0 | PathT],Accu) -&gt;
   97:    Path = filename:join([X || X &lt;- filename:split(filename:absname(Path0)), 
   98:			       X =/= "."]),    
   99:    io:format("...in ~s~n",[Path]),
<a name="100"></a>  100:    Erls = find_files(Path,".erl"),
  101:    collect_erls(PathT,Erls ++ Accu).
  102:		     
  103:
<a name=build_ip>  104:<b>build_ip</b></a>(PathList,LibDirIncludes) -&gt;
  105:    LibDir0 = code:lib_dir(),
  106:    {LibDir,Headers} = if
  107:			   LibDirIncludes -&gt;
  108:			       io:format("...in ~p~n",[LibDir0]),
  109:			       {LibDir0,find_files(LibDir0,".hrl")};
<a name="110"></a>  110:			   true -&gt;
  111:			       {false,[]}
  112:		       end,
  113:    DDirs = [filename:dirname(X) || X &lt;- Headers],
  114:    MoreDirs = build_ip(PathList,[],LibDir),
  115:    lists:usort(DDirs ++ MoreDirs).
  116:
<a name=build_ip>  117:<b>build_ip</b></a>([],Accu,_LibDir) -&gt;
  118:    Accu;
<a name=build_ip>  119:<b>build_ip</b></a>([Path0|PathT],Accu,LibDir) -&gt;
<a name="120"></a>  120:    Path = filename:join([X || X &lt;- filename:split(filename:absname(Path0)), 
  121:			     X =/= "."]),
  122:
  123:    case lists:prefix(LibDir,Path) of
  124:	true -&gt;
  125:	    build_ip(PathT,Accu,LibDir);
  126:	false -&gt;
  127:	    io:format("...in ~p~n",[Path]),
  128:	    Headers = find_files(Path,".hrl"),
  129:	    DDirs = [filename:dirname(X) || X &lt;- Headers],
<a name="130"></a>  130:	    NAccu = lists:usort(DDirs) ++ Accu,
  131:	    build_ip(PathT,NAccu,LibDir)
  132:    end.
  133:    
  134:
  135:
  136:<i>% 	    filename:join([Dir,"..","..","kernel","include"]),</i>
  137:<i>% 	    filename:join([Dir,"..","..","stdlib","include"]),</i>
  138:<i>% 	    filename:join([Dir,"..","..","test_server","include"]),</i>
  139:<i>% 	    filename:join([Dir,"..","..","hipe","main"]) | IncludePath],</i>
<a name="140"></a>  140:
<a name=do_trans>  141:<b>do_trans</b></a>(File,IncludePath) -&gt;
  142:    % Heuristic includePath...
  143:    Dir = filename:dirname(File),
  144:    Inc0 = [Dir, 
  145:	    filename:join([Dir,"..","include"]),
  146:	    filename:join([Dir,"..","..","..","src"]),
  147:	    filename:join([Dir,"..","test_server"]),
  148: 	    filename:join([Dir,"..","..","test_server","include"]),
  149:	    filename:join([code:lib_dir(kernel),"include"]),
<a name="150"></a>  150:	    filename:join([code:lib_dir(stdlib),"include"])
  151:	    | IncludePath],
  152:    Inc = case code:lib_dir(hipe) of
  153:	      {error,_} -&gt;
  154:		  Inc0;
  155:	      HipeDir -&gt;
  156:		  Inc0 ++ [filename:join([HipeDir,"main"])]
  157:	  end,
  158:    % Defines to make various OTP applications checkable
  159:    Defs = [{erlang_daemon_port,0},{epmd_dist_high,0}, {epmd_dist_low,0},
<a name="160"></a>  160:	    {inets_priv_dir,"."},{inets_data_dir,"."},
  161:	    {'COMPILER_VSN',"0.0"},
  162:	    {'TIPC_DIST_SERVER',"x"}, {'TIPC_DIST_RESOLVER',"y"},
  163:	    {'TIPC_EPMD',"z"},{'APP',"tipc"},{'VSN',"0.0"},
  164:	    {'TIPC_SERVER', "a"}, 
  165:	    {'DSN', "0.0"},{'UID',0},{'PWD',"."},
  166:	    {'ConnectStr', "x"},%{vsn,"0.0"}, breaks to much code
  167:	    {'ORBVSN',"0.0"}],
  168:    case (catch epp:parse_file(File,Inc,Defs)) of
  169:	{ok, Tree0} -&gt;
<a name="170"></a>  170:	    case mnemosyne_lc:parse_transform(Tree0,[]) of
  171:		Tree when list(Tree) -&gt;
  172:		    case erl_lint:module(Tree) of
  173:			{ok,_} -&gt;
  174:			    case (catch erl_id_trans:parse_transform(Tree0, 
  175:								     [])) of
  176:				Tree2 when list(Tree2) -&gt;
  177:				    {ok, File};
  178:				{'EXIT', Reason} -&gt;
  179:				    {failed, {File, 
<a name="180"></a>  180:					      {transform,{crash, Reason}}}};
  181:				Else -&gt;
  182:				    {failed, {File, 
  183:					      {transform,{unknown, Else}}}}
  184:			    end;
  185:			
  186:			Else0 -&gt;
  187:			    {failed, {File, {lint, Else0}}}
  188:		    end;
  189:		MnemError -&gt;
<a name="190"></a>  190:		    {failed, {File, {mnemosyne,{unknown, MnemError}}}}
  191:	    end;
  192:	{'EXIT', Reason1} -&gt;
  193:	    {failed, {File, {parse,{crash, Reason1}}}};
  194:	{error, Reason2} -&gt;
  195:	    {failed, {File, {parse,{error, Reason2}}}};
  196:	Else1 -&gt;
  197:	    {failed, {File, {parse,{unknown, Else1}}}}
  198:    end.
  199:
<a name=find_files><a name="200"></a>  200:<b>find_files</b></a>(Path,Pattern) -&gt;
  201:    P2 = filename:join([X || X &lt;- filename:split(filename:absname(Path)), 
  202:			     X =/= "."]),
  203:    find_files(P2,Pattern,[]).
  204:
<a name=find_files>  205:<b>find_files</b></a>(Path,Pattern,Acc) -&gt;
  206:    case file:list_dir(Path) of
  207:	{ok, L} -&gt;
  208: 	    All = [filename:join(Path,X) || X &lt;- L], 
  209:	    Matching = [X || X &lt;- All, ends_with(X,Pattern)],
<a name="210"></a>  210:	    NewAcc1 = Matching ++ Acc,
  211:	    Dirs = [X || X &lt;- All, is_dir(X)],
  212:	    find_in_dirs(Dirs,Pattern,NewAcc1);
  213:	_ -&gt;
  214:	    Acc
  215:    end.
  216:	    
  217:
<a name=ends_with>  218:<b>ends_with</b></a>(Name,Pattern) -&gt;
  219:    LN = length(Name),
<a name="220"></a>  220:    LP = length(Pattern),
  221:    if 
  222:	LN &lt; LP -&gt;
  223:	    false;
  224:	true -&gt;
  225:	    Last = lists:sublist(Name,LN - LP + 1,LP),
  226:	    Pattern =:= Last
  227:    end.
  228:
<a name=is_dir>  229:<b>is_dir</b></a>(F) -&gt;
<a name="230"></a>  230:    case file:read_file_info(F) of
  231:	{ok,#file_info{type=directory}} -&gt;
  232:	    true;
  233:	_ -&gt;
  234:	    false
  235:    end.
  236:
<a name=find_in_dirs>  237:<b>find_in_dirs</b></a>([],_,Acc) -&gt;
  238:    Acc;
<a name=find_in_dirs>  239:<b>find_in_dirs</b></a>([Dir|T],Pattern,Acc) -&gt;
<a name="240"></a>  240:    NAcc = find_files(Dir,Pattern,Acc),
  241:    find_in_dirs(T,Pattern,NAcc).
  242:
  243:
  244:
  245:<i>% From here on there's only fake code to serve as test cases </i>
  246:<i>% for the id_transform.</i>
  247:<i>% They need to be exported.</i>
  248:
<a name=check>  249:<b>check</b></a>(X,_Y) when X -&gt;   
<a name="250"></a>  250:    true;
<a name=check>  251:<b>check</b></a>(A,_) when atom(A) -&gt;
  252:    atom;
<a name=check>  253:<b>check</b></a>(A,_) when erlang:is_list(A) -&gt;
  254:    list;
<a name=check>  255:<b>check</b></a>(A,B) when erlang:'+'(A,B) -&gt;
  256:    atom;
<a name=check>  257:<b>check</b></a>(_,_) -&gt;
  258:    false.
  259:
<a name=check2><a name="260"></a>  260:<b>check2</b></a>(A) -&gt;
  261:    case A of
  262:	"hej" ++ "hopp" -&gt;
  263:	    a;
  264:	[$h,$e,$j] ++ "hopp" -&gt;
  265:	    a;
  266:	[1] ++ [2] -&gt;
  267:	    b
  268:    end.
  269:
<a name="270"></a>  270:-<b>record</b>(x,{x,y}).
  271:-<b>record</b>(y,{x=1,y=0}).
  272:
<a name=g>  273:<b>g</b></a>() -&gt;
  274:    #y.y.
  275:
<a name=f>  276:<b>f</b></a>(#y.y) -&gt;
  277:    vansinne;
  278:
<a name=f>  279:<b>f</b></a>(X) when X =:= #y.y -&gt;
<a name="280"></a>  280:    {#y.y,_Y} = {X,hej};
<a name=f>  281:<b>f</b></a>(X) -&gt;
  282:    if X#x.y -&gt;
  283:	    ok;
  284:       element(3,X) -&gt;
  285:	    banan;
  286:       true -&gt;
  287:	    nok
  288:    end;
  289:
<a name=f><a name="290"></a>  290:<b>f</b></a>(#x{_='_'}) -&gt;
  291:    hopp;
<a name=f>  292:<b>f</b></a>(#x{x=true,y=true}) -&gt;
  293:    babba;
<a name=f>  294:<b>f</b></a>(A) when A == #x{x=true,y=true} -&gt;
  295:    true;
<a name=f>  296:<b>f</b></a>(A) when A#x.x == 4 -&gt;
  297:    #x{x = 1, _ = 2}.
  298:
  299:<i>% Stolen from erl_lint_SUITE.erl</i>
<a name="300"></a>  300:-<b>record</b>(apa, {}).
  301:
<a name=t>  302:<b>t</b></a>(A) when atom(A) -&gt;
  303:    atom;
<a name=t>  304:<b>t</b></a>(A) when binary(A) -&gt;
  305:    binary;
<a name=t>  306:<b>t</b></a>(A) when constant(A) -&gt;
  307:    constant;
<a name=t>  308:<b>t</b></a>(A) when float(A) -&gt;
  309:    float;
<a name=t><a name="310"></a>  310:<b>t</b></a>(A) when function(A) -&gt;
  311:    function;
<a name=t>  312:<b>t</b></a>(A) when integer(A) -&gt;
  313:    integer;
<a name=t>  314:<b>t</b></a>(A) when is_atom(A) -&gt;
  315:    is_atom;
<a name=t>  316:<b>t</b></a>(A) when is_binary(A) -&gt;
  317:    is_binary;
<a name=t>  318:<b>t</b></a>(A) when is_constant(A) -&gt;
  319:    is_constant;
<a name=t><a name="320"></a>  320:<b>t</b></a>(A) when is_float(A) -&gt;
  321:    is_float;
<a name=t>  322:<b>t</b></a>(A) when is_function(A) -&gt;
  323:    is_function;
<a name=t>  324:<b>t</b></a>(A) when is_integer(A) -&gt;
  325:    is_integer;
<a name=t>  326:<b>t</b></a>(A) when is_list(A) -&gt;
  327:    is_list;
<a name=t>  328:<b>t</b></a>(A) when is_number(A) -&gt;
  329:    is_number;
<a name=t><a name="330"></a>  330:<b>t</b></a>(A) when is_pid(A) -&gt;
  331:    is_pid;
<a name=t>  332:<b>t</b></a>(A) when is_port(A) -&gt;
  333:    is_port;
<a name=t>  334:<b>t</b></a>(A) when is_record(A, apa) -&gt;
  335:    is_record;
<a name=t>  336:<b>t</b></a>(A) when is_reference(A) -&gt;
  337:    is_reference;
<a name=t>  338:<b>t</b></a>(A) when is_tuple(A) -&gt;
  339:    is_tuple;
<a name=t><a name="340"></a>  340:<b>t</b></a>(A) when list(A) -&gt;
  341:    list;
<a name=t>  342:<b>t</b></a>(A) when number(A) -&gt;
  343:    number;
<a name=t>  344:<b>t</b></a>(A) when pid(A) -&gt;
  345:    pid;
<a name=t>  346:<b>t</b></a>(A) when port(A) -&gt;
  347:    port;
<a name=t>  348:<b>t</b></a>(A) when record(A, apa) -&gt;
  349:    record;
<a name=t><a name="350"></a>  350:<b>t</b></a>(A) when reference(A) -&gt;
  351:    reference;
<a name=t>  352:<b>t</b></a>(A) when tuple(A) -&gt;
  353:    tuple.
  354:
<a name=t1>  355:<b>t1</b></a>(A) when atom(A), atom(A) -&gt;
  356:    atom;
<a name=t1>  357:<b>t1</b></a>(A) when binary(A), binary(A) -&gt;
  358:    binary;
<a name=t1>  359:<b>t1</b></a>(A) when constant(A), constant(A) -&gt;
<a name="360"></a>  360:    constant;
<a name=t1>  361:<b>t1</b></a>(A) when float(A), float(A) -&gt;
  362:    float;
<a name=t1>  363:<b>t1</b></a>(A) when function(A), function(A) -&gt;
  364:    function;
<a name=t1>  365:<b>t1</b></a>(A) when integer(A), integer(A) -&gt;
  366:    integer;
<a name=t1>  367:<b>t1</b></a>(A) when is_atom(A), is_atom(A) -&gt;
  368:    is_atom;
<a name=t1>  369:<b>t1</b></a>(A) when is_binary(A), is_binary(A) -&gt;
<a name="370"></a>  370:    is_binary;
<a name=t1>  371:<b>t1</b></a>(A) when is_constant(A), is_constant(A) -&gt;
  372:    is_constant;
<a name=t1>  373:<b>t1</b></a>(A) when is_float(A), is_float(A) -&gt;
  374:    is_float;
<a name=t1>  375:<b>t1</b></a>(A) when is_function(A), is_function(A) -&gt;
  376:    is_function;
<a name=t1>  377:<b>t1</b></a>(A) when is_integer(A), is_integer(A) -&gt;
  378:    is_integer;
<a name=t1>  379:<b>t1</b></a>(A) when is_list(A), is_list(A) -&gt;
<a name="380"></a>  380:    is_list;
<a name=t1>  381:<b>t1</b></a>(A) when is_number(A), is_number(A) -&gt;
  382:    is_number;
<a name=t1>  383:<b>t1</b></a>(A) when is_pid(A), is_pid(A) -&gt;
  384:    is_pid;
<a name=t1>  385:<b>t1</b></a>(A) when is_port(A), is_port(A) -&gt;
  386:    is_port;
<a name=t1>  387:<b>t1</b></a>(A) when is_record(A, apa), is_record(A, apa) -&gt;
  388:    is_record;
<a name=t1>  389:<b>t1</b></a>(A) when is_reference(A), is_reference(A) -&gt;
<a name="390"></a>  390:    is_reference;
<a name=t1>  391:<b>t1</b></a>(A) when is_tuple(A), is_tuple(A) -&gt;
  392:    is_tuple;
<a name=t1>  393:<b>t1</b></a>(A) when list(A), list(A) -&gt;
  394:    list;
<a name=t1>  395:<b>t1</b></a>(A) when number(A), number(A) -&gt;
  396:    number;
<a name=t1>  397:<b>t1</b></a>(A) when pid(A), pid(A) -&gt;
  398:    pid;
<a name=t1>  399:<b>t1</b></a>(A) when port(A), port(A) -&gt;
<a name="400"></a>  400:    port;
<a name=t1>  401:<b>t1</b></a>(A) when record(A, apa), record(A, apa) -&gt;
  402:    record;
<a name=t1>  403:<b>t1</b></a>(A) when reference(A), reference(A) -&gt;
  404:    reference;
<a name=t1>  405:<b>t1</b></a>(A) when tuple(A), tuple(A) -&gt;
  406:    tuple.
  407:
<a name=t2>  408:<b>t2</b></a>(A) when atom(A); atom(A) -&gt;
  409:    atom;
<a name=t2><a name="410"></a>  410:<b>t2</b></a>(A) when binary(A); binary(A) -&gt;
  411:    binary;
<a name=t2>  412:<b>t2</b></a>(A) when constant(A); constant(A) -&gt;
  413:    constant;
<a name=t2>  414:<b>t2</b></a>(A) when float(A); float(A) -&gt;
  415:    float;
<a name=t2>  416:<b>t2</b></a>(A) when function(A); function(A) -&gt;
  417:    function;
<a name=t2>  418:<b>t2</b></a>(A) when integer(A); integer(A) -&gt;
  419:    integer;
<a name=t2><a name="420"></a>  420:<b>t2</b></a>(A) when is_atom(A); is_atom(A) -&gt;
  421:    is_atom;
<a name=t2>  422:<b>t2</b></a>(A) when is_binary(A); is_binary(A) -&gt;
  423:    is_binary;
<a name=t2>  424:<b>t2</b></a>(A) when is_constant(A); is_constant(A) -&gt;
  425:    is_constant;
<a name=t2>  426:<b>t2</b></a>(A) when is_float(A); is_float(A) -&gt;
  427:    is_float;
<a name=t2>  428:<b>t2</b></a>(A) when is_function(A); is_function(A) -&gt;
  429:    is_function;
<a name=t2><a name="430"></a>  430:<b>t2</b></a>(A) when is_integer(A); is_integer(A) -&gt;
  431:    is_integer;
<a name=t2>  432:<b>t2</b></a>(A) when is_list(A); is_list(A) -&gt;
  433:    is_list;
<a name=t2>  434:<b>t2</b></a>(A) when is_number(A); is_number(A) -&gt;
  435:    is_number;
<a name=t2>  436:<b>t2</b></a>(A) when is_pid(A); is_pid(A) -&gt;
  437:    is_pid;
<a name=t2>  438:<b>t2</b></a>(A) when is_port(A); is_port(A) -&gt;
  439:    is_port;
<a name=t2><a name="440"></a>  440:<b>t2</b></a>(A) when is_record(A, apa); is_record(A, apa) -&gt;
  441:    is_record;
<a name=t2>  442:<b>t2</b></a>(A) when is_reference(A); is_reference(A) -&gt;
  443:    is_reference;
<a name=t2>  444:<b>t2</b></a>(A) when is_tuple(A); is_tuple(A) -&gt;
  445:    is_tuple;
<a name=t2>  446:<b>t2</b></a>(A) when list(A); list(A) -&gt;
  447:    list;
<a name=t2>  448:<b>t2</b></a>(A) when number(A); number(A) -&gt;
  449:    number;
<a name=t2><a name="450"></a>  450:<b>t2</b></a>(A) when pid(A); pid(A) -&gt;
  451:    pid;
<a name=t2>  452:<b>t2</b></a>(A) when port(A); port(A) -&gt;
  453:    port;
<a name=t2>  454:<b>t2</b></a>(A) when record(A, apa); record(A, apa) -&gt;
  455:    record;
<a name=t2>  456:<b>t2</b></a>(A) when reference(A); reference(A) -&gt;
  457:    reference;
<a name=t2>  458:<b>t2</b></a>(A) when tuple(A); tuple(A) -&gt;
  459:    tuple.
<a name="460"></a>  460:
<a name=t3>  461:<b>t3</b></a>(A) when is_atom(A) or is_atom(A) -&gt;
  462:    is_atom;
<a name=t3>  463:<b>t3</b></a>(A) when is_binary(A) or is_binary(A) -&gt;
  464:    is_binary;
<a name=t3>  465:<b>t3</b></a>(A) when is_constant(A) or is_constant(A) -&gt;
  466:    is_constant;
<a name=t3>  467:<b>t3</b></a>(A) when is_float(A) or is_float(A) -&gt;
  468:    is_float;
<a name=t3>  469:<b>t3</b></a>(A) when is_function(A) or is_function(A) -&gt;
<a name="470"></a>  470:    is_function;
<a name=t3>  471:<b>t3</b></a>(A) when is_integer(A) or is_integer(A) -&gt;
  472:    is_integer;
<a name=t3>  473:<b>t3</b></a>(A) when is_list(A) or is_list(A) -&gt;
  474:    is_list;
<a name=t3>  475:<b>t3</b></a>(A) when is_number(A) or is_number(A) -&gt;
  476:    is_number;
<a name=t3>  477:<b>t3</b></a>(A) when is_pid(A) or is_pid(A) -&gt;
  478:    is_pid;
<a name=t3>  479:<b>t3</b></a>(A) when is_port(A) or is_port(A) -&gt;
<a name="480"></a>  480:    is_port;
<a name=t3>  481:<b>t3</b></a>(A) when is_record(A, apa) or is_record(A, apa) -&gt;
  482:   is_record;
<a name=t3>  483:<b>t3</b></a>(A) when is_reference(A) or is_reference(A) -&gt;
  484:   is_reference;
<a name=t3>  485:<b>t3</b></a>(A) when is_tuple(A) or is_tuple(A) -&gt;
  486:   is_tuple; 
<a name=t3>  487:<b>t3</b></a>(A) when record(A, apa) -&gt;
  488:   foo;
  489:<i>% Compiler crash </i>
<a name="490"></a>  490:<i>%t3(A) when {erlang,is_record}(A, apa) -&gt;</i>
  491:<i>%   foo;</i>
<a name=t3>  492:<b>t3</b></a>(A) when erlang:is_record(A, apa) -&gt;
  493:   foo;
<a name=t3>  494:<b>t3</b></a>(A) when is_record(A, apa) -&gt;
  495:   foo;
<a name=t3>  496:<b>t3</b></a>(A) when record({apa}, apa) -&gt;
  497:   {A,foo};
  498:<i>% Compiler crash </i>
  499:<i>%t3(A) when {erlang,is_record}({apa}, apa) -&gt;</i>
<a name="500"></a>  500:<i>%   foo;</i>
<a name=t3>  501:<b>t3</b></a>(A) when erlang:is_record({apa}, apa) -&gt;
  502:   {A,foo};
<a name=t3>  503:<b>t3</b></a>(A) when is_record({apa}, apa) -&gt;
  504:   {A,foo}.
  505:
  506:-<b>record</b>(apa2,{a=a,b=foo:bar()}).
<a name=apa>  507:<b>apa</b></a>() -&gt;
  508:    [X || X &lt;- [], #apa2{a = a} == {r,X,foo}];
<a name=apa>  509:<b>apa</b></a>() -&gt;
<a name="510"></a>  510:    [X || X &lt;- [], #apa2{b = b} == {r,X,foo}];
<a name=apa>  511:<b>apa</b></a>() -&gt;
  512:    [X || X &lt;- [], 3 == X#apa2.a].
  513:
  514:
  515:
  516:
  517:
  518:
</pre>
<hr size=1><i>The transformation of this file (519 lines) took 0.01 seconds</i><br>
</body>
</html>
