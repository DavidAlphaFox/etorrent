<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/queue_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:-<b>module</b>(queue_SUITE).
   19:-<b>export</b>([all/1]).
<a name="20"></a>   20:
   21:-<b>export</b>([do/1, to_list/1, io_test/1, op_test/1, error/1]).
   22:
   23:-<b>export</b>([init_per_testcase/2, fin_per_testcase/2]).
   24:
   25:-<b>include</b>("test_server.hrl").
   26:
   27:<i>% Default timetrap timeout (set in init_per_testcase).</i>
   28:-<b>define</b>(default_timeout, ?t:minutes(1)).
   29:
<a name=init_per_testcase><a name="30"></a>   30:<b>init_per_testcase</b></a>(Case, Config) -&gt;
   31:    ?line Dog = ?t:timetrap(?default_timeout),
   32:    [{watchdog, Dog} | Config].
<a name=fin_per_testcase>   33:<b>fin_per_testcase</b></a>(Case, Config) -&gt;
   34:    Dog = ?config(watchdog, Config),
   35:    test_server:timetrap_cancel(Dog),
   36:    ok.
   37:
<a name=all>   38:<b>all</b></a>(doc) -&gt;
   39:    ["Test cases for queue."];
<a name=all><a name="40"></a>   40:<b>all</b></a>(suite) -&gt;
   41:    [do, to_list, io_test, op_test, error].
   42:
<a name=do>   43:<b>do</b></a>(doc) -&gt;
   44:    [""];
<a name=do>   45:<b>do</b></a>(suite) -&gt;
   46:    [];
<a name=do>   47:<b>do</b></a>(Config) when list(Config) -&gt;
   48:    ?line E = queue:new(),
   49:    ?line [] = queue:to_list(E),
<a name="50"></a>   50:
   51:    ?line do_queue(E,
   52:		   [{in, 1},
   53:		    {in, 2},
   54:		    {out, {value, 1}},
   55:		    {in, 3},
   56:		    {out, {value, 2}},
   57:		    {out, {value, 3}},
   58:		    {out, empty}
   59:		   ]),
<a name="60"></a>   60:    ok.
   61:
<a name=to_list>   62:<b>to_list</b></a>(doc) -&gt;
   63:    ["OTP-2701"];
<a name=to_list>   64:<b>to_list</b></a>(suite) -&gt;
   65:    [];
<a name=to_list>   66:<b>to_list</b></a>(Config) when list(Config) -&gt;
   67:    ?line E = queue:new(),
   68:    ?line Q = do_queue(E, [{in, 1},
   69:			   {in, 2},
<a name="70"></a>   70:			   {in, 3},
   71:			   {out, {value, 1}},
   72:			   {in, 4},
   73:			   {in, 5}]),
   74:    ?line case queue:to_list(Q) of
   75:	      [2,3,4,5] -&gt;
   76:		  ok;
   77:	      Other -&gt;
   78:		  test_server:fail(Other)
   79:	  end,
<a name="80"></a>   80:
   81:    ok.
   82:
<a name=do_queue>   83:<b>do_queue</b></a>(Q, []) -&gt;
   84:    Q;
<a name=do_queue>   85:<b>do_queue</b></a>(Q, [E | Rest]) -&gt;
   86:    do_queue(do_queue_1(E, Q), Rest).
   87:
<a name=do_queue_1>   88:<b>do_queue_1</b></a>({in, E}, Q) -&gt;
   89:    queue:in(E, Q);
<a name=do_queue_1><a name="90"></a>   90:<b>do_queue_1</b></a>({out, E}, Q) -&gt;
   91:    case queue:out(Q) of
   92:	{E, Q1} -&gt;
   93:	    Q1;
   94:	Other -&gt;
   95:	    test_server:fail({"out failed", E, Q, Other})
   96:    end.
   97:
   98:
<a name=io_test>   99:<b>io_test</b></a>(doc) -&gt;
<a name="100"></a>  100:    "Test input and output";
<a name=io_test>  101:<b>io_test</b></a>(suite) -&gt;
  102:    [];
<a name=io_test>  103:<b>io_test</b></a>(Config) when list(Config) -&gt;
  104:    ?line [4,3,5] = 
  105:	io([snoc,snoc,head,head,head,cons,cons,snoc], queue:new(), 1),
  106:    ?line [5,3,4] = 
  107:	io([cons,cons,daeh,daeh,daeh,snoc,snoc,cons], queue:new(), 1),
  108:    ?line [4,3,5] = 
  109:	io([in,in,out,out,out,in_r,in_r,in], queue:new(), 1),
<a name="110"></a>  110:    ?line [5,3,4] = 
  111:	io([in_r,in_r,out_r,out_r,out_r,in,in,in_r], queue:new(), 1),
  112:    %%
  113:    ?line [] = 
  114:	io([snoc,snoc,head,snoc,snoc,head,head,snoc,head,head], queue:new(), 1),
  115:    ?line [] = 
  116:	io([cons,cons,daeh,cons,cons,daeh,daeh,cons,daeh,daeh], queue:new(), 1),
  117:    ?line [] = 
  118:	io([in,in,out,in,in,out,out,in,out,out], queue:new(), 1),
  119:    ?line [] = 
<a name="120"></a>  120:	io([in_r,in_r,out_r,in_r,in_r,out_r,out_r,in_r,out_r,out_r], 
  121:	   queue:new(), 1),
  122:    %%
  123:    ?line [5,6] = 
  124:	io([snoc,snoc,snoc,head,head,snoc,snoc,snoc,head,head], queue:new(), 1),
  125:    ?line [6,5] = 
  126:	io([cons,cons,cons,daeh,daeh,cons,cons,cons,daeh,daeh], queue:new(), 1),
  127:    ?line [5,6] = 
  128:	io([in,in,in,out,out,in,in,in,out,out], queue:new(), 1),
  129:    ?line [6,5] = 
<a name="130"></a>  130:	io([in_r,in_r,in_r,out_r,out_r,in_r,in_r,in_r,out_r,out_r], 
  131:	   queue:new(), 1),
  132:    %%
  133:    ?line [5] = 
  134:	io([snoc,head,head,snoc,head,snoc,head,snoc,head,snoc], queue:new(), 1),
  135:    ?line [5] = 
  136:	io([cons,daeh,daeh,cons,daeh,cons,daeh,cons,daeh,cons], queue:new(), 1),
  137:    ?line [5] = 
  138:	io([in,out,out,in,out,in,out,in,out,in], queue:new(), 1),
  139:    ?line [5] = 
<a name="140"></a>  140:	io([in_r,out_r,out_r,in_r,out_r,in_r,out_r,in_r,out_r,in_r], 
  141:	   queue:new(), 1),
  142:    %%
  143:    ?line [] =
  144:	io([snoc,head,snoc,snoc,head,head,snoc,snoc,snoc,head,head,head], 
  145:	   queue:new(), 1),
  146:    ?line [] =
  147:	io([cons,daeh,cons,cons,daeh,daeh,cons,cons,cons,daeh,daeh,daeh],
  148:	  queue:new(), 1),
  149:    ?line [] =
<a name="150"></a>  150:	io([in,out,in,in,out,out,in,in,in,out,out,out], 
  151:	   queue:new(), 1),
  152:    ?line [] =
  153:	io([in_r,out_r,in_r,in_r,out_r,out_r,in_r,in_r,in_r,out_r,out_r,out_r],
  154:	  queue:new(), 1),
  155:    %%
  156:    ?line [3] =	io([cons,cons,cons,snoc,daeh,daeh,daeh], queue:new(), 1),
  157:    ?line [3] =	io([snoc,snoc,snoc,cons,head,head,head], queue:new(), 1),
  158:    ?line [3] =	io([in,in,in,in_r,out,out,out], queue:new(), 1),
  159:    ?line [3] =	io([in_r,in_r,in_r,in,out_r,out_r,out_r], queue:new(), 1),
<a name="160"></a>  160:    %%
  161:    Q2 = queue:join(queue:cons(1, queue:new()),queue:cons(2, queue:new())),
  162:    Q1 = queue:reverse(Q2),
  163:    ?line [1] = io([head],  Q1, 3),
  164:    ?line [1] = io([out],   Q1, 3),
  165:    ?line [1] = io([daeh],  Q2, 3),
  166:    ?line [1] = io([out_r], Q2, 3),
  167:<i>%    ?line [2] =	io([cons,cons,snoc,daeh,daeh], [], 1),</i>
  168:<i>%    ?line [2] =	io([snoc,snoc,cons,head,head], [], 1),</i>
  169:<i>%    ?line [2] =	io([in,in,in_r,out,out], [], 1),</i>
<a name="170"></a>  170:<i>%    ?line [2] =	io([in_r,in_r,in,out_r,out_r], [], 1),</i>
  171:    %%
  172:    ok.
  173:
  174:<i>%% Perform a list of operations to a queue.</i>
  175:<i>%% Keep a reference queue on the side; just a list.</i>
  176:<i>%% Compare the read values between the queues.</i>
  177:<i>%% Return the resulting queue as a list.</i>
  178:<i>%% Inserted values are increments of the previously inserted.</i>
<a name=io>  179:<b>io</b></a>(Ops, Q, X) -&gt;
<a name="180"></a>  180:    io(Ops, Q, queue:to_list(Q), X).
  181:
<a name=io>  182:<b>io</b></a>([head | Tail], Q, [], X) -&gt;
  183:    true = queue:is_empty(Q),
  184:    {'EXIT',{empty,_}} = (catch {ok,queue:head(Q)}),
  185:    {'EXIT',{empty,_}} = (catch {ok,queue:tail(Q)}),
  186:    io(Tail, Q, [], X);
<a name=io>  187:<b>io</b></a>([head | Tail], Q, [H | T], X) -&gt;
  188:    H = queue:head(Q),
  189:    false = queue:is_empty(Q),
<a name="190"></a>  190:    io(Tail, queue:tail(Q), T, X);
<a name=io>  191:<b>io</b></a>([daeh | Tail], Q, [], X) -&gt;
  192:    true = queue:is_empty(Q),
  193:    {'EXIT',{empty,_}} = (catch {ok,queue:daeh(Q)}),
  194:    {'EXIT',{empty,_}} = (catch {ok,queue:lait(Q)}),
  195:    io(Tail, Q, [], X);
<a name=io>  196:<b>io</b></a>([daeh | Tail], Q, QQ, X) -&gt;
  197:    H = queue:daeh(Q),
  198:    false = queue:is_empty(Q),
  199:    [H | T] = lists:reverse(QQ),
<a name="200"></a>  200:    io(Tail, queue:lait(Q), lists:reverse(T), X);
<a name=io>  201:<b>io</b></a>([out | Tail], Q, [], X) -&gt;
  202:    {empty, Q1} = queue:out(Q),
  203:    io(Tail, Q1, [], X);
<a name=io>  204:<b>io</b></a>([out | Tail], Q, [H | T], X) -&gt;
  205:    {{value,H}, Q1} = queue:out(Q),
  206:    io(Tail, Q1, T, X);
<a name=io>  207:<b>io</b></a>([out_r | Tail], Q, [], X) -&gt;
  208:    {empty, Q1} = queue:out_r(Q),
  209:    io(Tail, Q1, [], X);
<a name=io><a name="210"></a>  210:<b>io</b></a>([out_r | Tail], Q, QQ, X) -&gt;
  211:    {{value,H}, Q1} = queue:out_r(Q),
  212:    [H | T] = lists:reverse(QQ),
  213:    io(Tail, Q1, lists:reverse(T), X);
<a name=io>  214:<b>io</b></a>([cons | Tail], Q, QQ, X) -&gt;
  215:    io(Tail, queue:cons(X,Q), [X|QQ], X+1);
<a name=io>  216:<b>io</b></a>([snoc | Tail], Q, QQ, X) -&gt;
  217:    io(Tail, queue:snoc(Q,X), QQ++[X], X+1);
<a name=io>  218:<b>io</b></a>([in_r | Tail], Q, QQ, X) -&gt;
  219:    io(Tail, queue:in_r(X,Q), [X|QQ], X+1);
<a name=io><a name="220"></a>  220:<b>io</b></a>([in | Tail], Q, QQ, X) -&gt;
  221:    io(Tail, queue:in(X,Q), QQ++[X], X+1);
<a name=io>  222:<b>io</b></a>([], Q, QQ, _X) -&gt;
  223:    QQ = queue:to_list(Q),
  224:    Length = length(QQ),
  225:    Length = queue:len(Q),
  226:    QQ.
  227:
  228:
<a name=op_test>  229:<b>op_test</b></a>(doc) -&gt;
<a name="230"></a>  230:    "Test operations on whole queues";
<a name=op_test>  231:<b>op_test</b></a>(suite) -&gt;
  232:    [];
<a name=op_test>  233:<b>op_test</b></a>(Config) when list(Config) -&gt;
  234:    ?line Len = 50,
  235:    ?line Len2 = 2*Len,
  236:    ?line L1 = lists:seq(1, Len),
  237:    ?line L1r = lists:reverse(L1),
  238:    ?line L2 = lists:seq(Len+1, Len2),
  239:    ?line L2r = lists:reverse(L2),
<a name="240"></a>  240:    ?line L3 = L1++L2,
  241:    ?line L3r = L2r++L1r,
  242:    ?line Q0 = queue:new(),
  243:    ?line [] = queue:to_list(Q0),
  244:    ?line Q0 = queue:from_list([]),
  245:    ?line Q1 = queue:from_list(L1),
  246:    ?line Q2 = queue:from_list(L2),
  247:    ?line Q3 = queue:from_list(L3),
  248:    ?line Len = queue:len(Q1),
  249:    ?line Len = queue:len(Q2),
<a name="250"></a>  250:    ?line Len2 = queue:len(Q3),
  251:    ?line L1 = queue:to_list(Q1),
  252:    ?line L2 = queue:to_list(Q2),
  253:    ?line L3 = queue:to_list(Q3),
  254:    ?line Q3b = queue:join(Q0, queue:join(queue:join(Q1, Q2), Q0)),
  255:    ?line L3 = queue:to_list(Q3b),
  256:    ?line {Q0, Q3} = queue:split(0, Q3),
  257:    ?line {Q3, Q0} = queue:split(Len2, Q3),
  258:    ?line {Q1a, Q2a} = queue:split(Len, Q3),
  259:    ?line L1 = queue:to_list(Q1a),
<a name="260"></a>  260:    ?line L2 = queue:to_list(Q2a),
  261:    ?line {Q1b, Q2b} = queue:split(Len, Q3b),
  262:    ?line L1 = queue:to_list(Q1b),
  263:    ?line L2 = queue:to_list(Q2b),
  264:    ?line Len = queue:len(Q1b),
  265:    ?line Len = queue:len(Q2b),
  266:    ?line Len2 = queue:len(Q3b),
  267:    ?line Q1r = queue:reverse(Q1),
  268:    ?line Q2r = queue:reverse(Q2),
  269:    ?line Q1ar = queue:reverse(Q1a),
<a name="270"></a>  270:    ?line Q2ar = queue:reverse(Q2a),
  271:    ?line Q1br = queue:reverse(Q1b),
  272:    ?line Q2br = queue:reverse(Q2b),
  273:    ?line Q3br = queue:reverse(Q3b),
  274:    ?line L1r = queue:to_list(Q1r),
  275:    ?line L1r = queue:to_list(Q1ar),
  276:    ?line L1r = queue:to_list(Q1br),
  277:    ?line L2r = queue:to_list(Q2r),
  278:    ?line L2r = queue:to_list(Q2ar),
  279:    ?line L2r = queue:to_list(Q2br),
<a name="280"></a>  280:    ?line L3r = queue:to_list(Q3br),
  281:    ?line Len = queue:len(Q1br),
  282:    ?line Len = queue:len(Q2br),
  283:    ?line Len2 = queue:len(Q3br),
  284:    ok.
  285:
<a name=error>  286:<b>error</b></a>(doc) -&gt;
  287:    "Test queue errors";
<a name=error>  288:<b>error</b></a>(suite) -&gt;
  289:    [];
<a name=error><a name="290"></a>  290:<b>error</b></a>(Config) when list(Config) -&gt;
  291:    ?line {'EXIT',{badarg,_}} = (catch queue:in(1, illegal_queue)),
  292:    ?line {'EXIT',{badarg,_}} = (catch queue:out(illegal_queue)),
  293:    ?line {'EXIT',{badarg,_}} = (catch queue:in_r(1, illegal_queue)),
  294:    ?line {'EXIT',{badarg,_}} = (catch queue:out_r(illegal_queue)),
  295:    ?line {'EXIT',{badarg,_}} = (catch queue:to_list(illegal_queue)),
  296:    %%
  297:    ?line {'EXIT',{badarg,_}} = (catch queue:from_list(no_list)),
  298:    ?line {'EXIT',{badarg,_}} = (catch queue:is_empty(no_queue)),
  299:    ?line {'EXIT',{badarg,_}} = (catch queue:len(no_queue)),
<a name="300"></a>  300:    %%
  301:    ?line {'EXIT',{badarg,_}} = (catch queue:cons(1, no_queue)),
  302:    ?line {'EXIT',{badarg,_}} = (catch queue:head(no_queue)),
  303:    ?line {'EXIT',{badarg,_}} = (catch queue:tail(no_queue)),
  304:    %%
  305:    ?line {'EXIT',{badarg,_}} = (catch queue:snoc(no_queue, 1)),
  306:    ?line {'EXIT',{badarg,_}} = (catch queue:last(no_queue)),
  307:    ?line {'EXIT',{badarg,_}} = (catch queue:daeh(no_queue)),
  308:    ?line {'EXIT',{badarg,_}} = (catch queue:lait(no_queue)),
  309:    ?line {'EXIT',{badarg,_}} = (catch queue:init(no_queue)),
<a name="310"></a>  310:    %%
  311:    ?line {'EXIT',{badarg,_}} = (catch queue:reverse(no_queue)),
  312:    ?line {'EXIT',{badarg,_}} = (catch queue:join(queue:new(), no_queue)),
  313:    ?line {'EXIT',{badarg,_}} = (catch queue:join(no_queue, queue:new())),
  314:    ?line {'EXIT',{badarg,_}} = (catch queue:split(17, no_queue)),
  315:    ?line {'EXIT',{badarg,_}} = (catch queue:head(no_queue)),
  316:    %%
  317:    ?line Q0 = queue:new(),
  318:    ?line {'EXIT',{badarg,_}} = (catch queue:split(1, Q0)),
  319:    ?line {'EXIT',{badarg,_}} = (catch queue:split(2, queue:snoc(Q0, 1))),
<a name="320"></a>  320:    ok.
</pre>
<hr size=1><i>The transformation of this file (321 lines) took 0.00 seconds</i><br>
</body>
</html>
