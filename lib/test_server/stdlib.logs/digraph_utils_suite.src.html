<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/digraph_utils_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 2000, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:<i>%%</i>
   19:-<b>module</b>(digraph_utils_SUITE).
<a name="20"></a>   20:
   21:-<b>include</b>("test_server.hrl").
   22:
   23:-<b>export</b>([all/1]).
   24:
   25:-<b>export</b>([simple/1, loop/1, isolated/1, topsort/1, subgraph/1, condensation/1]).
   26:
   27:
   28:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
   29:
<a name=all><a name="30"></a>   30:<b>all</b></a>(suite) -&gt; {req, [stdlib], [simple, loop, isolated, topsort, 
   31:			       subgraph, condensation]}.
   32:
   33:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
   34:
<a name=simple>   35:<b>simple</b></a>(doc) -&gt; [];
<a name=simple>   36:<b>simple</b></a>(suite) -&gt; [];
<a name=simple>   37:<b>simple</b></a>(Config) when list(Config) -&gt;
   38:    ?line G = digraph:new(),
   39:    ?line add_vertices(G, [a]),
<a name="40"></a>   40:    ?line add_edges(G, [{b,c},{b,d},{e,f},{f,g},{g,e},{h,h},{i,i},{i,j}]),
   41:    ?line 10 = length(digraph_utils:postorder(G)),
   42:    ?line 10 = length(digraph_utils:preorder(G)),
   43:    ?line ok = evall(digraph_utils:components(G), 
   44:		     [[a],[b,c,d],[e,f,g],[h],[i,j]]),
   45:    ?line ok = evall(digraph_utils:strong_components(G), 
   46:	       [[a],[b],[c],[d],[e,f,g],[h],[i],[j]]),
   47:    ?line ok = evall(digraph_utils:cyclic_strong_components(G), 
   48:		     [[e,f,g],[h],[i]]),
   49:    ?line true = path(G, e, e),
<a name="50"></a>   50:    ?line false = path(G, e, j),
   51:    ?line false = path(G, a, a),
   52:    ?line false = digraph_utils:topsort(G),
   53:    ?line false = digraph_utils:is_acyclic(G),
   54:    ?line ok = eval(digraph_utils:loop_vertices(G), [h,i]),
   55:    ?line ok = eval(digraph_utils:reaching([e], G), [e,f,g]),
   56:    ?line ok = eval(digraph_utils:reaching_neighbours([e], G), [e,f,g]),
   57:    ?line ok = eval(digraph_utils:reachable([e], G), [e,f,g]),
   58:    ?line ok = eval(digraph_utils:reachable_neighbours([e], G), [e,f,g]),
   59:    ?line ok = eval(digraph_utils:reaching([b], G), [b]),
<a name="60"></a>   60:    ?line ok = eval(digraph_utils:reaching_neighbours([b], G), []),
   61:    ?line ok = eval(digraph_utils:reachable([b], G), [b,c,d]),
   62:    ?line ok = eval(digraph_utils:reachable_neighbours([b], G), [c,d]),
   63:    ?line ok = eval(digraph_utils:reaching([h], G), [h]),
   64:    ?line ok = eval(digraph_utils:reaching_neighbours([h], G), [h]),
   65:    ?line ok = eval(digraph_utils:reachable([h], G), [h]),
   66:    ?line ok = eval(digraph_utils:reachable_neighbours([h], G), [h]),
   67:    ?line ok = eval(digraph_utils:reachable([e,f], G), [e,f,g]),
   68:    ?line ok = eval(digraph_utils:reachable_neighbours([e,f], G), [e,f,g]),
   69:    ?line ok = eval(digraph_utils:reachable([h,h,h], G), [h]),
<a name="70"></a>   70:    ?line true = digraph:delete(G),
   71:    ok.
   72:
<a name=loop>   73:<b>loop</b></a>(doc) -&gt; [];
<a name=loop>   74:<b>loop</b></a>(suite) -&gt; [];
<a name=loop>   75:<b>loop</b></a>(Config) when list(Config) -&gt;
   76:    ?line G = digraph:new(),
   77:    ?line add_vertices(G, [a,b]),
   78:    ?line add_edges(G, [{a,a},{b,b}]),
   79:    ?line ok = evall(digraph_utils:components(G), [[a],[b]]),
<a name="80"></a>   80:    ?line ok = evall(digraph_utils:strong_components(G), [[a],[b]]),
   81:    ?line ok = evall(digraph_utils:cyclic_strong_components(G), [[a],[b]]),
   82:    ?line [_,_] = digraph_utils:topsort(G),
   83:    ?line false = digraph_utils:is_acyclic(G),	
   84:    ?line ok = eval(digraph_utils:loop_vertices(G), [a,b]),
   85:    ?line [_,_] = digraph_utils:preorder(G),
   86:    ?line [_,_] = digraph_utils:postorder(G),
   87:    ?line ok = eval(digraph_utils:reaching([b], G), [b]),
   88:    ?line ok = eval(digraph_utils:reaching_neighbours([b], G), [b]),
   89:    ?line ok = eval(digraph_utils:reachable([b], G), [b]),
<a name="90"></a>   90:    ?line ok = eval(digraph_utils:reachable_neighbours([b], G), [b]),
   91:    ?line true = path(G, a, a),
   92:    ?line true = digraph:delete(G),
   93:    ok.
   94:
<a name=isolated>   95:<b>isolated</b></a>(doc) -&gt; [];
<a name=isolated>   96:<b>isolated</b></a>(suite) -&gt; [];
<a name=isolated>   97:<b>isolated</b></a>(Config) when list(Config) -&gt;
   98:    ?line G = digraph:new(),
   99:    ?line add_vertices(G, [a,b]),
<a name="100"></a>  100:    ?line ok = evall(digraph_utils:components(G), [[a],[b]]),
  101:    ?line ok = evall(digraph_utils:strong_components(G), [[a],[b]]),
  102:    ?line ok = evall(digraph_utils:cyclic_strong_components(G), []),
  103:    ?line [_,_] = digraph_utils:topsort(G),
  104:    ?line true = digraph_utils:is_acyclic(G),	
  105:    ?line ok = eval(digraph_utils:loop_vertices(G), []),
  106:    ?line [_,_] = digraph_utils:preorder(G),
  107:    ?line [_,_] = digraph_utils:postorder(G),
  108:    ?line ok = eval(digraph_utils:reaching([b], G), [b]),
  109:    ?line ok = eval(digraph_utils:reaching_neighbours([b], G), []),
<a name="110"></a>  110:    ?line ok = eval(digraph_utils:reachable([b], G), [b]),
  111:    ?line ok = eval(digraph_utils:reachable_neighbours([b], G), []),
  112:    ?line false = path(G, a, a),
  113:    ?line true = digraph:delete(G),
  114:    ok.
  115:
<a name=topsort>  116:<b>topsort</b></a>(doc) -&gt; [];
<a name=topsort>  117:<b>topsort</b></a>(suite) -&gt; [];
<a name=topsort>  118:<b>topsort</b></a>(Config) when list(Config) -&gt;
  119:    ?line G = digraph:new(),
<a name="120"></a>  120:    ?line add_edges(G, [{a,b},{b,c},{c,d},{d,e},{e,f}]),
  121:    ?line ok = eval(digraph_utils:topsort(G), [a,b,c,d,e,f]),
  122:    ?line true = digraph:delete(G),
  123:    ok.
  124:
<a name=subgraph>  125:<b>subgraph</b></a>(doc) -&gt; [];
<a name=subgraph>  126:<b>subgraph</b></a>(suite) -&gt; [];
<a name=subgraph>  127:<b>subgraph</b></a>(Config) when list(Config) -&gt;
  128:    ?line G = digraph:new([acyclic]),
  129:    ?line add_edges(G, [{b,c},{b,d},{e,f},{f,fg,fgl,g},{f,fg2,fgl2,g},{g,e},
<a name="130"></a>  130:			{h,h},{i,i},{i,j}]),
  131:    ?line add_vertices(G, [{b,bl},{f,fl}]),
  132:    ?line SG = digraph_utils:subgraph(G, [u1,b,c,u2,f,g,i,u3]),
  133:    ?line [b,c,f,g,i] = lists:sort(digraph:vertices(SG)),
  134:    ?line {b,bl} = digraph:vertex(SG, b),
  135:    ?line {c,[]} = digraph:vertex(SG, c),
  136:    ?line {fg,f,g,fgl} = digraph:edge(SG, fg),
  137:    ?line {fg2,f,g,fgl2} = digraph:edge(SG, fg2),
  138:    ?line {_, {_, acyclic}} = lists:keysearch(cyclicity, 1, digraph:info(SG)),
  139:    ?line true = digraph:delete(SG),
<a name="140"></a>  140:
  141:    ?line SG1 = digraph_utils:subgraph(G, [f, g, h], 
  142:				       [{type, []}, {keep_labels, false}]),
  143:    ?line [f,g,h] = lists:sort(digraph:vertices(SG1)),
  144:    ?line {f,[]} = digraph:vertex(SG1, f),
  145:    ?line {fg,f,g,[]} = digraph:edge(SG1, fg),
  146:    ?line {_, {_, cyclic}} = lists:keysearch(cyclicity, 1, digraph:info(SG1)),
  147:    ?line true = digraph:delete(SG1),
  148:    
  149:    ?line SG2 = digraph_utils:subgraph(G, [f, g, h], 
<a name="150"></a>  150:				       [{type, [acyclic]}, 
  151:					{keep_labels, true}]),
  152:    ?line [f,g,h] = lists:sort(digraph:vertices(SG2)),
  153:    ?line {f,fl} = digraph:vertex(SG2, f),
  154:    ?line {fg,f,g,fgl} = digraph:edge(SG2, fg),
  155:    ?line {_, {_, acyclic}} = lists:keysearch(cyclicity, 1, digraph:info(SG2)),
  156:    ?line true = digraph:delete(SG2),
  157:    
  158:    ?line {error, _} = digraph_utils:subgraph(G, [f], [{invalid, opt}]),
  159:    ?line {error, _} = 
<a name="160"></a>  160:	digraph_utils:subgraph(G, [f], [{keep_labels, not_Bool}]),
  161:    ?line {error, _} = digraph_utils:subgraph(G, [f], [{type, not_type}]),
  162:    ?line {error, _} = digraph_utils:subgraph(G, [f], [{type, [not_type]}]),
  163:
  164:    ?line true = digraph:delete(G),
  165:
  166:    ok.
  167:
<a name=condensation>  168:<b>condensation</b></a>(doc) -&gt; [];
<a name=condensation>  169:<b>condensation</b></a>(suite) -&gt; [];
<a name=condensation><a name="170"></a>  170:<b>condensation</b></a>(Config) when list(Config) -&gt;
  171:    ?line G = digraph:new([]),
  172:    ?line add_edges(G, [{b,c},{b,d},{e,f},{f,fg,fgl,g},{f,fg2,fgl2,g},{g,e},
  173:			{h,h},{j,i},{i,j}]),
  174:    ?line add_vertices(G, [q]),
  175:    ?line CG = digraph_utils:condensation(G),
  176:    ?line Vs = sort_2(digraph:vertices(CG)),
  177:    ?line [[b],[c],[d],[e,f,g],[h],[i,j],[q]] = Vs,
  178:    ?line Fun = fun(E) -&gt; 
  179:			{_E, V1, V2, _L} = digraph:edge(CG, E), 
<a name="180"></a>  180:			{lists:sort(V1), lists:sort(V2)} 
  181:		end,
  182:    ?line Es = lists:map(Fun, digraph:edges(CG)),
  183:    ?line [{[b],[c]},{[b],[d]},{[e,f,g],[e,f,g]},{[h],[h]},{[i,j],[i,j]}] =
  184:	lists:sort(Es),
  185:    ?line true = digraph:delete(CG),
  186:    ?line true = digraph:delete(G),
  187:    ok.
  188:
  189:<i>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</i>
<a name="190"></a>  190:
<a name=sort_2>  191:<b>sort_2</b></a>(L) -&gt;
  192:    lists:sort(lists:map(fun(V) -&gt; lists:sort(V) end, L)).
  193:
<a name=path>  194:<b>path</b></a>(G, V1, V2) -&gt;
  195:    digraph:get_path(G, V1, V2) /= false.
  196:
<a name=add_vertices>  197:<b>add_vertices</b></a>(G, Vs) -&gt;
  198:    lists:foreach(fun({V, Label}) -&gt; digraph:add_vertex(G, V, Label);
  199:		     (V) -&gt; digraph:add_vertex(G, V) 
<a name="200"></a>  200:		  end, Vs).
  201:
<a name=add_edges>  202:<b>add_edges</b></a>(G, L) -&gt;
  203:    Fun = fun({From, To}) -&gt; 
  204:		  digraph:add_vertex(G, From),
  205:		  digraph:add_vertex(G, To),
  206:		  digraph:add_edge(G, From, To);
  207:	     ({From, Edge, Label, To}) -&gt;
  208:		  digraph:add_vertex(G, From),
  209:		  digraph:add_vertex(G, To),
<a name="210"></a>  210:		  digraph:add_edge(G, Edge, From, To, Label)
  211:	  end,
  212:    lists:foreach(Fun, L).
  213:
<a name=eval>  214:<b>eval</b></a>(L, E) -&gt;
  215:    Expected = lists:sort(E),
  216:    Got = lists:sort(L),
  217:    if 
  218:	Expected == Got -&gt;
  219:	    ok;
<a name="220"></a>  220:	true -&gt;
  221:	    not_ok
  222:    end.
  223:
<a name=evall>  224:<b>evall</b></a>(L, E) -&gt;
  225:    F = fun(L1) -&gt; lists:sort(L1) end,
  226:    Fun = fun(LL) -&gt; F(lists:map(F, LL)) end,
  227:    
  228:    Expected = Fun(E),
  229:    Got = Fun(L),
<a name="230"></a>  230:    if 
  231:	Expected == Got -&gt;
  232:	    ok;
  233:	true -&gt;
  234:	    not_ok
  235:    end.
</pre>
<hr size=1><i>The transformation of this file (236 lines) took 0.00 seconds</i><br>
</body>
</html>
