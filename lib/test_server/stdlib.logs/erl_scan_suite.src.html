<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head><title>/usr/home/jlouis/hacking/test_server/stdlib_test/erl_scan_SUITE.erl</title></head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
    1:<i>%% ``The contents of this file are subject to the Erlang Public License,</i>
    2:<i>%% Version 1.1, (the "License"); you may not use this file except in</i>
    3:<i>%% compliance with the License. You should have received a copy of the</i>
    4:<i>%% Erlang Public License along with this software. If not, it can be</i>
    5:<i>%% retrieved via the world wide web at http://www.erlang.org/.</i>
    6:<i>%% </i>
    7:<i>%% Software distributed under the License is distributed on an "AS IS"</i>
    8:<i>%% basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</i>
    9:<i>%% the License for the specific language governing rights and limitations</i>
<a name="10"></a>   10:<i>%% under the License.</i>
   11:<i>%% </i>
   12:<i>%% The Initial Developer of the Original Code is Ericsson Utvecklings AB.</i>
   13:<i>%% Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings</i>
   14:<i>%% AB. All Rights Reserved.''</i>
   15:<i>%% </i>
   16:<i>%%     $Id$</i>
   17:<i>%%</i>
   18:-<b>module</b>(erl_scan_SUITE).
   19:-<b>export</b>([all/1]).
<a name="20"></a>   20:
   21:-<b>export</b>([error/1, error_1/1, error_2/1, iso88591/1]).
   22:
   23:-<b>export</b>([init_per_testcase/2, fin_per_testcase/2]).
   24:
   25:-<b>import</b>(lists, [nth/2,flatten/1]).
   26:-<b>import</b>(io_lib, [print/1]).
   27:
   28:
   29:-<b>include</b>("test_server.hrl").
<a name="30"></a>   30:
   31:<i>% Default timetrap timeout (set in init_per_testcase).</i>
   32:-<b>define</b>(default_timeout, ?t:minutes(1)).
   33:
<a name=init_per_testcase>   34:<b>init_per_testcase</b></a>(Case, Config) -&gt;
   35:    ?line Dog = ?t:timetrap(?default_timeout),
   36:    [{watchdog, Dog} | Config].
<a name=fin_per_testcase>   37:<b>fin_per_testcase</b></a>(Case, Config) -&gt;
   38:    Dog = ?config(watchdog, Config),
   39:    test_server:timetrap_cancel(Dog),
<a name="40"></a>   40:    ok.
   41:
<a name=all>   42:<b>all</b></a>(doc) -&gt;
   43:    ["Test cases for the 'erl_scan' module."];
<a name=all>   44:<b>all</b></a>(suite) -&gt;
   45:    [error,iso88591].
   46:
<a name=error>   47:<b>error</b></a>(doc) -&gt;
   48:    ["Error cases"];
<a name=error>   49:<b>error</b></a>(suite) -&gt;
<a name="50"></a>   50:    [error_1, error_2].
   51:
<a name=error_1>   52:<b>error_1</b></a>(doc) -&gt;
   53:    ["(OTP-2347)"];
<a name=error_1>   54:<b>error_1</b></a>(suite) -&gt;
   55:    [];
<a name=error_1>   56:<b>error_1</b></a>(Config) when list(Config) -&gt;
   57:    ?line {error, _, _} = erl_scan:string("'a"),
   58:    ok.
   59:
<a name=error_2><a name="60"></a>   60:<b>error_2</b></a>(doc) -&gt;
   61:    ["Checks that format_error works on the error cases."];
<a name=error_2>   62:<b>error_2</b></a>(suite) -&gt;
   63:    [];
<a name=error_2>   64:<b>error_2</b></a>(Config) when list(Config) -&gt;
   65:    ?line lists:foreach(fun check/1, error_cases()),
   66:    ok.
   67:
<a name=error_cases>   68:<b>error_cases</b></a>() -&gt;
   69:    ["'a",
<a name="70"></a>   70:     "\"a",
   71:     "'\\",
   72:     "\"\\",
   73:     "$",
   74:     "$\\",
   75:     "2.3e",
   76:     "2.3e-",
   77:     "91#9"
   78:].
   79:
<a name=assert_type><a name="80"></a>   80:<b>assert_type</b></a>(N, integer) when integer(N) -&gt;
   81:    ok;
<a name=assert_type>   82:<b>assert_type</b></a>(N, atom) when atom(N) -&gt;
   83:    ok.
   84:    
<a name=check>   85:<b>check</b></a>(String) -&gt;
   86:    Error = erl_scan:string(String),
   87:    check_error(Error, erl_scan).
   88:
   89:<i>%%% (This should be useful for all format_error functions.)</i>
<a name=check_error><a name="90"></a>   90:<b>check_error</b></a>({error, Info, EndLine}, Module0) -&gt;
   91:    ?line {ErrorLine, Module, Desc} = Info,
   92:    ?line true = (Module == Module0),
   93:    ?line assert_type(EndLine, integer),
   94:    ?line assert_type(ErrorLine, integer),
   95:    ?line true = (ErrorLine =&lt; EndLine),
   96:    ?line String = lists:flatten(Module0:format_error(Desc)),
   97:    ?line true = io_lib:printable_list(String).
   98:
<a name=iso88591>   99:<b>iso88591</b></a>(doc) -&gt; ["Tests the support for ISO-8859-1 i.e Latin-1"];
<a name=iso88591><a name="100"></a>  100:<b>iso88591</b></a>(suite) -&gt; [];
<a name=iso88591>  101:<b>iso88591</b></a>(Config) when list(Config) -&gt;
  102:    ?line ok =
  103:     case catch begin
  104:		   %% Some atom and variable names
  105:		   V1s = [$Á,$á,$é,$ë],
  106:		   V2s = [$N,$ä,$r],
  107:		   A1s = [$h,$ä,$r],
  108:		   A2s = [$ö,$r,$e],
  109:		   %% Test parsing atom and variable characters.
<a name="110"></a>  110:		   {ok,Ts1,_} = erl_scan:string(V1s ++ " " ++ V2s ++
  111:					       "\327" ++
  112:					       A1s ++ " " ++ A2s),
  113:		   V1s = atom_to_list(element(3, nth(1, Ts1))),
  114:		   V2s = atom_to_list(element(3, nth(2, Ts1))),
  115:		   A1s = atom_to_list(element(3, nth(4, Ts1))),
  116:		   A2s = atom_to_list(element(3, nth(5, Ts1))),
  117:		   %% Test printing atoms
  118:		   A1s = flatten(print(element(3, nth(4, Ts1)))),
  119:		   A2s = flatten(print(element(3, nth(5, Ts1)))),
<a name="120"></a>  120:		   %% Test parsing and printing strings.
  121:		   S1 = V1s ++ "\327" ++ A1s ++ "\250" ++ A2s,
  122:		   S1s = "\"" ++ S1 ++ "\"",
  123:		   {ok,Ts2,_} = erl_scan:string(S1s),
  124:		   S1 = element(3, nth(1, Ts2)),
  125:		   S1s = flatten(print(element(3, nth(1, Ts2)))),
  126:		   ok				%It all worked
  127:	       end of
  128:	{'EXIT',R} -&gt;				%Something went wrong!
  129:	     {error,R};
<a name="130"></a>  130:	ok -&gt; ok				%Aok
  131:    end.
  132:
  133:
</pre>
<hr size=1><i>The transformation of this file (134 lines) took 0.01 seconds</i><br>
</body>
</html>
