-module(metainfo_test).
-include_lib("eunit/include/eunit.hrl").

parse_fail_test() ->
    {could_not_read_file, enoent} = metainfo:parse("test_data/nonexisting").

parse_test() ->
    D1 = read_torrent_file(),
    D1 = real_data().

get_piece_length_test() ->
    {ok, T} = real_data(),
    32768 = metainfo:get_piece_length(T).

get_pieces_test() ->
    {ok, T} = read_torrent_file(),
    P1 = real_data_pieces(),
    P1 = metainfo:get_pieces(T).

get_url_test() ->
    {ok, T} = read_torrent_file(),
    "http://test:6969/announce" = metainfo:get_url(T).

get_infohash_test() ->
    {ok, T} = read_torrent_file(),
    "586CCC8A3714AB39F73D373F8BFD628DEC224C3" = metainfo:get_infohash(T).

%% -------------------------------------------------------------------
read_torrent_file() ->
    metainfo:parse("test_data/test.torrent").

%% -------------------------------------------------------------------
real_data() -> {ok, {dict,[{{string,"info"},
    {dict,[{{string,"pieces"}, {string,[65, 7, 196, 20, 51, 22, 120,
    93, 174, 55, 243, 209, 210, 73, 104, 172, 178, 58, 193, 162, 136,
    8, 206, 239, 194, 216, 68, 24, 240, 200, 98, 159, 126, 195, 130,
    95, 230, 36, 62, 193, 161, 182, 90, 129, 227, 249, 140, 47, 110,
    177, 38, 187, 214, 127, 196, 24, 14, 226, 197, 160, 142, 33, 38,
    11, 121, 102, 75, 211, 9, 182, 225, 82, 217, 112, 6, 55, 216, 194,
    205, 43, 86, 224, 198, 61, 134, 44, 32, 227, 65, 218, 117, 187,
    51, 165, 243, 146, 197, 138, 200, 217, 67, 52, 7, 117, 67, 57, 85,
    153, 141, 138, 245, 14, 34, 205, 253, 131, 98, 56, 197, 44, 248,
    85, 13, 118, 239, 121, 158, 191, 136, 92, 0, 151, 191, 155, 109,
    162, 13, 187, 116, 107, 35, 188, 156, 234, 129, 196, 98, 36, 253,
    88, 128, 71, 235, 176, 133, 55, 244, 14, 84, 5, 170, 17, 211, 231,
    81, 106, 160, 85, 221, 9, 154, 202, 1, 57, 33, 22, 109, 2, 248,
    52, 22, 125, 10, 14, 246, 220, 14, 148, 129, 160, 65, 7, 102, 9,
    180, 231, 59, 161, 124, 207, 171, 58, 116, 65, 4, 41, 79, 235, 4,
    150, 216, 31, 199, 251, 140, 7, 84, 228, 94, 51, 91, 157, 186, 80,
    183, 238, 89, 243, 74, 56, 168, 204, 129, 32, 56, 185, 161, 100,
    143, 6, 93, 102, 195, 221, 251, 88, 184, 92, 166, 88, 227, 186,
    205, 117, 49, 234, 212, 191, 199, 20, 90, 238, 254, 223, 153, 117,
    74, 216, 239, 26, 248, 25, 210, 108, 20, 58, 222, 118, 221, 13,
    93, 247, 96, 53, 62, 189, 137, 196, 125, 36, 71, 122, 203, 163,
    26, 164, 126, 139, 7, 86, 131, 253, 2, 207, 78, 72, 203, 187, 247,
    135, 10, 123, 246, 108, 163, 114, 142, 42, 126, 22]}},
    {{string,"piece length"},{integer,32768}},
    {{string,"name"},{string,"fasc2a.ps.gz"}},
    {{string,"length"},{integer,521664}}]}},
			   {{string,"creation date"}, {integer,1177100547}},
    {{string,"announce"},{string,"http://test:6969/announce"}}]}}.

real_data_pieces() ->
 [<<131,253,2,207,78,72,203,187,247,135,10,123,246,108,163,114,142,42,126,22>>,
 <<93,247,96,53,62,189,137,196,125,36,71,122,203,163,26,164,126,139,7,86>>,
 <<90,238,254,223,153,117,74,216,239,26,248,25,210,108,20,58,222,118,221,13>>,
 <<93,102,195,221,251,88,184,92,166,88,227,186,205,117,49,234,212,191,199,20>>,
 <<91,157,186,80,183,238,89,243,74,56,168,204,129,32,56,185,161,100,143,6>>,
 <<171,58,116,65,4,41,79,235,4,150,216,31,199,251,140,7,84,228,94,51>>,
 <<22,125,10,14,246,220,14,148,129,160,65,7,102,9,180,231,59,161,124,207>>,
 <<170,17,211,231,81,106,160,85,221,9,154,202,1,57,33,22,109,2,248,52>>,
 <<35,188,156,234,129,196,98,36,253,88,128,71,235,176,133,55,244,14,84,5>>,
 <<248,85,13,118,239,121,158,191,136,92,0,151,191,155,109,162,13,187,116,107>>,
 <<67,52,7,117,67,57,85,153,141,138,245,14,34,205,253,131,98,56,197,44>>,
 <<86,224,198,61,134,44,32,227,65,218,117,187,51,165,243,146,197,138,200,217>>,
 <<142,33,38,11,121,102,75,211,9,182,225,82,217,112,6,55,216,194,205,43>>,
 <<161,182,90,129,227,249,140,47,110,177,38,187,214,127,196,24,14,226,197,160>>,
 <<136,8,206,239,194,216,68,24,240,200,98,159,126,195,130,95,230,36,62,193>>,
 <<65,7,196,20,51,22,120,93,174,55,243,209,210,73,104,172,178,58,193,162>>].

